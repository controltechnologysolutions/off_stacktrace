"use strict";function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _toConsumableArray(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function initPersistence(persistence){if(persistence.isImmutable)return persistence;persistence.isImmutable=function(a){return"id"==a},persistence.defineProp=function(a,b,c,d){"function"==typeof a.__defineSetter__&&"function"==typeof a.__defineGetter__?(a.__defineSetter__(b,function(a){c(a)}),a.__defineGetter__(b,function(){return d()})):Object.defineProperty(a,b,{get:d,set:function(a){c(a)},enumerable:!0,configurable:!0})},persistence.set=function(a,b,c){if(persistence.isImmutable(b))throw new Error("immutable field: "+b);a[b]=c},persistence.get=function(a,b){return 1==arguments.length?a:a[b]},function(){function b(a){return t[a]}function c(a){this.trackedObjects={},this.objectsToRemove={},this.objectsRemoved=[],this.globalPropertyListeners={},this.queryCollectionCache={},this.conn=a}function d(c){function e(b,d,e){var g=a.getArgs(arguments,[{name:"session",optional:!0,check:persistence.isSession,defaultValue:persistence},{name:"obj",optional:!0,check:function(a){return a},defaultValue:{}}]);if(h.isMixin)throw new Error("Cannot instantiate mixin");b=g.session,d=g.obj;var i=this;this.id=d.id||persistence.createUUID(),this._new=!0,this._type=c,this._dirtyProperties={},this._data={},this._data_obj={},this._session=b||persistence,this.subscribers={};for(var j in h.fields)!function(){if(h.fields.hasOwnProperty(j)){var a=j;persistence.defineProp(i,a,function(c){var d=i._data[a];(d!==c||d&&c&&d.getTime&&c.getTime)&&(i._data[a]=c,i._dirtyProperties[a]=d,i.triggerEvent("set",i,a,c),i.triggerEvent("change",i,a,c),b.propertyChanged(i,a,d,c))},function(){return i._data[a]}),i._data[j]=f(h.fields[j])}}();for(var k in h.hasOne)h.hasOne.hasOwnProperty(k)&&!function(){var a=k,c=h.hasOne[k].type.meta.isMixin?a+"_class":null;persistence.defineProp(i,a,function(d){var e=i._data[a],f=i._data_obj[a]||b.trackedObjects[i._data[a]];if(null==d?(i._data[a]=null,i._data_obj[a]=void 0,c&&(i[c]="")):d.id?(i._data[a]=d.id,i._data_obj[a]=d,c&&(i[c]=d._type),b.add(d),b.add(i)):i._data[a]=d,i._dirtyProperties[a]=e,i.triggerEvent("set",i,a,d),i.triggerEvent("change",i,a,d),h.hasOne[a].inverseProperty){var g=i[a];if(g){var j=g[h.hasOne[a].inverseProperty];j.list&&j._filter&&j.triggerEvent("change",i,a,d)}if(f){var j=f[h.hasOne[a].inverseProperty];j.list&&j._filter&&j.triggerEvent("change",i,a,d)}}},function(){if(i._data[a]){if(void 0!==i._data_obj[a])return i._data_obj[a];if(i._data[a]&&b.trackedObjects[i._data[a]])return i._data_obj[a]=b.trackedObjects[i._data[a]],i._data_obj[a];throw new Error("Property '"+a+"' of '"+h.name+"' with id: "+i._data[a]+" not fetched, either prefetch it or fetch it manually.")}return null})}();for(var k in h.hasMany)h.hasMany.hasOwnProperty(k)&&!function(){var a=k;h.hasMany[a].manyToMany?persistence.defineProp(i,a,function(b){if(!b||!b._items)throw new Error("Not yet supported.");for(var c=b._items,d=0;d<c.length;d++)persistence.get(i,a).add(c[d])},function(){if(i._data[a])return i._data[a];var c=h.hasMany[a],d=c.type.meta,e=d.hasMany[c.inverseProperty],f=c.mixin?c.mixin.meta.name:h.name,g=e.mixin?e.mixin.meta.name:d.name,j=new persistence.ManyToManyDbQueryCollection(b,d.name);return j.initManyToMany(i,a),j._manyToManyFetch={table:c.tableName,prop:f+"_"+a,inverseProp:g+"_"+c.inverseProperty,id:i.id},i._data[a]=j,b.uniqueQueryCollection(j)}):persistence.defineProp(i,a,function(b){if(!b||!b._items)throw new Error("Not yet supported.");for(var c=b._items,d=0;d<c.length;d++)persistence.get(i,a).add(c[d])},function(){if(i._data[a])return i._data[a];var c=b.uniqueQueryCollection(new persistence.DbQueryCollection(b,h.hasMany[a].type.meta.name).filter(h.hasMany[a].inverseProperty,"=",i));return i._data[a]=c,c})}();this.initialize&&this.initialize();for(var l in d)d.hasOwnProperty(l)&&"id"!==l&&persistence.set(i,l,d[l])}function g(a,c,d,e){var f=(a._session,[]),h=b(a._type),i=h.fields;for(var j in d)d.hasOwnProperty(j)&&f.push(j);var k=[],l=[];f.forEach(function(a){d[a]!==!0||h.hasMany[a]?l.push(a):k.push(a)});var m=a._data,n={};k.forEach(function(b){"id"===b?n.id=a.id:h.hasOne[b]?n[b]=m[b]?{id:m[b]}:null:n[b]=persistence.entityValToJson(m[b],i[b])}),f=l.slice(),persistence.asyncForEach(f,function(b,e){h.hasOne[b]?a.fetch(c,b,function(a){a?g(a,c,d[b],function(a){n[b]=a,e()}):(n[b]=null,e())}):h.hasMany[b]&&persistence.get(a,b).list(function(a){n[b]=[],persistence.asyncForEach(a,function(e,f){var e=a.pop();d[b]===!0?(n[b].push({id:e.id}),f()):g(e,c,d[b],function(a){n[b].push(a),f()})},e)})},function(){e(n)})}if(u[c])return u[c];var h=t[c];e.prototype=new j,e.meta=h,e.prototype.equals=function(a){return this.id==a.id},e.prototype.toJSON=function(){var a={id:this.id};for(var b in this._data)this._data.hasOwnProperty(b)&&("object"==_typeof(this._data[b])&&null!=this._data[b]?void 0!=this._data[b].toJSON&&(a[b]=this._data[b].toJSON()):a[b]=this._data[b]);return a},e.prototype.selectJSON=function(b,c,d){var e=this,f=a.getArgs(arguments,[{name:"tx",optional:!0,check:persistence.isTransaction,defaultValue:null},{name:"props",optional:!1},{name:"callback",optional:!1}]);if(b=f.tx,c=f.props,d=f.callback,!b)return void this._session.transaction(function(a){e.selectJSON(a,c,d)});var i={};c.forEach(function(a){for(var b=i,c=a.split("."),d=0;d<c.length;d++){var e=c[d];if(d===c.length-1)if("*"===e){b.id=!0;for(var f in h.fields)h.fields.hasOwnProperty(f)&&(b[f]=!0);for(var f in h.hasOne)h.hasOne.hasOwnProperty(f)&&(b[f]=!0);for(var f in h.hasMany)h.hasMany.hasOwnProperty(f)&&(b[f]=!0)}else if("["===e[0]){e=e.substring(1,e.length-1);var g=e.split(/,\s*/);g.forEach(function(a){b[a]=!0})}else b[e]=!0;else b[e]=b[e]||{},b=b[e]}}),g(this,b,i,d)},e.prototype.fetch=function(b,c,e){var f=a.getArgs(arguments,[{name:"tx",optional:!0,check:persistence.isTransaction,defaultValue:null},{name:"rel",optional:!1,check:a.hasType("string")},{name:"callback",optional:!1,check:a.isCallback()}]);b=f.tx,c=f.rel,e=f.callback;var g=this,i=this._session;if(!b)return void i.transaction(function(a){g.fetch(a,c,e)});if(this._data[c])if(this._data_obj[c])e&&e(this._data_obj[c]);else{var j=h.hasOne[c].type;j.meta.isMixin&&(j=d(this._data[c+"_class"])),j.load(i,b,this._data[c],function(a){g._data_obj[c]=a,e&&e(a)})}else e&&e(null)},e.prototype.markDirty=function(a){this._dirtyProperties[a]=!0},e.all=function(b){var d=a.getArgs(arguments,[{name:"session",optional:!0,check:persistence.isSession,defaultValue:persistence}]);return b=d.session,b.uniqueQueryCollection(new q(b,c))},e.fromSelectJSON=function(b,c,d,f){function g(a){a||(a=new e(b),d.id&&(a.id=d.id)),b.add(a);var g=[];for(var i in d)if(d.hasOwnProperty(i)){if("id"===i)continue;h.fields[i]?persistence.set(a,i,persistence.jsonToEntityVal(d[i],h.fields[i])):(h.hasOne[i]||h.hasMany[i])&&g.push(i)}persistence.asyncForEach(g,function(e,f){if(h.hasOne[e])h.hasOne[e].type.fromSelectJSON(b,c,d[e],function(b){persistence.set(a,e,b),f()});else if(h.hasMany[e]){var g=persistence.get(a,e),i=d[e].slice(0),j=h.hasMany[e].type;g.list(c,function(a){persistence.asyncForEach(i,function(d,e){j.fromSelectJSON(b,c,d,function(b){for(var c=0;c<a.length;c++)if(a[c].id===b.id)return void e();g.add(b),e()})},function(){f()})})}},function(){f(a)})}var i=a.getArgs(arguments,[{name:"session",optional:!0,check:persistence.isSession,defaultValue:persistence},{name:"tx",optional:!0,check:persistence.isTransaction,defaultValue:null},{name:"jsonObj",optional:!1},{name:"callback",optional:!1,check:a.isCallback()}]);return b=i.session,c=i.tx,d=i.jsonObj,f=i.callback,c?("string"==typeof d&&(d=JSON.parse(d)),d?void(d.id?e.load(b,c,d.id,g):g(new e(b))):void f(null)):void b.transaction(function(a){e.fromSelectJSON(b,a,d,f)})},e.load=function(b,c,d,f){var g=a.getArgs(arguments,[{name:"session",optional:!0,check:persistence.isSession,defaultValue:persistence},{name:"tx",optional:!0,check:persistence.isTransaction,defaultValue:null},{name:"id",optional:!1,check:a.hasType("string")},{name:"callback",optional:!0,check:a.isCallback(),defaultValue:function(){}}]);e.findBy(g.session,g.tx,"id",g.id,g.callback)},e.findBy=function(b,c,d,f,g){var h=a.getArgs(arguments,[{name:"session",optional:!0,check:persistence.isSession,defaultValue:persistence},{name:"tx",optional:!0,check:persistence.isTransaction,defaultValue:null},{name:"property",optional:!1,check:a.hasType("string")},{name:"value",optional:!1},{name:"callback",optional:!0,check:a.isCallback(),defaultValue:function(){}}]);return b=h.session,c=h.tx,d=h.property,f=h.value,g=h.callback,"id"===d&&f in b.trackedObjects?void g(b.trackedObjects[f]):c?void e.all(b).filter(d,"=",f).one(c,function(a){g(a)}):void b.transaction(function(a){e.findBy(b,a,d,f,g)})},e.index=function(a,b){var c=b||{};"string"==typeof a&&(a=[a]),c.columns=a,h.indexes.push(c)},e.hasMany=function(a,b,c){var d=b.meta;if(d.hasMany[c]){var f=h.name+"_"+a+"_"+d.name,g=d.name+"_"+c+"_"+h.name;f>g&&(f=g),h.hasMany[a]={type:b,inverseProperty:c,manyToMany:!0,tableName:f},d.hasMany[c]={type:e,inverseProperty:a,manyToMany:!0,tableName:f},delete h.hasOne[a],delete h.fields[a+"_class"]}else h.hasMany[a]={type:b,inverseProperty:c},d.hasOne[c]={type:e,inverseProperty:a},h.isMixin&&(d.fields[c+"_class"]=persistence.typeMapper?persistence.typeMapper.classNameType:"TEXT")},e.hasOne=function(a,b,c){h.hasOne[a]={type:b,inverseProperty:c},b.meta.isMixin&&(h.fields[a+"_class"]=persistence.typeMapper?persistence.typeMapper.classNameType:"TEXT")},e.is=function(a){var b=a.meta;if(!b.isMixin)throw new Error("not a mixin: "+a);a.meta.mixedIns=a.meta.mixedIns||[],a.meta.mixedIns.push(h);for(var c in b.fields)b.fields.hasOwnProperty(c)&&(h.fields[c]=b.fields[c]);for(var d in b.hasOne)b.hasOne.hasOwnProperty(d)&&(h.hasOne[d]=b.hasOne[d]);for(var d in b.hasMany)b.hasMany.hasOwnProperty(d)&&(b.hasMany[d].mixin=a,h.hasMany[d]=b.hasMany[d])};for(var i=persistence.entityDecoratorHooks,k=0;k<i.length;k++)i[k](e);return u[c]=e,e}function e(){if(persistence.typeMapper&&persistence.typeMapper.newUuid)return persistence.typeMapper.newUuid();for(var a=[],b="0123456789ABCDEF",c=0;c<32;c++)a[c]=b.substr(Math.floor(16*Math.random()),1);a[12]="4",a[16]=b.substr(3&a[16]|8,1);var d=a.join("");return d}function f(a){if(persistence.typeMapper&&persistence.typeMapper.defaultValue)return persistence.typeMapper.defaultValue(a);switch(a){case"TEXT":return"";case"BOOL":return!1;default:return a.indexOf("INT")!==-1?0:a.indexOf("CHAR")!==-1?"":null}}function g(a,b){for(var c=a.length,d=0;d<c;d++){var e=a[d];if(e.equals&&e.equals(b))return!0;if(e===b)return!0}return!1}function h(a,b){for(var c=a.length,d=0;d<c;d++){var e=a[d];if(e.equals&&e.equals(b))return void a.splice(d,1);if(e===b)return void a.splice(d,1)}}function i(a,b,c){this.obj=a,this.eventType=b,this.fn=c}function j(){this.subscribers={}}function k(){}function l(a,b){this.left=a,this.right=b}function m(a,b){this.left=a,this.right=b}function n(a,b,c){this.property=a,this.operator=b.toLowerCase(),this.value=c}function o(){}function p(a,b){this.init(a,b,p)}function q(a,b){this.init(a,b,q)}function r(a,b){this.init(a,b,persistence.ManyToManyDbQueryCollection),this._localAdded=[],this._localRemoved=[]}function s(a){this.init(persistence,null,s),this._items=a||[]}var t={},u={};persistence.getEntityMeta=function(){return t},persistence.trackedObjects={},persistence.objectsToRemove={},persistence.objectsRemoved=[],persistence.globalPropertyListeners={},persistence.queryCollectionCache={},persistence.getObjectsToRemove=function(){return this.objectsToRemove},persistence.getTrackedObjects=function(){return this.trackedObjects},persistence.entityDecoratorHooks=[],persistence.flushHooks=[],persistence.schemaSyncHooks=[],persistence.debug=!0,persistence.subscribeToGlobalPropertyListener=function(a,b,c){var d=b+"__"+c;if(d in this.globalPropertyListeners){for(var e=this.globalPropertyListeners[d],f=0;f<e.length;f++)if(e[f]===a)return;this.globalPropertyListeners[d].push(a)}else this.globalPropertyListeners[d]=[a]},persistence.unsubscribeFromGlobalPropertyListener=function(a,b,c){for(var d=b+"__"+c,e=this.globalPropertyListeners[d],f=0;f<e.length;f++)if(e[f]===a)return void e.splice(f,1)},persistence.propertyChanged=function(a,b,c,d){if(this.trackedObjects[a.id]){var e=a._type,f=e+"__"+b;if(f in this.globalPropertyListeners)for(var g=this.globalPropertyListeners[f],h=0;h<g.length;h++){var i=g[h],j=a._data;j[b]=c;var k=i._filter.match(j);j[b]=d;var l=i._filter.match(j);k!=l&&i.triggerEvent("change",i,a)}}},persistence.objectRemoved=function(a){var b=a._type;if(this.queryCollectionCache[b]){var c=this.queryCollectionCache[b];for(var d in c)if(c.hasOwnProperty(d)){var e=c[d];e._filter.match(a)&&e.triggerEvent("change",e,a)}}},persistence.getMeta=b,c.prototype=persistence,persistence.Session=c,persistence.define=function(a,b){if(t[a])return d(a);var c={name:a,fields:b,isMixin:!1,indexes:[],hasMany:{},hasOne:{}};return t[a]=c,d(a)},persistence.isDefined=function(a){return!!t[a]},persistence.defineMixin=function(a,b){var c=this.define(a,b);return c.meta.isMixin=!0,c},persistence.isTransaction=function(a){return!a||a&&a.executeSql},persistence.isSession=function(a){return!a||a&&a.schemaSync},persistence.add=function(a){if(a){var b=this.trackedObjects[a.id];if(b)b._dirtyProperties!=a._dirtyProperties&&(this.trackedObjects[a.id]=a);else if(this.trackedObjects[a.id]=a,a._new)for(var c in a._data)a._data.hasOwnProperty(c)&&this.propertyChanged(a,c,void 0,a._data[c]);return this}},persistence.remove=function(a){return a._new?delete this.trackedObjects[a.id]:(this.objectsToRemove[a.id]||(this.objectsToRemove[a.id]=a),this.objectsRemoved.push({id:a.id,entity:a._type})),this.objectRemoved(a),this},persistence.clean=function(){this.trackedObjects={},this.objectsToRemove={},this.objectsRemoved=[],this.globalPropertyListeners={},this.queryCollectionCache={}},persistence.asyncForEach=function(a,b,c){function d(){var e=a.pop();b(e,function(b,e){a.length>0?d():c(b,e)})}a=a.slice(0),a.length>0?d():c()},persistence.asyncParForEach=function(a,b,c){var d=0,e=a.length;0===e&&c();for(var f=0;f<e;f++)b(a[f],function(a,b){d++,d===e&&c(a,b)})},persistence.defaultTransactionErrorHandler=function(a,b,c){var d='Failed to execute query "'+a+'"';b&&(d+=" with arguments "+b),d+=" resulting in the error "+c,console.error(d)},persistence.jsonToEntityVal=function(a,b){if(!b)return a;switch(b){case"DATE":return"number"==typeof a?a>1e12?new Date(a):new Date(1e3*a):null;default:return a}},persistence.entityValToJson=function(a,b){if(!b)return a;switch(b){case"DATE":return a?(a=new Date(a),Math.round(a.getTime()/1e3)):null;default:return a}},persistence.dump=function(b,c,d){var e=a.getArgs(arguments,[{name:"tx",optional:!0,check:persistence.isTransaction,defaultValue:null},{name:"entities",optional:!0,check:function(a){return!a||a&&a.length&&!a.apply},defaultValue:null},{name:"callback",optional:!1,check:a.isCallback(),defaultValue:function(){}}]);if(b=e.tx,c=e.entities,d=e.callback,!c){c=[];for(var f in u)u.hasOwnProperty(f)&&c.push(u[f])}var g={};persistence.asyncParForEach(c,function(a,c){a.all().list(b,function(d){var e=[];persistence.asyncParForEach(d,function(c,d){var f={},g=a.meta.fields;for(var h in g)g.hasOwnProperty(h)&&(f[h]=persistence.entityValToJson(c._data[h],g[h]));var i=a.meta.hasOne;for(var j in i)i.hasOwnProperty(j)&&(f[j]=c._data[j]);var k=a.meta.hasMany,l=[];for(var m in k)k.hasOwnProperty(m)&&l.push(m);persistence.asyncParForEach(l,function(a,d){var e=persistence.get(c,a);e.list(b,function(b){f[a]=b.map(function(a){return a.id}),d()})},function(){f.id=c.id,e.push(f),d()})},function(){g[a.meta.name]=e,c()})})},function(){d(g)})},persistence.load=function(b,c,e){var f=a.getArgs(arguments,[{name:"tx",optional:!0,check:persistence.isTransaction,defaultValue:null},{name:"dump",optional:!1},{name:"callback",optional:!0,check:a.isCallback(),defaultValue:function(){}}]);b=f.tx,c=f.dump,e=f.callback;var g=[],h=this;for(var i in c)if(c.hasOwnProperty(i))for(var j=d(i),k=j.meta.fields,l=c[i],m=0;m<l.length;m++){var n=l[m],o=new j;o.id=n.id;for(var p in n)if(n.hasOwnProperty(p))if(persistence.isImmutable(p))o[p]=n[p];else if(j.meta.hasMany[p]){var q=j.meta.hasMany[p];if(q.manyToMany&&j.meta.name<q.type.meta.name)continue;var r=persistence.get(o,p);n[p].length>0&&n[p].forEach(function(a){g.push({Entity:j,coll:r,id:a})})}else persistence.set(o,p,persistence.jsonToEntityVal(n[p],k[p]));this.add(o)}h.flush(b,function(){persistence.asyncForEach(g,function(a,c){a.Entity.load(h,b,a.id,function(b){a.coll.add(b),c()})},function(){h.flush(b,e)})})},persistence.dumpToJson=function(b,c,d){var e=a.getArgs(arguments,[{name:"tx",optional:!0,check:persistence.isTransaction,defaultValue:null},{name:"entities",optional:!0,check:function(a){return a&&a.length&&!a.apply},defaultValue:null},{name:"callback",optional:!1,check:a.isCallback(),defaultValue:function(){}}]);b=e.tx,c=e.entities,d=e.callback,this.dump(b,c,function(a){d(JSON.stringify(a))})},persistence.loadFromJson=function(b,c,d){var e=a.getArgs(arguments,[{name:"tx",optional:!0,check:persistence.isTransaction,defaultValue:null},{name:"jsonDump",optional:!1},{name:"callback",optional:!0,check:a.isCallback(),defaultValue:function(){}}]);b=e.tx,c=e.jsonDump,d=e.callback,this.load(b,JSON.parse(c),d)},persistence.createUUID=e,i.prototype.unsubscribe=function(){this.obj.removeEventListener(this.eventType,this.fn)},j.prototype.addEventListener=function(a,b){return this.subscribers[a]||(this.subscribers[a]=[]),this.subscribers[a].push(b),new i(this,a,b)},j.prototype.removeEventListener=function(a,b){for(var c=this.subscribers[a],d=0;d<c.length;d++)if(c[d]==b)return this.subscribers[a].splice(d,1),!0;return!1},j.prototype.triggerEvent=function(a){if(this.subscribers[a])for(var b=this.subscribers[a].slice(0),c=0;c<b.length;c++)b[c].apply(null,arguments)},k.prototype.match=function(a){return!0},k.prototype.makeFit=function(a){},k.prototype.makeNotFit=function(a){},k.prototype.toUniqueString=function(){return"NULL"},k.prototype.subscribeGlobally=function(){},k.prototype.unsubscribeGlobally=function(){},l.prototype.match=function(a){return this.left.match(a)&&this.right.match(a)},l.prototype.makeFit=function(a){this.left.makeFit(a),this.right.makeFit(a)},l.prototype.makeNotFit=function(a){this.left.makeNotFit(a),this.right.makeNotFit(a)},l.prototype.toUniqueString=function(){return this.left.toUniqueString()+" AND "+this.right.toUniqueString()},l.prototype.subscribeGlobally=function(a,b){this.left.subscribeGlobally(a,b),this.right.subscribeGlobally(a,b)},l.prototype.unsubscribeGlobally=function(a,b){this.left.unsubscribeGlobally(a,b),this.right.unsubscribeGlobally(a,b)},m.prototype.match=function(a){return this.left.match(a)||this.right.match(a)},m.prototype.makeFit=function(a){this.left.makeFit(a),this.right.makeFit(a)},m.prototype.makeNotFit=function(a){this.left.makeNotFit(a),this.right.makeNotFit(a)},m.prototype.toUniqueString=function(){return this.left.toUniqueString()+" OR "+this.right.toUniqueString()},m.prototype.subscribeGlobally=function(a,b){this.left.subscribeGlobally(a,b),this.right.subscribeGlobally(a,b)},m.prototype.unsubscribeGlobally=function(a,b){this.left.unsubscribeGlobally(a,b),this.right.unsubscribeGlobally(a,b)},n.prototype.match=function(a){var b=this.value,c=persistence.get(a,this.property);switch(b&&b.getTime&&(b=1e3*Math.round(b.getTime()/1e3),c&&c.getTime&&(c=1e3*Math.round(c.getTime()/1e3))),this.operator){case"=":return c===b;case"!=":return c!==b;case"<":return c<b;case"<=":return c<=b;case">":return c>b;case">=":return c>=b;case"in":return g(b,c);case"not in":return!g(b,c)}},n.prototype.makeFit=function(a){if("="!==this.operator)throw new Error("Sorry, can't perform makeFit for other filters than =");persistence.set(a,this.property,this.value)},n.prototype.makeNotFit=function(a){if("="!==this.operator)throw new Error("Sorry, can't perform makeNotFit for other filters than =");persistence.set(a,this.property,null)},n.prototype.subscribeGlobally=function(a,b){persistence.subscribeToGlobalPropertyListener(a,b,this.property)},n.prototype.unsubscribeGlobally=function(a,b){persistence.unsubscribeFromGlobalPropertyListener(a,b,this.property)},n.prototype.toUniqueString=function(){var a=this.value;return a&&a._type&&(a=a.id),this.property+this.operator+a},persistence.NullFilter=k,persistence.AndFilter=l,persistence.OrFilter=m,persistence.PropertyFilter=n,persistence.uniqueQueryCollection=function(a){var b=a._entityName;return a._items?a:(this.queryCollectionCache[b]||(this.queryCollectionCache[b]={}),a)},o.prototype=new j,o.prototype.oldAddEventListener=o.prototype.addEventListener,o.prototype.setupSubscriptions=function(){this._filter.subscribeGlobally(this,this._entityName)},o.prototype.teardownSubscriptions=function(){this._filter.unsubscribeGlobally(this,this._entityName)},o.prototype.addEventListener=function(a,b){var c=this,d=this.oldAddEventListener(a,b);return 1===this.subscribers[a].length&&this.setupSubscriptions(),d.oldUnsubscribe=d.unsubscribe,d.unsubscribe=function(){this.oldUnsubscribe(),0===c.subscribers[a].length&&c.teardownSubscriptions()},d},o.prototype.persistQueries=function(){return[]},o.prototype.init=function(a,b,c){this._filter=new k,this._orderColumns=[],this._prefetchFields=[],this._entityName=b,this._constructor=c,this._limit=-1,this._skip=0,this._reverse=!1,this._session=a||persistence,this.subscribers={}},o.prototype.toUniqueString=function(){var a=this._constructor.name+": "+this._entityName;a+="|Filter:";var b=[];a+=this._filter.toUniqueString(),a+="|Values:";for(var c=0;c<b.length;c++)a+=b+"|^|";a+="|Order:";for(var c=0;c<this._orderColumns.length;c++){var d=this._orderColumns[c];a+=d[0]+", "+d[1]+", "+d[2]}a+="|Prefetch:";for(var c=0;c<this._prefetchFields.length;c++)a+=this._prefetchFields[c];return a+="|Limit:",a+=this._limit,a+="|Skip:",a+=this._skip,a+="|Reverse:",a+=this._reverse},o.prototype.clone=function(a){var b=new this._constructor(this._session,this._entityName);if(b._filter=this._filter,b._prefetchFields=this._prefetchFields.slice(0),b._orderColumns=this._orderColumns.slice(0),b._limit=this._limit,b._skip=this._skip,b._reverse=this._reverse,a){var c={};for(var d in this.subscribers)this.subscribers.hasOwnProperty(d)&&(c[d]=this.subscribers[d].slice(0));b.subscribers=c}else b.subscribers=this.subscribers;return b},o.prototype.filter=function(a,b,c){var d=this.clone(!0);d._filter=new l(this._filter,new n(a,b,c));var e=this._session;return d=e.uniqueQueryCollection(d),e.uniqueQueryCollection(d)},o.prototype.or=function(a){var b=this.clone(!0);return b._filter=new m(this._filter,a),this._session.uniqueQueryCollection(b)},o.prototype.and=function(a){var b=this.clone(!0);return b._filter=new l(this._filter,a),this._session.uniqueQueryCollection(b)},o.prototype.order=function(a,b,c){b=void 0===b||b,c=void 0===c||c;var d=this.clone();return d._orderColumns.push([a,b,c]),this._session.uniqueQueryCollection(d)},o.prototype.limit=function(a){var b=this.clone();return b._limit=a,this._session.uniqueQueryCollection(b)},o.prototype.skip=function(a){var b=this.clone();return b._skip=a,this._session.uniqueQueryCollection(b)},o.prototype.reverse=function(){var a=this.clone();return a._reverse=!0,this._session.uniqueQueryCollection(a)},o.prototype.prefetch=function(a){var b=this.clone();return b._prefetchFields.push(a),this._session.uniqueQueryCollection(b)},o.prototype.selectJSON=function(b,c,e){var f=a.getArgs(arguments,[{name:"tx",optional:!0,check:persistence.isTransaction,defaultValue:null},{name:"props",optional:!1},{name:"callback",optional:!1}]),g=this._session,h=this;if(b=f.tx,c=f.props,e=f.callback,!b)return void g.transaction(function(a){h.selectJSON(a,c,e)});d(this._entityName);this.list(function(a){var d=[];persistence.asyncForEach(a,function(a,e){a.selectJSON(b,c,function(a){d.push(a),e()})},function(){e(d)})})},o.prototype.add=function(a){if(!a.id||!a._type)throw new Error("Cannot add object of non-entity type onto collection.");this._session.add(a),this._filter.makeFit(a),this.triggerEvent("add",this,a),this.triggerEvent("change",this,a)},o.prototype.addAll=function(a){for(var b=0;b<a.length;b++){var c=a[b];this._session.add(c),this._filter.makeFit(c),this.triggerEvent("add",this,c)}this.triggerEvent("change",this)},o.prototype.remove=function(a){if(!a.id||!a._type)throw new Error("Cannot remove object of non-entity type from collection.");this._filter.makeNotFit(a),this.triggerEvent("remove",this,a),this.triggerEvent("change",this,a)},o.prototype.each=function(b,c){var d=a.getArgs(arguments,[{name:"tx",optional:!0,check:persistence.isTransaction,defaultValue:null},{name:"eachFn",optional:!0,check:a.isCallback()}]);b=d.tx,c=d.eachFn,this.list(b,function(a){for(var b=0;b<a.length;b++)c(a[b])})},o.prototype.forEach=o.prototype.each,o.prototype.one=function(b,c){var d=a.getArgs(arguments,[{name:"tx",optional:!0,check:persistence.isTransaction,defaultValue:null},{name:"oneFn",optional:!1,check:a.isCallback()}]);b=d.tx,c=d.oneFn;this.limit(1).list(b,function(a){c(0===a.length?null:a[0])})},p.prototype=new o,q.prototype=new p,q.prototype.add=function(a){this._session.add(a),this.triggerEvent("add",this,a),this.triggerEvent("change",this,a)},q.prototype.remove=function(a){this._session.remove(a),this.triggerEvent("remove",this,a),this.triggerEvent("change",this,a)},r.prototype=new p,r.prototype.initManyToMany=function(a,b){this._obj=a,this._coll=b},r.prototype.add=function(a){g(this._localAdded,a)||(this._session.add(a),this._localAdded.push(a),this.triggerEvent("add",this,a),this.triggerEvent("change",this,a))},r.prototype.addAll=function(a){for(var b=0;b<a.length;b++){var c=a[b];g(this._localAdded,c)||(this._session.add(c),this._localAdded.push(c),this.triggerEvent("add",this,c))}this.triggerEvent("change",this)},r.prototype.clone=function(){var a=p.prototype.clone.call(this);return a._localAdded=this._localAdded,a._localRemoved=this._localRemoved,a._obj=this._obj,a._coll=this._coll,a},r.prototype.remove=function(a){g(this._localAdded,a)?h(this._localAdded,a):g(this._localRemoved,a)||this._localRemoved.push(a),this.triggerEvent("remove",this,a),this.triggerEvent("change",this,a)},s.prototype=new o,s.prototype.clone=function(){var a=p.prototype.clone.call(this);return a._items=this._items,a},s.prototype.add=function(a){g(this._items,a)||(this._session.add(a),this._items.push(a),this.triggerEvent("add",this,a),this.triggerEvent("change",this,a))},s.prototype.addAll=function(a){for(var b=0;b<a.length;b++){var c=a[b];g(this._items,c)||(this._session.add(c),this._items.push(c),this.triggerEvent("add",this,c))}this.triggerEvent("change",this)},s.prototype.remove=function(a){for(var b=this._items,c=0;c<b.length;c++)b[c]===a&&(this._items.splice(c,1),this.triggerEvent("remove",this,a),this.triggerEvent("change",this,a))},s.prototype.list=function(b,c){var d=a.getArgs(arguments,[{name:"tx",optional:!0,check:persistence.isTransaction,defaultValue:null},{name:"callback",optional:!0,check:a.isCallback()}]);c=d.callback,c&&!c.executeSql||(c=arguments[1]);for(var e=this._items.slice(0),f=this,g=[],h=0;h<e.length;h++)this._filter.match(e[h])&&g.push(e[h]);return g.sort(function(a,b){for(var c=0;c<f._orderColumns.length;c++){var d=f._orderColumns[c][0],e=f._orderColumns[c][1],g=f._orderColumns[c][2],h=persistence.get(a,d),i=persistence.get(b,d);if(g||(h=h.toLowerCase(),i=i.toLowerCase()),h<i)return e?-1:1;if(h>i)return e?1:-1}return 0}),this._skip&&g.splice(0,this._skip),this._limit>-1&&(g=g.slice(0,this._limit)),this._reverse&&g.reverse(),c?void c(g):g},s.prototype.destroyAll=function(a){a&&!a.executeSql||(a=arguments[1]),this._items=[],this.triggerEvent("change",this),a&&a()},s.prototype.count=function(b,c){var d=a.getArgs(arguments,[{name:"tx",optional:!0,check:persistence.isTransaction,defaultValue:null},{name:"callback",optional:!0,check:a.isCallback()}]);b=d.tx,c=d.callback;var e=this.list();return c?void c(e.length):e.length},persistence.QueryCollection=o,persistence.DbQueryCollection=p,persistence.ManyToManyDbQueryCollection=r,persistence.LocalQueryCollection=s,persistence.Observable=j,persistence.Subscription=i,persistence.AndFilter=l,persistence.OrFilter=m,persistence.PropertyFilter=n}();var a={};return function(){a.getArgs=function(a,b){for(var c=0,d=0,e={};d<b.length;){var f=b[d],g=a[c];if(f.optional)void 0!==g&&f.check(g)?(e[f.name]=g,c++,d++):(void 0!==f.defaultValue&&(e[f.name]=f.defaultValue),d++);else{if(f.check&&!f.check(g))throw new Error("Invalid value for argument: "+f.name+" Value: "+g);e[f.name]=g,d++,c++}}return e},a.hasProperty=function(a){return function(b){return b&&void 0!==b[a]}},a.hasType=function(a){return function(b){return("undefined"==typeof b?"undefined":_typeof(b))===a}},a.isCallback=function(){return function(a){return a&&a.apply}}}(),persistence.argspec=a,persistence}function config(persistence,a){function b(a,b,c,d){d=d||"";var e=persistence.typeMapper,f=persistence.getMeta(b),g=persistence.define(b);if(!c[d+"id"])return null;var h=new g(a,(void 0),(!0));h.id=e.dbValToEntityVal(c[d+"id"],e.idType),h._new=!1;var i=[];for(var j in c)if(c.hasOwnProperty(j)){if(j.startsWith("#")){i.push(j);continue}if(j.substring(0,d.length)===d){var k=j.substring(d.length);"id"!=k&&(h._data[k]=e.dbValToEntityVal(c[j],f.fields[k]||e.idType))}}for(var l=0;l<i.length;l++){var m=i[l],n=m.substr(1,m.indexOf(".")-1),o=m.substr(m.indexOf(".")+1);if(h.hasOwnProperty(n)){var p=e.dbValToEntityVal(c[m],"JSON");for(var q in p)p.hasOwnProperty(q)&&(h[n]["#"+o+"."+q]=p[q])}}return h.generatedRowStamp=persistence.createUUID(),h}function c(a,b,c){var d=persistence.getMeta(a._type),e=persistence.typeMapper,g=[],h=[],i=[],j=[];if(a._new)for(var k in d.fields)d.fields.hasOwnProperty(k)&&(a._dirtyProperties[k]=!0);for(var k in a._dirtyProperties)if(a._dirtyProperties.hasOwnProperty(k)){g.push("`"+k+"`");var l=d.fields[k]||e.idType;h.push(e.entityValToDbVal(a._data[k],l)),i.push(e.outVar("?",l)),j.push("`"+k+"` = "+e.outVar("?",l))}var m=[];for(var k in d.hasMany)d.hasMany.hasOwnProperty(k)&&(m=m.concat(persistence.get(a,k).persistQueries()));f(b,m,function(){if(!a._new&&0===g.length)return void(c&&c());if(a._dirtyProperties={},a._new){g.push("id"),h.push(e.entityIdToDbId(a.id)),i.push(e.outIdVar("?"));var d="INSERT INTO `"+a._type+"` ("+g.join(", ")+") VALUES ("+i.join(", ")+")";a._new=!1,b.executeSql(d,h,c,c)}else{var d="UPDATE `"+a._type+"` SET "+j.join(",")+" WHERE id = "+e.outId(a.id);b.executeSql(d,h,c,c)}})}function d(a,b,c){var d=persistence.getMeta(a._type),e=persistence.typeMapper,g=[["DELETE FROM `"+a._type+"` WHERE id = "+e.outId(a.id),null]];for(var h in d.hasMany)if(d.hasMany.hasOwnProperty(h)&&d.hasMany[h].manyToMany){var i=d.hasMany[h].tableName;g.push(["DELETE FROM `"+i+"` WHERE `"+d.name+"_"+h+"` = "+e.outId(a.id),null])}f(b,g,c)}function e(a,b,c){"sqliteplugin"===persistence.db.implementation?a.bulkSQL(b,function(){return c(b,null)},function(a){return c(null,a)}):this.executeQueriesSeq(a,b,c)}function f(a,b,c){persistence.asyncForEach(b,function(b,c){var d=b[0],e=b[1];a.executeSql(d,e,c,function(a){persistence.defaultTransactionErrorHandler(d,e,a),c(null,a)})},function(a,b){
c&&c(a,b)})}var g=persistence.argspec;persistence.typeMapper=a.typeMapper||defaultTypeMapper,persistence.generatedTables={},persistence.schemaSync=function(b,c,d){var e=g.getArgs(arguments,[{name:"tx",optional:!0,check:persistence.isTransaction,defaultValue:null},{name:"callback",optional:!0,check:g.isCallback(),defaultValue:function(){}},{name:"emulate",optional:!0,check:g.hasType("boolean")}]);if(b=e.tx,c=e.callback,d=e.emulate,!b){var h=this;return void this.transaction(function(a){h.schemaSync(a,c,d)})}var i,j,k,l,m=[],n=persistence.typeMapper,o=persistence.getEntityMeta();for(var p in o)if(o.hasOwnProperty(p)){if(i=o[p],!i.isMixin){j=[];for(var q in i.fields)i.fields.hasOwnProperty(q)&&j.push([q,i.fields[q]]);for(var r in i.hasOne)i.hasOne.hasOwnProperty(r)&&(k=i.hasOne[r].type.meta,j.push([r,n.idType]),m.push([a.createIndex(i.name,[r]),null]));for(var s=0;s<i.indexes.length;s++)m.push([a.createIndex(i.name,i.indexes[s].columns,i.indexes[s]),null])}for(var r in i.hasMany)if(i.hasMany.hasOwnProperty(r)&&i.hasMany[r].manyToMany&&(l=i.hasMany[r].tableName,!persistence.generatedTables[l])){var k=i.hasMany[r].type.meta,t=i.hasMany[r].inverseProperty;if(k.hasMany[t].type.meta!=i)continue;var u=i.name+"_"+r,v=k.name+"_"+t;m.push([a.createIndex(l,[u]),null]),m.push([a.createIndex(l,[v]),null]);var w=[[u,n.idType],[v,n.idType]];i.isMixin&&w.push([u+"_class",n.classNameType]),k.isMixin&&w.push([v+"_class",n.classNameType]),m.push([a.createTable(l,w),null]),persistence.generatedTables[l]=!0}i.isMixin||(j.push(["id",n.idType,"PRIMARY KEY"]),persistence.generatedTables[i.name]=!0,m.push([a.createTable(i.name,j),null]))}for(var x=persistence.schemaSyncHooks,s=0;s<x.length;s++)x[s](b);d?c(b):f(b,m,function(_,a){c(b,a)})},persistence.flush=function(a,b){var e=g.getArgs(arguments,[{name:"tx",optional:!0,check:persistence.isTransaction},{name:"callback",optional:!0,check:g.isCallback(),defaultValue:null}]);a=e.tx,b=e.callback;var f=this;if(!a)return void this.transaction(function(a){f.flush(a,b)});var h=persistence.flushHooks;persistence.asyncForEach(h,function(b,c){b(f,a,c)},function(){var e=[];for(var g in f.trackedObjects)f.trackedObjects.hasOwnProperty(g)&&e.push(f.trackedObjects[g]);var h=[];for(var g in f.objectsToRemove)f.objectsToRemove.hasOwnProperty(g)&&(h.push(f.objectsToRemove[g]),delete f.trackedObjects[g]);if(f.objectsToRemove={},b)persistence.asyncParForEach(h,function(b,c){d(b,a,c)},function(d,f){return f?b(d,f):void persistence.asyncParForEach(e,function(b,d){c(b,a,d)},b)});else{for(var i=0;i<e.length;i++)c(e[i],a);for(var i=0;i<h.length;i++)d(h[i],a)}})},persistence.reset=function(a,b){var c=g.getArgs(arguments,[{name:"tx",optional:!0,check:persistence.isTransaction,defaultValue:null},{name:"callback",optional:!0,check:g.isCallback(),defaultValue:function(){}}]);a=c.tx,b=c.callback;var d=this;return a?void this.schemaSync(a,function(){function c(){var b=f.pop();a.executeSql("DROP TABLE IF EXISTS `"+b+"`",null,function(){f.length>0?c():e()},e)}function e(a,c){d.clean(),persistence.generatedTables={},b&&b(a,c)}var f=[];for(var g in persistence.generatedTables)persistence.generatedTables.hasOwnProperty(g)&&f.push(g);f.length>0?c():e()},!0):void d.transaction(function(a){d.reset(a,b)})},persistence.save=c,persistence.executeQueriesSeq=f,persistence.executeQueriesSeqForceBatch=e,persistence.QueryCollection.prototype.persistQueries=function(){return[]};var h=persistence.QueryCollection.prototype.clone;persistence.QueryCollection.prototype.clone=function(a){var b=h.call(this,a);return b._additionalJoinSqls=this._additionalJoinSqls.slice(0),b._additionalWhereSqls=this._additionalWhereSqls.slice(0),b._projectionFields=this._projectionFields.slice(0),b._extraProjectionFields=this._extraProjectionFields.slice(0),b._querytoUse=this._querytoUse,b._additionalGroupSqls=this._additionalGroupSqls.slice(0),b._manyToManyFetch=this._manyToManyFetch,b};var i=persistence.QueryCollection.prototype.init;persistence.QueryCollection.prototype.init=function(a,b,c){i.call(this,a,b,c),this._manyToManyFetch=null,this._additionalJoinSqls=[],this._additionalWhereSqls=[],this._additionalGroupSqls=[],this._projectionFields=[],this._extraProjectionFields=[],this._querytoUse=null};var j=persistence.QueryCollection.prototype.toUniqueString;persistence.QueryCollection.prototype.toUniqueString=function(){var a=j.call(this);a+="|JoinSQLs:";for(var b=0;b<this._additionalJoinSqls.length;b++)a+=this._additionalJoinSqls[b];a+="|WhereSQLs:";for(var b=0;b<this._additionalWhereSqls.length;b++)a+=this._additionalWhereSqls[b];a+="|GroupSQLs:";for(var b=0;b<this._additionalGroupSqls.length;b++)a+=this._additionalGroupSqls[b];return this._manyToManyFetch&&(a+="|ManyToManyFetch:",a+=JSON.stringify(this._manyToManyFetch)),a},persistence.NullFilter.prototype.sql=function(a,b,c){return"1=1"},persistence.AndFilter.prototype.sql=function(a,b,c){return"("+this.left.sql(a,b,c)+" AND "+this.right.sql(a,b,c)+")"},persistence.OrFilter.prototype.sql=function(a,b,c){return"("+this.left.sql(a,b,c)+" OR "+this.right.sql(a,b,c)+")"},persistence.PropertyFilter.prototype.sql=function(a,b,c){var d=persistence.typeMapper,e=b?"`"+b+"`.":"",f=a.fields[this.property]||d.idType;if("="===this.operator&&null===this.value)return e+"`"+this.property+"` IS NULL";if("!="===this.operator&&null===this.value)return e+"`"+this.property+"` IS NOT NULL";if("in"===this.operator){for(var g=this.value,h=[],i=0;i<g.length;i++)h.push("?"),c.push(d.entityValToDbVal(g[i],f));return 0===g.length?"1 = 0":e+"`"+this.property+"` IN ("+h.join(", ")+")"}if("not in"===this.operator){for(var g=this.value,h=[],i=0;i<g.length;i++)h.push("?"),c.push(d.entityValToDbVal(g[i],f));return 0===g.length?"1 = 1":e+"`"+this.property+"` NOT IN ("+h.join(", ")+")"}var j=this.value;return j!==!0&&j!==!1||(j=j?1:0),c.push(d.entityValToDbVal(j,f)),e+"`"+this.property+"` "+this.operator+" "+d.outVar("?",f)},persistence.DbQueryCollection.prototype.list=function(a,c){function d(a,b,c){var d=[k.inIdVar("`"+b+"`.id")+" AS "+c+"id"];for(var e in a.fields)a.fields.hasOwnProperty(e)&&d.push(k.inVar("`"+b+"`.`"+e+"`",a.fields[e])+" AS `"+c+e+"`");for(var e in a.hasOne)a.hasOne.hasOwnProperty(e)&&d.push(k.inIdVar("`"+b+"`.`"+e+"`")+" AS `"+c+e+"`");return d}var e=g.getArgs(arguments,[{name:"tx",optional:!0,check:persistence.isTransaction,defaultValue:null},{name:"callback",optional:!1,check:g.isCallback()}]);a=e.tx,c=e.callback;var f=this,h=this._session;if(!a)return void h.transaction(function(a){f.list(a,c)});var i=this._entityName,j=persistence.getMeta(i),k=persistence.typeMapper;if(j.isMixin){var l=[];return void persistence.asyncForEach(j.mixedIns,function(b,c){var d=f.clone();d._entityName=b.name,d.list(a,function(a){l=l.concat(a),c()})},function(){var a=new persistence.LocalQueryCollection(l);a._orderColumns=f._orderColumns,a._reverse=f._reverse,a.list(null,c)})}var e=[],m=i+"_",n="root",o=[];if(this._projectionFields&&this._projectionFields.length>0){for(var p={},q=0;q<this._projectionFields.length;q++)p[this._projectionFields[q]]=this._projectionFields[q];o=d({fields:p},n,m)}else o=d(j,n,m);if(this._extraProjectionFields&&this._extraProjectionFields.length>0)for(var r=0;r<this._extraProjectionFields.length;r++){var s=this._extraProjectionFields[r];o.push(s.field+" as "+s.alias)}var t="",u=this._additionalWhereSqls.slice(0),v=this._manyToManyFetch;v&&(t+="LEFT JOIN `"+v.table+"` AS mtm ON mtm.`"+v.inverseProp+"` = `root`.`id` ",u.push("mtm.`"+v.prop+"` = "+k.outId(v.id))),t+=this._additionalJoinSqls.join(" ");for(var w=0;w<this._prefetchFields.length;w++){var x=this._prefetchFields[w].split("."),y=x[0],z=i;x.length>1&&(y=x[1],z=x[0]);var A=persistence.getMeta(z),B=A.hasOne[y].type.meta;if(B.isMixin)throw new Error("cannot prefetch a mixin");var C=B.name+"_"+y+"_tbl",D=n;x.length>1&&(D=z+"_"+z+"_tbl"),o=o.concat(d(B,C,y+"_")),t+="LEFT JOIN `"+B.name+"` AS `"+C+"` ON `"+C+"`.`id` = `"+D+"`.`"+y+"` "}var E="WHERE "+[this._filter.sql(j,n,e)].concat(u).join(" AND "),F="SELECT "+o.join(", ")+" FROM `"+i+"` AS `"+n+"` "+t+" "+E;this._additionalGroupSqls.length>0&&(F+=this._additionalGroupSqls.join(" ")),this._orderColumns.length>0&&(F+=" ORDER BY "+this._orderColumns.map(function(a){return(a[2]?"`":"LOWER(`")+m+a[0]+(a[2]?"` ":"`) ")+(a[1]?"ASC":"DESC")}).join(", ")),this._limit>=0&&(F+=" LIMIT "+this._limit),this._skip>0&&(F+=" OFFSET "+this._skip),this._querytoUse&&(F=this._querytoUse,m=""),h.flush(a,function(){a.executeSql(F,e,function(a){var d=[];f._reverse&&a.reverse();for(var e=0;e<a.length;e++){for(var g=a[e],j=b(h,i,g,m),k=0;k<f._prefetchFields.length;k++){var l=f._prefetchFields[k].split("."),n=l[0],o=i;l.length>1&&(n=l[1],o=l[0]);var p=persistence.getMeta(o),q=p.hasOne[n].type.meta;j._data_obj[n]=b(h,q.name,g,n+"_"),h.add(j._data_obj[n])}d.push(j),h.add(j)}c(d),f.triggerEvent("list",f,d)})})},persistence.DbQueryCollection.prototype.destroyAll=function(a,b){var c=g.getArgs(arguments,[{name:"tx",optional:!0,check:persistence.isTransaction,defaultValue:null},{name:"callback",optional:!0,check:g.isCallback(),defaultValue:function(){}}]);a=c.tx,b=c.callback;var d=this,e=this._session;if(!a)return void e.transaction(function(a){d.destroyAll(a,b)});var f=this._entityName,h=persistence.getMeta(f),i=persistence.typeMapper;if(h.isMixin)return void persistence.asyncForEach(h.mixedIns,function(c,e){var f=d.clone();f._entityName=c.name,f.destroyAll(a,b)},b);var j="",k=this._additionalWhereSqls.slice(0),l=this._manyToManyFetch;l&&(j+="LEFT JOIN `"+l.table+"` AS mtm ON mtm.`"+l.inverseProp+"` = `root`.`id` ",k.push("mtm.`"+l.prop+"` = "+i.outId(l.id))),j+=this._additionalJoinSqls.join(" ");var c=[],m="WHERE "+[this._filter.sql(h,null,c)].concat(k).join(" AND "),n="SELECT id FROM `"+f+"` "+j+" "+m,o="DELETE FROM `"+f+"` "+j+" "+m,p=c.slice(0);e.flush(a,function(){a.executeSql(n,c,function(c){for(var g=0;g<c.length;g++)delete e.trackedObjects[c[g].id],e.objectsRemoved.push({id:c[g].id,entity:f});d.triggerEvent("change",d),a.executeSql(o,p,b,b)},b)})},persistence.DbQueryCollection.prototype.count=function(a,b){var c=g.getArgs(arguments,[{name:"tx",optional:!0,check:persistence.isTransaction,defaultValue:null},{name:"callback",optional:!1,check:g.isCallback()}]);a=c.tx,b=c.callback;var d=this,e=this._session;if(a&&!a.executeSql&&(b=a,a=null),!a)return void e.transaction(function(a){d.count(a,b)});var f=this._entityName,h=persistence.getMeta(f),i=persistence.typeMapper;if(h.isMixin){var j=0;return void persistence.asyncForEach(h.mixedIns,function(b,c){var e=d.clone();e._entityName=b.name,e.count(a,function(a){j+=a,c()})},function(){b(j)})}var k="",l=this._additionalWhereSqls.slice(0),m=this._manyToManyFetch;m&&(k+="LEFT JOIN `"+m.table+"` AS mtm ON mtm.`"+m.inverseProp+"` = `root`.`id` ",l.push("mtm.`"+m.prop+"` = "+i.outId(m.id))),k+=this._additionalJoinSqls.join(" ");var c=[],n="WHERE "+[this._filter.sql(h,"root",c)].concat(l).join(" AND "),o="SELECT COUNT(*) AS cnt FROM `"+f+"` AS `root` "+k+" "+n;e.flush(a,function(){a.executeSql(o,c,function(a){b(parseInt(a[0].cnt,10))})})},persistence.ManyToManyDbQueryCollection.prototype.persistQueries=function(){for(var a=[],b=persistence.getMeta(this._obj._type),c=b.hasMany[this._coll].type.meta,d=persistence.typeMapper,e=b.hasMany[this._coll],f=c.hasMany[e.inverseProperty],g=e.mixin?e.mixin.meta.name:b.name,h=f.mixin?f.mixin.meta.name:c.name,i=0;i<this._localAdded.length;i++){var j=[g+"_"+this._coll,h+"_"+e.inverseProperty],k=[d.outIdVar("?"),d.outIdVar("?")],l=[d.entityIdToDbId(this._obj.id),d.entityIdToDbId(this._localAdded[i].id)];e.mixin&&(j.push(g+"_"+this._coll+"_class"),k.push("?"),l.push(b.name)),f.mixin&&(j.push(h+"_"+e.inverseProperty+"_class"),k.push("?"),l.push(c.name)),a.push(["INSERT INTO "+e.tableName+" (`"+j.join("`, `")+"`) VALUES ("+k.join(",")+")",l])}this._localAdded=[];for(var i=0;i<this._localRemoved.length;i++)a.push(["DELETE FROM  "+e.tableName+" WHERE `"+g+"_"+this._coll+"` = "+d.outIdVar("?")+" AND `"+h+"_"+e.inverseProperty+"` = "+d.outIdVar("?"),[d.entityIdToDbId(this._obj.id),d.entityIdToDbId(this._localRemoved[i].id)]]);return this._localRemoved=[],a}}function isString(a){return null!==a&&void 0!==a&&("string"==typeof a||"object"===("undefined"==typeof a?"undefined":_typeof(a))&&a.constructor===String)}function isMobile(){return"Mobile"==DeviceDetect.catagory}function isDesktop(){return"Desktop"==DeviceDetect.catagory}function safeCSSselector(a){if(a){var b=a.toLowerCase();return b=b.replace(".","_"),b=b.replace("#","_")}return""}function instantiateIfUndefined(a,b){var c=void 0===b||1==b;return(void 0===a||c&&null===a)&&(a={}),a}function FillRelationship(a,b,c){return b=b.replace(/_/g,"_."),b=b.replace(/\.\./g,"."),JsonProperty(a,b,c,!0)}function GetRelationshipName(a){return a=a.replace(/_/g,"_."),a=a.replace(/\.\./g,".")}function RemoveSpecialChars(a){return a.replace(/[^\w\s]/gi,"")}function JsonProperty(a,b,c,d){for(var e=b.split("."),f=a,g=0;g<e.length;g++)if(f.hasOwnProperty(e[g]))f=f[e[g]];else{if(void 0==c&&!d)return null;g==e.length-1?f[e[g]]=c:f[e[g]]={},f=f[e[g]]}return f}function nullOrCommaSplit(a){return null==a||""===a?null:a.split(",")}function emptyIfNull(a){return null==a?"":a}function booleanEquals(a,b){return a===b||("1"==a||"true"==a?"true"==b||"1"==b:"1"==b||"true"==b?"true"==a||"1"==a:"0"==a||"false"==a?"false"==b||"0"==b:("0"==b||"false"==b)&&("false"==a||"0"==a))}function nullOrUndef(a){return void 0===a||null==a}function insertOrUpdateArray(a,b,c){c=c||"id";for(var d=-1,e=0;e<a.length;e++)if(a[e][c]==b[c]){d=e;break}d==-1?a.push(b):a[d]=b}function lockCommandBars(){var a=$("[data-classplaceholder=commandbar]");a.each(function(a,b){for(var c=$(b).find("button"),d=0;d<c.length;d++){var e=$(c[d]);e.prop("disabled")!==!0&&(e.attr("disabled","disabled"),e.attr("forceddisable","disabled"))}})}function unLockCommandBars(){var a=$("[data-classplaceholder=commandbar]");a.each(function(a,b){for(var c=$(b).find("button"),d=0;d<c.length;d++){var e=$(c[d]);"disabled"===e.attr("forceddisable")&&e.removeAttr("disabled")}})}function lockTabs(){var a=$("[data-toggle=tab]");a.each(function(a,b){var c=$(b);c.removeAttr("data-toggle"),c.attr("data-toggle","tab_inactive")})}function unLockTabs(){var a=$("[data-toggle=tab_inactive]");a.each(function(a,b){var c=$(b);c.removeAttr("data-toggle"),c.attr("data-toggle","tab")})}function capitaliseFirstLetter(a){for(var b=a.split(/[ ]+/),c="",d=0;d<b.length;d++)c+=b[d].charAt(0).toUpperCase()+b[d].slice(1),c+=d+1==b.length?"":" ";return c}function isIE11(){if("Netscape"!==navigator.appName)return!1;var a=navigator.userAgent,b=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})");return null!=b.exec(a)}function isIE(){return"Explorer"===BrowserDetect.browser||isIE11()}function isIe9(){var a=sessionStorage.mockie9;return a===!0||"true"===a||isIE()&&("9"==BrowserDetect.version||"8"==BrowserDetect.version||"7"==BrowserDetect.version)}function isChrome(){return"Chrome"===BrowserDetect.browser}function isFirefox(){return"Firefox"===BrowserDetect.browser}function loadScript(a,b){var c=document.getElementsByTagName("head")[0],d=document.createElement("script");d.type="text/javascript",d.src=url(a),d.onreadystatechange=b,d.onload=b,c.appendChild(d)}function url(a){if(angular.mock||window.cordova)return a;if(null==a)return null;a.endsWith("html")&&(a=a.toLowerCase());var b=location.protocol+"//"+location.hostname+(location.port?":"+location.port:"");b.search("localhost:")==-1&&(b+="/softWrench"),a&&"/"!=a[0]&&(a="/"+a);var c=$(routes_basecontext)[0].value;return"/"==c?a:c+a}function GetPopUpMode(){if(angular.mock)return"none";var a=$(hddn_popupmode)[0].value;return void 0!==a&&"null"!=a&&""!=a||(a="none"),a}function BuildDataObject(){var a={},b=$(crud_InitialData)[0].value;return void 0===b||null==b||""==b?a:(a.data=b,a)}function platformQS(){return"platform="+platform()}function platform(){return"web"}function detailSchema(){return"detail"}function listSchema(){return"list"}function executeFunctionByName(a,b){for(var c=Array.prototype.slice.call(arguments).splice(2),d=a.split("."),e=d.pop(),f=0;f<d.length;f++)b=b[d[f]];return b[e].apply(this,c)}function addCurrentSchemaDataToJson(a,b){return a["%%currentschema"]={},a["%%currentschema"].schemaId=b.schemaId,a["%%currentschema"].mode=b.mode,a["%%currentschema"].platform=platform(),a}function addSchemaDataToJson(a,b,c){if(a=addCurrentSchemaDataToJson(a,b),c)a["%%nextschema"]={},a["%%nextschema"].schemaId=c.schemaId,null!=c.nextSchemaMode&&(a["%%nextschema"].mode=c.schemaMode),a["%%nextschema"].platform=platform();else if(null!=b.properties&&null!=b.properties["nextschema.schemaid"]){var d=b.properties["nextschema.schemaid"];a["%%nextschema"]={},a["%%nextschema"].schemaId=d,null!=b.properties["nextschema.schemamode"]&&(a["%%nextschema"].mode=b.properties["nextschema.schemamode"]),a["%%nextschema"].platform=platform()}return a}function removeEncoding(a){return a=replaceAll(a,"%5B%5D",""),a=replaceAll(a,"%5B","."),a=replaceAll(a,"%5D","")}function getCurrentDate(){var a=new Date,b=a.getDate(),c=a.getMonth()+1,d=a.getFullYear();return b<10&&(b="0"+b),c<10&&(c="0"+c),a=c+"/"+b+"/"+d}function replaceAll(a,b,c){return null==a?null:a.replace(new RegExp(b,"g"),c)}function imgToBase64(a){var b=document.createElement("canvas");b.width=a.width,b.height=a.height;var c=b.getContext("2d");c.drawImage(a,0,0);var d=b.toDataURL("image/png");return d}function printWindow(){window.print()}function isEmpty(a){if(null==a)return!0;if(a.length>0)return!1;if(0===a.length)return!0;if(""===a)return!0;for(var b in a)if(hasOwnProperty.call(a,b))return!1;return!0}function removeDuplicatesOnArray(a,b){if(!a||!b)return a;var c=[],d=[];return a.forEach(function(a){var e=a[b];c.indexOf(e)>=0||(c.push(e),d.push(a))}),d}function guid(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}function mergeObjects(a,b){for(var c in a)a.hasOwnProperty(c)&&b.hasOwnProperty(c)&&(b[c]=a[c]);return b}function setDeep(a,b,c){b=b.split(".");for(var d=0,e=b.length;d<e-1;++d)a=a[b[d]];return a[b[d]]=c}function getDeep(a,b){b=b.split(".");for(var c=0,d=b.length;c<d;++c)a=a[b[c]];return a}var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};if("undefined"!=typeof exports){exports.createPersistence=function(){return initPersistence({})};var singleton;"function"==typeof exports.__defineGetter__?exports.__defineGetter__("persistence",function(){return singleton||(singleton=exports.createPersistence()),singleton}):Object.defineProperty(exports,"persistence",{get:function(){return singleton||(singleton=exports.createPersistence()),singleton},enumerable:!0,configurable:!0})}else window||(window={}),window.persistence=initPersistence(window.persistence||{});"undefined"==typeof JSON&&(JSON={}),JSON.stringify||!function(){function f(a){return a<10?"0"+a:a}function quote(a){return escapable.lastIndex=0,escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return"string"==typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function str(a,b){var c,d,e,f,g,h=gap,i=b[a];switch(i&&"object"===("undefined"==typeof i?"undefined":_typeof(i))&&"function"==typeof i.toJSON&&(i=i.toJSON(a)),"function"==typeof rep&&(i=rep.call(b,a,i)),"undefined"==typeof i?"undefined":_typeof(i)){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";if(gap+=indent,g=[],"[object Array]"===Object.prototype.toString.apply(i)){for(f=i.length,c=0;c<f;c+=1)g[c]=str(c,i)||"null";return e=0===g.length?"[]":gap?"[\n"+gap+g.join(",\n"+gap)+"\n"+h+"]":"["+g.join(",")+"]",gap=h,e}if(rep&&"object"===("undefined"==typeof rep?"undefined":_typeof(rep)))for(f=rep.length,c=0;c<f;c+=1)d=rep[c],"string"==typeof d&&(e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));else for(d in i)Object.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));return e=0===g.length?"{}":gap?"{\n"+gap+g.join(",\n"+gap)+"\n"+h+"}":"{"+g.join(",")+"}",gap=h,e}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(a){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(a){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(a,b,c){var d;if(gap="",indent="","number"==typeof c)for(d=0;d<c;d+=1)indent+=" ";else"string"==typeof c&&(indent=c);if(rep=b,b&&"function"!=typeof b&&("object"!==("undefined"==typeof b?"undefined":_typeof(b))||"number"!=typeof b.length))throw new Error("JSON.stringify");return str("",{"":a})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&"object"===("undefined"==typeof e?"undefined":_typeof(e)))for(c in e)Object.hasOwnProperty.call(e,c)&&(d=walk(e,c),void 0!==d?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;if(cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}();var defaultTypeMapper={idType:"VARCHAR(32)",classNameType:"TEXT",columnType:function(a){switch(a){case"JSON":return"TEXT";case"BOOL":return"INT";case"DATE":return"INT";default:return a}},inVar:function(a,b){return a},outVar:function(a,b){return a},outId:function(a){return"'"+a+"'"},dbValToEntityVal:function(a,b){if(null===a||void 0===a)return a;switch(b){case"DATE":return a>1e12?new Date(parseInt(a,10)):new Date(1e3*parseInt(a,10));case"BOOL":return 1===a||"1"===a;case"INT":return+a;case"BIGINT":return+a;case"JSON":return a?JSON.parse(a):a;default:return a}},entityValToDbVal:function(a,b){return void 0===a||null===a?null:"JSON"===b&&a?JSON.stringify(a):a.id?a.id:"BOOL"===b?"false"===a?0:a?1:0:"DATE"===b||a.getTime?(a=new Date(a),Math.round(a.getTime()/1e3)):"VARCHAR(32)"===b?a.toString():a},inIdVar:function(a){return this.inVar(a,this.idType)},outIdVar:function(a){return this.outVar(a,this.idType)},entityIdToDbId:function(a){return this.entityValToDbVal(a,this.idType)}};"undefined"!=typeof exports?(exports.defaultTypeMapper=defaultTypeMapper,exports.config=config):(window||(window={}),window.persistence=window.persistence||persistence||{},window.persistence.store=window.persistence.store||{},window.persistence.store.sql={defaultTypeMapper:defaultTypeMapper,config:config});try{window||(window={})}catch(e){window={},exports.console=console}var persistence=window&&window.persistence?window.persistence:{};persistence.store||(persistence.store={}),persistence.store.cordovasql={},persistence.store.cordovasql.config=function(persistence,a,b,c,d,e){var f=null;if(persistence.transaction=function(a){if(!f)throw new Error("No ongoing database connection, please connect first.");f.transaction(a)},persistence.db=persistence.db||{},persistence.db.implementation="unsupported",persistence.db.conn=null,!isRippleEmulator()&&window&&"sqlitePlugin"in window?persistence.db.implementation="sqliteplugin":window&&window.openDatabase&&(persistence.db.implementation="websql"),persistence.db.sqliteplugin={},persistence.db.sqliteplugin.connect=function(a,b){var c={},d=window.sqlitePlugin.openDatabase({name:a,bgType:b,location:"default"});return c.transaction=function(a){return d.transaction(function(b){return a(persistence.db.sqliteplugin.transaction(b))})},c},persistence.db.sqliteplugin.transaction=function(a){var b={};return b.executeSql=function(b,c,d,e){window.rootlogger.get("persistence#transaction",["persistence","sql"]).debug(b,c),a.executeSql(b,c,function(_,a){if(d){for(var b=[],c=0;c<a.rows.length;c++)b.push(a.rows.item(c));d(b)}},function(a){e?e(a):persistence.defaultTransactionErrorHandler(b,c,a)})},b.bulkSQL=function(b,c,d){persistence.debug&&console.log(b),a.db.sqlBatch(b,function(){c&&c()},function(a){d?d(a):persistence.defaultTransactionErrorHandler(b,args,a)})},b},persistence.db.websql={},persistence.db.websql.connect=function(a,b,c,d){var e={},f=openDatabase(a,b,c,d);return e.transaction=function(a){return f.transaction(function(b){return a(persistence.db.websql.transaction(b))})},e},persistence.db.websql.transaction=function(a){var b={};return b.executeSql=function(b,c,d,e){persistence.debug&&console.log(b,c),a.executeSql(b,c,function(_,a){if(d){for(var b=[],c=0;c<a.rows.length;c++)b.push(a.rows.item(c));d(b)}},function(a){e?e(a):persistence.defaultTransactionErrorHandler(b,c,a)})},b},persistence.db.connect=function(a,b,c,d,e){return"sqliteplugin"==persistence.db.implementation?persistence.db.sqliteplugin.connect(a,e):"websql"==persistence.db.implementation?persistence.db.websql.connect(a,b,c,d):null},persistence.store.cordovasql.sqliteDialect={createTable:function(a,b){for(var c=persistence.typeMapper,d="CREATE TABLE IF NOT EXISTS `"+a+"` (",e=[],f=0;f<b.length;f++){var g=b[f];e.push("`"+g[0]+"` "+c.columnType(g[1])+(g[2]?" "+g[2]:""))}return d+=e.join(", "),d+=")"},createIndex:function(a,b,c){return c=c||{},"CREATE "+(c.unique?"UNIQUE ":"")+"INDEX IF NOT EXISTS `"+a+"__"+b.join("_")+"` ON `"+a+"` ("+b.map(function(a){return"`"+a+"`"}).join(", ")+")"}},persistence.store.sql.config(persistence,persistence.store.cordovasql.sqliteDialect),f=persistence.db.connect(a,b,c,d,e),!f)throw new Error("No supported database found in this browser.")};try{exports.persistence=persistence}catch(e){}if(!window.persistence)throw new Error("persistence.js should be loaded before persistence.migrations.js");!function(){var a={migrations:[],version:function(a){persistence.transaction(function(b){b.executeSql("SELECT current_version FROM schema_version",null,function(c){0==c.length?b.executeSql("INSERT INTO schema_version VALUES (0)",null,function(){a(0)}):a(c[0].current_version)})})},setVersion:function(b,c){persistence.transaction(function(d){d.executeSql("UPDATE schema_version SET current_version = ?",[b],function(){a._version=b,c&&c()})})},setup:function(b){persistence.transaction(function(c){c.executeSql("CREATE TABLE IF NOT EXISTS schema_version (current_version INTEGER)",null,function(){a.migration(0,{up:function(){},down:function(){}}),b&&b()})})},reset:function(b){a.migrations=[],a.migration(0,{up:function(){},down:function(){}}),a.setVersion(0,b)},migration:function(c,d){return a.migrations[c]=new b(c,d),a.migrations[c]},migrateUpTo:function(b,c){function d(){var a=e.pop();a||c(),a.up(function(){e.length>0?d():c&&c()})}var e=[];this.version(function(f){for(var g=f+1;g<=b;g++)e.unshift(a.migrations[g]);e.length>0?d():c&&c()})},migrateDownTo:function(b,c){function d(){var a=e.pop();a||c(),a.down(function(){e.length>0?d():c&&c()})}var e=[];this.version(function(f){for(var g=f;g>b;g--)e.unshift(a.migrations[g]);e.length>0?d():c&&c()})},migrate:function(b,c){1===arguments.length&&(c=b,b=this.migrations.length-1),this.version(function(d){d<b?a.migrateUpTo(b,c):d>b?a.migrateDownTo(b,c):c()})}},b=function(a,b){this.version=a,this.body=b,this.actions=[]};b.prototype.executeActions=function(b,c){var d=this.actions,e=void 0!==c?c:this.version;persistence.transaction(function(c){function f(){if(0==d.length)a.setVersion(e,b);else{var g=d.pop();g(c,f)}}f()})},b.prototype.up=function(a){this.body.up&&this.body.up.apply(this),this.executeActions(a)},b.prototype.down=function(a){this.body.down&&this.body.down.apply(this),this.executeActions(a,this.version-1)},b.prototype.createTable=function(a,b){var d=new c;b&&b(d);for(var e,f="CREATE TABLE "+a+" (id VARCHAR(32) PRIMARY KEY";e=d.columns.pop();)f+=", "+e;this.executeSql(f+")")},b.prototype.dropTable=function(a){var b="DROP TABLE "+a;this.executeSql(b)},b.prototype.addColumn=function(a,b,c){var d="ALTER TABLE "+a+" ADD "+b+" "+c;this.executeSql(d)},b.prototype.removeColumn=function(a,b){this.action(function(c,d){var e='select sql from sqlite_master where type = "table" and name == "'+a+'"';c.executeSql(e,null,function(e){for(var f=new RegExp("CREATE TABLE `\\w+` |\\w+ \\((.+)\\)").exec(e[0].sql)[1].split(", "),g=[],h=[],i=0;i<f.length;i++){var j=new RegExp("((`\\w+`)|(\\w+)) .+").exec(f[i])[1];j!=b&&(h.push(f[i]),g.push(j))}h=h.join(", "),g=g.join(", ");var k=[];k.unshift(["ALTER TABLE "+a+" RENAME TO "+a+"_bkp;",null]),k.unshift(["CREATE TABLE "+a+" ("+h+");",null]),k.unshift(["INSERT INTO "+a+" SELECT "+g+" FROM "+a+"_bkp;",null]),k.unshift(["DROP TABLE "+a+"_bkp;",null]),persistence.executeQueriesSeq(c,k,d)})})},b.prototype.addIndex=function(a,b,c){var d="CREATE "+(c===!0?"UNIQUE":"")+" INDEX "+a+"_"+b+" ON "+a+" ("+b+")";this.executeSql(d)},b.prototype.removeIndex=function(a,b){var c="DROP INDEX "+a+"_"+b;this.executeSql(c)},b.prototype.executeSql=function(a,b){this.action(function(c,d){c.executeSql(a,b,d)})},b.prototype.action=function(a){this.actions.unshift(a)};var c=function(){this.columns=[]};c.prototype.text=function(a){this.columns.unshift(a+" TEXT")},c.prototype.integer=function(a){this.columns.unshift(a+" INT")},c.prototype.real=function(a){this.columns.unshift(a+" REAL")},c.prototype["boolean"]=function(a){this.columns.unshift(a+" BOOL")},c.prototype.date=function(a){this.columns.unshift(a+" DATE")},c.prototype.json=function(a){this.columns.unshift(a+" TEXT")},persistence.migrations={},persistence.migrations.Migrator=a,persistence.migrations.Migration=b,persistence.migrations.init=function(){a.setup.apply(a,Array.prototype.slice.call(arguments,0))},persistence.migrate=function(){a.migrate.apply(a,Array.prototype.slice.call(arguments,0))},persistence.defineMigration=function(){a.migration.apply(a,Array.prototype.slice.call(arguments,0))}}(),function(a){a.fn.scannerDetection=function(b){if(null===b)return a(this).data("scannerDetection",{options:{}}).unbind(".scannerDetection").unbind("keydown.scannerDetection"),this;if("string"==typeof b)return this.each(function(){this.scannerDetectionTest(b)}),this;var c={onComplete:!1,onError:!1,onReceive:!1,timeBeforeScanTest:100,avgTimeByChar:14,minLength:3,endChar:[9,13],stopPropagation:!1,preventDefault:!1};return"function"==typeof b&&(b={onComplete:b}),b="object"!==("undefined"==typeof b?"undefined":_typeof(b))?a.extend({},c):a.extend({},c,b),this.each(function(){var c,d=this,e=a(d),f=0,g=0,h="",i=!1,j=!1,k="",l=function(){f=0,h="",k=""};d.scannerDetectionTest=function(i){if(i&&(f=g=0,h=i,k=i),h.length>=b.minLength&&g-f<h.length*b.avgTimeByChar){var j;return b.onComplete&&(j=h?h.replace(/\W/g,""):null,b.onComplete.call(d,j)),e.trigger("scannerDetectionComplete",{string:h}),l(),!0}if(b.onError&&b.onError.call(d,h),e.trigger("scannerDetectionError",{string:h}),c){var m=a(c).val()+k;a(c).val(m),angular.element(a(c)).triggerHandler("input"),a(c).trigger("input")}return l(),!1},e.data("scannerDetection",{options:b}).unbind(".scannerDetection").bind("keydown.scannerDetection",function(a){if(a.which>=48&&a.which<=90&&("text"===a.target.type||"search"===a.target.type)?(a.preventDefault(),
c=a.target,k=a.shiftKey||a.which<65?String.fromCharCode(a.which):String.fromCharCode(a.which+32)):c=null,b.stopPropagation&&a.stopImmediatePropagation(),b.preventDefault&&a.preventDefault(),f&&b.endChar.indexOf(a.which)!==-1?(a.preventDefault(),a.stopImmediatePropagation(),i=!0):(h+=String.fromCharCode(a.which),i=!1),f||(f=Date.now()),g=Date.now(),j&&clearTimeout(j),i?(d.scannerDetectionTest(),j=!1):j=setTimeout(d.scannerDetectionTest,b.timeBeforeScanTest),b.onReceive&&b.onReceive.call(d,a),e.trigger("scannerDetectionReceive",{evt:a}),f&&b.endChar.indexOf(a.which)!==-1){var l=jQuery.Event("keypress",a);l.type="keypress.scannerDetection",c||e.triggerHandler(l),a.preventDefault(),a.stopImmediatePropagation()}})}),this}}(jQuery),function(angular,a){function b(a){if(a instanceof Error)return a.stack?a=a.message&&a.stack.indexOf(a.message)<0?"Error: "+a.message+"\n"+a.stack:a.stack:a.sourceURL&&(a=a.message+"\n"+a.sourceURL+":"+a.line),a;if(!angular.isString(a))try{var b=JSON.stringify(JSON.decycle(a));return b}catch(c){return a}return a}var c=angular.module("rollingLog",[]);c.factory("$roll",["$q",function(c){function d(a){var b=c.defer();return window.resolveLocalFileSystemURL(a,function(a){return b.resolve(a)},function(a){return b.reject(a)}),b.promise}function e(){var a=c.defer();return window.requestFileSystem(LocalFileSystem.PERSISTENT,1048576,function(b){return a.resolve(b)},function(b){return a.reject(b)}),a.promise}var f={location:null,writer:null};return f.removeFile=function(a){var b=c.defer();return e().then(function(c){c.root.getFile(a,{create:!1},function(a){return a.remove(function(){return b.resolve()})})}),b.promise},f.moveFile=function(a,b){var d=c.defer();return a.moveTo(f.location,b,function(a){return d.resolve(a)},function(a){return d.reject(a)}),d.promise},f.getFileSize=function(a){var b=c.defer();return a.file(function(a){return b.resolve(a.size)},function(a){return b.reject(a)}),b.promise},f.getFile=function(a){var b=c.defer();return f.location?f.location.getFile(a,{create:!0,exclusive:!1},function(a){return b.resolve(a)},function(a){return b.reject(a)}):b.reject("Please set location before getting a file."),b.promise},f.setWriter=function(a){var b=c.defer();return a.createWriter(function(a){f.writer=a,f.writer.seek(f.writer.length),b.resolve(f.writer)},function(a){return b.reject(a)}),b.promise},f.write=function(a){var b=c.defer();return f.writer?(f.writer.onwrite=function(){return b.resolve("Write to file success.")},f.writer.onerror=function(a){return b.reject(a)},f.writer.write(a)):b.reject("No writer defined. Please use setWriter before writing."),b.promise},f.setLocation=function(a){var b=c.defer();return d(a).then(function(a){f.location=a,b.resolve(a)},function(a){return b.reject(a)}),b.promise},{logs:[],logCurr:".0.txt",logLast:".1.txt",started:!1,listenForPause:function(a){a?document.addEventListener("pause",this.getOnPause(),!1):document.removeEventListener("pause",this.getOnPause(),!1)},readCurrent:function(){var a=this.config.prefix+this.logCurr,b=c.defer();return f.getFile(a).then(function(a){a.file(function(a){var c=new FileReader;c.onloadend=function(a){b.resolve(this.result)},c.readAsText(a)})})["catch"](function(a){b.reject(a)}),b.promise},writeToFile:function(a){var b=this;if(!a||a.length<=0)return c.when("Success");var d,e="",g=c.defer(),h=this.config.prefix+this.logCurr,i=this.config.prefix+this.logLast;return f.getFile(h).then(function(a){return d=a,f.getFileSize(d)}).then(function(a){return a>b.config.logSize?f.moveFile(d,i).then(function(a){return f.getFile(h)}).then(function(a){return d=a,f.setWriter(d)}):f.setWriter(d)}).then(function(){for(;a.length>0;)e+="\n"+a.shift();return f.write(e)}).then(function(a){g.resolve("success")})["catch"](function(b){console.error(b,"Error writing to log file.. Adding old logs to logs variable for next time."),a.push.apply(a,_toConsumableArray(e.split("\n"))),g.reject(b)})["finally"](function(){b.started=!0}),g.promise},writeLog:function(a,c){if(!(c.length<=0)){var d=[].slice.call(c).map(b).join(" ");this.logs.push(d),this.started&&("error"===a||this.logs.length>this.config.eventBuffer)&&(this.started=!1,this.writeToFile(this.logs,this.directory))}},getOnPause:function(){var a=this;return function(){a.writeNow()}},config:{logSize:25600,eventBuffer:25,debug:!1,console:!1,writeOnPause:!1,prefix:"log",directory:"dataDirectory"},setConfig:function(a){return a?(void 0!==a.logSize&&(this.config.logSize=parseInt(a.logSize,10)),void 0!==a.eventBuffer&&(this.config.eventBuffer=parseInt(a.eventBuffer,10)),void 0!==a.debug&&(this.config.debug=!!a.debug),void 0!==a.console&&(this.config.console=!!a.console),void 0!==a.writeOnPause&&(this.config.writeOnPause=!!a.writeOnPause,this.listenForPause(this.config.writeOnPause)),void 0!==a.prefix&&a.prefix.length>=1&&(this.config.prefix=a.prefix),void 0!==a.directory&&(this.config.directory=a.directory),this.config):this.config},start:function(){var b,d=this,e=c.defer();try{if(!window.cordova)throw"Cordova not found";b=a.file[this.config.directory],this.debug("Setting location to Cordova file data directory: "+b),f.setLocation(b).then(function(a){d.started=!0,e.resolve("Rolling logger started.")},function(a){console.error(a),e.reject("Rolling logger unable to start.")})}catch(g){console.error(g),console.error("No file logging during this session"),e.reject("Rolling logger unable to start")}return e.promise},writeNow:function(){return this.started?this.writeToFile(this.logs,this.directory):c.reject("No file to write to")},log:function(){this.writeLog("log",arguments)},info:function(){this.writeLog("info",arguments)},error:function(){this.writeLog("error",arguments)},debug:function(){this.writeLog("debug",arguments)},warn:function(){this.writeLog("warn",arguments)},trace:function(){this.writeLog("trace",arguments)}}}])}(angular,cordova),function(angular){angular.module("ion-autocomplete",[]).directive("ionAutocomplete",["$ionicTemplateLoader","$ionicBackdrop","$ionicScrollDelegate","$rootScope","$document","$q","$parse","$ionicPlatform","$log","$timeout",function(a,b,c,d,e,f,g,h,i,j){return{require:"?ngModel",restrict:"A",scope:{model:"=ngModel",placeholder:"@",cancelLabel:"@",selectItemsLabel:"@",selectedItemsLabel:"@",templateUrl:"@",templateData:"=",itemsMethod:"&",itemsMethodValueKey:"@",itemValueKey:"@",itemViewValueKey:"@",multipleSelect:"@",itemsClickedMethod:"&",itemsRemovedMethod:"&",componentId:"@",modelToItemMethod:"&",loadingIcon:"@",hasUseWhereClause:"=",title:"@"},link:function(d,k,l,m){function n(a){var b=d.getItemValue(a,d.itemViewValueKey);return b?(b=replaceAll(b,"undefined|null",""),b.startsWith(" -")||b.endsWith("- ")?replaceAll(b," - | -|- ",""):b):""}function o(a){var b=n(a);d.$emit("sw:ionAutocomplete:viewValue",b),k.val(b)}if(m){var p="ion-content ion-item.item-text-wrap:first";d.placeholder=d.placeholder?d.placeholder:"Search for...",d.cancelLabel=d.cancelLabel?d.cancelLabel:"true"===d.multipleSelect?"Done":"Cancel",d.selectItemsLabel=d.selectItemsLabel?d.selectItemsLabel:"Select an item...",d.selectedItemsLabel=d.selectedItemsLabel?d.selectedItemsLabel:"Selected items:",d.templateUrl=d.templateUrl?d.templateUrl:"",d.loadingIcon=d.loadingIcon?d.loadingIcon:"",d.useWhereClause=!0,d.fontCache=null,d.showLoadingIcon=!1,d.items=[],d.selectedItems=[],d.searchQuery=void 0,d.getItemValue=function(a,b){if(angular.isArray(a)){var c=[];return angular.forEach(a,function(d){b&&angular.isObject(a)?c.push(g(b)(d)):c.push(d)}),c}return b&&angular.isObject(a)?g(b)(a):a},d.$on("sw:association:resolved",function(a,b){var c=b[d.componentId];c&&o(c.item)}),m.$render=function(){var a=n(m.$viewValue);k.val(a),d.$emit("sw:ionAutocomplete:viewValue",a)},m.$formatters.push(n),m.$parsers.push(function(a){return d.getItemValue(a,d.itemValueKey)});var q=['<div class="ion-autocomplete-container modal">','<ion-header-bar class="bar-positive bar bar-header" align-title="center">','<div class="buttons buttons-left">','<span class="left-buttons">','<button class="ion-autocomplete-cancel button-icon"><i class="fa fa-chevron-left"></i>&ensp;Back</button>',"</span>","</div>",'<div class="title title-center header-item" style="left: 86px !important; right: 86px !important;">{{title}}</div>','<div class="buttons buttons-right">','<span class="right-buttons">','<button class="ion-autocomplete-clear button-icon"><i class="fa fa-eraser"></i>&ensp;Clear</button>',"</span>","</div>","</ion-header-bar>",'<ion-header-bar class="bar-subheader bar-dark bar bar-header" align-title="center" ng-class="{\'hasusewhereclause\' : hasUseWhereClause}">','<label class="item-input-wrapper search">','<i class="placeholder-icon fa fa-search"></i>','<input type="search" class="ion-autocomplete-search" ng-model="searchQuery" ng-model-options="{ debounce: 500 }" placeholder="{{placeholder}}"/>',"</label>",'<label class="item-input-wrapper preferred" ng-show="hasUseWhereClause">','<div class="label">Preferred</div>','<ion-toggle toggle-class="toggle-light" ng-model="useWhereClause"></ion-toggle>',"</label>","</ion-header-bar>",'<ion-content class="has-header" has-bouncing="false">',"<ion-list>",'<ion-item class="item-divider" ng-show="selectedItems.length > 0">{{selectedItemsLabel}}</ion-item>','<ion-item ng-repeat="selectedItem in selectedItems track by $index" type="item-text-wrap" class="item-icon-left item-icon-right">','<i class="fa fa-check"></i>',"{{getItemValue(selectedItem, itemViewValueKey)}}",'<i class="fa fa-trash" style="cursor:pointer" ng-click="removeItem($index)"></i>',"</ion-item>",'<ion-item class="item-divider" ng-show="items.length > 0">{{selectItemsLabel}}</ion-item>','<ion-item class="item-divider" ng-show="!items || items.length === 0">No results were found.</ion-item>','<ion-item collection-repeat="item in items" item-height="getItemHeight(getItemValue(item, itemViewValueKey))" item-width="100%" type="item-text-wrap" ng-click="selectItem(item)" class="item item-text-wrap" style="padding-right: 26px;">','<i ng-show="isItemSelected(item)" class="fa fa-check" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%);"></i>',"{{getItemValue(item, itemViewValueKey)}}","</ion-item>","</ion-list>",'<ion-infinite-scroll ng-if="moreItemsAvailable" on-infinite="loadMore()" distance="10%"></ion-infinite-scroll>',"</ion-content>","</div>"].join("");d.templateCompileStarted=!1;var r=function(){document.activeElement===k[0]&&k[0].blur(),d.templateCompileStarted||(d.templateCompileStarted=!0,a.compile({templateUrl:d.templateUrl,template:q,scope:d,appendTo:e[0].body}).then(function(a){function e(b,d){if((!g||g.showing)&&(d=d||1,a.scope.lastPage=d,void 0!==b&&(""==b&&1===d&&(a.scope.items=[]),angular.isFunction(a.scope.itemsMethod)))){a.scope.showLoadingIcon=!0;var e={query:b,useWhereClause:a.scope.useWhereClause,pageNumber:d};a.scope.componentId&&(e.componentId=a.scope.componentId);var h=f.when(a.scope.itemsMethod(e));h.then(function(b){j(function(){b&&b.data&&(b=b.data);var e=a.scope.getItemValue(b,a.scope.itemsMethodValueKey);1===d?a.scope.items=e:(a.scope.$broadcast("scroll.infiniteScrollComplete"),a.scope.items=a.scope.items.concat(e)),a.scope.moreItemsAvailable=e.length>0,c.resize(),a.scope.showLoadingIcon=!1},0)},function(b){return a.scope.showLoadingIcon=!1,f.reject(b)})}}angular.element(a.element.find("input"));a.scope.isItemSelected=function(b){return!!b&&a.scope.getItemValue(b,a.scope.itemValueKey)===a.scope.model},a.scope.getItemHeight=function(b){var c=$(a.element).find(p).width(),d=a.scope.getTextWidth(b),e=Math.ceil(d/c);return 20*e+32},a.scope.getTextWidth=function(b){var c=a.scope.getTextWidth.canvas||(a.scope.getTextWidth.canvas=document.createElement("canvas")),e=c.getContext("2d");d.fontCache||(d.fontCache=$(a.element).find(p).css("font")),e.font=d.fontCache;var f=e.measureText(b);return f.width},a.scope.selectItem=function(b){a.scope.items=[],a.scope.searchQuery=void 0,"true"===a.scope.multipleSelect?(t(a.scope.selectedItems,a.scope.itemValueKey,d.getItemValue(b,d.itemValueKey))||(a.scope.selectedItems=a.scope.selectedItems.concat([b])),m.$setViewValue(a.scope.selectedItems),m.$render()):(m.$setViewValue(b),m.$render(),n()),angular.isFunction(a.scope.itemsClickedMethod)&&a.scope.itemsClickedMethod({callback:{item:b,componentId:a.scope.componentId,selectedItems:a.scope.selectedItems.slice()}})},a.scope.removeItem=function(b){var c=a.scope.selectedItems.splice(b,1)[0];a.scope.selectedItems=a.scope.selectedItems.slice(),m.$setViewValue(a.scope.selectedItems),m.$render(),angular.isFunction(a.scope.itemsRemovedMethod)&&a.scope.itemsRemovedMethod({callback:{item:c,selectedItems:a.scope.selectedItems.slice(),componentId:a.scope.componentId}})};var g={showing:!1};a.scope.loadMore=function(){var b=void 0===a.scope.searchQuery?"":a.scope.searchQuery;e(b,a.scope.lastPage+1)},a.scope.$watch("searchQuery",function(a){e(a)}),a.scope.$watch("useWhereClause",function(){var b=void 0===a.scope.searchQuery?"":a.scope.searchQuery;e(b)});var l=function(){g.showing||(b.retain(),a.element.css("display","block"),d.$deregisterBackButton=h.registerBackButtonAction(function(){n()},300),g.showing=!0)},n=function(){a.element.css("display","none"),b.release(),d.$deregisterBackButton&&d.$deregisterBackButton(),g.showing=!1},o={moved:!1,startX:0,startY:0},q=function(a){i.get("ionautocomplete#ontouchstart").trace("ontouchstart handler"),o.moved=!1,"undefined"!=typeof a.originalEvent&&(a=a.originalEvent),o.startX=a.touches[0].clientX,o.startY=a.touches[0].clientY},r=function(a){i.get("ionautocomplete#ontouchmove").trace("ontouchmove handler"),"undefined"!=typeof a.originalEvent&&(a=a.originalEvent),(Math.abs(a.touches[0].clientX-o.startX)>10||Math.abs(a.touches[0].clientY-o.startY)>10)&&(o.moved=!0)},s=ionic.debounce(function(a){i.get("ionautocomplete#onclick").trace("onclick handler"),o.moved||ionic.scroll.isScrolling||(a&&(a.preventDefault(),a.stopPropagation()),l(),e(""),c.resize())},0),t=function(a,b,c){for(var e=0;e<a.length;e++)if(d.getItemValue(a[e],b)===c)return!0;return!1},u=function(b){var c=f.when(a.scope.modelToItemMethod({modelValue:b}));c.then(function(b){a.scope.selectItem(b)},function(a){return f.reject(a)})};k.bind("touchstart",q),k.bind("touchmove",r),k.bind("click focus",s),$(a.element).find(".ion-autocomplete-cancel").bind("click",function(b){a.scope.searchQuery=void 0,n()}),$(a.element).find(".ion-autocomplete-clear").bind("click",function(b){a.scope.items=[],m.$setViewValue(null),m.$render(),a.scope.searchQuery=void 0,n()}),a.scope.model&&angular.isFunction(a.scope.modelToItemMethod)&&"true"===a.scope.multipleSelect&&angular.isArray(a.scope.model)&&angular.forEach(a.scope.model,function(a){u(a)}),s()}))};k.bind("touchend click focus",r)}}}}]).directive("ionAutocomplete",function(){return{require:"?ngModel",restrict:"E",template:'<textarea ion-autocomplete class="ion-autocomplete item-text-wrap" autocomplete="off" autosize-textarea></textarea>',replace:!0}})}(angular),function(angular){angular.module("persistence.offline",[])}(angular),function(angular,persistence){angular.module("persistence.offline").provider("offlineEntities",[function(){var a={},b={entities:a,define:function(b,c){a[b]=persistence.define(b,c)},$get:[function(){return a}]};return b}])}(angular,persistence),function(angular,persistence){function a(a,b,c,d){var e=function(){var c=persistence.migrations.Migrator,e=persistence.migrations.Migration,f=c.migrations.slice(1),g=b.getInstance("offlineMigrationService");c.migrateSw=function(){var b=[];return persistence.runSql("select id from migrations").then(function(c){if(!c)return a.when();angular.forEach(c,function(a){b.push(a.id)});var d=[];angular.forEach(f,function(a){a.body.id||g.warn("Migration ignored due to absence of id."),a.body.id&&b.indexOf(a.body.id)<0&&d.push(a)});var e=a.defer(),h=function(){e.resolve()},i=d.reverse(),j=function k(){var a=i.pop();if(!a)return void h();var b=a.body.id;a.up(function(){persistence.runSql("insert into migrations (id,applied) values (?,?)",[b,(new Date).getTime()]).then(function(){i.length>0?k():h()})})};return j(),e.promise})};var h=e.prototype.createTable;e.prototype.createTable=function(a,b){var c=function(a){a.varchar=function(b,c){a.columns.unshift(b+" VARCHAR("+c+")")},a.numeric=function(b){a.columns.unshift(b+" NUMERIC")},b(a)};h.call(this,a,c)},e.prototype.addIndex=function(a,b,c,e){var f=d.addIndexQuery(a,b,c,e);this.executeSql(f)}},f=function(){return persistence.runSql("CREATE TABLE IF NOT EXISTS migrations (id VARCHAR(255) PRIMARY KEY, applied DATE)").then(function(){e()})},g=function(){angular.forEach(c,function(a,b){persistence.defineMigration(b+1,a)});var b=a.defer();return persistence.migrations.init(function(){f().then(function(){return persistence.migrations.Migrator.migrateSw()}).then(function(){b.resolve()})}),b.promise},h={migrate:g};return h}angular.module("persistence.offline").factory("offlineMigrationService",["$q","$log","offlineMigrations","swdbDAO",a])}(angular,persistence),function(angular){angular.module("persistence.offline").provider("offlineMigrations",function(){function a(a,b){for(var c=a+"";c.length<b;)c="0"+c;return c}var b={},c=function(){function b(c,d){_classCallCheck(this,b),this.id=c,this.tag=d,this.stringId=a(c,8),this.migrations=[]}return _createClass(b,[{key:"addMigration",value:function(a,b){console.log("adding migration "+a),b.id=this.stringId+"-"+(this.tag||"")+"-"+(a||""),this.migrations.push(b)}}]),b}(),d={migrationGroups:b,createMigrationGroup:function(a,d){var e=new c(a,d);return b[a]=e,e},$get:[function(){var a=[],c=[];return angular.forEach(b,function(a,d){d&&b.hasOwnProperty(d)&&c.push(Number(d))}),c=c.sort(function(a,b){return a-b}),angular.forEach(c,function(c){a=a.concat(b[c].migrations)}),a}]};return d})}(angular),function(angular,persistence){function a(a,b,c,d){function e(){return i.info("Initing Persistence..."),persistence.store.cordovasql.config(persistence,"offlineswdb","1.0","SWDB OffLine instance",5242880,0),persistence.debug="true"===sessionStorage.logsql||"debug"===sessionStorage.loglevel||"debug"===sessionStorage.log_persistence,persistence.runSql=j,i.info("Start Migrations..."),d.migrate().then(function(){i.info("Persistence Ready."),k()})}function f(a){a&&a.persistenceReady&&(h?a.persistenceReady():g.push(a))}var g=[],h=!1,i=c.get("offlinePersitenceBootstrap"),j=function(c,d){var e=b.defer();return persistence.transaction(function(b){b.executeSql(c,d,function(b){persistence.debug&&console.log(b),e.resolve(b),"undefined"!=typeof jasmine&&a.$digest()},function(a){var b="An error ocurred when executing the query '{0}'".format(c);d&&d.length>0&&(b+=" with parameters {0}".format(d));var f=new Error(b);f.cause=a,console.error(f),e.reject(f)})}),e.promise},k=function(){h=!0,angular.forEach(g,function(a){a.persistenceReady()}),g.splice(0,g.length)},l={init:e,addPersistenceReadyListener:f};return l}angular.module("persistence.offline").factory("offlinePersitenceBootstrap",["$rootScope","$q","$log","offlineMigrationService",a])}(angular,persistence),function(angular){function a(a,c,d,e,f){function g(){var a=f.currentFullUser();if(null==a)return f.logout();var b=a.properties.laborcode;if(!b){var c=f.currentFullUser().PersonId,d=c.indexOf(".");d!==-1&&(b=c.substring(0,1).toUpperCase()+c.substring(d+1,c.length).toUpperCase())}return b}function h(a,b){var d=g(),e=c.getIndexColumn(a.applicationName,a,"laborcode").replace("`root`","`"+b+"`");return e+" LIKE '"+d+"'"}function i(a,e){var f=a.offlineAssociations[e],i=d.getApplicationByName(f.to,!0),j=i.data.schemasList.find(function(a){return"list"===a.stereotypeAttr}),k=i.association?"AssociationData":"DataEntry",l=" left join "+k+" as `"+e+"` on (",m=f.attributes.find(function(a){return!!a.primary}),n=c.getIndexColumn(a.applicationName,a,m.from),o=c.getIndexColumn(j.applicationName,j,m.to).replace("`root`","`"+e+"`"),p="1=1";a.applicationName.equalsAny("workorder","todayworkorder","pastworkorder")&&(p=h(j,e));var q="`"+e+"`.application= 'assignment'",r=new Date,s=new Date(r.getFullYear(),r.getMonth(),r.getDate(),0,0,0).getTime(),t=s+b,u="`"+e+"`.dateindex02 = (select max(b.dateindex02) from AssociationData b where b.textindex01 = `"+e+"`.textindex01 and b.application = 'assignment' and b.textindex02 = "+("'"+g()+"'");return"todayworkorder"===a.applicationName?u+=" and b.dateindex02 <= "+t:"pastworkorder"===a.applicationName&&(u+=" and b.dateindex02 < "+s),u+=")",l+=n+" = "+o+" and "+p+" and "+q+"  and "+u+" )"}function j(b){var d=b.displayables.filter(function(a){return a.attribute.startsWith("#")&&a.attribute.contains(".")}).map(function(a){return a.attribute}),e=c.getSearchColumnsByApp(b.applicationName).find(function(a){return a.startsWith("#")&&a.contains(".")}),f=e?new Set(d.concat(e)):d;if(0===f.length)return{};k.debug("building left join parameters");var g=new Map,h=[],j=new Set;return f.forEach(function(b){var c=a.findRelatedEntityName(b).entityName;g.has(c)||(k.trace("adding entity "+c+" as a left join"),g.set(c,{field:"`"+c+"`.datamap",alias:"`#datamap."+c+"`"})),j.add(c)}),j.forEach(function(a){h.push(i(b,a))}),{additionalJoins:h,extraProjectionFields:Array.from(g.values())}}var k=e.get("queryListBuilderService",["list","search"]),l={buildJoinParameters:j};return l}var b=864e5;angular.module("persistence.offline").factory("queryListBuilderService",["offlineSchemaService","searchIndexService","metadataModelService","$log","securityService",a])}(angular),function(angular,persistence){angular.module("persistence.offline").factory("swdbDAO",["$q","offlineEntities",function(a,b){function c(a){if(!b[a])throw new Error("entity {0} not found".format(a));return b[a]}function d(a,b,d){d=d||{};var e=d.pageNumber||1,f=d.orderby||null,g=d.orderbyascending,h=d.pagesize,i=d.projectionFields||[],j=d.extraProjectionFields||[],k=d.additionalJoins||[],l=d.fullquery,m=d.prefetch,n=c(a).all();return h&&(n=n.limit(h),n=n.skip(h*(e-1))),n._additionalWhereSqls=[],n._projectionFields=[],n._extraProjectionFields=[],n._additionalJoinSqls=[],n._querytoUse=null,b&&n._additionalWhereSqls.push(b),i.length>0&&(n._projectionFields=i),k.length>0&&(n._additionalJoinSqls=k),j.length>0&&(n._extraProjectionFields=j),m&&(n=n.prefetch(m)),f&&(n=n.order(f,g)),l&&(n._querytoUse=l),n}function e(c,d,e){if(!b[c])throw new Error("entity {0} not found".format(c));d=d||{};var f=a.defer(),g=b[c];if(null==d.id||d._type&&d._type!=c){var h=new g;return e?f.resolve(e(d,h)):f.resolve(mergeObjects(d,h)),f.promise}return g.load(d.id,function(a){a||(a=new g),e?f.resolve(e(d,a)):f.resolve(mergeObjects(d,a))}),f.promise}function f(c,d){var e=b[c];return e?this.findSingleByQuery(c,"id='"+d+"'"):a.reject(new Error("entity {0} not found".format(c)))}function g(b,c){var e=a.defer(),f=d(b,null,c);return f.list(null,function(a){e.resolve(a)}),e.promise}function h(b,c,e){var f=a.defer(),g=d(b,c,e);try{g.list(null,function(a){f.resolve(a)})}catch(h){f.reject(h)}return f.promise}function i(b){var c=a.defer(),d=c.promise;return this.findAll(b).then(function(a){0==a.length?c.resolve(null):c.resolve(a[0])}),d}function j(b,c){persistence.add(b);var d=a.defer(),e=d.promise;return c?(d.resolve(),e):(persistence.flush(function(){d.resolve(b)}),e)}function k(b){var c=a.defer();return persistence.transaction(function(a){b?c.resolve([a,b]):c.resolve([a])}),c.promise}function l(b,c){if(null==b)return a.when();for(var d=0;d<b.length;d++)persistence.add(b[d]);var e=a.defer(),f=e.promise;return c?(e.resolve(b),f):(persistence.flush(function(){e.resolve(b)}),f)}function m(b,c){var d=a.defer(),e=d.promise;if(!b||0==b.length)return d.resolve(),e;for(var f=0;f<b.length;f++)persistence.remove(b[f]);return c?(d.resolve(b),e):(persistence.flush(function(){d.resolve()}),e)}function n(a,b){return this.executeQueries([a],b,!1)}function o(b,c,d){void 0==d&&(d=!0);var e=a.defer(),f=e.promise,g=b.map(function(a){return angular.isString(a)?[a]:[a.query,a.args]});return c?d?persistence.executeQueriesSeqForceBatch(c,g,function(a,b){return b?e.reject(b):e.resolve(a)}):persistence.executeQueriesSeq(c,g,function(a,b){return b?e.reject(b):e.resolve(a)}):persistence.transaction(function(a){d?persistence.executeQueriesSeqForceBatch(a,g,function(a,b){return b?e.reject(b):e.resolve(a)}):persistence.executeQueriesSeq(a,g,function(a,b){return b?e.reject(b):e.resolve(a)})}),f}function p(a,b,c){var d=c?angular.copy(c):{};return d.pagesize=1,d.pageNumber=1,this.findByQuery(a,b,d).then(function(a){return!a||a.length<=0?null:a[0]})}function q(b,c,e){var f=a.defer(),g=d(b,c,e);return g.count(function(a){return f.resolve(a)}),f.promise}function r(a){var c=[];for(var d in b)!b.hasOwnProperty(d)||a.indexOf(d)>=0||c.push("delete from {0}".format(d));return this.executeQueries(c)}function s(a){if(!b[a])throw new Error("entity {0} not found".format(a));return this.executeQuery("delete from {0}".format(a))}function t(){var a=this,b=[];return persistence.runSql("SELECT name FROM sqlite_master where type = 'table'").then(function(c){return angular.forEach(c,function(a){a.name.startsWith("_")||b.push("drop table if exists "+a.name)}),a.executeQueries(b)})}function u(){var b=a.defer();return persistence.reset(null,function(a,c){c?b.reject(c):b.resolve(a)}),b.promise}function v(a,b){return persistence.runSql(a,b)}function w(a,b,c,d){var e=b;b instanceof Array&&(e=b.join("_"),b=b.join(","));var f=d||a+"__"+e,g=c===!0?"UNIQUE":"",h="CREATE "+g+" INDEX IF NOT EXISTS "+f+" ON  "+a+" ("+b+")";return h}function x(a,b){var c=b;b instanceof Array&&(c=b.join("_"),b=b.join(","));var d="DROP INDEX IF EXISTS offlineswdb."+a+"_"+c;this.executeQuery(d)}var y={bulkSave:l,bulkDelete:m,countByQuery:q,createTx:k,dropIndex:x,executeStatement:v,executeQuery:n,executeQueries:o,findAll:g,findById:f,findByQuery:h,findUnique:i,findSingleByQuery:p,instantiate:e,save:j,recreateDataBase:u,dropDataBase:t,deleteTable:s,addIndexQuery:w,resetDataBase:r};return y}])}(angular,persistence),function(angular,persistence){angular.module("persistence.offline").config(["offlineEntitiesProvider",function(a){var b=a.entities;b.OptionFieldData=persistence.define("OptionFieldData",{application:"TEXT",schema:"TEXT",providerAttribute:"TEXT",optionkey:"TEXT",optionvalue:"TEXT",extraprojectionvalues:"JSON"}),b.AssociationData=persistence.define("AssociationData",{application:"TEXT",datamap:"JSON",rowstamp:"INT",remoteid:"NUMERIC",textindex01:"TEXT",textindex02:"TEXT",textindex03:"TEXT",textindex04:"TEXT",textindex05:"TEXT",numericindex01:"NUMERIC",numericindex02:"NUMERIC",dateindex01:"DATE",dateindex02:"DATE",dateindex03:"DATE"}),b.AssociationCache=persistence.define("AssociationCache",{data:"JSON"}),b.AssociationData.InsertionPattern="INSERT {0} INTO AssociationData (application,datamap,rowstamp,id,textindex01,textindex02,textindex03,textindex04,textindex05,numericindex01,numericindex02,dateindex01,dateindex02,dateindex03,remoteid) values (?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)",b.AssociationData.maxRowstampQueries="select max(rowstamp) as rowstamp,application,id from AssociationData group by application",b.AssociationData.maxRemoteIdQueries="select max(CAST(remoteid as int)) as remoteid,application,id from AssociationData group by application",b.AssociationData.maxRowstampQueryByApps="select max(rowstamp) as rowstamp,application,id from AssociationData where application in ({0}) group by application",b.AssociationData.maxRemoteIdQueryByApps="select max(CAST(remoteid as int)) as remoteid,application,id from AssociationData where application in ({0}) group by application",b.Batch=persistence.define("Batch",{application:"TEXT",sentDate:"DATE",completionDate:"DATE",lastChecked:"DATE",remoteId:"TEXT",status:"TEXT"}),b.BatchItem=persistence.define("BatchItem",{label:"TEXT",status:"TEXT",crudoperation:"TEXT"}),b.Batch.hasMany("items",b.BatchItem,"batch"),b.CompositionDataEntry=persistence.define("CompositionDataEntry",{application:"TEXT",datamap:"JSON",remoteId:"TEXT",isDirty:"BOOL",rowstamp:"INT",textindex01:"TEXT",textindex02:"TEXT",textindex03:"TEXT",textindex04:"TEXT",textindex05:"TEXT",numericindex01:"NUMERIC",numericindex02:"NUMERIC",dateindex01:"DATE",dateindex02:"DATE",dateindex03:"DATE"}),b.CompositionDataEntry.insertionQueryPattern="insert into CompositionDataEntry (application,datamap,isDirty,remoteId,rowstamp,id,'textindex01','textindex02','textindex03','textindex04','textindex05','numericindex01','numericindex02','dateindex01','dateindex02','dateindex03') values (:p0,:p1,0,:p2,:p3,:p4,:p5,:p6,:p7,:p8,:p9,:p10,:p11,:p12,:p13,:p14)",b.CompositionDataEntry.updateQueryPattern="update CompositionDataEntry set datamap='{0}' rowstamp={1} where remoteId='{2}' and applicaton='{3}'",b.CompositionDataEntry.syncdeletionQuery="delete from CompositionDataEntry where application = '{0}' and remoteId in ({1})",b.CompositionDataEntry.maxRowstampQueries="select max(rowstamp) as rowstamp,application,id from CompositionDataEntry  group by application",b.CompositionDataEntry.selectCompositions="select max(rowstamp) as rowstamp,application,id from CompositionDataEntry  group by application",b.Attachment=persistence.define("Attachment",{application:"TEXT",parentId:"TEXT",compositionRemoteId:"TEXT",docinfoRemoteId:"TEXT",path:"TEXT",compressed:"BOOL",content:"TEXT",mimetype:"TEXT"}),b.Attachment.NonPendingAttachments="select id,compositionRemoteId,docinfoRemoteId from Attachment where (path is not null or content is not null) and (id in ({0}) or docinfoRemoteId in ({1}) )",b.Attachment.UpdateRemoteIdOfExistingAttachments="update Attachment set 'compositionRemoteId' = ?, 'docinfoRemoteId'=? where id = ?",b.Attachment.CreateNewBlankAttachments="insert into Attachment ('application','parentId','compositionRemoteId','docinfoRemoteId','id') values (?,?,?,?,?)",b.Attachment.ByApplicationAndIds="select id,parentId,content from Attachment where application = ? and parentId in ({0}) and compositionRemoteId is null",b.Attachment.PendingAttachments="select id,docinfoRemoteId from Attachment where (path is null and content is null) and compositionRemoteId is not null",b.Attachment.UpdatePendingAttachment="update Attachment set content =? , mimetype=? where id =?",b.Attachment.UpdateAttachmentPath="update Attachment set path =? where docinfoRemoteId =?",b.Attachment.ByDocInfoId="select content,mimetype,path from Attachment where docinfoRemoteId = ?",b.Attachment.ByHashId="select content,mimetype,path from Attachment where id = ?",b.Attachment.DeleteById="delete from Attachment where id = ?",b.Attachment.DeleteMultipleByIdsPattern="delete from Attachment where id in ({0})",b.DataEntry=persistence.define("DataEntry",{application:"TEXT",originaldatamap:"JSON",datamap:"JSON",pending:"BOOL",remoteId:"TEXT",isDirty:"BOOL",hasProblem:"BOOL",rowstamp:"INT",textindex01:"TEXT",textindex02:"TEXT",textindex03:"TEXT",textindex04:"TEXT",textindex05:"TEXT",numericindex01:"NUMERIC",numericindex02:"NUMERIC",dateindex01:"DATE",dateindex02:"DATE",dateindex03:"DATE"}),b.Operation=persistence.define("Operation",{datamap:"JSON",operation:"TEXT",creationDate:"DATE"}),b.DataEntry.hasMany("operations",b.Operation,"entry"),b.DataEntry.maxRowstampByAppQuery="select max(rowstamp) as rowstamp,application,id from DataEntry where application = '{0}'",b.DataEntry.maxRowstampGeneralQuery="select max(rowstamp) as rowstamp,application,id from DataEntry group by application",b.DataEntry.insertionQueryPattern="insert into DataEntry ('application','datamap','pending','isDirty','remoteId','rowstamp','id','textindex01','textindex02','textindex03','textindex04','textindex05','numericindex01','numericindex02','dateindex01','dateindex02','dateindex03') values (:p0,:p1,0,0,:p2,:p3,:p4,:p5,:p6,:p7,:p8,:p9,:p10,:p11,:p12,:p13,:p14)",b.DataEntry.updateQueryPattern="update DataEntry set 'datamap'=:p0,'pending'=0,'rowstamp'=:p1,'textindex01'=:p2,'textindex02'=:p3,'textindex03'=:p4,'textindex04'=:p5,'textindex05'=:p6,'numericindex01'=:p7,'numericindex02'=:p8,'dateindex01'=:p9,'dateindex02'=:p10,'dateindex03'=:p11 where remoteId=:p12 and application=:p13",b.DataEntry.insertOrReplacePattern="INSERT OR REPLACE INTO DataEntry (application,datamap,pending,isDirty,remoteId,rowstamp,id,textindex01,textindex02,textindex03,textindex04,textindex05,numericindex01,numericindex02,dateindex01,dateindex02,dateindex03) values (?,?,0,0,?,?,?,?,?,?,?,?,?,?,?,?,?)",
b.DataEntry.deleteQueryPattern="delete from DataEntry where remoteId in ({0}) and application='{1}'",b.DataEntry.deleteInIdsStatement="delete from DataEntry where id in(?) and application=?",b.DataEntry.deleteLocalStatement="delete from DataEntry where id=? and application=?",b.DataEntry.updateLocalPattern="update DataEntry set 'datamap'=?,'isDirty'=1,'textindex01'=?,'textindex02'=?,'textindex03'=?,'textindex04'=?,'textindex05'=?,'numericindex01'=?,'numericindex02'=?,'dateindex01'=?,'dateindex02'=?,'dateindex03'=? where id =?",b.DataEntry.updateLocalSetOriginalPattern="update DataEntry set 'datamap'=?,'originaldatamap'=?,'isDirty'=1,'textindex01'=?,'textindex02'=?,'textindex03'=?,'textindex04'=?,'textindex05'=?,'numericindex01'=?,'numericindex02'=?,'dateindex01'=?,'dateindex02'=?,'dateindex03'=? where id =?",b.DataEntry.insertLocalPattern="insert into DataEntry ('application','datamap','isDirty','pending','remoteId','rowstamp','id','textindex01','textindex02','textindex03','textindex04','textindex05','numericindex01','numericindex02','dateindex01','dateindex02','dateindex03') values (?,?,1,0,null,null,?,?,?,?,?,?,?,?,?,?,?)",b.DataEntry.restoreToOriginalStateStatement="update DataEntry set isDirty=0,hasProblem=0,datamap=originaldatamap where id=? and application=?",b.DataEntry.findProblems="select p.* from Problem p left join batchitem bi on p.id = bi.problem left join batch b on b.id = bi.batch where bi.dataentry = ? order by b.sentDate desc",b.BatchItem.hasOne("dataentry",b.DataEntry),b.BatchItem.hasOne("operation",b.Operation),b.Problem=persistence.define("Problem",{message:"TEXT"}),b.BatchItem.hasOne("problem",b.Problem),b.SyncOperation=persistence.define("SyncOperation",{startdate:"DATE",enddate:"DATE",lastcheckdate:"DATE",lastsyncServerVersion:"TEXT",status:"TEXT",numberofdownloadeditems:"INT",numberofdownloadedsupportdata:"INT",clientOperationId:"INT",hasProblems:"BOOL",metadatachange:"BOOL",items:"INT"}),b.SyncOperation.hasMany("batches",b.Batch,"syncoperation"),b.Settings=persistence.define("Settings",{localversion:"TEXT",serverurl:"TEXT"}),b.User=persistence.define("User",{name:"TEXT",orgid:"TEXT",siteid:"TEXT"}),b.Configuration=persistence.define("Configuration",{key:"TEXT",value:"JSON"}),b.Application=persistence.define("Application",{application:"TEXT",association:"BOOL",composition:"BOOL",data:"JSON"}),b.WhereClause=persistence.define("WhereClause",{application:"TEXT",parentApplication:"TEXT",metadataid:"TEXT",data:"TEXT"}),b.Menu=persistence.define("Menu",{data:"JSON"}),b.CommandBar=persistence.define("CommandBar",{key:"TEXT",data:"JSON"}),b.Cookie=persistence.define("Cookie",{name:"TEXT",value:"TEXT"}),b.Cookie.index(["name"],{unique:!0}),b.Cookie.insertStatement="insert into Cookie (id, name, value) values (?,?,?)",b.Cookie.updateByNameStatement="update Cookie set value=? where name=?",b.Cookie.deleteByNameStatement="delete from Cookie where name=?",b.Cookie.deleteAllStatement="delete from Cookie",b.ActiveLaborTracker=persistence.define("ActiveLaborTracker",{parentid:"TEXT",laborlocalid:"TEXT"})}])}(angular,persistence),function(angular){angular.module("persistence.offline").config(["offlineMigrationsProvider",function(a){var b=a.createMigrationGroup(5,"offline migrations");b.addMigration("table OptionFieldData",{up:function(){this.createTable("OptionFieldData",function(a){a.text("application"),a.text("schema"),a.text("providerAttribute"),a.text("optionkey"),a.text("optionvalue"),a.json("extraprojectionvalues")})},down:function(){this.dropTable("OptionFieldData")}}),b.addMigration("table AssociationData",{up:function(){this.createTable("AssociationData",function(a){a.text("application"),a.json("datamap"),a.integer("rowstamp"),a.text("textindex01"),a.text("textindex02"),a.text("textindex03"),a.text("textindex04"),a.text("textindex05"),a.numeric("numericindex01"),a.numeric("numericindex02"),a.date("dateindex01"),a.date("dateindex02"),a.date("dateindex03")})},down:function(){this.dropTable("AssociationData")}}),b.addMigration("table AssociationCache",{up:function(){this.createTable("AssociationCache",function(a){a.json("data")})},down:function(){this.dropTable("AssociationCache")}}),b.addMigration("table Batch",{up:function(){this.createTable("Batch",function(a){a.text("application"),a.date("sentdate"),a.date("completionDate"),a.date("lastChecked"),a.text("remoteId"),a.text("status"),a.varchar("syncoperation",32)}),this.addIndex("Batch","syncoperation")},down:function(){this.removeIndex("Batch","syncoperation"),this.dropTable("Batch")}}),b.addMigration("table BatchItem",{up:function(){this.createTable("BatchItem",function(a){a.text("label"),a.text("status"),a.text("crudoperation"),a.varchar("problem",32),a.varchar("operation",32),a.varchar("dataentry",32),a.varchar("batch",32)}),this.addIndex("BatchItem","problem"),this.addIndex("BatchItem","operation"),this.addIndex("BatchItem","dataentry"),this.addIndex("BatchItem","batch")},down:function(){this.removeIndex("BatchItem","batch"),this.removeIndex("BatchItem","dataentry"),this.removeIndex("BatchItem","operation"),this.removeIndex("BatchItem","problem"),this.dropTable("BatchItem")}}),b.addMigration("table CompositionDataEntry",{up:function(){this.createTable("CompositionDataEntry",function(a){a.text("application"),a.json("datamap"),a.text("remoteId"),a["boolean"]("isDirty"),a.integer("rowstamp")})},down:function(){this.dropTable("CompositionDataEntry")}}),b.addMigration("table Attachment",{up:function(){this.createTable("Attachment",function(a){a.text("application"),a.text("parentId"),a.text("compositionRemoteId"),a.text("docinfoRemoteId"),a.text("path"),a["boolean"]("compressed"),a.text("content"),a.text("mimetype")})},down:function(){this.dropTable("Attachment")}}),b.addMigration("table DataEntry",{up:function(){this.createTable("DataEntry",function(a){a.text("application"),a.json("originaldatamap"),a.json("datamap"),a["boolean"]("pending"),a.text("remoteId"),a["boolean"]("isDirty"),a["boolean"]("hasProblem"),a.integer("rowstamp"),a.text("textindex01"),a.text("textindex02"),a.text("textindex03"),a.text("textindex04"),a.text("textindex05"),a.numeric("numericindex01"),a.numeric("numericindex02"),a.date("dateindex01"),a.date("dateindex02"),a.date("dateindex03")}),this.addIndex("DataEntry",["application","remoteid"],!0)},down:function(){this.dropTable("DataEntry")}}),b.addMigration("table Operation",{up:function(){this.createTable("Operation",function(a){a.json("datamap"),a.text("operation"),a.date("creationDate"),a.varchar("entry",32)}),this.addIndex("Operation","entry")},down:function(){this.removeIndex("Operation","entry"),this.dropTable("Operation")}}),b.addMigration("table Problem",{up:function(){this.createTable("Problem",function(a){a.text("message")})},down:function(){this.dropTable("Problem")}}),b.addMigration("table SyncOperation",{up:function(){this.createTable("SyncOperation",function(a){a.date("startdate"),a.date("enddate"),a.date("lastcheckdate"),a.text("lastsyncServerVersion"),a.text("status"),a.integer("numberofdownloadeditems"),a.integer("numberofdownloadedsupportdata"),a["boolean"]("hasProblems"),a["boolean"]("metadatachange"),a.integer("items")})},down:function(){this.dropTable("SyncOperation")}}),b.addMigration("table Settings",{up:function(){this.createTable("Settings",function(a){a.text("localversion"),a.text("serverurl")})},down:function(){this.dropTable("Settings")}}),b.addMigration("table User",{up:function(){this.createTable("User",function(a){a.text("name"),a.text("orgid"),a.text("siteid")})},down:function(){this.dropTable("User")}}),b.addMigration("table Configuration",{up:function(){this.createTable("Configuration",function(a){a.text("key"),a.json("value")})},down:function(){this.dropTable("Configuration")}}),b.addMigration("table Application",{up:function(){this.createTable("Application",function(a){a.text("application"),a["boolean"]("association"),a["boolean"]("composition"),a.json("data")})},down:function(){this.dropTable("Application")}}),b.addMigration("table WhereClause",{up:function(){this.createTable("WhereClause",function(a){a.text("application"),a.text("parentApplication"),a.text("metadataid"),a.text("data")})},down:function(){this.dropTable("WhereClause")}}),b.addMigration("table Menu",{up:function(){this.createTable("Menu",function(a){a.json("data")})},down:function(){this.dropTable("Menu")}}),b.addMigration("table CommandBar",{up:function(){this.createTable("CommandBar",function(a){a.text("key"),a.json("data")})},down:function(){this.dropTable("CommandBar")}}),b.addMigration("table Cookie",{up:function(){this.createTable("Cookie",function(a){a.text("name"),a.text("value")}),this.addIndex("Cookie","name",!0)},down:function(){this.removeIndex("Cookie","name"),this.dropTable("Cookie")}}),b.addMigration("table ActiveLaborTracker",{up:function(){this.createTable("ActiveLaborTracker",function(a){a.text("parentid"),a.text("laborlocalid")})},down:function(){this.dropTable("ActiveLaborTracker")}}),b.addMigration("search indexes  for CompositionData",{up:function(){this.addColumn("CompositionDataEntry","textindex01","text"),this.addColumn("CompositionDataEntry","textindex02","text"),this.addColumn("CompositionDataEntry","textindex03","text"),this.addColumn("CompositionDataEntry","textindex04","text"),this.addColumn("CompositionDataEntry","textindex05","text"),this.addColumn("CompositionDataEntry","numericindex01","numeric"),this.addColumn("CompositionDataEntry","numericindex02","numeric"),this.addColumn("CompositionDataEntry","dateindex01","date"),this.addColumn("CompositionDataEntry","dateindex02","date"),this.addColumn("CompositionDataEntry","dateindex03","date")},down:function(){this.removeColumn("CompositionDataEntry","textindex01"),this.removeColumn("CompositionDataEntry","textindex02"),this.removeColumn("CompositionDataEntry","textindex03"),this.removeColumn("CompositionDataEntry","textindex04"),this.removeColumn("CompositionDataEntry","textindex05"),this.removeColumn("CompositionDataEntry","numericindex01"),this.removeColumn("CompositionDataEntry","numericindex02"),this.removeColumn("CompositionDataEntry","dateindex01"),this.removeColumn("CompositionDataEntry","dateindex02"),this.removeColumn("CompositionDataEntry","dateindex03")}}),b.addMigration("add remoteid for associationdata",{up:function(){this.addColumn("AssociationData","remoteid","text"),this.addIndex("AssociationData",["application","remoteid"],!0)},down:function(){this.removeColumn("AssociationData","remoteid")}}),b.addMigration("add clientopreationid for syncoperation",{up:function(){this.addColumn("SyncOperation","clientoperationid","text")}})}])}(angular,persistence),function(angular,persistence,_){try{angular.module("persistence.offline")}catch(a){return}var b=angular.module("audit.offline",["persistence.offline"]);angular.module("persistence.offline").config(["offlineMigrationsProvider",function(a){var b=a.createMigrationGroup(10,"offline audit migrations");b.addMigration("table AuditEntry",{up:function(){this.createTable("AuditEntry",function(a){a.text("operation"),a.json("originaldatamap"),a.json("datamap"),a.text("refApplication"),a.text("refClientId"),a.text("refId"),a.text("refUserId"),a.text("createdBy"),a.date("createdDate")})},down:function(){this.dropTable("AuditEntry")}})}]),angular.module("persistence.offline").config(["offlineEntitiesProvider",function(a){var b=a.entities;b.AuditEntry=persistence.define("AuditEntry",{operation:"TEXT",originaldatamap:"JSON",datamap:"JSON",refApplication:"TEXT",refClientId:"TEXT",refId:"TEXT",refUserId:"TEXT",createdBy:"TEXT",createdDate:"DATE"}),b.AuditEntry.listPattern="refApplication='{0}' and createdBy='{1}'",b.AuditEntry.listApplicationsStatement="select distinct refApplication from AuditEntry where createdBy=?",b.AuditEntry.forEntityPattern="refClientId='{0}' and refApplication='{1}'",b.AuditEntry.deleteRelatedStatement="delete from AuditEntry where refClientId=? and refApplication=?",b.AuditEntry.deleteRelatedByRefIdStatement="delete from AuditEntry where refApplication=? and (refId in ({0}) or refId is null)"}]),function(a){function b(a,b,c,d,e){function f(a,b){if(!a[b])throw new Error("IllegalArgumentError: AuditEntry cannot have an empty '"+b+"'")}function g(a){return a.createdBy||(a.createdBy=d.currentUser()),f(a,"operation"),f(a,"refApplication"),f(a,"refClientId"),f(a,"createdBy"),a.createdDate=new Date,c.instantiate("AuditEntry",a)}function h(a){return g(a).then(function(a){return c.save(a)})}function i(a,b,c,d,e,f){var g={operation:a,refApplication:b,refClientId:c,refId:d,refUserId:e,createdBy:f};return h(g)}function j(){var a=d.currentUser();return c.executeStatement(b.AuditEntry.listApplicationsStatement,[a]).then(function(a){return _.pluck(a,"refApplication")})}function k(a,e){var f=d.currentUser(),g=b.AuditEntry.listPattern.format(a,f),h={orderby:"createdDate",orderbyascendig:!1};return e&&(h.pagesize=e.pagesize,h.pageNumber=e.pagenumber),c.findByQuery("AuditEntry",g,h)}function l(a){return c.findById("AuditEntry",a)}function m(a){return c.findById("DataEntry",a.refClientId)}function n(a,d){return c.findByQuery("AuditEntry",b.AuditEntry.forEntityPattern.format(a,d))}function o(a,d){return c.executeStatement(b.AuditEntry.deleteRelatedStatement,[a,d])}function p(){return e.go("main.audit.applicationselect")}var q={registerEvent:i,registerEntry:h,listEntries:k,listAudittedApplications:j,getAuditEntry:l,getTrackedEntity:m,getEntriesForEntity:n,deleteRelatedEntries:o,goToAudit:p};return q}a.factory("offlineAuditService",["$q","offlineEntities","swdbDAO","securityService","routeService",b])}(b)}(angular,persistence,_),function(angular){var a={webcommons:angular.module("webcommons_services",["sw_rootcommons"]),maximoapplications:angular.module("maximo_applications",[]),rootCommons:angular.module("sw_rootcommons",[])};window.modules=a}(angular),function(a){a.webcommons.service("statuscolorService",["$rootScope","$injector","contextService","schemaService","dispatcherService",function(a,b,c,d,e){var f=function(b,d){var e=a.statuscolorFallbackJson;if(e&&!angular.equals({},e)||(e=c.fetchFromContext("statuscolorfallback",!0),a.statuscolorFallbackJson=e),!e||!d)return"#777";var f=e[d];return f||(f=e["default"]),f[b.toLowerCase()]};return{getColor:function(b,d){if(!b)return"transparent";var e=a.statusColor;if((void 0===e||angular.equals({},e))&&(e=c.fetchFromContext("statuscolor",!0),a.statusColor=e),null==e)return f(b,d);var g=e[d];return(g||(g=e["default"]))&&(b in g||b.toLowerCase()in g)?g[b.toLowerCase()]:f(b,d)},load:function(a,b){c.insertIntoContext("statuscolor",a),c.insertIntoContext("statuscolorfallback",b)},getColorObject:function(a,b,c){var f=d.getProperty(c,"list.colorscheme.service"),g=e.invokeServiceByString(f,[a,b,c]);return g&&(g.forecolor||(g.forecolor="white")),g},colorToHex:function(a){var b=document.createElement("div");b.style.color=a;var c=window.getComputedStyle(document.body.appendChild(b)).color.match(/\d+/g).map(function(a){return parseInt(a,10)});return document.body.removeChild(b),c.length>=3?"#"+((1<<24)+(c[0]<<16)+(c[1]<<8)+c[2]).toString(16).substr(1):null},foregroundColor:function(a){var b=this.colorToHex(a);return b?parseInt(b.substring(1),16)>8388607.5?"#000":"#fff":"#000"},getPriorityColor:function(a){return 1===a||"1"===a?"#39b54a":2===a||"2"===a?"#4488f2":3===a||"3"===a?"#D850FA":4===a||"4"===a?"#f2d935":5===a||"5"===a?"#e59323":6===a||"6"===a?"#f65752":"#777"}}}])}(modules);var modalShown="sw.modal.show",HideModal="sw.modal.hide",crudSaved="sw.crud.detail.savecompleted",CrudSubmitData="sw.crud.detail.submit",BodyRendered="sw.crud.body.rendered",TabsLoaded="sw.crud.body.alltabsloaded",MoveFocus="sw.crud.body.movefocus",ResetFocusToCurrent="sw.crud.input.resetfocustocurrent",NavigateRequestCrawl="sw.crud.body.crawl",NavigateRequestCrawlOcurred="sw.crud.body.crawlocurred",AjaxError="sw.ajax.error",AjaxFinished="sw.ajax.finished",AjaxInit="sw.ajax.init",ReadyToPrint="sw.application.print.ready",PrintReadyForList="sw.application.print.readyforlist",PrintReadyForDetailedList="sw.application.print.readyfordetailedlist",PrintShowModal="sw.application.print.showmodal",PrintHideModal="sw.application.print.hidemodal",PrintSectionRendered="sw.application.print.sectionrendered",AppChanged="sw.crud.applicationchanged",AppRedirected="sw.crud.navigation.applicationredirected",TitleChanged="sw.crud.navigation.titlechanged",RenderView="sw.crud.navigation.renderview",LoginHappened="sw.crud.navigation.login",DetailLoaded="sw.crud.navigation.detailloaded",RenderViewWithData="sw.crud.navigation.renderwithdata",REDIRECT_BEFORE="sw.crud.navigation.beforeredirection",REDIRECT_AFTER="sw.crud.navigation.redirected",REDIRECT_AFTERACTION="sw.crud.navigation.actionredirected",REFRESH_GRID="sw.crud.list.refreshgrid",GRID_REFRESHED="sw.crud.list.gridrefreshed",ClearQuickSearch="sw.crud.list.clearQuickSearch",ToggleSelectionMode="sw.crud.list.toggleselectionmode",ToggleSelected="sw.crud.list.toggleselected",ReloadToggleState="sw.crud.list.reloadtogglestate",ListTableRendered="sw.crud.list.tbodyrendered",FilterRowRendered="sw.crud.list.filterrowrendered",GridDataChanged="sw.crud.list.griddatachanged",GRID_SETFILTER="sw.crud.list.setfilter",GridClearFilter="sw.crud.list.clearfilter",GRID_CHANGED="sw.crud.list.gridchanged",GRID_REFRESH="sw.grid.refresh",AssociationResolved="sw.crud.association.resolved",AssociationUpdated="sw.crud.association.updated",Association_EagerOptionUpdated="sw.crud.associations.updateeageroptions",ClearAutoCompleteCache="sw.crud.association.clearautocompletecache",COMPOSITION_RESOLVED="sw.crud.composition.dataresolved",COMPOSITION_EDIT="sw.crud.composition.edit",COMPOSITION_REFRESH_PAGE="sw.crud.composition.refreshpage",COMPOSITION_BATCH_ADD_MULTIPLE="sw.crud.composition.batch.add.multiple",FORCE_RESIZE="sw.layout.forceresize",JavascriptEventConstants=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"ModalShown",get:function(){return modalShown}},{key:"ReadyToPrint",get:function(){return ReadyToPrint}},{key:"PrintReadyForList",get:function(){return PrintReadyForList}},{key:"PrintReadyForDetailedList",get:function(){return PrintReadyForDetailedList}},{key:"PrintShowModal",get:function(){return PrintShowModal}},{key:"PrintHideModal",get:function(){return PrintHideModal}},{key:"PrintSectionRendered",get:function(){return PrintSectionRendered}},{key:"HideModal",get:function(){return HideModal}},{key:"ErrorAjax",get:function(){return AjaxError}},{key:"AjaxFinished",get:function(){return AjaxFinished}},{key:"AjaxInit",get:function(){return AjaxInit}},{key:"BodyRendered",get:function(){return BodyRendered}},{key:"TabsLoaded",get:function(){return TabsLoaded}},{key:"NavigateRequestCrawl",get:function(){return NavigateRequestCrawl}},{key:"NavigateRequestCrawlOcurred",get:function(){return NavigateRequestCrawlOcurred}},{key:"MoveFocus",get:function(){return MoveFocus}},{key:"ResetFocusToCurrent",get:function(){return ResetFocusToCurrent}},{key:"AppChanged",get:function(){return AppChanged}},{key:"Login",get:function(){return LoginHappened}},{key:"AppBeforeRedirection",get:function(){return REDIRECT_BEFORE}},{key:"REDIRECT_AFTER",get:function(){return REDIRECT_AFTER}},{key:"ActionAfterRedirection",get:function(){return REDIRECT_AFTERACTION}},{key:"ApplicationRedirected",get:function(){return AppRedirected}},{key:"TitleChanged",get:function(){return TitleChanged}},{key:"DetailLoaded",get:function(){return DetailLoaded}},{key:"RenderView",get:function(){return RenderView}},{key:"RenderViewWithData",get:function(){return RenderViewWithData}},{key:"CrudSaved",get:function(){return crudSaved}},{key:"CrudSubmitData",get:function(){return CrudSubmitData}},{key:"AssociationResolved",get:function(){return AssociationResolved}},{key:"Association_EagerOptionUpdated",get:function(){return Association_EagerOptionUpdated}},{key:"ClearAutoCompleteCache",get:function(){return ClearAutoCompleteCache}},{key:"RefreshGrid",get:function(){return REFRESH_GRID}},{key:"GRID_REFRESHED",get:function(){return GRID_REFRESHED}},{key:"GRID_REFRESH2",get:function(){return GRID_REFRESH}},{key:"GRID_SETFILTER",get:function(){return GRID_SETFILTER}},{key:"GRID_CLEARFILTER",get:function(){return GridClearFilter}},{key:"GRID_CHANGED",get:function(){return GRID_CHANGED}},{key:"ListTableRendered",get:function(){return ListTableRendered}},{key:"GridDataChanged",get:function(){return GridDataChanged}},{key:"FilterRowRendered",get:function(){return FilterRowRendered}},{key:"ClearQuickSearch",get:function(){return ClearQuickSearch}},{key:"ToggleSelectionMode",get:function(){return ToggleSelectionMode}},{key:"ToggleSelected",get:function(){return ToggleSelected}},{key:"ReloadToggleState",get:function(){return ReloadToggleState}},{key:"COMPOSITION_RESOLVED",get:function(){return COMPOSITION_RESOLVED}},{key:"CompositionEdit",get:function(){return COMPOSITION_EDIT}},{key:"CompositionRefreshPage",get:function(){return COMPOSITION_REFRESH_PAGE}},{key:"CompositionBatchAddMultiple",get:function(){return COMPOSITION_BATCH_ADD_MULTIPLE}},{key:"ForceResize",get:function(){return FORCE_RESIZE}}]),a}();"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(a){return this.indexOf(a,this.length-a.length)!==-1}),"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(a){return void 0!=a&&this.slice(0,a.length)==a}),String.prototype.format=String.prototype.f=function(){for(var a=this,b=arguments.length;b--;)a=a.replace(new RegExp("\\{"+b+"\\}","gm"),arguments[b]);return a},String.prototype["in"]=String.prototype.f=function(){var a=this;return a.equalsAny(arguments)},String.prototype.equalsAny=String.prototype.f=function(){for(var a=this,b=arguments.length;b--;)if(arguments[b].isEqual(a,!0))return!0;return!1},String.prototype.equalsIc=String.prototype.f=function(){return this.isEqual(arguments[0],!0)},String.prototype.nullOrEmpty=String.prototype.f=function(){var a=this;return 0==a.trim().length},String.prototype.isEqual=String.prototype.f=function(a,b){var c=this;return b?null!=a&&c.toLowerCase()==a.toLowerCase():c==a},String.prototype.equalIc=String.prototype.f=function(a){var b=this;return null!=a&&b.toLowerCase()==a.toLowerCase()};var nullOrEmpty=function(a){return nullOrUndef(a)||0===String(a).trim().length},isNullOrEmpty=function(a){return nullOrUndef(a)||0===String(a).trim().length},isArrayNullOrEmpty=function(a){return nullOrUndef(a)||0===a.length};String.format=function(){for(var a=arguments[0],b=0;b<arguments.length-1;b++){var c=new RegExp("\\{"+b+"\\}","gm");a=a.replace(c,arguments[b+1])}return a},"function"!=typeof String.prototype.byteSize&&(String.prototype.byteSize=function(){return encodeURI(this).split(/%(?:u[0-9A-F]{2})?[0-9A-F]{2}|./).length-1}),String.prototype.containsIgnoreCase=function(a){return a=a.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),new RegExp(a,"i").test(this)},String.prototype.repeat=function(a){return new Array(a+1).join(this)},"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(a){return this.indexOf(a,this.length-a.length)!==-1}),"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(a){return void 0!=a&&this.slice(0,a.length)==a});var BrowserDetect={init:function(){this.browser=this.searchString(this.dataBrowser)||"Other",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"Unknown"},searchString:function(a){for(var b=0;b<a.length;b++){var c=a[b].string;if(this.versionSearchString=a[b].subString,c.indexOf(a[b].subString)!=-1)return a[b].identity}},searchVersion:function(a){var b=a.indexOf(this.versionSearchString);if(b!=-1)return parseFloat(a.substring(b+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.userAgent,subString:"Safari",identity:"Safari"},{string:navigator.userAgent,subString:"Opera",identity:"Opera"}]};BrowserDetect.init();var DeviceDetect={init:function(){this.os=this.searchString(this.dataOS)||"Unknown",this.catagory=this.getType(this.os)||"Unknown"},searchString:function(a){for(var b=0;b<a.length;b++){var c=a[b].string;if(this.versionSearchString=a[b].subString,c.indexOf(a[b].subString)!=-1)return a[b].identity}},getType:function(a){if("Unknown"!==a){var b;switch(a){case"Windows":case"Macintosh":default:b="Desktop";break;case"Android":case"iPhone":case"iPad":b="Mobile"}return b}},dataOS:[{string:navigator.userAgent,subString:"Windows",identity:"Windows"},{string:navigator.userAgent,subString:"Macintosh",identity:"Macintosh"},{string:navigator.userAgent,subString:"Android",identity:"Android"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone"},{string:navigator.userAgent,subString:"iPad",identity:"iPad"}]};DeviceDetect.init();var RequiredParam=function(){throw new Error("Required Parameter")};Date.prototype.mmddyyyy=Date.prototype.f=function(){var a=this.getFullYear().toString(),b=(this.getMonth()+1).toString(),c=this.getDate().toString();return(b[1]?b:"0"+b[0])+"/"+(c[1]?c:"0"+c[0])+"/"+a},String.prototype.format=String.prototype.f=function(){for(var a=this,b=arguments.length;b--;)a=a.replace(new RegExp("\\{"+b+"\\}","gm"),arguments[b]);return a},String.prototype.nullOrEmpty=String.prototype.f=function(){var a=this;return 0==a.trim().length},String.prototype.isEqual=String.prototype.f=function(a,b){var c=this;return b?!(null==a||!isString(a))&&c.toLowerCase()===a.toLowerCase():c===a},String.prototype.contains=function(a){return this.indexOf(a)>=0};var nullOrEmpty=function(a){return nullOrUndef(a)||0==String(a).trim().length},isArrayNullOrEmpty=function(a){return nullOrUndef(a)||0==a.length},hasSingleElement=function(a){return!nullOrUndef(a)&&1==a.length},safePush=function(a,b,c){if(c&&a&&b){a[b]||(a[b]=[]);var d=a[b];if(null==c.id)d.push(c);else{var e=d.findIndex(function(a){return null!=a.id&&a.id===c.id});e!==-1?d[e]=c:d.push(c)}}},nullifyProperties=function(a,b){if(b&&a)for(var c=0;c<b.length;c++){var d=b[c];a[d]=null}};String.format=function(){for(var a=arguments[0],b=0;b<arguments.length-1;b++){var c=new RegExp("\\{"+b+"\\}","gm");a=a.replace(c,arguments[b+1])}return a},$.extend({findFirst:function(a,b){if(null!=a){var c;for(c=0;c<a.length;++c)if(b(a[c],c))return a[c]}}}),$.extend({keys:function(a){var b=[];return $.each(a,function(a){b.push(a)}),b}});var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(a){for(var b,c,d,e,f,g,h,i="",j=0;j<a.length;)b=a.charCodeAt(j++),c=a.charCodeAt(j++),d=a.charCodeAt(j++),e=b>>2,f=(3&b)<<4|c>>4,g=(15&c)<<2|d>>6,h=63&d,isNaN(c)?g=h=64:isNaN(d)&&(h=64),i=i+this._keyStr.charAt(e)+this._keyStr.charAt(f)+this._keyStr.charAt(g)+this._keyStr.charAt(h);return i},decode:function(a){var b,c,d,e,f,g,h,i="",j=0;for(a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");j<a.length;)e=this._keyStr.indexOf(a.charAt(j++)),f=this._keyStr.indexOf(a.charAt(j++)),g=this._keyStr.indexOf(a.charAt(j++)),h=this._keyStr.indexOf(a.charAt(j++)),b=e<<2|f>>4,c=(15&f)<<4|g>>2,d=(3&g)<<6|h,i+=String.fromCharCode(b),64!=g&&(i+=String.fromCharCode(c)),64!=h&&(i+=String.fromCharCode(d));return i},_utf8_encode:function(a){a=a.replace(/\r\n/g,"\n");for(var b="",c=0;c<a.length;c++){var d=a.charCodeAt(c);d<128?b+=String.fromCharCode(d):d>127&&d<2048?(b+=String.fromCharCode(d>>6|192),b+=String.fromCharCode(63&d|128)):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128),b+=String.fromCharCode(63&d|128))}return b},_utf8_decode:function(a){for(var b="",c=0,d=c1=c2=0;c<a.length;)d=a.charCodeAt(c),d<128?(b+=String.fromCharCode(d),c++):d>191&&d<224?(c2=a.charCodeAt(c+1),b+=String.fromCharCode((31&d)<<6|63&c2),c+=2):(c2=a.charCodeAt(c+1),c3=a.charCodeAt(c+2),b+=String.fromCharCode((15&d)<<12|(63&c2)<<6|63&c3),c+=3);return b}};!_typeof("function"!==window.debounce)||window._&&"function"==typeof window._.debounce?window.debounce=window._.debounce:window.debounce=function(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null,c||a.apply(e,f)},h=c&&!d;clearTimeout(d),d=setTimeout(g,b),h&&a.apply(e,f)}},!_typeof("function"!==window.throttle)||window._&&"function"==typeof window._.throttle?window.throttle=window._.throttle:window.throttle=function(a,b,c){var d,e,f,g=null,h=0;c||(c={});var i=function(){h=c.leading===!1?0:Date.now(),g=null,f=a.apply(d,e),g||(d=e=null)};return function(){var j=Date.now();h||c.leading!==!1||(h=j);var k=b-(j-h);return d=this,e=arguments,k<=0||k>b?(g&&(clearTimeout(g),g=null),h=j,f=a.apply(d,e),g||(d=e=null)):g||c.trailing===!1||(g=setTimeout(i,k)),f}},window.getUrlParameter=function(a){for(var b,c=decodeURIComponent(window.location.search.substring(1)),d=c.split("&"),e=0;e<d.length;e++)if(b=d[e].split("="),b[0]===a)return void 0===b[1]||b[1];return null},_typeof("function"!==Object.values)&&(Object.values=function(a){return Object.keys(a).map(function(b){return a[b]})}),jQuery.fn.extend({exists:function(){return this.length>0}}),Array.prototype.subarray=function(a,b){return b||(b=-1),this.slice(a,this.length+1-b*-1)},Array.prototype.flatten=function(){var a,b=Object.prototype.toString,c="[object Array]",d=[],e=this;if(!this.length)return d;a=e.pop();do b.call(a)===c?e.push.apply(e,a):d.push(a);while(e.length&&void 0!==(a=e.pop()));return d.reverse(),d},Array.prototype.find=Array.prototype.find||function(a){for(var b=this,c=0;c<b.length;c++){var d=b[c];if(a(d))return d}return null},Array.prototype.firstOrDefault=function(a){for(var b=this,c=0;c<b.length;c++){var d=b[c];if(a(d))return d}return null},Array.prototype.findIndex=Array.prototype.findIndex||function(a,b){var c=-1;return Array.prototype.some.call(this,function(d,e,f){return a.call(b,d,c=e,f)})?c:-1},Array.prototype.equals=function(a){return this.length==a.length&&this.every(function(b,c){return b==a[c]})},"function"!=typeof Array.prototype.distinct&&(Array.prototype.distinct=function(){for(var a={},b=[],c=this.length,d=0,e=0;e<c;e++){var f=this[e];1!==a[f]&&(a[f]=1,b[d++]=f)}return b});var isObjectEmpty=function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0};"function"!=typeof JSON.decycle&&(JSON.decycle=function(a,b){var c=new WeakMap;return function d(a,e){var f,g;return void 0!==b&&(a=b(a)),"object"!==("undefined"==typeof a?"undefined":_typeof(a))||null===a||a instanceof Boolean||a instanceof Date||a instanceof Number||a instanceof RegExp||a instanceof String?a:(f=c.get(a),void 0!==f?{$ref:f}:(c.set(a,e),Array.isArray(a)?(g=[],a.forEach(function(a,b){g[b]=d(a,e+"["+b+"]")})):(g={},Object.keys(a).forEach(function(b){g[b]=d(a[b],e+"["+JSON.stringify(b)+"]")})),g))}(a,"$")}),"function"!=typeof JSON.retrocycle&&(JSON.retrocycle=function retrocycle($){var px=/^\$(?:\[(?:\d+|"(?:[^\\"\u0000-\u001f]|\\([\\"\/bfnrt]|u[0-9a-zA-Z]{4}))*")\])*$/;return function rez(value){value&&"object"===("undefined"==typeof value?"undefined":_typeof(value))&&(Array.isArray(value)?value.forEach(function(element,i){if("object"===("undefined"==typeof element?"undefined":_typeof(element))&&null!==element){var path=element.$ref;"string"==typeof path&&px.test(path)?value[i]=eval(path):rez(element)}}):Object.keys(value).forEach(function(name){var item=value[name];if("object"===("undefined"==typeof item?"undefined":_typeof(item))&&null!==item){var path=item.$ref;"string"==typeof path&&px.test(path)?value[name]=eval(path):rez(item)}}))}($),$}),!function(a,angular){a.rootCommons.service("contextService",["$log","$rootScope",function(a,b){return{insertIntoContext:function(a,c,d){var e=url("");return d?b[e+":ctx_"+a]=c:(null==c||isString(c)||(c=JSON.stringify(c)),sessionStorage[e+":ctx_"+a]=c),c},set:function(a,b,c){return this.insertIntoContext(a,b,c)},get:function(a,b,c){return this.fetchFromContext(a,b,c)},fetchFromContext:function(a,b,c,d){var e=this.retrieveFromContext(a,c,d);if("undefined"!=e)return null!=e&&1==b&&isString(e)?JSON.parse(e):e;
},getFromContext:function(a,b,c){return this.fetchFromContext(a,b,c)},retrieveFromContext:function(a,c,d){var e=url("");if(c){var f=b[e+":ctx_"+a];return d&&delete b[e+":ctx_"+a],f}var g=sessionStorage[e+":ctx_"+a];return d&&sessionStorage.removeItem([e+":ctx_"+a]),"null"==g?null:g},deleteFromContext:function(a){var c=url("");delete sessionStorage[c+":ctx_"+a],delete b[c+":ctx_"+a]},isLocal:function(){if(localStorage.mocknonlocal||sessionStorage.mocknonlocal)return!1;if(angular.mock)return!0;var a=this.retrieveFromContext("isLocal");return!!a&&"true"===a},isDev:function(){var a=this.retrieveFromContext("environment");return!a||0===a.indexOf("dev")},client:function(){return this.retrieveFromContext("clientName")},isClient:function(b){var c=this.client();return b===c||(!(!angular.isArray(b)||!jQuery.inArray(c,b))||!b&&(a.getInstance("contextService#isClient").warn("asked for null client name"),!1))},getUserData:function(){if(angular.mock)return{login:"testuser"};if(null!=b.user)return b.user;var a=this.retrieveFromContext("user");if(null==a)return null;var c=JSON.parse(a);return b.user=c,c},InModule:function(a){if(null==a)return!1;var b=!1,c=this.currentModule();return!nullOrUndef(c)&&($.each(a,function(a,d){if(d.equalIc(c))return void(b=!0)}),b)},HasRole:function(a){if(null==a)return!0;var b=this.getUserData(),c=b.roles,d=!1;return $.each(a,function(a,b){$.each(c,function(a,c){if(c.name==b)return void(d=!0)})}),d},loadUserContext:function(a){b.user=a,this.insertIntoContext("user",JSON.stringify(a)),b.userContextDate=new Date},loadConfigs:function(a){this.insertIntoContext("clientName",a.clientName),this.insertIntoContext("environment",a.environment),this.insertIntoContext("isLocal",a.isLocal),this.insertIntoContext("i18NRequired",a.i18NRequired),this.insertIntoContext("systeminittime",a.initTimeMillis),this.insertIntoContext("successMessageTimeOut",a.successMessageTimeOut),a.clientSideLogLevel.equalsAny("warn","debug","info","error","none")||(a.clientSideLogLevel="warn"),this.insertIntoContext("defaultlevel",a.clientSideLogLevel.toLowerCase()),this.insertIntoContext("invbalancesListScanOrder",a.invbalancesListScanOrder),this.insertIntoContext("newInvIssueDetailScanOrder",a.newInvIssueDetailScanOrder),this.insertIntoContext("invIssueListScanOrder",a.invIssueListScanOrder),this.insertIntoContext("physicalcountListScanOrder",a.physicalcountListScanOrder),this.insertIntoContext("physicaldeviationListScanOrder",a.physicaldeviationListScanOrder),this.insertIntoContext("matrectransTransfersListScanOrder",a.matrectransTransfersListScanOrder),this.insertIntoContext("reservedMaterialsListScanOrder",a.reservedMaterialsListScanOrder),this.insertIntoContext("invIssueListBeringScanOrder",a.invIssueListBeringScanOrder),this.insertIntoContext("newKeyISsueDetailScanOrder",a.newKeyIssueDetailScanOrder),this.insertIntoContext("activityStreamFlag",a.activityStreamFlag,!0),this.insertIntoContext("crudSearchFlag",a.crudSearchFlag,!0),this.insertIntoContext("UIShowClassicAdminMenu",a.uiShowClassicAdminMenu,!0),this.insertIntoContext("UIShowToolbarLabels",a.uiShowToolbarLabels,!0),this.insertIntoContext("isLocal",a.isLocal);var c=a.displayableFormats.dateTimeFormat;c&&c.indexOf("hh")!==-1&&c.indexOf("a")===-1&&(c+=" a"),this.insertIntoContext("dateTimeFormat",c),b.defaultEmail=a.defaultEmail,b.clientName=a.clientName,b.environment=a.environment,b.i18NRequired=a.i18NRequired},getResourceUrl:function(a){var b=url(a);if(!this.isLocal()){var c=this.getFromContext("systeminittime");return b.indexOf("?")==-1?b+"?"+c:b+"&"+c}return b},currentModule:function(){return this.retrieveFromContext("currentmodule")},clearContext:function(){for(var a=url(""),b=sessionStorage.length;b--;){var c=sessionStorage.key(b);c.startsWith(a+":ctx_")&&sessionStorage.removeItem(c)}},insertReportSearchDTO:function(a,b){this.insertIntoContext("repSearchDTO_"+a,b)},retrieveReportSearchDTO:function(a){return this.retrieveFromContext("repSearchDTO_"+a)},setActiveTab:function(a){this.insertIntoContext("currenttab",a)},getActiveTab:function(){return this.fetchFromContext("currenttab")}}}])}(modules,angular),function(angular,a){a.webcommons.service("tabsService",["fieldService","i18NService",function(a,b){var c=function(a,c,d){var e={};return e.items=[],e.items.push(a),e.schema=c,e.title=b.getTabLabel(c,d),e},d=function(a){return a.rendererParameters&&"true"===a.rendererParameters.tabsection};return{hasCount:function(a){return!!a&&("ApplicationCompositionDefinition"===a.type||"ApplicationTabDefinition"===a.type&&!!a.countRelathionship)},getCompositionSchema:function(a,b,c){var d=this.nonInlineCompositionsDict(a),e=d[b];return d=e.schema.schemas,"print"===c?d.print?d.print:d.detail:d.list},getCompositionIdName:function(a,b,c){return this.getCompositionSchema(a,b,c).idFieldName},hasTabs:function(a){if(void 0!=a.hasTabs)return a.hasTabs;var b=this.tabsDisplayables(a).length;return a.hasTabs=b>0,b},tabsDisplayablesForPrinting:function(a,b){if(void 0!=a.tabsDisplayablesForPrinting)return a.tabsDisplayablesForPrinting;var c=[],d=this.tabsDisplayables(a);return $.each(d,function(a,d){var e=b[d.relationship];void 0!=e&&e.length>0&&c.push(d)}),a.tabsDisplayablesForPrinting=c,c},filterTabs:function(b){var c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=[];return angular.forEach(b,function(b){a.isTabOrComposition(b)&&!b.isHidden?(e.push(b),c&&(e=e.concat(this.tabsDisplayables(b,c)))):!a.isSection(b)||d(b)&&!c||(e=e.concat(this.tabsDisplayables(b,c)))},this),e},tabsDisplayables:function(a){var b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!b&&void 0!=a.tabsDisplayables)return a.tabsDisplayables;if(b&&void 0!=a.allTabsDisplayables)return a.allTabsDisplayables;var c=this.filterTabs(a.displayables,b);return b?a.allTabsDisplayables=c:a.tabsDisplayables=c,c},tabsPrintDisplayables:function(a){return this.tabsDisplayables(a).filter(function(a){return!a.isHidden&&a.isPrintEnabled})},nonInlineCompositionsDict:function(a){if(void 0!=a.nonInlineCompositionsDict)return a.nonInlineCompositionsDict;var b={},c=this.tabsDisplayables(a,!0);return c.forEach(function(a){b[a.relationship]=a}),a.nonInlineCompositionsDict=b,b},buildCompositionsToExpand:function(b,d,e,f,g){var h="";if(null==b)return"";var i=this;return $.each(b,function(b,j){if(0!=j.value){var k=a.getDisplayableByKey(d,b);if(a.isTab(k))return void g.push({key:b,tabObject:c(e,k,d)});var l=e[b];if(void 0==l)return void(h+=b+"=lazy,,,");var m=i.getCompositionSchema(d,b,j.schema);if(void 0!=m.properties.expansible&&"false"==m.properties.expansible)return void(void 0!=g&&l.length>0&&g.push({key:b,schema:m}));for(var n=i.getCompositionIdName(d,b,f),o=[],p=0;p<l.length;p++){var q=l[p];o.push(q[n])}o.length>0&&(h+=b+"="+o.join(",")+",,,")}}),""!=h&&(h=h.substring(0,h.length-3)),h},locatePrintSchema:function(a,b){var c=nonInlineCompositionsDict(a),d=c[b];return d.schema.schemas.print},getTitle:function(a,b){var c=nonInlineCompositionsDict(a),d=c[b];return d.label},hasTab:function(b,c){var d=a.getDisplayableByKey(b,c);return!!d&&a.isTabOrComposition(d)}}}])}(angular,modules),function(a){a.webcommons.service("i18NService",["$rootScope","contextService",function(a,b){function c(a){var b;return b=null==a.attribute&&void 0!=a.label?a.label.replace(":",""):a.attribute}var d=function(b){var c=a.sw_i18ncatalogs,d=!0;return $.each(c,function(a,c){"en"!=a&&(d=d&&e(b,c))}),d},e=function(a,b){var c=null;return null!=b&&(c=JsonProperty(b,a)),null!=c},f=function(c,e,f){if(!nullOrUndef(b.retrieveFromContext("currentmodule"))&&!f)return e;var g=a.sw_currentcatalog,h=null;if(null!=g&&(h=JsonProperty(g,c)),null!=h)return h;if(b.isLocal()&&1==a.i18NRequired){if(null==e)return null;if(void 0==sessionStorage.ignorei18n&&!d(c))return"??"+e+"??"}return e},g=function(a,b){return void 0==a?null:"string"==typeof a?a:a.hasOwnProperty(b.schemaId)?a[b.schemaId]:a._};return{getI18nLabel:function(a,b){if("ApplicationCompositionDefinition"===a.type||"ApplicationSection"===a.type){var d=this.getI18nSectionHeaderLabel(a,a.header,b);if(null!=d&&""!==d)return d}if(a.isHidden)return"";var e=b.applicationName,h=c(a),i=e+"."+h;"OptionField"===a.type&&(i+="._label");var j=f(i,a.label);return g(j,b)},getI18nLabelTooltip:function(b,d){var h=d.applicationName,i=c(b),j=h+"."+i+"._tooltip";e(j,a.sw_currentcatalog)||(j=h+"."+i,"OptionField"==b.type&&(j+="._label"));var k=b.toolTip;void 0==k&&(k=b.label);var l=f(j,k);return l===b.label&&(l=""),g(l,d)},getI18nOptionField:function(a,b,c){if("OptionField"!=b.type||null!=b.providerAttribute)return a.label;var d=c.applicationName,e=b.attribute,h=""==a.value?a.label:a.value,i=d+"."+e+"."+h,j=f(i,a.label);return g(j,c)},getI18nCommandLabel:function(a,b){var c=b.applicationName,d=c+"._commands."+a.id,e=f(d,a.label);return g(e,b)},getI18nInputLabel:function(a,b){var c=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=this.getI18nLabel(a,b);if(""===d)return"";var e=d.charAt(d.length-1);return":"===e||"?"===e||"ApplicationSection"===a.type?d:(c||(d+=":"),d)},getI18nMenuLabel:function(a,b){if(nullOrUndef(a.id))return b?a.tooltip:a.title;var c=a.title,d="_menu."+a.id;return b&&(d+="_tooltip",c=a.tooltip),f(d,c,!0)},getI18nMenuIcon:function(a){if(nullOrUndef(a.id))return a.icon;var b=a.icon,c="_menu."+a.id+"_icon";return f(c,b,!0)},getI18nPlaceholder:function(a){var b=a.label,c=b.charAt(b.length-1);if(":"!=c)return b;var d=b.substr(0,b.length-1);return d},getI18nRecordLabel:function(a,b){if(null==b||null==a)return"";var c=a.userIdFieldName,d=b[c];return a.idDisplayable&&null!=d?"{0} {1}".format(a.idDisplayable,d):""},getI18nTitle:function(a){var b=a.applicationName,c=b+"._title."+a.schemaId;return f(c,a.title)},get18nValue:function(a,b,c){var d=null!=a&&a.indexOf("_headermenu")>-1,e=f(a,b,d);if(void 0==c)return e;var g=e.format;return g.apply(e,c)},getI18nSectionHeaderLabel:function(a,b,c){if(void 0==b)return"";var d=c.applicationName;a=nullOrUndef(a.id)?a.relationship:a.id;var e=d+"."+a+"._header",h=f(e,b.label);return g(h,c)},getTabLabel:function(a,b){var c=a.applicationName,d=c+"."+a.id+"._title",e=f(d,a.label);return g(e,b)},getLookUpDescriptionLabel:function(a){return a&&a.rendererParameters&&a.rendererParameters.columnlabel?a.rendererParameters.columnlabel.toUpperCase():this.get18nValue("general.description","Description",null)},load:function(b,c){var d=JSON.parse(b),e={};$.each(d,function(a,b){e[a]=b}),a.sw_i18ncatalogs=e,this.changeCurrentLanguage(c)},getCurrentLanguage:function(){return a.sw_userlanguage},changeCurrentLanguage:function(b){a.sw_userlanguage=b;var c=null!=b?b.toLowerCase():"";a.sw_currentcatalog=a.sw_i18ncatalogs[c],a.$broadcast("sw_languageChanged",c)}}}])}(modules),function(a,angular){a.webcommons.service("schemaService",["$q","fieldService","expressionService","schemaCacheService","restService",function(a,b,c,d,e){function f(a){if(a.jscache=a.jscache||{},!a.jscache.griddisplayables){a.jscache.qualifiercache={};for(var b=a.displayables,c=0;c<b.length;c++){var d=b[c];d.qualifier&&(a.jscache.qualifiercache[d.qualifier]=d)}}}function g(a){if(null==a)return null;var b=a.split(".");if(1==b.length)return{app:null,schemaId:a,mode:null};var c=null,d=b[0],e=b[1];return 3==b.length&&(c=b[2]),{app:d,schemaId:e,mode:c}}function h(a,b){return a[b.idFieldName]}function i(a,b){return a[b.userIdFieldName]}function j(a,b,c){}function k(a){return B(a.displayables)}function l(a){return B(b.nonTabFields(a.displayables,!0))}function m(a){return B(b.nonTabFields(a,!0))}function n(a){if(!a)return!1;if(a.jscache=a.jscache||{},a.jscache.hasAnyFieldOnMainTab)return a.jscache.hasAnyFieldOnMainTab;var c=b.nonTabFields(a.displayables,!1),d=c.length>0;return a.jscache.hasAnyFieldOnMainTab=d,d}function o(a,b){return!!a&&(a.properties&&"true"==a.properties[b])}function p(a,b){return!!a&&(a.properties=a.properties||{},a.properties[b])}function q(a){var b=a.applicationName+"."+a.schemaId;return a.mode&&"none"!==a.mode&&(b+="."+a.mode),b}function r(a){return{applicationName:a.applicationName,schemaId:a.schemaId,mode:a.mode,platform:platform()}}function s(a,b,d){if(!a)return null;if(!b)return"New "+a.title;var e=b;if(null!=a.properties["detail.titleexpression"])return c.evaluate(a.properties["detail.titleexpression"],e);var f=a.idDisplayable;if(null==f)return a.title;var g,h=e[a.userIdFieldName];return h||(h="New "+a.title),g=d?h:f+" "+h}function t(a,b,c){if(!a||!b)return null;var d=u(a,"summary");return d?b[d.attribute]||b.description:b.description}function u(a,b){return a.jscache=a.jscache||{},a.jscache.qualifiercache?a.jscache.qualifiercache[b]:(f(a),a.jscache.qualifiercache[b])}function v(a){if("input"===a.mode)return!0;if(a.jscache=a.jscache||{},a.jscache.editable)return a.jscache.editable;var c=C(a).some(function(a){return b.isPropertyTrue(a,"editable")});return a.jscache.editable=c,c}function w(a,b,c){var d=a.stereotype;return d&&"None"!==d?angular.isArray(b)?b.some(function(a){return d.contains(a)}):d.contains(b):c||!1}function x(a,b){return w(a,["detail","Detail"],b)}function y(a,b){return w(a,["list","List"],b)}function z(a,b){return null==a?null==b:null!=b&&this.buildApplicationKey(a)===this.buildApplicationKey(b)}function A(a,b){return a.applicationName===b.applicationName&&a.schemaId===b.schemaId}function B(a,c,d){return a?(c=c||[],a.forEach(function(a){b.isNullInvisible(a,d)||(angular.isArray(a.displayables)?B(a.displayables,c,d):c.push(a))}),c):[]}function C(a){return B(a.displayables)}function D(b,c){var f=d.getCachedSchema(b,c);if(f)return a.when(f);var g={applicationName:b,targetSchemaId:c},h=e.getPromise("Metadata","GetSchemaDefinition",g);return h.then(function(a){return d.addSchemaToCache(a.data),a.data})}return{areTheSame:z,buildApplicationKey:q,buildApplicationMetadataSchemaKey:r,getId:h,getUserId:i,getProperty:p,getSummary:t,getTitle:s,hasAnyFieldOnMainTab:n,hasEditableProperty:v,isPropertyTrue:o,locateDisplayableByQualifier:u,locateJquerySectionElementByApp:j,allFieldsIncludingTabs:k,nonTabFields:l,nonTabFieldsFromDisplayables:m,parseAppAndSchema:g,isStereotype:w,isDetail:x,isList:y,isSameSchema:A,allDisplayables:C,flattenDisplayables:B,getSchema:D}}])}(modules,angular),function(angular,a){a.webcommons.service("fieldService",["$injector","$log","$filter","expressionService","eventService","userService","formatService",function(a,b,c,d,e,f,g){var h=function m(a,b,c){if(c.jscache=c.jscache||{},void 0!=c.jscache.isHidden)return c.jscache.isHidden;var e=c.isHidden||"ApplicationSection"!=c.type&&j(c,b),f="ApplicationCompositionDefinition"==c.type&&!c.inline;if(e||f)return c.jscache.isHidden=!0,!0;if("ApplicationSection"===c.type&&null==c.resourcepath&&(0===c.displayables.length||0===$.grep(c.displayables,function(c){return!m(a,b,c)}).length)){var g=null!=c.header&&null!==c.attribute&&"true"===c.header.parameters.enablecontrol;return!g}var h=!d.evaluate(c.showExpression,a);return"List"==b.stereotype&&(c.jscache.isHidden=h),h},i=function(a,b){return a.attribute==b.idFieldName},j=function(a,b){return!!i(a,b)&&(("Detail"==b.stereotype&&"input"==b.mode||"DetailNew"==b.stereotype)&&!a.isReadOnly)},k=function(a){return void 0==a||""===a||"true"===a.toLowerCase()},l={isFieldHidden:function(a,b,c){return null!=c&&h(a,b,c)},getParameter:function(a,b){return a.rendererParameters[b]},isFieldRequired:function(a,b){if("ApplicationSection"===a.type&&a.parameters)return"true"===a.parameters.required;var c=a.requiredExpression;return void 0!=c?d.evaluate(c,b):c},isFieldReadOnly:function(a,b,c,e){var f=arguments.length>4&&void 0!==arguments[4]&&arguments[4],g=c.isReadOnly;return!!g||null!=c.enableExpression&&(!f&&!d.evaluate(c.enableExpression,a,e))},fieldHasValue:function(a,b){return("message"!==b.attribute||!a.message||"\n                                    "!==a.message)&&!!a[b.attribute]},isPropertyTrue:function(a,b){return!!a&&(a.rendererParameters&&"true"==a.rendererParameters[b])},nonTabFields:function(a,b){b=void 0==b||b;for(var c=[],d=0;d<a.length;d++){var e=a[d];this.isTabOrComposition(e)||!b&&e.isHidden||c.push(e)}return c},fillDefaultValues:function(a,b,c){return $.each(a,function(e,h){var i=h.attribute;if(h.displayables&&h.displayables.length>0&&l.fillDefaultValues(h.displayables,b,c),void 0!=i&&null==b[i]){var j=null,m=a[e];if(null!=m.evalExpression?(j=d.evaluate(m.evalExpression,b,c,m),b[i]=j):null!=m.defaultExpression&&(j=d.evaluate(m.defaultExpression,b,c,m),b[i]=j),null==j&&null!=h.defaultValue)if("@now"==h.defaultValue)b[i]=g.format("@now",h,null);else{var n=f.readProperty(h.defaultValue);"numericinput"===m.rendererType&&n&&(n=parseInt(n)),"checkbox"===m.rendererType&&n&&(n=k(n)),b[i]=n}}}),b},isAssociation:function(a){var b=a.type;return"ApplicationAssociationDefinition"===b},isLazyAssociation:function(a){return this.isAssociation&&a.schema.isLazyLoaded},isTabComposition:function(a){var b=a.type;return"ApplicationCompositionDefinition"===b&&!a.inline},isSection:function(a){var b=a.type;return"ApplicationSection"===b},isInlineComposition:function(a){var b=a.type;return"ApplicationCompositionDefinition"===b&&a.inline},isListOnlyComposition:function(a){var b=a.type;return"ApplicationCompositionDefinition"===b&&null==a.schema.schemas.detail},isTabOrComposition:function(a){return this.isTab(a)||this.isTabComposition(a)},isTab:function(a){if(null==a)return!1;var b=a.type;return"ApplicationTabDefinition"===b},getDisplayableByKey:function(a,b){if(a.jscache=a.jscache||{},a.jscache.fieldsByKey=a.jscache.fieldsByKey||{},void 0!=a.jscache.fieldsByKey[b])return a.jscache.fieldsByKey[b];for(var c=a.displayables,d=0;d<c.length;d++){var e=c[d];if(e.attribute&&e.attribute===b||e.tabId&&e.tabId===b||e.id&&e.id===b)return a.jscache.fieldsByKey[b]=e,e;if(void 0!=e.displayables){var f=this.getDisplayableByKey(e,b);if(void 0!=f&&(f.attribute&&f.attribute===b||f.tabId&&f.tabId===b||f.id&&f.id===b))return a.jscache.fieldsByKey[b]=f,f}}return null},getDisplayablesByAssociationKey:function(a,b){a.jscache=a.jscache||{};var c=a.jscache.displayablesByAssociation=a.jscache.displayablesByAssociation||{};if(void 0!=c[b])return c[b];var d=[],e=this;return $.each(a.displayables,function(a,c){if(c.associationKey==b)d.push(c);else if(void 0!=c.displayables){var f=e.getDisplayablesByAssociationKey(c,b);null!=f&&(d=d.concat(f))}}),c[b]=d,d},countVisibleDisplayables:function(a,b,c){for(var d=0,e=0;e<c.length;e++)this.isFieldHidden(a,b,c[e])||d++;return d},getVisibleDisplayables:function(a,b){for(var c=b.displayables,d=[],e=0;e<c.length;e++)this.isFieldHidden(a,b,c[e])||d.push(c[e]);return d},getDisplayableIndexByKey:function(a,b){for(var c=a.displayables,d=0;d<c.length;d++){var e=c[d];if(e.attribute&&e.attribute===b)return d}return-1},getVisibleDisplayableIdxByKey:function(a,b){var c=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!a)return-1;a.jscache=a.jscache||{};for(var e=this.getLinearDisplayables(a,c,d),f=0;f<e.length;f++){var g=e[f];if(g.associationKey===b||g.target===b||g.attribute===b&&!g.isHidden)return f}return-1},getLinearDisplayables:function(a){var b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],c=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(a.jscache=a.jscache||{},a.jscache.alldisplayables&&!b)return a.jscache.alldisplayables;for(var d=a.displayables,e=[],f=0;f<d.length;f++){var g=d[f];g.displayables?(c&&e.push(g),e=e.concat(this.getLinearDisplayables(g,b,c))):e.push(g)}return a.jscache.alldisplayables=e,e},getNextVisibleDisplayableIdx:function(a,c,d){var e=this.getLinearDisplayables(c),f=this.getVisibleDisplayableIdxByKey(c,d);if(f==-1||f==e.length)return-1;for(var g=f+1;g<e.length;g++){var h=e[g];if(!$('[data-field="'+h.attribute+'"]').is(":hidden")&&!this.isFieldHidden(a,c,h)&&!this.isFieldReadOnly(a,c,h))return b.getInstance("fieldService#getNextVisibleDisplayable").debug("found",h.attribute,h),g}return-1},getRequiredDisplayables:function(a){for(var b=a.displayables,c=[],d=0;d<b.length;d++)b[d].required&&c.push(b[d]);return c},getId:function(a,b){return a[b.idFieldName]},getDisplayablesOfTypes:function(a,b){var c=[],d=this;return $.each(a,function(a,e){var f=e.type;if($.inArray(f,b)!=-1&&c.push(e),void 0!=e.displayables){var g=d.getDisplayablesOfTypes(e.displayables,b);c=c.concat(g)}}),c},getDisplayablesOfRendererTypes:function(a,b){var c=[],d=this;return $.each(a,function(a,e){var f=e.rendererType;$.inArray(f,b)!=-1&&c.push(e),void 0!=e.displayables&&(c=c.concat(d.getDisplayablesOfRendererTypes(e.displayables,b)))}),c},getFilterDisplayables:function(a){var b=[],c=this;return $.each(a,function(a,d){null!=d.filter&&null!=d.filter.operation&&b.push(d),void 0!=d.displayables&&(b=b.concat(c.getFilterDisplayables(d.displayables)))}),b},isNullInvisible:function(a,b){return void 0!=a.showExpression&&"true"!=a.showExpression&&!a.isHidden&&!d.evaluate(a.showExpression,b)},onFieldChange:function(a,c){b.getInstance("sw4.fieldservice#onFieldChange").debug("Invoking before field change event");var d=e.beforechange(a,c);return null===d?void c["continue"]():void(void 0!=d&&0==d?c.interrupt():void 0!=d&&1==d&&c["continue"]())},postFieldChange:function(a,c,d,f){var g={fields:c.datamap,target:a,scope:c,oldValue:d,newValue:f};b.get("sw4.fieldservice#postfieldchange",["event","field","afterchange"]).debug("Invoking post field change event."),e.afterchange(a,g)},currentDate:function(){return new Date},getQualifier:function(a,b){var c=a.qualifier;if(!c||!c.startsWith("expression="))return c;var d=c.replace("expression=","");d=replaceAll(d,"'",'"');var e;try{e=JSON.parse(d)}catch(f){throw console.error("Invalid qualifier expression for field",a,":",d),f}var g=b[a.attribute];if(e.hasOwnProperty(g))return e[g];for(var h in e)if(e.hasOwnProperty(h)){var i=h.match(/@.+/g);if(i){var j=(h.match(/!/g)||[]).length%2===0;i=i[0].replace("@",""),i=replaceAll(i,"!","");var k=b[i];k=!([!1,0,void 0,null,"false"].indexOf(k)>=0);var l=e[h];if(j&&k)return l;if(!j&&!k)return l}}return e["#default"]}};return l}])}(angular,modules),function(angular,a){function b(b,c,d){function e(){return o=o||d.get("configurationService")}function f(a){return{min:parseInt(a[n.keys.min]),adjacent:parseInt(a[n.keys.adjacent]),uppercase:"true".equalIc(a[n.keys.uppercase]),lowercase:"true".equalIc(a[n.keys.lowercase]),number:"true".equalIc(a[n.keys.number]),special:"true".equalIc(a[n.keys.special]),blacklist:window.isString(a[n.keys.blacklist])?a[n.keys.blacklist].split(","):[],login:"true".equalIc(a[n.keys.login]),placement:{number:{first:"true".equalIc(a[n.keys.numberFirst]),last:"true".equalIc(a[n.keys.numberLast])},special:{first:"true".equalIc(a[n.keys.specialFirst]),last:"true".equalIc(a[n.keys.specialLast])}}}}function g(){var d=b.get("passwordValidationService#fetchPasswordConfiguration",["validation","config","password"]),e=Object.values(n.keys),g=url("/api/generic/Configuration/GetConfigurations?")+a.param({fullKeys:e});return n.promise=c.get(g).then(function(a){return f(a.data)})["catch"](function(a){return d.error("Error fetching password configuration\n",a,"\nusing default configuration"),n["default"]})["finally"](function(){return n.promise=null}),n.promise}function h(a,b,c){a=a||"",c=c||{};var d=[];if(angular.isNumber(b.min)&&b.min>0&&a.length<b.min&&d.push("Lenght must greater than or equal to "+b.min),angular.isNumber(b.adjacent)&&b.adjacent>0){var e=new RegExp("(.)"+"\\1".repeat(b.adjacent)+"+","g");e.test(a)&&d.push("Cannot have more than "+b.adjacent+" identical adjacent characters")}angular.isArray(b.blacklist)&&b.blacklist.some(function(b){return b===a})&&d.push("Password cannot be any of the following: "+b.blacklist.join(", ")),b.uppercase&&!/[A-Z]/.test(a)&&d.push("Requires at least one uppercase letter"),b.lowercase&&!/[a-z]/.test(a)&&d.push("Requires at least one lowercase letter");var f=/[0-9]/;b.number&&!f.test(a)&&d.push("Requires at least one number character");var g=/^[a-zA-Z0-9- ]*$/;b.special&&g.test(a)&&d.push("Requires at least one special character");var h=c.username;if(!b.login&&h&&a.contains(h)&&d.push("Cannot contain user's username"),!b.placement)return d;var i=a.charAt(0),j=a.charAt(a.length-1);return b.placement.number&&!b.placement.number.first&&f.test(i)&&d.push("First character cannot be a number"),b.placement.number&&!b.placement.number.last&&f.test(j)&&d.push("Last character cannot be a number"),!b.placement.special||b.placement.special.first||g.test(i)||d.push("First character cannot be a special character"),!b.placement.special||b.placement.special.last||g.test(j)||d.push("Last character cannot be a special character"),d}function i(){return n.promise||g()}function j(){var a={};Object.values(n.keys).forEach(function(b){return a[b]=e().getConfigurationValue(b)});var b=f(a);return b}function k(a,b){var c=this.getPasswordConfiguration();return h(a,c,b)}function l(a,b){return this.getPasswordConfigurationAsync().then(function(c){return h(a,c,b)})}var m=function q(){_classCallCheck(this,q),this.min=6,this.adjacent=3,this.uppercase=!0,this.lowercase=!0,this.number=!0,this.special=!0,this.blacklist=[],this.login=!0,this.placement={number:{first:!1,last:!1},special:{first:!1,last:!1}}},n={promise:null,"default":new m,keys:{min:"/Global/Password/Min",adjacent:"/Global/Password/Adjacent",uppercase:"/Global/Password/Uppercase",lowercase:"/Global/Password/Lowercase",number:"/Global/Password/Number",special:"/Global/Password/Special",blacklist:"/Global/Password/BlackList",numberFirst:"/Global/Password/PlacementNumberFirst",numberLast:"/Global/Password/PlacementNumberLast",specialFirst:"/Global/Password/PlacementSpecialFirst",specialLast:"/Global/Password/PlacementSpecialLast",login:"/Global/Password/Login"}},o=null,p={validatePassword:k,validatePasswordAsync:l,getPasswordConfiguration:j,getPasswordConfigurationAsync:i};return p}angular.module("webcommons_services").service("passwordValidationService",["$log","$http","$injector",b])}(angular,jQuery),function(angular){function a(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(a,b){var c=this,e=[];return a.forEach(function(a){var f=a.label;if(!d.isNullInvisible(a,b)){var h=!!a.requiredExpression&&g.evaluate(a.requiredExpression,b);if(h&&nullOrEmpty(b[a.attribute])&&e.push(f),a.displayables){var i=c.validate(a.displayables,b);e=e.concat(i)}}}),e}function o(a,b,c){var d="";switch(a){case"number":d=new RegExp(/^\d+$/);break;case"phonenumber":d=new RegExp(/^\d+$/);break;case"email":d=new RegExp(/^(([^<>()\[\]\.,;:\s@\"]+(\.[^<>()\[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/,"i");break;case"custom":d=new RegExp(b,c)}return d}function p(a){return o(a.rendererParameters.valtype,a.rendererParameters.valpattern,a.rendererParameters.valflags)}function q(a){var b=a.rendererParameters.valtype;switch(b){case"number":return"^\\d+$";case"phonenumber":return"^\\d+$";case"email":return'^(([^<>()\\[\\]\\.,;:\\s@\\"]+(\\.[^<>()\\[\\]\\.,;:\\s@\\"]+)*)|(\\".+\\"))@(([^<>()[\\]\\.,;:\\s@\\"]+\\.)+[^<>()[\\]\\.,;:\\s@\\"]{2,})$';case"custom":return a.rendererParameters.valpattern||""}return""}function r(a,b){if(!a.schema.schemas)return[];var c=a.schema.schemas.list;if(!c)return[];var d=b[a.relationship],e=[];if(!d)return e;for(var f=0;f<d.length;f++){var g=d[f],h=i.buildMergedDatamap(g,b);h["#rownum"]=f,e=e.concat(this.validate(c,c.displayables,h,null,!0))}return e}function s(a){var b=l.currentSchema(a),c=l.rootDataMap(a);return this.validate(b,b.displayables,c)}function t(a,c,d){if(null==a||null==c)return b.when();if("true"===sessionStorage.mockclientvalidation)return b.when();var e=this.validate(a,a.displayables,c,d);b.defer();return e.length>0?b.reject(e):b.when()}function u(b,e,f){var i=this,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},n=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=a.get("validationService#validate",["validation"]);n||a.get("validationService#validate",["save"]).info("init validation for schema "+b.schemaId+" of application "+b.applicationName);var p=[],q=j.flattenDisplayables(e,null,f),r=function u(a,b,c){var d=a[b];if(!d)return null;var e=d.find(function(a){return a.$name===c})||d[0][c];return!e&&angular.isArray(d)&&d[0].$error?u(d[0].$error,b,c):e},s=function(a,b){var c=r(a,"email",b);return!!c&&c.$invalid};if(q.forEach(function(a){var e=a.label;o.debug("performing validation on field {0}".format(e));var h=!!a.requiredExpression&&g.evaluate(a.requiredExpression,f),k=b.title?b.title:b.applicationName,n=c.get18nValue(b.applicationName+".name",k);if("email"===a.rendererType&&l.email&&s(l,a.attribute))return void p.push(c.get18nValue("messagesection.validation.requiredExpression","Invalid email at field {0} for {1}",[e,n]));if("password"===a.rendererType){var q=r(l,"password",a.attribute);if(q){var t=q.$viewValue,u=f[a.rendererParameters.usernameFieldName];if(h||!nullOrEmpty(t)){var v=m.validatePassword(t,{username:u});p=p.concat(v.map(function(a){return"<br><strong>"+e+"</strong>: "+a}))}}}if((d.isInlineComposition(a)||d.isListOnlyComposition(a)&&j.hasEditableProperty(a.schema.schemas.list))&&(p=p.concat(i.validateInlineComposition(a,f))),h&&nullOrEmpty(f[a.attribute])){if(!nullOrEmpty(f.docinfoid))return;var w=f["#rownum"]?"("+f["#rownum"]+")":"";if("upload"===a.rendererType&&nullOrEmpty(f.newattachment_path))return void p.push(c.get18nValue("messagesection.validation.requiredExpression","<strong>{0}{1}</strong> is required",[e,w]));e.equalIc("alias")||!e.endsWith("s")&&!e.endsWith("S")?p.push(c.get18nValue("messagesection.validation.requiredExpression","<strong>{0}{1}</strong> is required",[e,w])):p.push(c.get18nValue("messagesection.validation.requiredExpression","<strong>{0}{1}</strong> are required",[e,w]))}}),void 0==n||!n){var t=h.beforesubmit_onvalidation(b,f);null!=t&&Array.isArray(t)&&(p=p.concat(t)),p.length>0&&(k.notifymessage("error",p.join(", ")),$("html, body").animate({scrollTop:0},"fast"))}return p}var v={getInvalidLabels:n,validate:u,validateCurrent:s,validatePromise:t,validateInlineComposition:r,getValidationPattern:p,getValidationPatternByType:o,getValidationPatterString:q};return v}angular.module("webcommons_services").service("validationService",["$log","$q","i18NService","fieldService","$rootScope","dispatcherService","expressionService","eventService","compositionCommons","schemaService","alertService","crudContextHolderService","passwordValidationService",a])}(angular),function(angular){function a(a,b,c,d,e,f){var g=function(a,b,d){var e=f.defer(),g=b?"Are you sure you want to delete {0} {1}?".format(b,d):"Are you sure you want to delete this?",h=a?a:c.get18nValue("general.defaultcommands.delete.confirmmsg",g,[b,d]);return bootbox.setDefaults({locale:c.getCurrentLanguage()}),bootbox.confirm({templates:{header:"<div class='modal-header'><i class='fa fa-question-circle'></i><h4 class='modal-title'></h4></div>"},message:h,title:c.get18nValue("general.defaultcommands._confirmationtitle","Confirm..."),className:"smallmodal",callback:function(a){a?e.resolve():e.reject()}}),e.promise},h=function(a,b,d){var e=f.defer(),g=b?"Are you sure you want to cancel {0} {1}?".format(b,d):"Are you sure you want to cancel this?",h=a?a:c.get18nValue("general.defaultcommands.delete.confirmmsg",g,[b,d]);return bootbox.setDefaults({locale:c.getCurrentLanguage()}),bootbox.cancelDialog({templates:{header:"<div class='modal-header'><i class='fa fa-question-circle'></i><h4 class='modal-title'></h4></div>"},message:h,title:c.get18nValue("general.defaultcommands._confirmationtitle","Confirm..."),className:"smallmodal",callback:function(a){a?e.resolve():e.reject()}}),e.promise},i=function(a){var b=f.defer();return bootbox.setDefaults({locale:c.getCurrentLanguage()}),bootbox.alert({templates:{header:"<div class='modal-header'><i class='fa fa-times-circle'></i><h4 class='modal-title'></h4></div>"},message:a,title:c.get18nValue("general.defaultcommands._alert","Sorry..."),className:"smallmodal error",callback:function(){b.resolve()}}),b.promise},j=function(a,b,c,e,f,g){d.createNotification(a,null,b,e,f,g)},k=function(a){d.createNotification("success",null,a);
},l=function(a){for(var b,c=3,d=0,e=a.prependMessage;a.hasOwnProperty("innerException")&&d<c;)b=a.innerException,a=a.innerException,d++;null!=b&&(a={},a.errorStack=b.stackTrace,a.errorMessage=b.message),e&&(a.errorMessage=e+" --> "+a.errorMessage);var f=a.errorMessage||a.exceptionMessage,g={};return g.type=a.errorType||a.exceptionType,g.outline=a.outlineInformation,g.stack=a.errorStack||a.fullStack||a.stackTrace,g.message=f,g},m=function(a){if("undefined"!=typeof a){var b=this.buildException(a);d.createNotification("error",null,b.message,b.type,b.outline,b.stack)}},n=function(a){if("undefined"!=typeof a&&a.warningDto){var b="";b+=a.warningDto.warnMessage;var c=this.buildException(a.warningDto);a.successMessage&&this.notifymessage("success",a.successMessage),d.createNotification("warning",null,b,c.type,c.message,c.stack)}},o=function(a){return"<div style='text-align: center;vertical-align: middle;'>"+a+"</div>"},p={confirm:g,confirmCancel:h,buildException:l,alert:i,notifymessage:j,notifyexception:m,notifyWarning:n,success:k,buildCenteredTemplate:o};return $(window).on("error",function(a){d.processJsError(a)}),p}angular.module("webcommons_services").service("alertService",["$rootScope","$timeout","i18NService","notificationViewModel","$log","$q",a])}(angular),function(angular){function a(a,b,c,d){function e(e,f,g){if(void 0==f||null==e)return e;if(void 0!=f.rendererParameters.formatter){if(f.rendererParameters.formatter.startsWith("@")){var h=f.rendererParameters.formatter;h=h.substring(1);var i=h.split("."),j=i[0],m=i[1],n=c.loadService(j,m),o={value:e,column:f,datamap:g};return n(o)}if("lower"===f.rendererParameters.formatter)return e.toLowerCase().trim();if("upper"===f.rendererParameters.formatter)return e.toUpperCase().trim()}var p;if(f.rendererType&&f.rendererType.equalsAny("datetime","date","time")&&(null==f.rendererParameters.formatter||"datetime"===f.rendererParameters.formatter)){if(null!=e)return p=f.rendererParameters.format,null==p&&(p=d.retrieveFromContext("dateTimeFormat")),k(e,p,!1)}else if("ApplicationSection"===f.type&&f.parameters.format){if(null!=f.parameters.format&&null!=e)return p=f.parameters.format,k(e,p,!1)}else if(void 0!=f.rendererParameters&&null!=f.rendererParameters.formatter)if("numberToBoolean"===f.rendererParameters.formatter&&(e=1==e?b.get18nValue("general.yes","Yes"):b.get18nValue("general.no","No")),"booltostring"===f.rendererParameters.formatter&&(e=e===!0||1===e?"true":"false"),"stringtonumberbool"===f.rendererParameters.formatter)e="1"===e||"true"===e?1:0;else if("numberToAbs"===f.rendererParameters.formatter)isNaN(e)||(e=Math.abs(e));else{if("doubleToTime".equalsIc(f.rendererParameters.formatter)){if(null==e)return"";var q=e.toString();if(q.length>0&&q.indexOf(".")===-1)return"0"===q?"00 : 00":e+" : 00";var r=q.split(".")[0],s=q.split(".")[1];r=parseInt(r);var t=Math.round(Math.round(60*parseFloat("0."+s)*100)/100);return(r<10?"0"+r:r)+" : "+(t<10?"0"+t:""+t)}if("doubleToTimeExt"===f.rendererParameters.formatter){if(null==e)return"";var u=36e5*e,q=new Date(u),v=Math.floor(e/24),r=q.getUTCHours(),t=q.getUTCMinutes(),w=q.getUTCSeconds();return(v<10?"0"+v:v)+" : "+(r<10?"0"+r:r)+" : "+(t<10?"0"+t:""+t)+" : "+(w<10?"0"+w:""+w)}if("descriptionDataHandler"==f.rendererParameters.formatter)return l(e,f);if("money"==f.rendererParameters.formatter)return a("currency")(e,"$",2)}else if(void 0!=f.rendererParameters&&null!=f.rendererParameters.limit&&"undefined"!=typeof e){var x=e.toString(),y=f.rendererParameters.limit,z=x.substring(0,f.rendererParameters.limit);return x.length>y&&(z+="..."),z}return e}function f(a,b){return b||(b=d.retrieveFromContext("dateTimeFormat")),k(a,b,!0)}function g(a,b){if(a)return a.trim();var c=d.retrieveFromContext("dateTimeFormat");return b?c:c.replace("hh:mm","")}function h(a,b){var c=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return a?(a=a.replace("dd","DD"),a=a.replace("yyyy","YYYY"),b||(a=a.replace("HH:mm",""),a=a.replace("hh:mm","")),c||(a=a.replace(":mm",":00")),a.trim()):(a=d.retrieveFromContext("dateTimeFormat"),a=a.replace("dd","DD"),a=a.replace("yyyy","YYYY"),b||(a=a.replace("HH:mm",""),a=a.replace("hh:mm","")),c||(a=a.replace(":mm",":00")),a)}function i(a){return angular.forEach(a,function(b,c){a[c]=null==b?null:angular.isArray(b)?b:b.toString()}),a}function j(a){switch("undefined"==typeof a?"undefined":_typeof(a)){case"boolean":return a;case"number":return 1===a;case"string":return a.equalsIc("y")||a.equalsIc("yes")||a.equalsIc("true")||a.equalsIc("1")}return!1}var k=function(b,c,d,e){if(null==b)return null;if(angular.isString(b)&&b.equalsAny("@now","@currentdatetime","@currentdate"))return a("date")(new Date,c);try{return a("date")(b,c)}catch(f){return b=new Date(b),a("date")(b,c)}},l=function(a,b){if(null==a)return"";try{var c=a.split("Logged Date:")[1];if(!nullOrUndef(c)){var d=c.replace(/ /g,""),e=b.rendererParameters.format,f=k(d,e,!1);a=a.replace(d,f)}}catch(g){return a}return a},m={format:e,formatDate:f,adjustDateFormatForAngular:g,adjustDateFormatForPicker:h,doContentStringConversion:i,isChecked:j};return m}angular.module("webcommons_services").service("formatService",["$filter","i18NService","dispatcherService","contextService",a])}(angular),function(modules){modules.webcommons.service("eventService",["$log","$q","dispatcherService","crudContextHolderService","expressionService",function($log,$q,dispatcherService,crudContextHolderService,expressionService){var loadEvent=function(a,b){return a&&void 0!==a.events?a.events[b]:null},logMsg=function(a,b){var c=a?a+" - ":"";return c+b},execute=function execute(event,eventParameters){if(!event)return null;var type=event,log=$log.getInstance("eventService#execute"),hasService=event.service&&event.method;if(!hasService&&!event.expression)return log.warn(logMsg(type,"the event has not service and method or expression.")),null;if(hasService){var fn=dispatcherService.loadService(event.service,event.method);if(!fn)return log.warn(logMsg(type,"method "+event.method+" from service "+event.service+" not found.")),null;log.debug(logMsg(type,"invoking method "+event.method+" from service "+event.service+"."));var serviceParameters=Object.keys(eventParameters).map(function(a){return eventParameters[a]});return fn.apply(null,serviceParameters)}var expression=event.expression;if(log.debug(logMsg(type,"evaluating the expression "+expression+".")),"true"===expression||expression===!0)return!0;if(null==expression||"false"===expression||expression===!1)return!1;expression=expression.replace(/\$e/g,"eventParameters");try{return eval(expression)}catch(e){return log.error(e),!1}};return{dispatch:function(a,b,c){var d=loadEvent(b,a);return d?execute(d,c):null},onload:function(a,b,c,d){var e=loadEvent(b,"onload");e&&(d.tabid=d.tabid||crudContextHolderService.getActiveTab(),d.applicationName=d.applicationName||crudContextHolderService.currentApplicationName(),d.schemaId=d.schemaId||crudContextHolderService.currentSchema().schemaId,execute(e,{scope:a,schema:b,datamap:c,parameters:d}))},onviewdetail:function(a,b){var c=loadEvent(a,"onviewdetail");c&&execute(c,{parameters:b})},beforesubmit_onvalidation:function(a,b,c){var d=loadEvent(a,"beforesubmit.onvalidation");return d?execute(d,{schema:a,datamap:b,parameters:c}):[]},beforesubmit_prevalidation:function(a,b,c){var d=loadEvent(a,"beforesubmit.prevalidation");return d?execute(d,{schema:a,datamap:b,parameters:c}):null},beforesubmit_postvalidation:function(a,b,c){var d=loadEvent(a,"beforesubmit.postvalidation");return d?$q.when(execute(d,{schema:a,datamap:b,parameters:c})):$q.when(null)},onedit_validation:function(a,b){var c=loadEvent(b,"onedit.validation");return c?execute(c,{datamap:a,schema:b}):$q.when(null)},onremoval_validation:function(a,b){var c=loadEvent(b,"onremoval.validation");return c?execute(c,{datamap:a,schema:b}):$q.when(null)},providerloaded:function(a,b){var c=loadEvent(a,"providerloaded");return c?execute(c,{providerLoadedParameters:b}):null},afterchange:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=loadEvent(a,"afterchange");return c?(b.fieldMetadata=a,execute(c,{parameters:b})):null},beforechange:function(a,b){var c=loadEvent(a,"beforechange");return!c||execute(c,{event:b})},onassociationsloaded:function(a){var b=loadEvent(a,"onassociationsloaded");return b?execute(b,{}):null},onschemafullyloaded:function(a){var b=loadEvent(a,"onschemafullyloaded");return b?execute(b,{}):null}}}])}(modules),function(a){a.rootCommons.service("restService",["$http","$log","$q","contextService",function(a,b,c,d){var e=["Signin","FirstSolarEmail","FirstSolarWpGenericEmail","UmcRequestController","UserSetup/DefinePassword","UserSetup/DoSetPassword","UserSetupWebApi/ForgotPassword","UserSetupWebApi/SendActivationEmail","UserSetupWebApi/NewUserRegistration"];return{validateAnonymous:function(a,b){return!!e.some(function(b){return b===a})||!!e.some(function(c){return c===a+"/"+b})},getActionUrl:function(a,b,c){b=void 0===b||null==b?"get":b;var e=null==c?{}:c,f=d.getFromContext("serverurl");return f?f+"/api/generic/"+a+"/"+b+"?"+$.param(e,!1):url("/api/generic/"+a+"/"+b+"?"+$.param(e,!1))},invokePost:function(a,b,c,d,e,f){this.postPromise(a,b,c,d).then(function(a){null!=e&&e(a.data)})["catch"](function(a){null!=f&&f(a.data)})},invokeGet:function(a,c,d,e,f){var g=this.getActionUrl(a,c,d),h=b.getInstance("restService#invokeGet");h.info("invoking get on url {0}".format(g));var i=this.getPromise(a,c,d);i.then(function(a){null!=e&&e(a.data)})["catch"](function(a){null!=f&&f(a.data)})},postPromise:function(e,f,g,h,i){var j=this.getActionUrl(e,f,g),k=b.getInstance("restService#invokePost",["post","network"]);return d.get("anonymous",!1,!0)&&!this.validateAnonymous(e,f)?(k.warn("mocking call to {0}. consider filtering that request off the stack".format(j)),c.reject()):(k.info("invoking post on url {0}".format(j)),a.post(j,h,i))},post:function(){return this.postPromise.apply(this,arguments)},putPromise:function(e,f,g,h,i){var j=this.getActionUrl(e,f,g),k=b.getInstance("restService#invokePut",["put","network"]);return d.get("anonymous",!1,!0)&&!this.validateAnonymous(e,f)?(k.info("mocking call to {0} consider filtering that request off the stack".format(j)),c.reject()):(k.info("invoking put on url {0}".format(j)),a.put(j,h,i))},put:function(){return this.putPromise.apply(this,arguments)},getPromise:function(e,f,g,h){var i=this.getActionUrl(e,f,g),j=b.getInstance("restService#invokeGet");return d.get("anonymous",!1,!0)&&!this.validateAnonymous(e,f)?(j.info("mocking call to {0} consider filtering that request off the stack".format(i)),c.reject()):(j.info("invoking get on url {0}".format(i)),a.get(i,h))},getPromiseNoDigest:function(c,d,e){var f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},g=this.getActionUrl(c,d,e),h=b.getInstance("restService#invokeGet");return h.info("invoking get on url {0}".format(g)),a.get("nodigest:"+g,f)},get:function(){return this.getPromise.apply(this,arguments)}}}])}(modules),function(modules){modules.webcommons.service("expressionService",["$rootScope","$log","contextService","dispatcherService",function($rootScope,$log,contextService,dispatcherService){function buildScopeVariables(variables,scopeVariables,datamap,onlyReturnRootNode,scope){for(var i=0;i<scopeVariables.length;i++){var referenceVariable=scopeVariables[i],scopeReplaceStr=2==referenceVariable.length?"scope":"scope.",realVariable=referenceVariable.replace(/\$\./,scopeReplaceStr);realVariable=realVariable.replace(/\s/g,"");var subVariable=compiledScopeRegex.test(realVariable)||compiledServiceRegex.test(realVariable);if(1==subVariable){var subVariables=_getVariables(realVariable,datamap,onlyReturnRootNode,scope);$.each(subVariables,function(key,value){realVariable=realVariable.replace(key,eval(value)),void 0!=variables[key]&&1==onlyReturnRootNode&&delete variables[key]})}variables[referenceVariable]=realVariable}}function buildServiceVariables(variables,serviceVariables,datamap,onlyReturnRootNode,scope){for(var i=0;i<serviceVariables.length;i++){var referenceVariable=serviceVariables[i],realVariable=referenceVariable.replace(/fn\:/,"");realVariable=realVariable.replace(/\s/g,"");var declaration=extractFnSignatureFromExpression(realVariable),subVariable=compiledScopeRegex.test(realVariable)||compiledServiceRegex.test(realVariable);if(1==subVariable){var subVariables=_getVariables(realVariable,datamap,onlyReturnRootNode,scope);$.each(subVariables,function(key,value){realVariable=realVariable.replace(key,value),declaration=declaration.replace(key,eval(value)),void 0!=variables[key]&&1==onlyReturnRootNode&&delete variables[key]})}var functionCallStr=realVariable.substring(0,realVariable.indexOf("(")),functionCall=functionCallStr.split("."),service=functionCall[0],method=functionCall[1],functionParameterRegex=new RegExp(/,(?=[^\)]*(?:\(|$))(?=(?:[^']*'[^']*')*[^']*$)/g),parameters=declaration.split(functionParameterRegex);realVariable=dispatcherService.invokeService(service,method,parameters)}variables[referenceVariable]=realVariable}function buildDatamapVariables(a,b,c){for(var d="datamap",e=0;e<b.length;e++){var f=b[e],g=f.replace(/\@/,"");g=d+"['"+g+"']",a[f]=g}}function extractFnSignatureFromExpression(a){var b=1;a=a.substring(a.indexOf("(")+1);var c=0;for(c;c<a.length&&b>0;c++)"("==a[c]?b++:")"==a[c]&&b--;var d=a.substring(0,c-1);return d}function _getVariables(a,b,c,d){var e={},f=a.match(compiledScopeRegex);null!=f&&buildScopeVariables(e,f,b,c,d);var g=a.match(compiledServiceRegex);null!=g&&buildServiceVariables(e,g,b,c,d);var h=a.match(compiledDatamapRegex);return null!=h&&buildDatamapVariables(e,h,b),e}var preCompiledReplaceRegex=/(?:^|\W)@(\#*)([\w+\.]+)(?!\w)/g,compiledDatamapRegex=/(\@\#?)(\w+(\.?\w?)*)/g,datamapRegexString="(@#?)(w+(.?w?)*)",compiledScopeRegex=/\$\.(\w+)?((\.\w+)|(\[.*?\]+)|(\(.*?\)))*/g,scopeRegexString="$.(w+)?((.w+)|([.*?]+)|((.*?)))*",compiledServiceRegex=/fn\:\w+\.\w+(\(.*?\)((\s?\,\s?.*?)*\))*)((\.\w+)|(\[.*?\])|\)|(\(.*?\)((\s?\,\s?.*?)*\))*))*/g,serviceRegexString="fn:w+.w+((.*?)((s?,s?.*?)*))*)((.w+)|([.*?])|)|((.*?)(s?,s?.*?))*))*";return{getDatamapRegex:function(){return new RegExp("/"+datamapRegexString+"/g")},getScopeRegex:function(){return new RegExp("/"+scopeRegexString)+"/g"},getServiceRegex:function(){return new RegExp("/"+serviceRegexString+"/g")},getExpression:function(a,b,c){var d=_getVariables(a,b,!0,c);return null!=d&&$.each(d,function(b,c){a=a.replace(new RegExp(b,"g"),c)}),a=a.replace(/ctx:/g,"contextService.")},getVariables:function(a,b){return _getVariables(a,b,!1,scope)},getVariablesBeforeJordanFuckedUp:function(a){var b=a.match(preCompiledReplaceRegex);if(null!=b)for(var c=0;c<b.length;c++)b[c]=b[c].replace(/[\@\(\)]/g,"").trim();return b},getVariablesForWatch:function(a,b){b=b||"datamap.";var c=this.getVariablesBeforeJordanFuckedUp(a);if(null==c)return null;for(var d="[",e=0;e<c.length;e++)d+=b+c[e],e!=c.length-1&&(d+=",");return d+="]"},evaluate:function evaluate(expression,datamap,scope,displayable){var log=$log.getInstance("expressionService#evaluate");if("true"===expression||expression===!0)return!0;if(null==expression||"false"===expression||expression===!1)return!1;if(expression.startsWith("service:")){var realServiceDefinition=expression.substr(8),targetFunction=dispatcherService.loadServiceByString(realServiceDefinition),schema=scope?scope.schema:null;return targetFunction(datamap,schema,displayable)}expression=expression.replace(/\$/g,"scope");var expressionToEval=this.getExpression(expression,datamap||{},scope);if(!datamap&&expressionToEval.indexOf("datamap")>=0)return!0;try{return eval(expressionToEval)}catch(e){return contextService.isLocal()&&log.error(e),!0}}}}])}(modules),function(a){a.webcommons.service("dispatcherService",["$injector","$log","$q","$rootScope",function(a,b,c,d){var e=function(c,d){var e=b.getInstance("dispatcherService#loadService");if(void 0===c||void 0===d)return null;var f=a.getInstance(c);if(!f)return e.warn("Service "+c+" missing"),null;var g=f[d];return g?g.bind(f):(e.warn("Method "+d+" not found on service "+c),null)};return{loadServiceByString:function(a){if(!a)return null;var b=a.split(".");if(2!==b.length)throw new Error("wrong metadata configuration. service string should be 'servicexxx.methodxxx'".format(a));return this.loadService(b[0],b[1])},loadService:function(a,b){return e(a,b)},invokeService:function(a,b,c){var d=this.loadService(a,b,c);if(null==d)return null;if(null!=c){for(var e=[],f=0;f<c.length;f++)e.push(c[f]);return d.apply(this,e)}return d.apply(this)},invokeServiceByString:function(a,b){if(null==a)return null;var c=a.split(".");return 2!=c.length?null:this.invokeService(c[0],c[1],b)},loadBaseDeferred:function(){var a=c.defer(),b=a.promise;return b.success=function(a){return b.then(a),b},b.error=function(a){return b["catch"](a),b},a},dispatchevent:function(a){d.$broadcast(a,Array.prototype.slice.call(arguments,1))}}}])}(modules),function(angular){function a(a,b,c){function d(a,d){var e=a.applicationName,h=a.schemaId,i=a.tabid||"",j=c.defer(),k=j.promise;return g[e+"."+h+"."+i]=d||j,$(document).scannerDetection({avgTimeByChar:f,onComplete:function(a){var c=b.getActiveTab()||"",d=b.currentSchema(),e=b.currentApplicationName();if(!e||!d)return void $(document).scannerDetection(null);if(!Array.isArray(d)){var f=g[e+"."+d.schemaId+"."+c];return void(angular.isFunction(f)?f(a):angular.isFunction(f.resolve)?j.resolve(a):$(document).scannerDetection(null))}var h=g[e+"."+d[0].schemaId+"."+c],i=g[e+"."+d[1].schemaId+"."+c];return angular.isFunction(h)||angular.isFunction(i)?h===i?void h(a):(angular.isFunction(h)&&h(a),void(angular.isFunction(i)&&i(a))):void $(document).scannerDetection(null)}}),k}function e(){return f}a.$on(JavascriptEventConstants.AppChanged,function(){$(document).scannerDetection(null)});var f=isMobile()?300:14;"true"===sessionStorage.debugscanner&&(f=3e4);var g={},h={registerScanCallBackOnSchema:d,getTimeBetweenChars:e};return h}try{angular.module("sw_scan",[])}catch(b){}angular.module("sw_scan").service("scanningCommonsService",["$rootScope","crudContextHolderService","$q",a])}(angular),function(angular){var a=function(){function a(b){_classCallCheck(this,a),this.contextService=b}return _createClass(a,[{key:"locatePrimaryEmail",value:function(a){if(!a)return null;for(var b=0;b<a.length;b++){var c=a[b];if(c.isprimary)return c.emailaddress}return null}},{key:"readProperty",value:function(a){if(null==a)return null;if(!a.startsWith("@"))return a;var b=this.contextService.getUserData();if(a.startsWith("@user.")){var c=a.substring(6);return b.hasOwnProperty(c)?b[c]:b.genericproperties[c]}return a.equalsAny("@userid")?b.username:a.equalsAny("@personid","@username")?null==b.maximoPersonId?b.username:b.maximoPersonId:a}},{key:"isSysAdmin",value:function(){return this.hasRole(["sysadmin"])}},{key:"getPersonId",value:function(){var a=this.contextService.getUserData(),b=a.maximoPersonId;return!b&&this.contextService.isLocal()&&"swadmin".equalsIc(a.login)?"SWADMIN":b}},{key:"hasRole",value:function(a){if(null==a)return!0;var b=this.contextService.getUserData(),c=b.roles,d=!1;return $.each(a,function(a,b){$.each(c,function(a,c){if(c.name==b)return void(d=!0)})}),d}},{key:"inGroup",value:function(a){var b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(null==a)return!0;var c=this.contextService.getUserData();if(b){var d=c.personGroups;if(!d||0===d.length){var e=c.genericproperties.persongroups||[];return e.some(function(b){return b===a})}for(var f=0;f<d.length;f++){var g=d[f];if(g.personGroup.name===a)return!0}return!1}return c.profiles&&c.profiles.some(function(b){return a.equalIc(b.name)})}}]),a}();a.$inject=["contextService"],angular.module("webcommons_services").service("userService",a)}(angular),function(angular){var a=function(){function a(b){_classCallCheck(this,a),this.datamapSanitizeService=b}return _createClass(a,[{key:"buildInlineDefinition",value:function(a){return a.schemas={list:a.compositionschemadefinition},a.inline=!0,a.collectionProperties={allowInsertion:"false",allowUpdate:"false",autoCommit:!1},a}},{key:"buildMergedDatamap",value:function(a,b){var c=b,d=angular.copy(c);if(d=this.datamapSanitizeService.sanitizeDataMapToSendOnAssociationFetching(d),a){var e=a;for(var f in e)e.hasOwnProperty(f)&&(d[f]=e[f])}return d}}]),a}();a.$inject=["datamapSanitizeService"],angular.module("webcommons_services").service("compositionCommons",["datamapSanitizeService",a])}(angular),function(angular){function a(){function a(a){return c.compressToUTF16(a)}function b(a){return c.decompressFromUTF16(a)}var c=window.LZString,d={compress:a,decompress:b};return d}angular.module("sw_rootcommons").service("compressionService",[a])}(angular),function(angular){function a(a){function b(b,c){var d=c&&c.ttl?c.ttl:null,e=!(!c||!c.compress)&&c.compress,f={data:b};if(d&&(f.expires=(new Date).getTime()+d),e){f.compressed=!0,f.parse=!angular.isString(b);var g=f.parse?JSON.stringify(b):b;f.data=a.compress(g)}return JSON.stringify(f)}function c(a,b){if(0!==b&&!b)throw new Error(a+" cannot be null nor undefined")}function d(b){var c=(new Date).getTime(),d=localStorage.getItem(b);if(!d)return null;var e=JSON.parse(d),f=e.expires;if(f&&f<=c)return localStorage.removeItem(b),null;var g=e.data;if(e.compressed){var h=a.decompress(g);return e.parse?JSON.parse(h):h}return g}function e(a,d,e){c("key",a),c("data",d);var f=b(d,e);localStorage.setItem(a,f)}function f(a){return c("key",a),d(a)}function g(a){c("key",a);var b=d(a);return localStorage.removeItem(a),b}var h={put:e,get:f,remove:g};return h}angular.module("sw_rootcommons").service("localStorageService",["compressionService",a])}(angular),function(angular){var customServiceName=void 0,customServiceCodeKeyName=void 0,dynamicScriptsCacheService=function(){function dynamicScriptsCacheService(a,b,c,d,e,f){_classCallCheck(this,dynamicScriptsCacheService),this.localStorageService=d,this.$injector=e,this.initEntriesFromLocalStorage(),this.$q=b,this.$rootScope=a,this.$log=c,this.contextService=f,customServiceName=function(a){return"$sw:custom_"+a},customServiceCodeKeyName=function(a){return"sw:customservice_"+a}}return _createClass(dynamicScriptsCacheService,[{key:"useCustomServiceIfPresent",value:function(a){var b=this.$log.get("dynamicScriptsCacheService#useCustomServiceIfPresent",["dynscripts","angular","services"]);b.trace("checking custom service + "+a);var c=this._loadedServices[a];if(c){var d=c.custom?customServiceName(a):a;if(this.$injector.has(d))return b.debug("returning custom service + "+a),this.$injector.get(d);var e=this.localStorageService.get(customServiceCodeKeyName(a)),f=this.registerScript(d,e);return f?(b.debug("returning custom service + "+a),this.$injector.get(d)):null}return null}},{key:"getClientState",value:function(){var a=this,b={};return Object.keys(this._loadedServices).forEach(function(c){b[c]=a._loadedServices[c].rowstamp}),b}},{key:"syncWithServerSideScripts",value:function(){var a=this,b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c=this.$log.get("dynamicScriptsCacheService#syncWithServerSideScripts",["dynscripts","angular","services"]),d=this.contextService,e=this.getClientState();this.restService||(this.restService=this.$injector.get("restService"));var f=void 0;return f=b?this.$q.when({data:b}):this.restService.postPromise("Scripts","BuildSyncMap",null,e),f.then(function(b){var e=b.data,f=e.length>0;f&&(e.forEach(function(b){if(b.toDelete)delete a._loadedServices[b.target],a.localStorageService.remove("sw:customservice_"+b.target);else{var d=a._loadedServices[b.target];d||(a._loadedServices[b.target]={},d=a._loadedServices[b.target]),d.rowstamp=b.rowstamp,d.custom=a.$injector.has(b.target),c.info("updating script cache for (refresh requested)"+b.target),a.localStorageService.put(customServiceCodeKeyName(b.target),b.code,{compress:!0})}}),a.localStorageService.put("sw:customservicesentries",a._loadedServices),window.restartApplication?d.set("restartneeded",!0):window.location.reload(!0))})}},{key:"registerScript",value:function registerScript($provide,scriptName,serviceClassBody){var log=this.$log.get("dynamicScriptsCacheService#register",["dynscripts","angular","services"]),evaluatedClass=void 0;try{evaluatedClass=eval(serviceClassBody)}catch(err){evaluatedClass=null}if(!evaluatedClass)return log.warn("error evaluating class for script "+scriptName),null;var scriptInjections=angular.injector.$$annotate(evaluatedClass);return scriptInjections&&(evaluatedClass.$inject=scriptInjections),log.info("registering script "+scriptName),$provide.service(scriptName,evaluatedClass)}},{key:"initEntriesFromLocalStorage",value:function(){var a=this.localStorageService.get("sw:customservicesentries")||{};this._loadedServices=a}},{key:"clearEntries",value:function(){var a=this;this.localStorageService.remove("sw:customservicesentries");var b=this._loadedServices.length>0;Object.keys(this._loadedServices).forEach(function(b){var c=customServiceCodeKeyName(b);a.localStorageService.remove(c)}),this._loadedServices={},b&&(window.restartApplication&&window.restartApplication(),window.location.reload(!0))}}]),dynamicScriptsCacheService}();dynamicScriptsCacheService.$inject=["$rootScope","$q","$log","localStorageService","$injector","contextService"],angular.module("sw_rootcommons").service("dynamicScriptsCacheService",dynamicScriptsCacheService)}(angular),function(angular){function a(a,b,c,d,e){function f(){delete localStorage[url("")+":schemaCache"],o={},o.systeminitMillis=localStorage.getItem(r)}function g(a,b){var c=d.getUserData().login;return q+c+":"+a+"."+b}function h(){return p||(p=c.get("restService")),p}function i(){if("true"===sessionStorage.ignoreSchemaCache)return";";var b=";"+Object.keys(o).join(";")+";";return a.get("schemaCacheService#getSchemaCacheKeys").debug("schema keys in cache {0}".format(b)),b}function j(b){if(b.cachedSchemaId){var c=a.get("schemaCacheService#getSchemaFromResult",["performance"]);c.info("schema {0}.{1} retrieved from cache".format(b.applicationName,b.cachedSchemaId));var d=k(b.applicationName,b.cachedSchemaId);return c.info("finish retrieving from cache".format(b.applicationName,b.cachedSchemaId)),d}return b.schema}function k(a,b){var c=a+"."+b,d=o[c];if(!d){var f=g(a,b);d=e.get(f),d&&(o[c]=d)}return d}function l(b){if(b&&!b.ignoreCache){var c=a.get("schemaCacheService#addSchemaToCache",["performance"]),f=b.applicationName+"."+b.schemaId;if(!o[f]){c.info("adding schema {0} retrieved to cache".format(f));var h=d.getFromContext("systeminittime");this.wipeSchemaCacheIfNeeded(),o[f]=b,o.systeminitMillis=h;var i=g(b.applicationName,b.schemaId);try{localStorage.setItem(r,h),e.put(i,b,{compress:!0}),c.info("finishing adding schema {0} retrieved to cache".format(f))}catch(j){c.warn("localStorage is full... avoiding cache")}}}}function m(b){var c=d.getFromContext("systeminittime");(b||o&&o.systeminitMillis!==c)&&(a.get("schemaCacheService#wipeSchemaCacheIfNeeded").info("wiping out schema cache"),delete localStorage[url("")+":schemaCache"],Object.keys(localStorage).filter(function(a){return a.startsWith(q)}).forEach(function(a){delete localStorage[a]}),o={systeminitMillis:c})}function n(a,c){var d=this,e=k(a,c);if(e)return b.when(e);var f={applicationName:a,targetSchemaId:c},g=h().getPromise("Metadata","GetSchemaDefinition",f);return g.then(function(a){return d.addSchemaToCache(a.data),a.data})}var o={},p=null,q=url("")+":schemaCache:",r=q+"systeminitMillis";f();var s={getSchemaCacheKeys:i,addSchemaToCache:l,getCachedSchema:k,getSchemaFromResult:j,wipeSchemaCacheIfNeeded:m,fetchSchema:n};return s}angular.module("webcommons_services").service("schemaCacheService",["$log","$q","$injector","contextService","localStorageService",a])}(angular),function(angular){var a=function(){var a=function(a){var b={};return angular.forEach(a,function(a,c){c.indexOf("_")===-1&&(b[c]=a)}),b},b={sanitizeDataMapToSendOnAssociationFetching:a};return b};angular.module("webcommons_services").service("datamapSanitizeService",a)}(angular),function(angular){function a(a,b,c,d){function e(b,c,d){var e=b.commandSchema.hasDeclaration,f=d;if(null==f)return null;var g="#"+c,h=e?b.applicationName+"_"+b.schemaId+"_"+b.mode.toLowerCase()+".#"+c:g,i=f[h];null==i&&(e&&"none"!==b.mode.toLocaleLowerCase()&&(h=b.applicationName+"_"+b.schemaId+"_none.#"+c,i=f[h]),null==i&&(i=f[g],null==i&&a.get("commandCommonsService#getCommands",["commands","metadata"]).warn("command bar "+h+", and fallback "+g+" not found")));var j=null!=i?i.commands:null;return j}function f(a,c){if(null==a)return b.reject();if(a.jscache=a.jscache||{},a.jscache.commandbars=a.jscache.commandbars||{},void 0!==a.jscache.commandbars[c])return a.jscache.commandbars[c];var e=d.fetchFromContext("commandbars",!0),f=this.getCommands(a,c,e);return a.jscache.commandbars[c]=f,f}function g(a,b,d,e){if(d.remove)return!0;var f=d.showExpression;return void 0!=f&&""!==f&&!c.evaluate(f,a,{schema:b},null)}var h={getCommands:e,getBarCommands:f,isCommandHidden:g};return h}angular.module("webcommons_services").service("commandCommonsService",["$log","$q","expressionService","contextService",a])}(angular),function(angular){function a(){function a(a,b){return h.htmlLinkPattern.format(a,b||"")}function b(a,b){angular.forEach(a,function(a){h.processors.push({regex:a,processor:b})})}function c(a){if(!a)return a;var b=angular.copy(a);return angular.forEach(h.processors,function(a){var c=a.regex,d=a.processor,e=b.match(c);!e||e.length<=0||angular.forEach(e,function(a){b=d(b,a)})}),b}function d(a){return c(a)}function e(a){return a=replaceAll(a,"\n",String.fromCharCode(10,13))}function f(a){var b=e(a);return d(b)}function g(){b([h.regex.nestedemailtags],function(b,c){var d=c.substring(1,c.lastIndexOf("<")),e=a(d,"mailto:");return b.replace(c,e)}),b([h.regex.emailtags],function(b,c){var d=c.indexOf("<mailto:")>=0,e=d?c.indexOf(":")+1:1,f=c.substring(e,c.length-1),g=a(f,"mailto:");return b.replace(c,g)}),b([h.regex.urltags,h.regex.fileurltags],function(b,c){var d=c.substring(1,c.length-1),e=a(d);return b.replace(c,e)}),b([h.regex.iftags],function(a,b){var c=b.indexOf("]>")+2,d=b.lastIndexOf("<![endif]>"),e=b.substring(c,d);return a.replace(b,e)})}var h={processors:[],regex:{nestedemailtags:/\<((([^<>()[\]\.,;:\s@\"]+(\.[^<>()[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,}))+(\<(mailto\:)?((([^<>()[\]\.,;:\s@\"]+(\.[^<>()[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,}))+\>)\>/g,emailtags:/\<(mailto\:)?((([^<>()[\]\.,;:\s@\"]+(\.[^<>()[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,}))+\>/g,urltags:/\<(((https?|ftp):\/\/)([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)\/?(\?([\w-]+(=[\w-]*)?(&[\w-]+(=[\w-]*)?)*)?)?)+\>/g,fileurltags:/\<(file:\/\/(\/\\\\)?([\da-zA-Z\.-]+)([(\/|\\)\w \.-]*)\/?(\?([\w-]+(=[\w-]*)?(&[\w-]+(=[\w-]*)?)*)?)?)+\>/g,iftags:/\<\!\[if\s\!?([^\<\>\[\]])+\]\>([^\<\>\[\]])+\<\!\[(endif)\]\>/g},htmlLinkPattern:"<a href='{1}{0}'>{0}</a>"},i={getDecodedValue:f,replaceInvalidTags:d,getDisplayableValue:e};return g(),i}angular.module("webcommons_services").service("richTextService",[a])}(angular),function(angular){angular.module("webcommons_services").directive("floatConverter",[function(){var a={restrict:"A",transclude:!1,replace:!1,require:"ngModel",link:function(a,b,c,d){d.$parsers.push(function(a){var b=parseFloat(a);return!angular.isNumber(b)||isNaN(b)?0:b}),d.$formatters.push(function(a){return"number"===b[0].type?a:String(a)})}};return a}])}(angular);var LogHelp=function a(b){_classCallCheck(this,a),this.description=b},LogHelper=function(){function a(){_classCallCheck(this,a)}return _createClass(a,[{key:"help",value:function(){var a={association:new LogHelp("logs association information"),composition:new LogHelp("logs composition information"),detail:new LogHelp("crud detail related information"),filter:new LogHelp("filter related logs"),grid:new LogHelp("crud grid related information"),init:new LogHelp("logs information about the initialization of the directives/controllers"),
layout:new LogHelp("logs information related to the layout of the screen"),modal:new LogHelp("modal related logs"),route:new LogHelp("information about navigation of pages"),save:new LogHelp("log for saving entries"),search:new LogHelp("logs information about the search process")};console.log("**************************************************************************************aspects****************************************************************************************************************"),console.table(a);var b={debug:new LogHelp("set a log, or an array of logs to debug level."),display:new LogHelp("Displays all current log levels"),info:new LogHelp("set a log, or an array of logs to info level."),reset:new LogHelp("resets specified logs (or all if none specified) to warn level")};console.log("**************************************************************************************functions****************************************************************************************************************"),console.table(b)}},{key:"level",value:function(a,b){return a?void(a instanceof Array?a.forEach(function(a){return sessionStorage["log_"+a]=b}):sessionStorage["log_"+a]=b):void(sessionStorage.loglevel=b)}},{key:"info",value:function(a){this.level(a,"info")}},{key:"debug",value:function(a){this.level(a,"debug")}},{key:"trace",value:function(a){this.level(a,"trace")}},{key:"display",value:function(){for(var a=sessionStorage.length,b={};a--;){var c=sessionStorage.key(a);c.startsWith("log_")&&(b[c]=new LogHelp(sessionStorage[c]))}console.table(b)}},{key:"reset",value:function(a){if(sessionStorage.loglevel="warn",a)a instanceof Array?a.forEach(function(a){return sessionStorage["log_"+a]="warn"}):sessionStorage["log_"+a]="warn";else for(var b=sessionStorage.length;b--;){var c=sessionStorage.key(b);c.startsWith("log_")&&(sessionStorage[c]="warn")}}}]),a}();window.swlog=new LogHelper,function(angular,a){function b(a,b){return!b||("none"===b||!b.equalsIc("trace")&&(b.equalsIc("debug")?a.equalsAny("trace"):b.equalsIc("info")?a.equalsAny("trace","debug"):b.equalsIc("warn")?a.equalsAny("trace","debug","info"):!b.equalsIc("error")||a.equalsAny("trace","debug","info","warn")))}function c(a,c){var d=sessionStorage["log_"+a];if(d)return d;var e="none";c&&angular.forEach(c,function(a){var c=sessionStorage["log_"+a];c&&b(c,e)&&(e=c)});var f=a.indexOf("#");if(f>=0){var g=a.substr(0,f),h=sessionStorage["log_"+g];if(h)return h}return e}function d(a,b){return b?"trace"===b?b:"debug"===b?"trace"===a?a:b:"info"===b?a.equalsAny("trace","debug")?a:b:"warn"===b?a.equalsAny("trace","debug","info")?a:b:a:a}function e(a,e){function f(a,b,c,d){return function(){var e=h(b,c,d);if(!e)return[];var f=[].slice.call(arguments),g=["["+b.toUpperCase()+"] "+window.moment().format("DD/MM/YYYY hh:mm:ss:SSS a")+"::["+c+"]> "],i=g.concat(f);return a.apply(null,i),i}}function g(){var a=sessionStorage.loglevel;return a?a:i.retrieveFromContext("defaultlevel")||"warn"}function h(a,e,f){var h=g(),i=c(e,f);return h=d(h,i),!b(a,h)}a.enabledContexts=[],window.rootlogger=a;var i;a.getInstance=function(b,c){return i||(i=e.get("contextService")),{log:f(a.log,"log",b,c,i),info:f(a.info,"info",b,c,i),warn:f(a.warn,"warn",b,c,i),debug:f(a.debug,"debug",b,c,i),trace:f(a.debug,"trace",b,c,i),error:f(a.error,"error",b,c,i),enableLogging:function(c){a.enabledContexts[b]=c},isLevelEnabled:function(a){return h(a,b,c)},get globalLogLevel(){return g()}}},a.get=function(a,b){return this.getInstance(a,b)}}a.rootCommons.config(["$provide",function(a){a.decorator("$log",["$delegate","$injector",function(a,b){return e(a,b),a}])}])}(angular,modules),function(angular,a){a.webcommons.config(["$provide",function(a){a.decorator("$rootScope",["$delegate","$log",function(a,b){var c=a.$emit,d=a.$broadcast,e=a.$on;return a.constructor.prototype.$onRootScope=function(b,c){var d=a.$on(b,c);return this.$on("$destroy",d),a},a.$emit=function(){var a=b.get("rootscope#emit");if(!arguments[0])throw new Error("event broadcasted with null value. Check JAvascriptEventConstants");return a.info(arguments[0]),a.debug.apply(a,arguments),c.apply(this,arguments)},a.$broadcast=function(){var a=b.get("rootscope#broadcast");if(!arguments[0])throw new Error("event broadcasted with null value. Check JAvascriptEventConstants");return a.info(arguments[0]),a.debug.apply(a,arguments),d.apply(this,arguments)},a.$on=function(){var a=b.get("rootscope#on");return a.info(arguments[0]),a.debug.apply(a,arguments),e.apply(this,arguments)},a}])}])}(angular,modules),function(angular){angular.module("webcommons_services").config(["$provide",function(a){a.decorator("dynamicScriptsCacheService",["$delegate","$injector",function(b,c){var d=b.registerScript;b.useCustomServiceIfPresent;return b.registerScript=function(){var b=[a].concat(Array.prototype.slice.call(arguments));return d.apply(this,b)},b}])}])}(angular),function(angular,a){function b(a,b,c,d){var e=a.invoke;a.getInstance=function(c,e){var f=b.client(),g=f+"."+c,h=d.get("clientawareserviceprovider",["services"]);if(a.has(g)){h.debug("Client specific service",g,"found.");var i=a.get(g);if(a.has(c)){h.debug(c,"base implementation found. Applying base property bindings to",g);var j=a.get(c);angular.forEach(j,function(a,b){if(j.hasOwnProperty(b)&&!i.hasOwnProperty(b)){var c=angular.isFunction(a)?a.bind(j):a;i[b]=c}}),i.__super__=j}return i}return f&&"otb"!==f&&h.debug("Client specific service",g,"not found. Attempting to instantiate base service",c),e?a.get(c):a.has(c)?a.get(c):null},a.invoke=function(a,b,f,g){var h=c.useCustomServiceIfPresent(g);return null!=h?(d.get("clientawareserviceprovider",["angular","services"]).debug("applying custom service for "+g),h):e(a,b,f,g)}}a.webcommons.run(["$injector","contextService","dynamicScriptsCacheService","$log",b])}(angular,modules),function(angular){function a(){function a(a,b,c){return"ISSUE"===c.issuetype?"viewinvissuedetail":"viewinvreturndetail"}function b(a,b,c){if("ISSUE"!==c.issuetype)return"viewinvreturndetail";var d=0;return angular.isString(["qtyreturned"])?d=parseInt(c.qtyreturned):null!=c.qtyreturned&&(d=c.qtyreturned),d+c.quantity>=0?"viewinvissuedetail":d+c.quantity!==-1?"invreturn"===a?"editinvreturndetail":"editinvissuedetail":null}var c={nextInvIssueDetailSchema:b,nextReadOnlyInvIssueDetailSchema:a};return c}angular.module("webcommons_services").service("inventorySharedService",[a])}(angular),document.addEventListener("deviceready",function(){angular.bootstrap(document.body,["softwrench"])},!1);var mobileServices=angular.module("sw_mobile_services",["sw_rootcommons","webcommons_services","maximo_applications","persistence.offline","audit.offline","rollingLog"]),offlineMaximoApplications=angular.module("maximo_offlineapplications",["persistence.offline","audit.offline"]),softwrench=angular.module("softwrench",["ionic","ion-autocomplete","ngCordova","sw_mobile_services","webcommons_services","sw_rootcommons","maximo_applications","maximo_offlineapplications","sw_scan","ng-mfb","ui.tinymce","ngTouch"]).run(["$ionicPlatform","swdbDAO","$log","securityService","localStorageService","menuModelService","metadataModelService","routeService","crudContextService","synchronizationNotificationService","offlinePersitenceBootstrap","offlineEntities","configurationService","$rootScope","$q","$cordovaSplashscreen","$timeout","offlineCommandService","$ionicScrollDelegate","trackingService","initialRouterService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){function v(){var a=window.localdevdata;if(a&&a.debuglogs){var b=a.debuglogs;b.forEach(function(a){swlog.debug(a)})}return C=window.location.href,t.enable(),k.init().then(function(){var a=f.initAndCacheFromDB(),b=g.initAndCacheFromDB(),c=r.initAndCacheFromDataBase(),e=m.loadConfigs(),h=m.loadClientConfigs(),i=d.restoreAuthCookie();return o.all([a,b,e,c,h,i]).then(function(){return f.updateAppsCount()})})}function w(){var a=parent.document.getElementById("exec-dialog");if(a){var b=parent.document.querySelector(".ui-widget-overlay"),c=angular.element(a.parentElement),d=angular.element(b),e={height:"0px",width:"0px",display:"none"};c.css(e),d.css(e)}}function x(){var a=c.get("bootstrap#initCordovaPlugins");a.info("init cordova plugins"),isRippleEmulator()&&q(w),window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.hideKeyboardAccessoryBar(ionic.Platform.isAndroid()),ionic.Platform.isAndroid()&&window.StatusBar&&window.StatusBar.styleDefault(),j.prepareNotificationFeature()}function y(){window.adjustAndroidSoftInput=y,ionic.Platform.isAndroid()&&(window.addEventListener("native.showkeyboard",function(a){q(function(){var a=document.activeElement;if(a){var b=window.innerHeight,c=a.getBoundingClientRect(),d=c.bottom;if(b<d){var e=d-b;s.scrollBy(0,e,!0)}}},0,!1)}),window.addEventListener("native.hidekeyboard",function(a){var b=document.activeElement;b&&b.blur(),q(function(){return s.resize()},0,!1)}))}function z(){n.$on("$stateChangeStart",function(a,b,c,e,f){b.name.indexOf("login")<0&&"settings"!==b.name||d.hasAuthenticatedUser()&&a.preventDefault()}),n.$on("$stateChangeSuccess",function(a,b,c,d,f){if(!(b.name.indexOf("login")<0||d.name.indexOf("settings")>=0)){var g=e.get("settings:serverurl");g||(a.preventDefault(),h.go("settings"))}}),document.addEventListener("resume",v,!1)}function A(){u.doInit()}function B(){return q(function(){if(p&&angular.isFunction(p.hide))try{p.hide()}catch(a){}},1e3)}var C=null;window.restartApplication=function(){window.location=C},a.ready(function(){v().then(function(){return y(),z(),x(),A()}).then(B)})}]).config(["$stateProvider","$urlRouterProvider","$logProvider","$ionicConfigProvider","$httpProvider",function(a,b,c,d,e){d.navBar.alignTitle("center"),e.useApplyAsync(!0),d.views.transition("none"),c.debugEnabled(!0),a.state("login",{url:"/login",templateUrl:getResourcePath("Content/Mobile/templates/login.html"),controller:"LoginController",params:{message:null}}).state("settings",{url:"/settings",templateUrl:getResourcePath("Content/Mobile/templates/settings_nomenu.html"),controller:"SettingsController"}).state("main",{url:"/main",templateUrl:getResourcePath("Content/Mobile/templates/main.html"),controller:"MainController"}).state("main.home",{url:"/home",cache:!1,views:{main:{templateUrl:getResourcePath("Content/Mobile/templates/syncoperation_detail.html"),controller:"SyncOperationDetailController"}}}).state("main.syncoperationhistory",{url:"/syncoperationhistory",views:{main:{templateUrl:getResourcePath("Content/Mobile/templates/syncoperation_list.html"),controller:"SyncOperationHistoryController"}}}).state("main.syncoperationdetail",{url:"/syncoperationdetail/{id}",views:{main:{templateUrl:getResourcePath("Content/Mobile/templates/syncoperation_detail.html"),controller:"SyncOperationDetailController"}}}).state("main.settings",{url:"/settings",views:{main:{templateUrl:getResourcePath("Content/Mobile/templates/settings.html"),controller:"SettingsController"}}}).state("main.support",{url:"/support",views:{main:{templateUrl:getResourcePath("Content/Mobile/templates/support.html"),controller:"SupportController"}}}).state("main.crudlist",{url:"/crudlist",cache:!1,views:{main:{templateUrl:getResourcePath("Content/Mobile/templates/crudlist.html"),controller:"CrudListController"}}}).state("main.crudlist.search",{url:"/crudlistsearch",views:{"main@main":{templateUrl:getResourcePath("Content/Mobile/templates/crudlistsearch.html"),controller:"CrudListSearchController"}}}).state("main.cruddetail",{url:"/cruddetail",views:{main:{templateUrl:getResourcePath("Content/Mobile/templates/crud_detail.html"),controller:"CrudDetailController"}}}).state("main.cruddetail.maininput",{url:"/crudinput",views:{body:{templateUrl:getResourcePath("Content/Mobile/templates/crud_input.html"),controller:"CrudInputController"}}}).state("main.cruddetail.compositionlist",{url:"/crudcompositionlist",cache:!1,views:{body:{templateUrl:getResourcePath("Content/Mobile/templates/crud_composition_list.html"),controller:"CrudCompositionListController"}}}).state("main.cruddetail.compositiondetail",{url:"/crudcompositionoutputdetail",views:{body:{templateUrl:getResourcePath("Content/Mobile/templates/crud_composition_detail.html"),controller:"CrudCompositionDetailController"}}}).state("main.cruddetail.tab",{url:"/tab",views:{body:{templateUrl:getResourcePath("Content/Mobile/templates/crud_tab.html"),controller:"CrudTabController"}}}).state("main.cruddetail.locationdrilldown",{url:"/locationdrilldown",cache:!1,views:{body:{templateUrl:getResourcePath("Content/Customers/firstsolar_offline/templates/fslocationdrilldown.html"),controller:"FsLocationDrillDownController"}}}).state("main.audit",{"abstract":!0,url:"/audit"}).state("main.audit.applicationselect",{url:"/application",views:{"main@main":{templateUrl:getResourcePath("Content/Mobile/templates/audit/audit.application.select.html"),controller:"AuditApplicationSelectController"}}}).state("main.audit.applicationselect.entrylist",{url:"/list/{application}",views:{"main@main":{templateUrl:getResourcePath("Content/Mobile/templates/audit/audit.entry.list.html"),controller:"AuditEntryListController"}}}).state("main.audit.applicationselect.entrylist.entrydetail",{url:"/entry/{id}",views:{"main@main":{templateUrl:getResourcePath("Content/Mobile/templates/audit/audit.entry.detail.html"),controller:"AuditEntryDetailController"}}})}]);!function(a){a.constants=a.constants||{},a.constants.localIdKey="#localswdbid",a.constants.isDirty="#localisDirty",a.constants.isPending="#localisPending",a.constants.newItem="_newitem#$"}(window),window.lastreleasebuildtime="1511953745639",function(angular,a){a.config(["$httpProvider",function(a){function b(a,b,c,d,e,f,g){function h(a){var b=a.config.timeout,c=a.config.request_start_timestamp,d=(new Date).getTime();return angular.isNumber(b)&&angular.isNumber(c)&&d-c>b}var i=null,j=function(a){a.headers.offlineMode=!0,a.headers.request_start_timestamp=(new Date).getTime();var b=e.getInstance("sw4.ajaxint#started");b.debug("url: "+a.url)},k=function(a){var b=e.getInstance("sw4.ajaxint#endedok");b.debug("status: "+a.status+", url: "+a.config.url)},l=function(a){var b=a.status;if(0===b||b===-1){if(f.isOffline())return new Error("No internet connection detected.");var c=h(a),d=(c?"Request timed out":"Server unreachable")+". Please make sure the url in settings is correct and check your internet connection.",e=new Error(d);return a.config.url.contains("SignIn/Ping")?a:(e.type=c?"timeout":"unreacheable",e)}if(b>=500&&b<600){var j=a.data?a.data.fullStack:"",k=new Error("Internal server error. Please contact support.");return j&&(k.stack=j),k}return 404===b?new Error("Requested resource not found. Please contact support."):(401===b&&(i||(i=g.get("securityService")),i.handleUnauthorizedRemoteAccess(a)),a)},m={request:function(b){return j(b),b||a.when(b)},response:function(b){return k(b),b||a.when(b)},responseError:function(b){var c=l(b);return a.reject(c||b)}};return m}a.defaults.withCredentials=!0,a.defaults.headers.common.offlineMode=!0,a.interceptors.push(["$q","$rootScope","$timeout","contextService","$log","networkConnectionService","$injector",b])}])}(angular,mobileServices),function(a,angular,_){window.shouldRotateToOrientation=function(a){return!0},window.isRippleEmulator=function(){return document.URL.indexOf("http://")>=0||document.URL.indexOf("https://")>=0},window.$s=function(a){var b=angular.element(a);return angular.isFunction(b.scope)?b.scope():null},window.Validate=Object.freeze(function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"notNull",value:function(a,b){if(void 0===a||null===a)throw new Error((b||"value")+" cannot be null")}},{key:"notEmpty",value:function(a,b){if(Validate.notNull(a,b),_.isString(a)&&!a)throw new Error("String "+(b||"value")+" cannot be empty");if(_.isArray(a)&&a.length<=0)throw new Error("Array "+(b||"value")+" cannot be empty");if(_.isObject(a)&&_.isEmpty(a))throw new Error("Object "+(b||"value")+" cannot be empty")}}]),a}()),window.getService=function(a){return angular.element(document.body).injector().get(a)},window.offlineFullClear=function(){var a=angular.element(document.body).injector().get("swdbDAO");a.dropDataBase().then(function(){console.log("database dropped"),localStorage.clear(),console.log("localStorage cleared"),sessionStorage.clear(),console.log("sessionStorage cleared","reloading application"),location.reload()})["catch"](function(a){return console.error("Failed to drop database",a)})},window.getResourcePath=function(a){return window.lastreleasebuildtime?a+"?"+window.lastreleasebuildtime:a}}(jQuery,angular,_);var ConfigurationKeys=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"FacilitiesChanged",get:function(){return"facilitieschanged"}}]),a}();!function(angular){angular.module("sw_mobile_services").constant("associationConstants",{Option:function(){function a(b,c,d,e,f){_classCallCheck(this,a),this.value=b,this.label=c||this.value,this.text=d||this.label,this.extrafields=e,this.checked=Boolean(f)}return _createClass(a,[{key:"setChecked",value:function(a){return this.checked=Boolean(a),this}}]),a}()})}(angular),function(a){a.constant("crudConstants",{operation:{create:"crud_create",update:"crud_update"}})}(mobileServices),function(a,ionic){function b(){var a=void 0;return ionic.Platform.isAndroid()?a="externalDataDirectory":ionic.Platform.isIOS()?a="dataDirectory":ionic.Platform.isWindowsPhone()&&(a="dataDirectory"),a}var c=function(){function a(b){if(_classCallCheck(this,a),!b||!angular.isString(b))throw new Error("Path is empty or is not a string");this.filePath=b;var c=b.lastIndexOf("/")+1;this.fileName=b.substr(c),this.dirPath=b.substr(0,c)}return _createClass(a,[{key:"toString",value:function(){return"{filePath: "+this.filePath+", fileName: "+this.fileName+", dirPath: "+this.dirPath+"}"}}]),a}(),d=function(){function a(b){if(_classCallCheck(this,a),!b||!angular.isString(b))throw new Error("Data is empty or is not a string");this.value=b,this.length=b.length,this.size=b.byteSize()}return _createClass(a,[{key:"toString",value:function(){return"{length: "+this.length+", size: "+this.size+"B}"}}]),a}(),e=function(){function a(b){_classCallCheck(this,a),this.data=new d(b);var c=window.LZString.compressToUTF16(b);this.compressed=new d(c)}return _createClass(a,[{key:"toString",value:function(){return"{raw: "+this.data.toString()+", compressed: "+this.compressed.toString()+"}"}}]),a}();a.constant("fileConstants",{fileEnabled:!isRippleEmulator(),appDirectory:b(),FilePathWrapper:c,FileContentWrapper:e})}(mobileServices,ionic),function(a){a.constant("rollingLogFileConstants",{logFileSize:10485760,eventBuffer:20,writeOnPause:!1,logToConsole:!1,debug:!0,logFileName:"SWOFF"})}(mobileServices),function(a){a.controller("AuditApplicationSelectController",["$scope","offlineAuditService","securityService","routeService",function(a,b,c,d){a.data={applications:[]};var e=function(){b.listAudittedApplications().then(function(b){a.data.applications=b})};a.selectApplication=function(a){d.go(".entrylist",{application:a})},e()}])}(softwrench),function(a){a.controller("AuditEntryDetailController",["$scope","offlineAuditService","formatService","$stateParams","$ionicHistory",function(a,b,c,d,e){a.data={entry:{},entity:{}},a.back=function(){e.goBack()};var f=function(a){return a.formattedDate=c.formatDate(a.createDate,"MM/dd/yyyy HH:mm"),a},g=function(c){b.getAuditEntry(c).then(function(c){return a.data.entry=f(c),b.getTrackedEntity(c)}).then(function(b){a.data.entity=b})};g(d.id)}])}(softwrench),function(a){a.controller("AuditEntryListController",["$scope","offlineAuditService","formatService","$stateParams","routeService","$ionicHistory",function(a,b,c,d,e,f){var g=d.application;a.data={entryList:[]},a.paginationData={currentPage:1,pageSize:10,hasMoreAvailable:!0},a.openDetail=function(a){e.go(".entrydetail",{id:a.id})},a.back=function(){f.goBack()};var h=function(a){return a.map(function(a){return a.formattedDate=c.formatDate(a.createDate,"MM/dd/yyyy HH:mm"),a})};a.loadPagedList=function(){var c={pagenumber:a.paginationData.currentPage,pagesize:a.paginationData.pageSize};b.listEntries(g,c).then(function(b){a.paginationData.hasMoreAvailable=b&&b.length>=a.paginationData.pageSize,a.paginationData.currentPage+=1,a.data.entryList=a.data.entryList.concat(h(b))})["finally"](function(){a.$broadcast("scroll.infiniteScrollComplete")})}}])}(softwrench),function(a){a.controller("CompositionMenuController",["$log","$scope","$ionicScrollDelegate","crudContextService",function(a,b,c,d){b.compositionMenus=function(){return d.currentCompositionsToShow()},b.getTabIcon=function(a){return"ApplicationTabDefinition"===a.type?a.icon:a.schema.schemas.list.properties["icon.composition.tab"]},b.loadTab=function(a){d.loadTab(a).then(function(){b.$emit("sw_compositionselected")}),c.scrollTop()},b.notOnMainTab=function(){return!d.isOnMainTab()}}])}(softwrench),function(a){a.controller("CrudCompositionDetailController",["$log","$scope","$rootScope","crudContextService","fieldService","offlineCompositionService","offlineAssociationService","schemaService","eventService",function(a,b,c,d,e,f,g,h,i){function j(){b.schema=d.getCompositionDetailSchema(),b.displayables=h.allDisplayables(b.schema),b.datamap=d.getCompositionDetailItem(),b.allowsUpdate=f.allowsUpdate(d.getCompositionDetailItem(),d.getCompositionListSchema()),i.onload(b,b.schema,b.datamap,{})}b.$on("$stateChangeSuccess",function(a,b,c,d,e){b.name.startsWith("main.cruddetail.compositiondetail")&&j()}),j()}])}(softwrench),function(a,_){a.controller("CrudCompositionListController",["$log","$scope","$rootScope","$ionicPopup","crudContextService","fieldService","formatService","crudContextHolderService","offlineAttachmentService","$injector",function(a,b,c,d,e,f,g,h,i,j){function k(a,b){if(!a||!j.has(a.service))return b();var c=j.getInstance(a.service);if(!angular.isFunction(c[a.method]))return b();for(var d=arguments.length,e=Array(d>2?d-2:0),f=2;f<d;f++)e[f-2]=arguments[f];return c[a.method].apply(c,e.concat([b]))}b.empty=function(){var a=e.compositionList();return!a||0===a.length},b.list=function(){return e.compositionList()},b.fieldValue=function(a,b){return g.format(a[b.attribute],b,a)},b.visibleFields=function(a){var b=e.getCompositionListSchema();return f.getVisibleDisplayables(a,b)},b.loadCompositionDetail=function(a){e.loadCompositionDetail(a)};var l=function(a,b,c){var d=b[c];if(d){var e=_.findIndex(d,function(b){return b["#localswdbid"]===a});e>=0&&d.splice(e,1)}};b.startDeleteLocalComposition=function(a){var c=a["#localswdbid"];if(c){var f=h.getCompositionDetailSchema(),g=f.title||f.applicationTitle,j=h.getCompositionListSchema(),m=h.getCrudContext(),n=m.composition.currentTab,o=n.schema,p=o.events.beforedelete||j.events.beforedelete,q=o.events.afterdelete||j.events.afterdelete,r=function(){return d.confirm({title:"Delete "+g,template:"Are you sure to delete this local "+g+"?"})},s=k(p,r,a);return s.then(function(d){if(d){var g=n.relationship,j=h.currentDetailItemDataMap();l(c,j,g);var o=m.originalDetailItemDatamap;l(c,o,g);var p=b.list(),r=p.indexOf(a);p.splice(r,1);var s=e.saveCurrentItem(!1),t="attachment"===f.applicationName?s.then(function(b){return i.deleteRelatedAttachment(a).then(function(){return b})}):s;return t.then(function(b){return k(q,function(){return b},a,b)})}})}},b.isDirty=function(a){return a[constants.localIdKey]}}])}(softwrench,_),function(a){a.controller("CrudDetailController",["$log","$q","$scope","$rootScope","$timeout","$state","schemaService","crudContextHolderService","wizardService","$ionicPlatform","drillDownService","offlineCompositionService","inlineCompositionService","crudContextService","fieldService","$ionicPopover","$ionicPopup","$ionicHistory","$ionicScrollDelegate","eventService","expressionService","offlineSchemaService","commandBarDelegate","swAlertPopup","loadingService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){function z(){d.areChangeEventsEnabled=!1}function A(){e(function(){return d.areChangeEventsEnabled=!0},0,!1)}function B(){a.get("crud_detail#init").debug("crud detail init"),c.allDisplayables=n.mainDisplayables(),c.displayables=i.getWizardFields(c.allDisplayables),c.schema=n.currentDetailSchema(),c.allDisplayablesIncludingTabs=g.allFieldsIncludingTabs(c.schema),c.datamap=n.currentDetailItemDataMap(),c.item=h.currentDetailItem(),e(function(){var a=$('command-bar[position="mobile.fab"]');w.positionFabCommandBar(a)},0,!1),c.inlineCompositionsLoaded?d.areChangeEventsEnabled=!0:m.loadInlineCompositions(c.item,c.datamap,c.allDisplayables).then(function(){c.inlineCompositionsLoaded=!0})}function C(a){x.alertValidationErrors(a)}c.inlineCompositionsLoaded=!1,p.fromTemplateUrl(getResourcePath("Content/Mobile/templates/griditemoptionsmenu.html"),{scope:c}).then(function(a){return c.optionspopover=a}),p.fromTemplateUrl(getResourcePath("Content/Mobile/templates/compositionmenu.html"),{scope:c}).then(function(a){return c.compositionpopover=a}),c.expandCompositions=function(a){c.compositionpopover.show(a)},c.compositionListSchema=null,c.$on("sw_compositionselected",function(){c.compositionpopover.hide(),c.compositionListSchema=c.isOnMainTab()?null:n.getCompositionListSchema()}),c.$watch(function(){return c.isOnMainTab()},function(a,b){b!==a&&(c.compositionListSchema=a?null:n.getCompositionListSchema())}),c.loadMainTab=function(){s.scrollTop(),n.loadTab(null)},c.tabTitle=function(){return n.tabTitle()},c.showNavigation=function(){return!n.hasDirtyChanges()},c.hasNextItem=function(){return!!h.getCrudContext().nextItem},c.hasPreviousItem=function(){return!!h.getCrudContext().previousItem},c.hasAnyComposition=function(){return n.currentCompositionsToShow().length>0},c.cancelChanges=function(){q.confirm({title:"Confirm Cancel",template:"Any changes made will be lost. Proceed?"}).then(function(a){a&&(z(),n.cancelChanges(),c.datamap=n.currentDetailItemDataMap(),e(function(){return d.areChangeEventsEnabled=!0},0,!1),A(),m.cancelChanges())})},c.saveChanges=function(){n.saveChanges().then(function(){c.inlineCompositionsLoaded=!1,B()})["catch"](function(a){if(a&&a.length>0)C(a);else if(a)throw a})},c.hasDirtyChanges=function(){return n.hasDirtyChanges()},c.shouldShowBack=function(){return!c.hasDirtyChanges()&&r.viewHistory().backView},c.navigateBack=function(){y.showDefault(),e(function(){return r.goBack()},0,!1)},c.isOnMainTab=function(){return n.isOnMainTab()},c.isOnDrillDown=function(){return k.isOnDrillDown()},c.drillDownBack=function(){k.drillDownBack()||c.navigateBack()},c.isDrillDownAssetView=function(){return k.getDrillDown().assetView},c.drillDownAssetView=function(){return k.assetView()},c.detailSubTitle=function(){return n.isCreation()?null:v.buildDisplayValue(n.currentListSchema(),"subtitle",c.datamap)},c.detailFeatured=function(a){return n.isCreation()?null:v.buildDisplayValue(n.currentListSchema(),"featured",c.datamap)},c.detailTitle=function(){var a=n.isCreation()?null:c.datamap;return g.getTitle(n.currentDetailSchema(),a,!0)},c.detailSummary=function(){var a=n.isCreation()?null:c.datamap;return g.getSummary(n.currentDetailSchema(),a,!0)};var D=function(a){z(),n[a]().then(function(){c.datamap=n.currentDetailItemDataMap(),c.item=h.currentDetailItem()})["finally"](function(){A()})};c.navigateNext=function(){D("navigateNext")},c.navigatePrevious=function(){D("navigatePrevious")},c.onSwipeLeft=function(){c.showNavigation()&&!c.isOnDrillDown()&&c.navigateNext()},c.onSwipeRight=function(){c.showNavigation()&&!c.isOnDrillDown()&&c.navigatePrevious()},c.onScroll=function(){var a=s.$getByHandle("detailHandler").getScrollPosition();if(a){var b=$('command-bar[position="mobile.fab"]');w.positionFabCommandBar(b,a.top)}},c.shouldShowWizardBack=function(){return i.canReturn()},c.shouldShowWizardForward=function(){return i.isInWizardState(c.allDisplayables)},c.wizardNavigateBack=function(){c.displayables=i.previous(c.allDisplayables)},c.wizardNavigateForward=function(){var a=n.validateDetail({},null,c.displayables);return 0!==a.length?void C(a):void(c.displayables=i.next(c.allDisplayables))},c.isDirty=function(a){return c.item.isDirty},c.isPending=function(a){return c.item.pending},c.hasProblems=function(){return c.item.hasProblem},c.lastProblemMesage=function(){var a=h.currentProblems();return a&&0!==a.length?a[0].message:null},c.drillStyle=function(){return"main.cruddetail.locationdrilldown"===f.$current.name?{height:"calc(100vh - 87px)"}:{}};var E=j.registerBackButtonAction(function(){c.shouldShowBack()?c.navigateBack():c.shouldShowWizardBack()?(c.wizardNavigateBack(),c.$apply()):c.cancelChanges()},100);c.$on("$destroy",E),c.$on("sw_cruddetailrefreshed",function(){c.datamap=n.currentDetailItemDataMap(),c.inlineCompositionsLoaded=!1,B()}),c.showDirtyOptions=function(a){var b=n.currentDetailItem();b.isDirty&&(h.getCrudContext().currentPopOverItem=b,c.optionspopover.show(a))},c.$on("sw_griditemoperationperformed",function(){c.optionspopover.hide(),h.getCrudContext().currentPopOverItem=null}),c.$on("$stateChangeSuccess",function(a,b,c,d,e){"main.cruddetail.compositiondetail"===d.name&&n.leavingCompositionDetail(),b.name.startsWith("main.cruddetail")&&"main.cruddetail.locationdrilldown"!==b.name&&(B(),y.hide(),"main.cruddetail.maininput"===b.name&&n.resetTab())}),B()}])}(softwrench),function(angular){angular.module("softwrench").controller("CrudInputController",["$log","$scope","crudContextService","fieldService","offlineAssociationService","$ionicPopover","expressionService",function(a,b,c,d,e,f,g){}])}(angular),function(a){a.controller("CrudListController",["$log","$scope","crudContextService","offlineSchemaService","$ionicScrollDelegate","$timeout","$ionicPopover","eventService","routeConstants","synchronizationFacade","routeService","crudContextHolderService","itemActionService","loadingService","$ionicSideMenuDelegate","laborService","crudSearchService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){function r(a){var b=[],c=[],d=[];return angular.forEach(a,function(a){p.hasItemActiveLabor(a)?b.push(a):a.isDirty?c.push(a):d.push(a)}),b.concat(c).concat(d)}function s(){b.crudlist.moreItemsAvailable=!0;var a=l.getCrudContext();a.itemlist=r(a.itemlist),b.crudlist.items=a.itemlist.map(function(a){return a})}function t(){s(),b._searching=!1,f(function(){return e.scrollTop()},0,!1);var a=c.currentListSchema(),d=c.itemlist();a&&h.onload(b,a,d,{schemaId:a.schemaId}),b.quickSearch=l.getQuickSearch(),"undefined"==typeof b.quickSearch.value&&(b.quickSearch.value=null)}var u=arguments;b.crudlist={items:[],moreItemsAvailable:!0},g.fromTemplateUrl(getResourcePath("Content/Mobile/templates/griditemoptionsmenu.html"),{scope:b}).then(function(a){return b.optionspopover=a}),t(),b.isSearching=function(){return b._searching},b.enableSearch=function(){b._searching=!0,e.scrollTop()},b.goToAdvancedFilter=function(){k.go(".search",{})},b.filter=function(){c.refreshGrid(!0).then(s)},b.isDirty=function(a){return a.isDirty},b.isPending=function(a){return a.pending},b.hasProblem=function(a){return a.hasProblem},b.showFilterOptions=function(a){b.filteroptionspopover.show(a)},b.$on("sw_filteroptionclosed",function(){b.filteroptionspopover.hide()}),b.createEnabled=function(){var a=c.currentListSchema();if(!a)return!1;var b=a.properties["list.offline.create.disabled"],d=c.getCrudContext().menuDisableCreate,e="true"===b||b===!0||"true"===d||d===!0;return!e&&c.hasNewSchemaAvailable()},b.disableSearch=function(a){b._searching=!1,a&&(q.clearGridSearchValues(),c.refreshGrid()),e.scrollTop()},b.gridTitle=function(){var a=l.currentListSchema(),b=l.getCrudContext(),d=b.menuGridTitle||c.gridTitle(a);return d+" ("+b.gridSearch.count+")"},b.itemTitle=function(a){var b=d.buildDisplayValue(c.currentListSchema(),"title",a);return null==b?"New "+c.currentTitle():b},b.itemSubTitle=function(a){return d.buildDisplayValue(c.currentListSchema(),"subtitle",a)},b.itemFeatured=function(a){return d.buildDisplayValue(c.currentListSchema(),"featured",a);
},b.itemExcerpt=function(a){return d.buildDisplayValue(c.currentListSchema(),"excerpt",a)},b.openDetail=function(a){c.loadDetail(a)},b.toggleMenu=function(){o.toggleLeft()},b.createItem=function(){c.createDetail()},b.fullSync=function(a){return n.showDefault(),j.fullSync().then(function(){c.refreshGrid()})["finally"](function(){n.hide(),b.$broadcast("scroll.refreshComplete")})},b.showGridItemOptions=function(a,c){c.isDirty&&(l.getCrudContext().currentPopOverItem=c,b.optionspopover.show(a))},b.$on("sw_griditemoperationperformed",function(){b.optionspopover.hide(),l.getCrudContext().currentPopOverItem=null}),b.$on("$stateChangeSuccess",function(c,d,e,g,h){a.get("crudlist#statehandler").debug("handler called",arguments),d.name.startsWith("main.crud")&&(d.name.startsWith("main.crudlist")?(t(),n.hide()):f(function(){return b.disableSearch()},500))}),b.$on(i.events.sameStateTransition,function(b,c){a.get("crudlist#statehandler").debug("handler called",u),c.name.startsWith("main.crudlist")&&t()}),b.loadMore=function(){var d=a.get("crudListController#loadMore");d.debug("fetching more items"),c.loadMorePromise().then(function(a){b.$broadcast("scroll.infiniteScrollComplete"),b.crudlist.items=b.crudlist.items.concat(a),b.crudlist.moreItemsAvailable=a.length>0})}}])}(softwrench),function(a,_){a.controller("CrudTabController",["$scope","$rootScope","$log","crudContextService","crudContextHolderService","schemaService","inlineCompositionService",function(a,b,c,d,e,f,g){function h(){c.get("crud_tab#init").debug("crud tab init");var b=e.getCrudContext();a.tab=b.composition.currentTab,a.tabAllDisplayables=f.nonTabFieldsFromDisplayables(a.tab.displayables),a.tabDisplayables=a.tabAllDisplayables,a.tabInlineCompositionsLoaded||(a.tabInlineCompositionsLoaded=!0,g.loadInlineCompositions(a.item,a.datamap,a.tabAllDisplayables,a.tab.id))}a.$on("sw_cruddetailrefreshed",function(){a.tabInlineCompositionsLoaded=!1,h()}),h()}])}(softwrench,_),function(a){a.controller("CrudListSearchController",["$log","$scope","crudContextHolderService","crudContextService","routeService","crudSearchService",function(a,b,c,d,e,f){function g(a,b){return"start"!==a&&"startUTC"!==a&&"end"!==a&&"endUTC"!==a||"string"!=typeof b?b:new Date(b)}function h(a,c){var d=b.gridSearch.searchValues[a.value];if(d){var e=d[c?"start":"end"];return e?void(d[c?"startUTC":"endUTC"]=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate()))):void(d[c?"startUTC":"endUTC"]=null)}}var i={},j={};b.clear=function(){f.clearGridSearchValues()},b.cancel=function(){b.gridSearch.searchValues=i,b.gridSearch.sort=j,i={},j={},e.go("^")},b.apply=function(){d.refreshGrid()},b.sortChanged=function(a){b.gridSearch.sort=b.gridSearch.sortables[a]},b.searchDateStartChanged=function(a){h(a,!0)},b.searchDateEndChanged=function(a){h(a,!1)},b.searchFieldLabel=function(a){return a.label||a.value},b.sortFieldLabel=function(){return b.gridSearch.sort?b.gridSearch.sort.label||b.gridSearch.sort.value:null},b.getSearchType=function(a){return"MetadataDateTimeFilter"===a.type?"date":"MetadataOptionFilter"===a.type?"option":"date"===a.dataType?"date":"default"},b.searchValue=function(a){return b.gridSearch.searchValues[a.value]},b.init=function(){b.gridSearch=c.getGridSearchData(),i=JSON.parse(JSON.stringify(b.gridSearch.searchValues),g),j=JSON.parse(JSON.stringify(b.gridSearch.sort)),b.gridSearch=f.initGridSearch()},b.init()}])}(softwrench),function(a){a.controller("FilterOptionController",["$log","$scope","$ionicScrollDelegate","crudContextService","crudFilterContextService",function(a,b,c,d,e){b.showpending=e.showPending(),b.showdirty=e.showDirty(),b.showproblems=e.showProblems(),b.changePending=function(){b.showpending=!b.showpending,e.showPending(b.showpending),d.refreshGrid()},b.changeDirty=function(){b.showdirty=!b.showdirty,e.showDirty(b.showdirty),d.refreshGrid()},b.changeProblem=function(){b.showProblems=!b.showProblems,e.showProblems(b.showProblems),d.refreshGrid()}}])}(softwrench),function(a){a.controller("GridItemPopOverController",["$log","$scope","synchronizationFacade","crudContextService","itemActionService","$ionicPopup","menuModelService","alertService","routeService","loadingService",function(a,b,c,d,e,f,g,h,i,j){b.quicksync=function(){var a=d.getCrudContext().currentPopOverItem;if(a.isDirty)return c.syncItem(a).then(function(){d.isOnMainTab()||(d.resetTab(),i.go("main.cruddetail.maininput")),g.updateAppsCount(),d.refreshGrid()})["catch"](function(a){c.handleError(a)}).then(function(a){f.alert({title:"Quick Sync",template:h.buildCenteredTemplate("Sync Successful")})})["finally"](function(){j.hide(),b.$emit("sw_griditemoperationperformed")})},b.restorestate=function(){var a=d.getCrudContext().currentPopOverItem;return e.deleteOrRestoreItem(a).then(function(a){return a?d.refreshGrid():null})["finally"](function(){b.$emit("sw_griditemoperationperformed")})}}])}(softwrench),function(a){a.controller("LoginController",["$scope","swAlertPopup","routeService","securityService","$timeout","$stateParams","loadingService","settingsService","dynamicScriptsCacheService",function(a,b,c,d,e,f,g,h,i){a.data={};var j=function(a,c){b.show({title:a,template:c})},k=function(){var a=f.message;a&&j("Attention",a)};a.login=function(b,e){g.showDefault(),b&&(a.data.username=b),e&&(a.data.password=e),d.login(a.data.username,a.data.password).then(function(b){c.go("main.home"),a.data={},i.clearEntries()})["catch"](function(a){d.logout(),j("Login failed",a&&a.message?a.message:"Please check your credentials.")})["finally"](function(){g.hide()})},a.viewSettings=function(){c.go("settings")},a.getIsDemoMode=function(){h.getServerUrl().then(function(b){a.isDemoMode=b.indexOf("demo.softwrench.net")>0})},a.$on("$stateChangeSuccess",function(b,c,d,f,g){e(function(){a.getIsDemoMode()})}),e(k),a.getIsDemoMode()}])}(softwrench),function(a){a.controller("MainController",["$scope","$ionicSideMenuDelegate","crudContextService",function(a,b,c){function d(){isRippleEmulator()&&$("body").addClass("ripple")}a.data={},a.isList=function(){return c.isList()},a.toggleLeft=function(){b.toggleLeft()},a.closeMenu=function(){b.toggleLeft()},a.title=function(){return c.currentTitle()},d()}])}(softwrench),function(a){window.MultiAssetController=function(a,b,c,d,e,f){function g(a){var b=a+13+"px";$("[state='main.cruddetail.tab']").css("height",b)}function h(){j.debug("loading multiassets"),b.loaded=!1,g(100);var a=d.currentDetailItemDataMap();b.multiassets=a.multiassetlocci_||[],b.associationData={};var e=[];angular.forEach(b.multiassets,function(a){var c={};e.push(i(a,c)),c.offlinelocation_=a.location,b.associationData[a.multiid]=c}),c.all(e).then(function(){g(b.multiassets&&b.multiassets.length>0?75*b.multiassets.length:16),b.loaded=!0})["catch"](function(a){return console.log(a)})}function i(a,d){var f=a.assetnum;return d.offlineasset_=f,f?e.filterPromise(b.detailSchema,a,"offlineasset_",'"assetnum":"'+f+'"',null,!0).then(function(a){d.assetdescription=a&&a[0]?a[0].datamap.description:null}):c.when(null)}var j=a.get("multiasset"),k=d.getCrudContext(),l=k.composition.currentTab;angular.forEach(l.displayables,function(a){"multiassetlocci_"===a.relationship&&(b.fieldMetadata=a)}),b.detailSchema=b.fieldMetadata.schema.schemas.detail,b.associationData={},b.loaded=!1,h(),b.$on(f.compositionLoadedEventName(),function(a,b){return h()}),b.toggleProcess=function(a){a.progress=a.progress?0:1,a["#isDirty"]="true"}},a.controller("MultiAssetController",["$log","$scope","$q","crudContextHolderService","offlineAssociationService","inlineCompositionService",window.MultiAssetController])}(softwrench),function(a){a.controller("SettingsController",["$scope","routeService","securityService","applicationStateService","settingsService","offlinePersitenceBootstrap",function(a,b,c,d,e,f){function g(){e.getSettings().then(function(b){return a.settings=b||{},a.settings.serverurl||(a.settings.serverurl="http://"),d.getAppConfig()}).then(function(b){a.config=b;var c;if(a.config.client&&(c=a.config.client.version.indexOf("#"))>0){var d=a.config.client.version;a.config.client.version=d.substring(0,c),a.config.client.commit=d.substring(c+1)}})}a.config=null,a.goToLogin=function(){b.go("login")},a.saveDemo=function(){a.settings.serverurl="http://demo.softwrench.net/",a.save()},a.save=function(){a.settings.serverurl.startsWith("http")||(a.settings.serverurl="http://"+a.settings.serverurl),e.saveSettings(a.settings).then(function(a){var d=c.hasAuthenticatedUser()?"main.home":"login";b.go(d)})},f.addPersistenceReadyListener({persistenceReady:function(){g()}})}])}(softwrench),function(angular){angular.module("softwrench").controller("SupportController",["$scope","supportService","$ionicPopup","dynamicScriptsCacheService","securityService","routeService","swdbDAO","$log","$roll",function(a,b,c,d,e,f,g,h,i){var j=h.get("SupportController");a.vm={loglevel:sessionStorage.loglevel||"WARN",sqlClientCollapsed:!0,logFileCollapsed:!0},a.toggleSQLClientState=function(){a.vm.sqlClientCollapsed=!a.vm.sqlClientCollapsed},a.toggleLogFile=function(){a.vm.logFileCollapsed=!a.vm.logFileCollapsed,a.vm.logFileCollapsed||i.readCurrent().then(function(b){a.vm.logoutput=b})},a.changeloglevel=function(a){sessionStorage.loglevel=a.item.value,a.item.value.equalIc("debug")?persistence.debug=!0:persistence.debug=!1},a.sendLogFiles=function(){b.getLogReportingModal(!1).then(function(a){a.show()})},a.reset=function(){var a=c.confirm({title:"Reset configurations",template:"Are you sure that you want to reset configurations? All non synchronized work will be lost"});return a.then(function(a){d.clearEntries(),window.location.reload(!0),e.logout(!0).then(function(){return f.go("login")}).then(function(a){})})},a.queryModel={},a.queryModel.sqlQuery="",a.queryModel.limitRows=!0,a.queryModel.limitRowsSize=10,a.queryModel.resultMessage="",a.queryModel.resultMessageStyle={color:"green"};var k=function(a,b){var c="";return c+="Query ("+a+") run with success",b&&b.length?(c+=":\n",angular.forEach(b,function(a){c+=JSON.stringify(a)+"\n"}),c):c+="."},l=function(a,b){var c="";return c+="Query ("+a+") run with error."};a.runSQL=function(){if(a.queryModel.sqlQuery){var b=a.queryModel.sqlQuery.trim();g.executeQuery(b).then(function(c){a.queryModel.resultMessageStyle.color="green",b.toLowerCase().startsWith("select")?a.queryModel.resultMessage=c.length+" results found.":a.queryModel.resultMessage="Success.",j.warn(k(b,c))},function(c){a.queryModel.resultMessageStyle.color="red",a.queryModel.resultMessage="Error: "+c+".",j.error(l(b,c))})}}}])}(angular),function(a){a.controller("SyncOperationDetailController",["$scope","synchronizationOperationService","contextService","routeService","securityService","synchronizationFacade","swAlertPopup","$stateParams","$ionicHistory","applicationStateService","$q","$timeout","$ionicPopup","$ionicScrollDelegate","loadingService","attachmentDataSynchronizationService","metadataModelService","menuModelService","offlineSchemaService","crudContextService","crudContextHolderService","indexCreatorService","swdbDAO","networkConnectionService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){a.data={operation:null,batchItems:[],isLatestOperation:!h.id,isSynching:!1,currentApplicationState:null,applicationStateCollapsed:!0};var y=function(){var c=a.data.isLatestOperation?b.getMostRecentOperation():b.getOperation(h.id);return c.then(function(c){return c?(a.data.operation=c,b.getBatchItems(c)):c}).then(function(a){return a?a.map(function(a){return a.problem&&(a.simpleproblem={message:a.problem.message}),a}):a}).then(function(b){a.data.batchItems=b})},z=function(){return j.currentApplicationsState().then(function(b){a.data.currentApplicationState=b,angular.forEach(b.applications,function(a){var b=q.getApplicationByName(a.application),c=s.locateSchema(b,"list");a.gridTitle=c?t.gridTitle(c):a.application})})},A=function(b){var c=b?f.isFirstSync():k.when(!1);return c.then(function(c){if(c)return l(function(){a.fullSynchronize(!0)},0,!1);o.showDefault();var d=y(),e=z();return k.all([d,e])["finally"](function(){b&&o.hide()})})};a.goToHistory=function(){d.go("main.syncoperationhistory")},a.goBack=function(){i.goBack()},a.solveProblems=function(){},a.reset=function(){return x.isOffline()?void g.show({title:"error",template:"No internet connection detected. Cannot perform the reset operation"}):m.confirm({title:"Reset",template:["All unsaved data will be lost","Proceed anyway?"].join(" ")}).then(function(a){return a?e.logout(!1,!1):k.reject()}).then(function(){return a.fullSynchronize()})},a.innerFullSynchronize=function(){a.data.isSynching=!0,o.showDefault(),u.clearGridSearch();var b=!1;return f.fullSync().then(function(a){return f.shouldFullResync().then(function(a){b=a,b||g.show({title:"Synchronization Succeeded"})}).then(function(){return A()})})["catch"](function(a){f.handleError(a)})["finally"](function(){if(a.data.isSynching=!1,o.hide(),p.downloadAttachments(),v.createIndexAfterFirstSync(),c.get("restartneeded"))return c.deleteFromContext("restartneeded"),void window.restartApplication()}).then(function(){return b?e.logout(!1,!1):k.reject()}).then(function(){return a.innerFullSynchronize()})},a.fullSynchronize=function(){f.shouldFullResync(!0).then(function(b){return b?e.logout(!1,!1).then(function(){return a.innerFullSynchronize()}):a.innerFullSynchronize()})},a.toggleApplicationStateCollapsed=function(){a.data.applicationStateCollapsed=!a.data.applicationStateCollapsed,a.data.applicationStateCollapsed?n.scrollTop(!0):n.scrollBottom(!0)},A(!0)}])}(softwrench),function(a){a.controller("SyncOperationHistoryController",["$scope","synchronizationOperationService","routeService",function(a,b,c){a.operationList=[],a.paginationData={currentPage:1,pageSize:10,hasMoreAvailable:!0},a.goBack=function(){c.go("main.home")},a.openDetail=function(a){c.go("main.syncoperationdetail",{id:a.id})},a.loadPagedList=function(){b.getSyncList(a.paginationData.currentPage).then(function(b){a.paginationData.hasMoreAvailable=b&&b.length>=a.paginationData.pageSize,a.paginationData.currentPage+=1,a.operationList=a.operationList.concat(b)})["finally"](function(){a.$broadcast("scroll.infiniteScrollComplete")})}}])}(softwrench),function(a,angular,_){function b(a,b,c,d,e,f,g,h){function i(){return a.findByQuery("Application","association=1").then(function(a){return a.map(function(a){return{name:a.application,title:a.data.title}})}).then(function(b){var c=_.indexBy(b,"name");return a.executeStatement("select application,count(id) from AssociationData group by application").then(function(a){return a.map(function(a){return{application:a.application,count:a["count(id)"],title:c[a.application].title}})})})}function j(){return a.findByQuery("Application","composition=0 and association=0").then(function(a){var c=a.map(function(a){return a.application}),d=c.map(function(a){var c=[p(a),q(a),r(a),s(a)];return b.all(c).spread(function(b,c,d,e){return{application:a,all:b,pending:c,dirty:d,problematic:e}})});return b.all(d)})}function k(){return b.all([j(),i()]).spread(function(a,b){return{applications:a,associations:b}})}function l(){var a=d.getConfig("serverconfig"),c=isRippleEmulator()?b.when("Ripple"):e.getVersionNumber();return b.all([a,c]).spread(function(a,b){return{server:a,client:{version:b}}})}function m(a){if(!angular.isArray(a)||a.length<=0)return b.when();var c=[];return angular.forEach(a,function(a){var b=t[a];if(b&&angular.isFunction(b)){var d=b().then(function(b){return{state:a,result:b}});c.push(d)}}),c.length<=0?b.when():b.all(c).then(function(a){var b={};return angular.forEach(a,function(a){b[a.state]=a.result}),b})}function n(){return this.getStates(["configs","device"]).then(function(a){var b=a.device;return b.clientVersion=a.configs.client.version,b})}function o(){return m(Object.keys(t))}var p=function(b){return a.countByQuery("DataEntry","application='"+b+"'")},q=function(b){return a.countByQuery("DataEntry","application='"+b+"' and pending = 1")},r=function(b){return a.countByQuery("DataEntry","application='"+b+"' and isDirty=1 and (hasProblem = 0 or hasProblem is null)")},s=function(b){return a.countByQuery("DataEntry","application='"+b+"' and hasProblem = 1")},t={settings:function(){return f.getSettings().then(function(a){return _.pick(a,"serverurl")})},configs:function(){return l()},applications:function(){return k()},user:function v(){var v=g.currentFullUser();return b.when(v)},device:function w(){var w=_.pick(h.getDevice(),"platform","version","model");return b.when(w)}},u={currentApplicationsState:k,getAppConfig:l,getStates:m,getServerDeviceData:n,getFullState:o};return u}a.factory("applicationStateService",["swdbDAO","$q","offlineEntities","configurationService","$cordovaAppVersion","settingsService","securityService","$cordovaDevice",b])}(mobileServices,angular,_),function(a,angular){a.factory("configurationService",["$http","$log","$q","swdbDAO","contextService","settingsService",function(a,b,c,d,e,f){function g(a){return angular.forEach(a,function(a){e.insertIntoContext(a.key,a.value),"serverconfig"===a.key&&e.set("environment",a.value.environment)}),a}function h(){return f.initializeSettings()}function i(){return d.findAll("Configuration").then(g)}function j(a){var b=a.map(function(a){return d.instantiate("Configuration",a)});return c.all(b).then(function(a){return d.bulkSave(a)}).then(g)}function k(a){return m(a.key).then(function(b){return null!=b&&(b.key=a.key,b.value=a.value),b?b:d.instantiate("Configuration",a)}).then(function(a){return d.save(a)})}function l(a){return d.findSingleByQuery("Configuration","key='"+a+"'").then(function(a){return a?a.value:null})}function m(a){return d.findSingleByQuery("Configuration","key='"+a+"'").then(function(a){return a?a:null})}var n={loadConfigs:i,loadClientConfigs:h,saveConfigs:j,saveConfig:k,getConfig:l,getFullConfig:m};return n}])}(mobileServices,angular),function(a){function b(a,b,c){function d(a){return k.storageNamespace+a}function e(b){return b?(a.put(d("settings"),b),b.serverurl&&a.put(d("serverurl"),b.serverurl),b):b}function f(){var f=a.get(d("settings"));return f?c.when(f):b.findSingleByQuery("Settings",null).then(e)}function g(){return f().then(function(a){return a.serverurl})}function h(){return f().then(function(a){return a.server.client})}function i(a){return b.instantiate("Settings",a).then(function(a){return b.save(a)}).then(e)}function j(){return b.findAll("Settings").then(function(a){return a.length<=0?i(null):e(a[0])})}var k={storageNamespace:"settings:"},l={getSettings:f,getClient:h,getServerUrl:g,saveSettings:i,initializeSettings:j};return l}a.factory("settingsService",["localStorageService","swdbDAO","$q",b])}(mobileServices),function(angular,a,_){function b(b,c,d,e,f,g,h,i,j,k){function l(){return e.listDir(a.file[d.config.directory]).then(function(a){return a.filter(function(a){return a.isFile&&a.name.startsWith(d.config.prefix)}).map(function(a){return a.nativeURL})})}function m(a){var b="<ul>";return angular.forEach(a,function(a,c){if(!angular.isFunction(a)){var d=a;a?angular.isArray(a)&&(d=a.toString()):d=String(a),b+="<li>"+c+": "+d+"</li>"}}),b+="</ul>"}function n(a){var b="";return angular.forEach(a,function(a,c){var d="";"user"===c?(d+="<div>",d+=m(_.omit(a,"meta","properties")),d+="<b>user.properties</b><br>"+m(a.properties),d+="</div>"):"configs"===c?(d+="<div>",d+="<b>configs.server</b><br>"+m(a.server),d+="<b>configs.client</b><br>"+m(a.client),d+="</div>"):d=m(a),b+="<div><b>"+c+"</b><br><div>"+d+"</div></div>"}),b}function o(a,b){var c=a.user,d="<div>softWrench Log Reporting from <b>"+c.UserName+"</b></div><br>";b&&(d+="<div>"+c.UserName+" included the following message:<br>"+b+"</div><br>");var e=n(a);return d+="\n                <div>\n                    <h3>Application state during the report<h3>\n                    "+e+"\n                </div><br>",d+="The log files are attached"}function p(){return k.findSingleByQuery("DataEntry","application='_configuration' and datamap like '%\"fullKey\":\""+u.logs.emailConfigKey+"\"%'").then(function(a){if(!a)return u.logs.emailTo;var b=a.datamap;return b.stringValue||b.defaultValue||u.logs.emailTo})}function q(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},d=a.subject,e=void 0===d?"":d,f=a.message,g=void 0===f?"":f,h=[c.getStates(["settings","configs","user","device"]),l(),p()];return b.all(h).spread(function(a,b,c){var d=a.configs.server.client.toUpperCase(),f="["+d+"][SWOFF][LOG]";e&&(f+=" "+e);var h=o(a,g),i=a.user.Email,j={to:[c],cc:[i],subject:f,body:h,isHtml:!0,attachments:b};return j})}function r(){var a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],b=j.$new(!0);return b.title=a?"Log Reporting":"Contact",b.actiontitle=a?"Send Report":"Send",b.email={subject:null,message:null},b.sendLogReport=function(a){s(a)["catch"](function(a){return h.alert({title:"Error Sending Log Report",template:a.message})})["finally"](function(){return b.modal.remove()})},i.fromTemplateUrl(getResourcePath(u.logs.modalTemplateUrl),{scope:b,animation:"slide-in-up",hardwareBackButtonClose:!0}).then(function(a){return b.modal=a})}function s(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return isRippleEmulator()||!d.started?b.reject(new Error("Logging is not enabled")):g.isOffline()?b.reject(new Error("Device is not connected to a network")):d.writeNow().then(function(){return f.isAvailable()}).then(function(){return q(a)}).then(function(a){return f.open(a)["catch"](function(){return b.when()})})}function t(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},c=a.title,d=void 0===c?u.logs.popup.title:c,e=a.template,f=void 0===e?u.logs.popup.template:e;u.logs.ongoing||(u.logs.ongoing=!0,h.confirm({title:d,template:f}).then(function(a){return a?r():b.reject()}).then(function(a){return a.show()})["catch"](function(a){return a})["finally"](function(){return u.logs.ongoing=!1}))}var u={logs:{emailTo:"support@controltechnologysolutions.com",emailConfigKey:"/Offline/Support/Email",modalTemplateUrl:"Content/Mobile/templates/support_reportlog_modal.html",popup:{title:"Log Reporting",template:"Do you wish to report to the support team"},ongoing:!1}},v={reportLogs:s,getLogReportingModal:r,requestLogReporting:_.debounce(t,500)};return v}angular.module("sw_mobile_services").factory("supportService",["$q","applicationStateService","$roll","$cordovaFile","$cordovaEmailComposer","networkConnectionService","$ionicPopup","$ionicModal","$rootScope","swdbDAO",b])}(angular,cordova,_),function(angular,_){function a(a,b,c){function d(b){return b?a.get(b+"/"+k.loggerContext,[k.loggerContext]):l}function e(){sessionStorage[k.loggerContextKey]=k.loggerLevel}function f(){sessionStorage[k.loggerContextKey]=l.globalLogLevel}function g(){return sessionStorage[k.loggerContextKey]===k.loggerLevel}function h(a){for(var b=d(a),c=arguments.length,e=Array(c>1?c-1:0),f=1;f<c;f++)e[f-1]=arguments[f];b.trace.apply(b,["[TRACKING]:"].concat(e))}function i(a,b){for(var d=arguments.length,e=Array(d>2?d-2:0),f=2;f<d;f++)e[f-2]=arguments[f];var g=!angular.isArray(b)||b.length<=0?"getFullState":"getStates";c[g](b).then(function(b){b&&!_.isEmpty(b)&&h.apply(void 0,[a,b].concat(e))})}function j(a){if(g()){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];i.apply(void 0,[a,null].concat(c))}}var k={loggerContext:"tracking",get loggerContextKey(){return"log_"+this.loggerContext},loggerLevel:"trace"},l=a.get(k.loggerContext,[k.loggerContext]),m={track:h,trackStates:i,trackFullState:j,enable:e,disable:f,get isEnabled(){return g()}};return m}angular.module("sw_mobile_services").factory("trackingService",["$log","$q","applicationStateService","$roll","$cordovaFile","$cordovaEmailComposer","networkConnectionService",a])}(angular,_),function(angular){function a(a,b,c,d){function e(a){a.searchFields[P]={label:"Quick Search",value:P,type:"BaseMetadataFilter"};var b={label:"Default",value:Q};a.sortables[Q]=b,a.sortableFields.push(b),a.sort=b}function f(a){if(a){var b=T.itemlist,c=b.indexOf(a);0===c?T.previousItem=null:T.previousItem=b[c-1],c===b.length-1?T.nextItem=null:T.nextItem=b[c+1]}}function g(){if(!isRippleEmulator())return null;var b=d.getFromContext("crudcontext");return b&&(T=JSON.parse(b),T.itemlist&&(T.itemlist=[]),T.originalDetailItemDatamap&&(T.currentDetailItem=T.currentDetailItem||{},T.originalDetailItemDatamap=angular.copy(T.originalDetailItemDatamap),T.currentDetailItem.datamap=T.originalDetailItemDatamap,f(b.currentDetailItem))),a.get("crudContextService#factory").debug("restoring state of crudcontext"),b}function h(){return"main.crudlist"===b.current.name}function i(){var a=this.tabTitle();return null!=a?T.currentTitle+" / "+a:T.currentTitle}function j(){return T.currentApplicationName}function k(){return T.currentListSchema}function l(){var a=T.currentListSchema,b=T.currentDetailSchema;return a?b?[a,b]:a:b}function m(){return T.newItem&&T.currentNewDetailSchema?T.currentNewDetailSchema:T.currentDetailSchema}function n(){return T.currentDetailItem}function o(){return T.currentProblems}function p(a){a&&(c.$broadcast("sw.problem.problemupdated"),T.currentProblems=[a])}function q(a){T.originalDetailItemDatamap=angular.copy(a)}function r(){return T.itemlist}function s(){return T.composition.currentDetailItem?T.composition.currentDetailItem:T.currentDetailItem.datamap}function t(){T.composition={},T.currentDetailItem=null}function u(){T.composition.currentDetailItem=null}function v(){return null==T.composition.currentTab}function w(){return"main.cruddetail.locationdrilldown"===b.current.name}function x(){T.composition.currentTab=null}function y(){return this.isOnMainTab()?null:T.composition.currentTab.label}function z(){return this.isOnMainTab()?null:T.composition.currentTab.schema.schemas.list.properties["icon.composition.tab"]}function A(){return this.isOnMainTab()?null:T.composition.currentTab.id}function B(){return T.composition.itemlist}function C(){return T.composition.currentListSchema}function D(){return T.composition.currentDetailSchema}function E(){return T.composition.currentDetailItem}function F(){return T.gridSearch}function G(a,b){var c=[],d=b[a];return d?(angular.forEach(d.split(","),function(a){var b=a.trim();b&&c.push(b)}),c):c}function H(){if(T.indexes)return T.indexes;T.indexes={};var a=T.currentApplication;return a&&a.data&&a.data.properties?(T.indexes.textIndexes=G("list.offline.text.indexlist",a.data.properties),T.indexes.numericIndexes=G("list.offline.numeric.indexlist",a.data.properties),T.indexes.dateIndexes=G("list.offline.date.indexlist",a.data.properties),T.indexes):T.indexes}function I(){angular.forEach(T.gridSearch.searchFields,function(a,b){T.gridSearch.searchFields.hasOwnProperty(b)&&(T.gridSearch.searchValues[b]={})}),T.gridSearch.sort=T.gridSearch.sortables[Q]}function J(){T.gridSearch={searchFields:{},searchValues:{},sortables:{},sortableFields:[],sort:{}},e(T.gridSearch)}function K(){return T.gridSearch.searchValues[P]||(T.gridSearch.searchValues[P]={}),T.gridSearch.searchValues[P]}function L(){return T}function M(){T=angular.copy(S),e(T.gridSearch)}function N(){return T.composition.currentDetailItem?T.composition.currentDetailItem&&!angular.equals(T.composition.originalDetailItemDatamap,T.composition.currentDetailItem):T.currentDetailItem&&!angular.equals(T.originalDetailItemDatamap,T.currentDetailItem.datamap)}function O(){T.drillDown=angular.copy(R)}var P="_quicksearch",Q="default",R={selectedLocation:null,locationHistory:[],locations:[],locationQuery:void 0,locationsCount:0,childAssetsView:!1,assets:[],assetSearchQuery:void 0,clean:!0,assetView:!1,assetsCount:0,page:1,moreItemsAvailable:!1},S={currentApplicationName:null,currentApplication:null,currentTitle:null,currentListSchema:null,itemlist:null,originalDetailItemDatamap:null,currentDetailItem:null,currentProblems:null,currentDetailSchema:null,currentNewDetailSchema:null,currentPopOverItem:null,newItem:!1,gridSearch:{searchFields:{},searchValues:{},sortables:{},sortableFields:[],sort:{},count:0},currentMenuId:null,menuGridTitle:null,menuDisableCreate:!1,readonly:!1,composition:{currentTab:null,currentListSchema:null,itemlist:null,currentDetailItem:null,originalDetailItemDatamap:null,currentDetailSchema:null},indexes:null,previousItem:null,nextItem:null,wizardStateIndex:0,drillDown:angular.copy(R)};e(S.gridSearch);var T=angular.copy(S),U={setPreviousAndNextItems:f,restoreState:g,isList:h,currentTitle:i,currentApplicationName:j,currentListSchema:k,currentDetailSchema:m,currentDetailItem:n,currentProblems:o,updateCurrentProblem:p,currentSchema:l,itemlist:r,currentDetailItemDataMap:s,leavingDetail:t,isOnMainTab:v,isOnDrillDown:w,resetTab:x,tabTitle:y,tabIcon:z,leavingCompositionDetail:u,compositionList:B,getCompositionListSchema:C,getCompositionDetailSchema:D,getCompositionDetailItem:E,getGridSearchData:F,getIndexes:H,clearGridSearchValues:I,clearGridSearch:J,getQuickSearch:K,hasDirtyChanges:N,getActiveTab:A,reset:M,updateOriginalItemDatamap:q,drillDownClear:O,getCrudContext:L};return U}angular.module("softwrench").factory("crudContextHolderService",["$log","$state","$rootScope","contextService",a])}(angular),function(a,angular,constants,_){constants=constants||{},a.factory("crudContextService",["$q","$log","$rootScope","$ionicHistory","swdbDAO","searchIndexService","problemService","metadataModelService","offlineSchemaService","offlineCompositionService","expressionService","offlineSaveService","schemaService","contextService","routeService","tabsService","crudSearchService","crudFilterContextService","validationService","crudContextHolderService","datamapSanitizationService","maximoDataService","menuModelService","loadingService","offlineAttachmentService","offlineEntities","queryListBuilderService","swAlertPopup","eventService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C){var D={},E={lastPageLoaded:1};c.$on("sw4:security:logout",function(){h.reset(),t.reset(),w.reset()});var F=null,G=function(a,b){return b.originalDetailItemDatamap=angular.copy(a.datamap),D.refreshGrid(!0).then(function(){return c.$broadcast("sw_cruddetailrefreshed"),a})};return D={getCrudContext:function(){return t.getCrudContext()},restoreState:function(){var a=t.restoreState();return a&&a.itemlist&&!a.currentDetailItem&&this.refreshGrid(),c.$broadcast("sw_staterestored"),a},resetContext:function(){t.reset()},isList:function(){return t.isList()},currentTitle:function(){return t.currentTitle()},currentApplicationName:function(){return t.currentApplicationName()},currentListSchema:function(){return t.currentListSchema()},currentDetailSchema:function(){return t.currentDetailSchema()},currentDetailItem:function(){return t.currentDetailItem()},itemlist:function(){return t.itemlist()},currentDetailItemDataMap:function(){return t.currentDetailItemDataMap()},leavingDetail:function(){t.leavingDetail()},isOnMainTab:function(){return t.isOnMainTab()},resetTab:function(){t.resetTab()},tabTitle:function(){return t.tabTitle()},tabIcon:function(){return t.tabIcon()},leavingCompositionDetail:function(){t.leavingCompositionDetail()},compositionList:function(){return t.compositionList()},getCompositionListSchema:function(){return t.getCompositionListSchema()},getCompositionDetailSchema:function(){return t.getCompositionDetailSchema()},getCompositionDetailItem:function(){return t.getCompositionDetailItem()},mainDisplayables:function(){return m.nonTabFields(this.currentDetailSchema())},currentCompositionsToShow:function(){var a=this.currentDetailSchema();if(!a)return[];var b=p.tabsDisplayables(a);return b},currentCompositionTabByName:function(a){return this.currentCompositionsToShow().find(function(b){return b.attribute===a})},currentCompositionSchemaById:function(a,b){var c=this.currentCompositionTabByName(a);return c?c.schema.schemas[b]:null},loadTab:function(a){var b=t.getCrudContext();return null==a?(this.resetTab(),o.go("main.cruddetail.maininput")):"ApplicationCompositionDefinition"!==a.type?(b.composition.currentTab=a,o.go("main.cruddetail.tab")):j.loadCompositionList(b.currentDetailItem,a).then(function(c){
return b.composition.currentTab=a,b.composition.itemlist=c,b.composition.currentListSchema=a.schema.schemas.list,b.composition.currentDetailSchema=a.schema.schemas.detail,b.composition.currentDetailItem=null,n.insertIntoContext("crudcontext",b),o.go("main.cruddetail.compositionlist")})},loadCompositionDetail:function(a){var b=this,c=this.validateDetail();if(c&&c.length>0)return B.alertValidationErrors(c,null,"Validation errors in the main form prevent you from editing this "+this.tabTitle()+". Please resolve this errors:").then(function(){return b.loadTab()});var d=t.getCrudContext(),e=this.getCompositionDetailSchema(),f=e.displayables;return"attachment"===e.applicationName?y.loadRealAttachment(a):(u.enforceNumericType(a,f),d.composition.currentDetailItem=a,d.composition.originalDetailItemDatamap=angular.copy(a),n.insertIntoContext("crudcontext",d),o.go("main.cruddetail.compositiondetail"))},addCompositionAllowed:function(){var a=t.getCrudContext(),b=a.composition;if(!b||!b.currentTab||!b.currentTab.schema||null!=b.currentDetailItem)return!1;var c=b.currentTab.schema.allowInsertion,d=a.currentDetailItem.datamap,e=a.currentDetailSchema;return k.evaluate(c,d,{schema:e},null)},createNewCompositionItem:function(){var a=this,b=this.validateDetail();if(b&&b.length>0)return B.alertValidationErrors(b,null,"Validation errors in the main form prevent you from adding a new "+this.tabTitle()+". Please resolve this errors:").then(function(){return a.loadTab()});var c=t.getCrudContext(),d=c.currentDetailItem.datamap;return c.composition.currentDetailItem={},i.fillDefaultValues(c.composition.currentDetailSchema,c.composition.currentDetailItem,d),c.composition.originalDetailItemDatamap={"_newitem#$":!0},n.insertIntoContext("crudcontext",c),o.go("main.cruddetail.compositiondetail")},hasDirtyChanges:function(){return t.hasDirtyChanges()},cancelChanges:function(){var a=t.getCrudContext();return a.composition.currentDetailItem?(a.composition.currentDetailItem=angular.copy(a.composition.originalDetailItemDatamap),o.go("main.cruddetail.compositionlist")):void(a.newItem?(this.refreshGrid(),a.newItem=!1):a.currentDetailItem.datamap=angular.copy(a.originalDetailItemDatamap))},validateDetail:function(a,b,c){var d=t.getCrudContext();a=a||{};var e=b||this.currentDetailSchema(),f=d.currentDetailItem.datamap,g=c||e.displayables;return s.validate(e,g,f,a.$error)},saveChanges:function(b,c){var d=this,e=t.getCrudContext();b=b||{};var f=this.validateDetail(b);if(f.length>0)return a.reject(f);var g=(e.currentDetailItem.datamap,e.composition);if(g&&g.currentDetailItem){var h=g.currentDetailItem,i=s.validate(g.currentDetailSchema,g.currentDetailSchema.displayables,h,b.$error);return i.length>0?a.reject(i):l.addAndSaveComposition(e.currentApplicationName,e.currentDetailItem,h,g.currentTab).then(function(){return g.originalDetailItemDatamap=g.currentDetailItem,d.refreshIfLeftJoinPresent(e,null)}).then(function(a){var b=g.itemlist.find(function(a){return a[constants.localIdKey]===h[constants.localIdKey]});return b?(angular.forEach(b,function(a,c){h.hasOwnProperty(c)&&"$$hashKey"!==c&&(b[c]=h[c])}),a):a}).then(function(a){return d.loadTab(g.currentTab).then(function(){return a})})}return this.saveCurrentItem(c,!0)},saveCurrentItem:function(b,c){var d=this,f=t.getCrudContext(),g=f.currentApplicationName,h=f.currentDetailItem,i=h.datamap,j=this.currentDetailSchema(),k=C.dispatch("offline.presave",j,{schema:j,datamap:i});return a.when(k).then(function(){var a=f.currentApplication.data.title||g;return l.saveItem(g,h,a,b)}).then(function(a){if(g=a.application,n.insertIntoContext("crudcontext",f),!f.newItem)return d.refreshIfLeftJoinPresent(f,a);if(w.updateAppsCount(),f.newItem=!1,!c)return G(a,f);var b=t.currentListSchema(),h=A.buildJoinParameters(b),i="`root`.application = '{0}' and `root`.id = '{1}'".format(g,a.newId);return e.findByQuery("DataEntry",i,h).then(function(a){var b=a[0];return f.currentDetailItem=b,G(b,f)})})},refreshIfLeftJoinPresent:function(a,b){var c=this.itemlist(),d=a.currentDetailItem;if(c.length>0){var e=c.some(function(a){return a.id===d.id&&a.generatedRowStamp!==d.generatedRowStamp});if(e)return this.refreshGrid(!0).then(function(){return b})}return b},restoreItemToOriginalState:function(a){var b=t.getCrudContext(),c=b.currentApplicationName,d=function(){var b=a.originaldatamap.attachment_||[],c=a.datamap.attachment_||[];if(c.length<=0)return[];var d=c.map(function(a){return a["#offlinehash"]}),e=b.map(function(a){return a["#offlinehash"]}),f=_.difference(d,e);return c.filter(function(a){return _.contains(f,a["#offlinehash"])})}(),f=a.hasProblem;a.isDirty=!1,a.hasProblem=!1;var h=e.executeStatement(z.DataEntry.restoreToOriginalStateStatement,[a.id,c]);return f&&(a.hasProblem=!1,h=h.then(function(){return g.deleteRelatedProblems(a.id)})),d.length>0&&(h=h.then(function(){return y.deleteRelatedAttachments(d)})),h},deleteLocalItem:function(a){var b=t.getCrudContext(),c=b.currentApplicationName,d=a.datamap.attachment_||[],f=e.executeStatement(z.DataEntry.deleteLocalStatement,[a.id,c]).then(function(a){return w.updateAppsCount(),a});return d.length>0?f.then(function(){return y.deleteRelatedAttachments(d)}):f},refreshGrid:function(c){var d=b.get("crudContextService#refreshGrid",["list","crud"]),e=t.getCrudContext();return e.itemlist=[],E.lastPageLoaded=1,E.pageNumber=1,this.loadMorePromise().then(function(){return c?a.when():(d.debug("application grid refreshed"),n.insertIntoContext("crudcontext",e),o.go("main.crudlist"))})},loadMorePromise:function(){q.initGridSearch();var b=t.getCrudContext(),c=t.getGridSearchData(),d=t.getQuickSearch(),g=t.currentListSchema(),h=t.currentApplicationName(),i="1=1";d.value&&(i+=" and `root`.datamap like '%:\"{0}%'".format(d.value)),i+=f.buildSearchQuery(h,g,c);var j=w.buildListQuery(b.currentApplicationName,b.currentMenuId,i),k=A.buildJoinParameters(g);if(1===E.lastPageLoaded){var l=j;e.countByQuery("DataEntry",l,k).then(function(a){c.count=a})}j+=f.buildSortQuery(h,g,c);var m=angular.extend({pagesize:10,pageNumber:E.lastPageLoaded},k);return e.findByQuery("DataEntry",j,m).then(function(c){E.lastPageLoaded=E.lastPageLoaded+1;for(var d=0;d<c.length;d++)b.itemlist.push(c[d]);return a.when(c)})},loadApplicationGrid:function(a,c,d,e){var f=b.get("crudContextService#loadApplicationGrid",["list","crud"]);f.debug("loading application grid"),F!==a&&t.clearGridSearch(),F=a;var g=t.getCrudContext();g.currentDetailItem=null,g.composition={};var j=h.getApplicationByName(a);return g.currentTitle=j.data.title,g.currentApplicationName=a,g.currentApplication=j,g.newItem=!1,d&&(g.currentMenuId=d,g.menuGridTitle=e&&e.offlinegridtitle,g.menuDisableCreate=e&&"true"===e.offlineDisableCreate),g.readonly="true"===j.data.properties["mobile.application.readonly"],g.currentListSchema=i.locateSchema(j,c),g.currentDetailSchema=i.loadDetailSchema(g.currentListSchema,g.currentApplication),g.currentNewDetailSchema=i.locateSchemaByStereotype(g.currentApplication,"detailnew"),null==g.currentNewDetailSchema&&m.isPropertyTrue(g.currentDetailSchema,"mobile.actasnewschema")&&(g.currentNewDetailSchema=g.currentDetailSchema),this.refreshGrid()},hasNewSchemaAvailable:function(){var a=t.getCrudContext(),b=a.currentNewDetailSchema;return!!b},navigatePrevious:function(){var a=t.getCrudContext();return a.previousItem?this.loadDetail(a.previousItem):o.go("main.crudlist")},navigateNext:function(){var b=this,c=t.getCrudContext();return c.nextItem?this.loadDetail(c.nextItem):this.loadMorePromise().then(function(d){return!d||d.length<=0?a.when():(t.setPreviousAndNextItems(c.currentDetailItem),c.nextItem?b.loadDetail(c.nextItem):a.when())})},isCreation:function(){var a=this.getCrudContext();return!a.originalDetailItemDatamap||a.originalDetailItemDatamap["_newitem#$"]},gridTitle:function(a){return a&&a.title?a.title:this.currentTitle()},createDetail:function(){var a=t.getCrudContext();return a.wizardStateIndex=0,a.currentDetailItem={datamap:{}},a.newItem=!0,i.fillDefaultValues(this.currentDetailSchema(),a.currentDetailItem.datamap),a.originalDetailItemDatamap={"_newitem#$":!0},o.go("main.cruddetail.maininput")},loadDetailByMaximoUid:function(a,b,c){var d=this;v.loadItemByMaximoUid(a,b,c).then(function(a){return d.loadDetail(a)})},loadDetail:function(a){var e=this;return d.clearCache().then(function(){var d=b.get("crudContextService#loadDetail",["crud","detail"]);d.debug("load detail init");var f=t.getCrudContext();if(!f.readonly){x.showDefault(),f.currentDetailSchema||(f.currentDetailSchema=i.loadDetailSchema(f.currentListSchema,f.currentApplication,a));var h=e.mainDisplayables();return u.enforceNumericType(a.datamap,h),f.currentDetailItem=a,C.onload({},f.currentDetailSchema,f.currentDetailItem.datamap,{}),f.originalDetailItemDatamap=angular.copy(f.currentDetailItem.datamap),t.setPreviousAndNextItems(a),isRippleEmulator()&&n.insertIntoContext("crudcontext",f),d.debug("loading problems"),g.getProblems(a.id).then(function(a){return d.debug("problems loaded done"),f.currentProblems=a,f.composition.currentTab?void e.loadTab(f.composition.currentTab):o.go("main.cruddetail.maininput")}).then(function(){d.debug("crud detail finished loading"),c.$broadcast("sw_cruddetailrefreshed"),x.hide()})}})}}}])}(mobileServices,angular,constants,_),function(a){a.factory("crudFilterContextService",["$q","$log","contextService",function(a,b,c){var d={showPending:!1,showDirty:!0,showProblems:!1};return{showPending:function(a){return void 0!=a&&(d.showPending=a,c.insertIntoContext("filterContext",d)),d.showPending},showProblems:function(a){return void 0!=a&&(d.showProblem=a,c.insertIntoContext("filterContext",d)),d.showProblem},showDirty:function(a){return void 0!=a&&(d.showDirty=a,c.insertIntoContext("filterContext",d)),d.showDirty}}}])}(mobileServices),function(a){var b=function(){function a(b,c,d,e){_classCallCheck(this,a),this.crudContextHolderService=b,this.dispatcherService=c,this.offlineAssociationService=d,this.fieldService=e;var f="android-arrow-up",g="android-arrow-down";this.getOptionLabels=function(a,b){if(!b||!a)return null;var c=[],d=b.split(";");return angular.forEach(d,function(b){angular.forEach(a,function(a){a.value===b&&c.push(a.label)})}),c.join(" & ")},this.sortKey=function(a,b){return a+"."+(b?"asc":"desc")},this.searchOptionChangedFunction=function(a,b){var c=this;return b?function(d){var e=c.crudContextHolderService.getGridSearchData(),f=e.searchValues[a];f&&(f.value=d,f.label=c.getOptionLabels(b,d))}:null},this.createSearchable=function(a,b,c){var d=c.displayables,e={};angular.forEach(d,function(a){a.attribute===b.attribute&&(e=a)});var f={label:b.label,value:b.attribute,type:b.type,dataType:e.dataType};if(a[b.attribute]=f,"MetadataOptionFilter"===b.type){if(f.whereClause=b.whereClause,!b.provider)return f.options=b.options,f.options&&angular.forEach(f.options,function(a){a.text=a.label||a.value}),void(f.optionChanged=this.searchOptionChangedFunction(b.attribute,f.options));if(f.options=[],f.optionChanged=this.searchOptionChangedFunction(b.attribute,f.options),b.provider.startsWith("@")){var g,h=b.provider.substring(1),i=this.dispatcherService.invokeServiceByString(h);return void(g=f.options).push.apply(g,_toConsumableArray(i))}var j=this.crudContextHolderService.currentDetailSchema(),k=b.provider.split("."),l=k[0],m=this.fieldService.getDisplayablesByAssociationKey(j,l);if(m&&0!==m.length){var n=k[1],o=m[0];this.offlineAssociationService.filterPromise(j,{},l,null,o).then(function(a){angular.forEach(a,function(a){var b={label:a.datamap[n],value:a.datamap[o.valueField]};b.text=b.label||b.value,f.options.push(b)})})}}},this.createSortable=function(a,b){return{label:a.label,value:this.sortKey(a.attribute,b),attribute:a.attribute,afterLabelIcon:b?f:g,direction:b?"asc":"desc"}},this.setPreSelectedValue=function(a,b){if("MetadataOptionFilter"===b.type){var c=a.searchFields[b.attribute];if(c){if(b.preselected)return void c.optionChanged(b.preselected);var d=[];angular.forEach(c.options,function(a){a.preSelected&&d.push(a.value)}),d.length>0&&c.optionChanged(d.join(";"))}}},this.setPreSelectedValues=function(){var a=this,b=this.crudContextHolderService.getGridSearchData(),c=this.crudContextHolderService.currentListSchema(),d=c.schemaFilters;d&&d.filters&&angular.forEach(d.filters,function(c){a.setPreSelectedValue(b,c)})}}return _createClass(a,[{key:"initGridSearch",value:function(){var a=this,b=this.crudContextHolderService.getGridSearchData(),c=b.searchFields;if(Object.keys(c).length>1)return b;var d=this.crudContextHolderService.currentListSchema(),e=d.schemaFilters;return e&&e.filters?(angular.forEach(e.filters,function(c){b.searchValues[c.attribute]||(b.searchValues[c.attribute]={}),a.createSearchable(b.searchFields,c,d),a.setPreSelectedValue(b,c);var e=a.createSortable(c,!0);b.sortables[e.value]=e,b.sortableFields.push(e);var f=a.createSortable(c,!1);b.sortables[f.value]=f,b.sortableFields.push(f)}),b):b}},{key:"clearGridSearchValues",value:function(){this.crudContextHolderService.clearGridSearchValues(),this.setPreSelectedValues()}}]),a}();b.$inject=["crudContextHolderService","dispatcherService","offlineAssociationService","fieldService"],a.service("crudSearchService",b)}(mobileServices),!function(angular){function a(a,b,c,d,e,f){var g="location",h="asset",i=!0;e.getAppConfig().then(function(a){var b=a.server.client;"firstsolar"===b&&(g="offlinelocation",h="offlineasset",i=!1)});var j=function(){return c.getCrudContext().drillDown},k=function(){var a=c.getCrudContext().drillDown;return a.selectedLocation?a.selectedLocation.datamap.location:null},l=function(a,b){var c=k();if(c)return" ("+a+c+b+") ";var e=d.currentFullUser().SiteId,f="PM"+e;return" ("+a+e+b+" OR "+a+f+b+" OR "+a+"140"+b+" OR "+a+"180"+b+") "},m=function(a){return a.page++,a.moreItemsAvailable=!1,{pagesize:20,pageNumber:a.page}},n=function(a,b){a.moreItemsAvailable=20===b.length},o=function(a,b){return a.locationQuery?" and "+(b?"`"+b+"`.":"")+"datamap like '%"+a.locationQuery+"%'":""},p=function(){var a=j();if(a.locationQuery){var b=i?" (1=1) ":l("`root`.textindex04 like '%/","/%'");return" `root`.application = '"+g+"' and "+b+" "+o(a,"root")+" order by `root`.textindex01"}var c=i?" (1=1) ":l('`root`.datamap like \'%"parent":"',"\"%'");return" `root`.application = '"+g+"' and "+c+" order by `root`.textindex01"},q=function(a){return a.assetQuery?" and `root`.datamap like '%"+a.assetQuery+"%'":""},r=function(a){var b=j(),c=a?" order by `root`.textindex02 ":"",d=k();if(i&&!d)return" `root`.application = '"+h+"' "+q(b)+" "+c+" ";var e=l("`root`.textindex01 = '","'");if(i)return" `root`.application = '"+h+"' "+q(b)+" and "+e+" "+c+" ";var f=l("textindex04 like '%/","/%'");return" `root`.application = '"+h+"' "+q(b)+" and ("+e+" or `root`.textindex01 in (select textindex01 from AssociationData where application = '"+g+"' and "+f+")) "+c+" "},s=function(){c.drillDownClear()},t=function(){return c.isOnDrillDown()},u=function(){return j()},v=function(){f.showDefault();var c=j();c.page=0;var d=[],e=k();if(i&&e?d.push(a.when([])):d.push(b.findByQuery("AssociationData",p(),m(c))),i&&e)d.push(a.when(0));else if(i)d.push(b.countByQuery("AssociationData"," `root`.application = '"+g+"' "+o(c,"root")));else{var q=l("`root`.textindex04 like '%/","/%'");d.push(b.countByQuery("AssociationData"," `root`.application = '"+g+"' and "+q+" "+o(c,"root")))}if(i&&!e)d.push(b.countByQuery("AssociationData"," `root`.application = '"+h+"'"));else{var r=l("`root`.textindex01 = '","'"),s=l("textindex04 like '%/","/%'");d.push(b.countByQuery("AssociationData"," `root`.application = '"+h+"' and ("+r+" or `root`.textindex01 in (select textindex01 from AssociationData where application = '"+g+"' and "+s+"))"))}return a.all(d).then(function(a){return n(c,a[0]),c.locations=a[0],c.locationsCount=a[1],c.assetsCount=a[2],f.hide(),c.locations})},w=function(a){var b=j();return b.locationHistory.push({location:b.selectedLocation,query:b.locationQuery}),b.selectedLocation=a,b.locationQuery=void 0,this.updateDrillDownLocations()},x=function(){var a=j();if(a.assetView)return a.assetView=!1,!0;if(0===a.locationHistory.length)return!1;var b=a.locationHistory.pop();return a.selectedLocation=b.location,a.locationQuery=b.query,this.updateDrillDownLocations(),!0},y=function(){f.showDefault();var c=j();c.page=0;var d=[];return d.push(b.findByQuery("AssociationData",r(!0),m(c))),d.push(b.countByQuery("AssociationData",r())),a.all(d).then(function(a){return n(c,a[0]),c.assets=a[0],c.assetsCount=a[1],f.hide(),c.assets})},z=function(){var a=j();return a.assetView=!0,a.assetQuery=void 0,this.updateDrillDownAssets()},A=function(a){return b.findByQuery("AssociationData"," `root`.application = '"+h+"' and `root`.textindex02 = '"+a+"'").then(function(a){return a[0]})},B=function(){var a=j();a.assetView?b.findByQuery("AssociationData",r(!0),m(a)).then(function(b){n(a,b),a.assets=a.assets.concat(b)}):b.findByQuery("AssociationData",p(),m(a)).then(function(b){n(a,b),a.locations=a.locations.concat(b)})},C={drillDownClear:s,isOnDrillDown:t,getDrillDown:u,updateDrillDownLocations:v,locationDrillDownClick:w,drillDownBack:x,updateDrillDownAssets:y,assetView:z,findAsset:A,loadMore:B};return C}mobileServices.factory("drillDownService",["$q","swdbDAO","crudContextHolderService","securityService","applicationStateService","loadingService",a])}(angular),function(a){var b="sw:inline:compositions:resolved",c=function(){function a(b,c,d,e){_classCallCheck(this,a),this.$rootScope=b,this.$q=c,this.offlineCompositionService=d,this.crudContextHolderService=e,this.arrayToObj=function(a){var b={};return angular.forEach(a,function(a,c){b[c]=a}),b},this.objToArray=function(a){var b=[];return angular.forEach(a,function(a){b.push(a)}),b}}return _createClass(a,[{key:"loadInlineCompositions",value:function(a,c,d){var e=this,f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"main",g=[];return angular.forEach(d,function(b){if("ApplicationCompositionDefinition"===b.type&&b.inline&&!(b.relationship in c)){var d=e.offlineCompositionService.loadCompositionList(a,b);g.push(d),c[b.relationship]=[],d.then(function(a){c[b.relationship]=e.arrayToObj(a)})}}),this.$q.all(g).then(function(){var a=e.crudContextHolderService.getCrudContext();return a.originalDetailItemDatamap=angular.copy(c),angular.forEach(d,function(b){"ApplicationCompositionDefinition"===b.type&&b.inline&&c[b.relationship]&&"object"===_typeof(c[b.relationship])&&(c[b.relationship]=e.objToArray(c[b.relationship]),a.originalDetailItemDatamap[b.relationship]=e.objToArray(a.originalDetailItemDatamap[b.relationship]))}),e.$rootScope.$broadcast(b,f)})}},{key:"cancelChanges",value:function(){this.$rootScope.$broadcast(b)}},{key:"compositionLoadedEventName",value:function(){return b}}]),a}();c.$inject=["$rootScope","$q","offlineCompositionService","crudContextHolderService"],a.service("inlineCompositionService",c)}(mobileServices),function(angular){function a(a,b,c){function d(){return f.messages}var e=c.getInstance("sw4.notificationViewModel"),f={messages:[]};return{createNotification:function(c,d,g,h,i,j){var k={};if(k.type=c,k.title=d,k.body=g,k.display=!0,h||i||j){var l={};l.type=h,l.outline=i,l.stack=j,k.exception=l}k.body&&(e.debug("createNotification",k),b(function(){f.messages.push(k)}),"success"!==k.type||k.exception||b(function(){k.display=!1},a.retrieveFromContext("successMessageTimeOut")))},getMoreInfo:function(a){var b=a.exception;return b.title=a.body,b.text="Error description:\n\nType: \n{0}\n\nMessage: \n{1}\n\nOutline:\n{2}\n\nStackTrace:\n{3}\n\n".format(b.type,b.title,b.outline,b.stack),b},removeNotification:function(a){e.debug("removeMessage",a),a.display=!1},messages:d()}}angular.module("sw_mobile_services").factory("notificationViewModel",["contextService","$timeout","$log",a])}(angular),!function(angular){function a(a,b,c,d){function e(c,d){if(0===d.length)return a.when(null);var e=d.map(function(a){return"id='"+a+"' or "}).join("");e=e.substring(0,e.lastIndexOf(" or "));var f="update DataEntry set hasProblem="+(c?1:0)+" where ("+e+")";return b.executeQuery(f)}function f(b){return b&&b.hasProblem?a.reject("It was not possible to sync."):a.when(null)}function g(a,b){var c=b.problem?a.problematicIds:a.okIds,e=b.dataentry.id;a.quickSyncItem&&a.quickSyncItem.id===e&&(a.quickSyncItem.hasProblem=!!b.problem,d.updateCurrentProblem(b.problem)),c.push(e)}function h(b,c){var d=a.defer();return persistence.transaction(function(a){c.items.list(a,function(a){angular.forEach(a,function(a){g(b,a)}),d.resolve()})}),d.promise}function i(b,c){if(!b||0===b.length)return a.when(b);var d={okIds:[],problematicIds:[],quickSyncItem:c},g=[];return angular.forEach(b,function(b){var c=a.defer();g.push(c.promise);try{h(d,b).then(function(){return c.resolve()})}catch(e){c.reject(e)}}),a.all(g).then(function(){return e(!1,d.okIds)}).then(function(){return e(!0,d.problematicIds)}).then(function(){return f(c)}).then(function(){return b})}function j(a){return b.executeQuery({query:c.DataEntry.findProblems,args:[a]})}function k(a){return j(a).then(function(a){return b.executeQuery("delete from Problem where id in ("+a.map(function(a){return"'"+a.id+"'"})+")")})}var l={updateHasProblemToDataEntries:i,getProblems:j,deleteRelatedProblems:k};return l}mobileServices.factory("problemService",["$q","swdbDAO","offlineEntities","crudContextHolderService",a])}(angular),!function(angular){function a(a,b){var c={},d=["asc","desc","is","null"],e=new Map,f=function(a){return a<=99?("0"+a).slice(-2):a},g=function(a,b,c){angular.forEach(b,function(b,d){var e=b.trim();e&&(a[e]="`root`."+c+f(d+1))})},h=function(a){var b={};if(!a||!a.properties)return b;var c=a.properties["list.offline.text.indexlist"];c&&g(b,c.split(","),"textindex");var d=a.properties["list.offline.numeric.indexlist"];d&&g(b,d.split(","),"numericindex");var e=a.properties["list.offline.date.indexlist"];return e&&g(b,e.split(","),"dateindex"),b},i=function(a,b,c){var f=c.split(/[\s]+/),g=[];return angular.forEach(f,function(c){var f=c.trim();if(f){if(d.indexOf(f)>=0)return void g.push(f);var h=e.get(a);h||(h=new Set,e.set(a,h)),h.add(f);var i=l(a,b,f);g.push(i||f)}}),g.join(" ")},j=function(b,c,d,e,f){var g=l(b,c,f);if(!g)return"";var h=d.searchFields[f];if(!h)return"";if("MetadataDateTimeFilter"===h.type||"date"===h.dataType){if(!e.startUTC&&!e.endUTC)return"";var i="";return e.startUTC&&(i+=" and "+g+" >= "+e.startUTC.getTime()+" "),e.endUTC&&(i+=" and "+g+" <= "+e.endUTC.getTime()+" "),i}if("MetadataOptionFilter"===h.type){if(!e.value||!e.value.trim())return"";var j=e.value.split(";"),k=[];return angular.forEach(j,function(b){var c=b.trim();if(c){if(!h.whereClause)return void k.push(g+" = '"+b+"'");if(h.whereClause.startsWith("@")){var d=h.whereClause.substring(1);k.push(a.invokeServiceByString(d,[b]))}}})," and ("+k.join(" or ")+") "}return e.value&&e.value.trim()?" and "+g+" like '%"+e.value+"%' ":""},k=function(a,b,c,d){var e={t1:null,t2:null,t3:null,t4:null,t5:null,n1:null,n2:null,d1:null,d2:null,d3:null};return a&&angular.forEach(a,function(a,b){e["t"+(b+1)]=d[a]||null}),b&&angular.forEach(b,function(a,b){e["n"+(b+1)]=d[a]||null}),c&&angular.forEach(c,function(a,b){var c,f=d[a];c=f?new Date(f).getTime():null,e["d"+(b+1)]=c}),e},l=function(a,d,e){if(c[a]||(c[a]=h(d)),!e)return c[a];if(e.startsWith("#")&&e.contains(".")){var f=b.findRelatedEntityName(e),g=f.entityName,i=b.locateRelatedListSchema(d,g),j=i.applicationName;return c[j]||(c[j]=h(i)),c[j][f.attribute].replace("`root`","`"+g+"`")}return c[a][e]},m=function(a,b,c){if(!c)return"";var d=c.split(","),e=[];return angular.forEach(d,function(c){c&&e.push(i(a,b,c))}),e.join(", ")},n=function(a,b,c){if(!c.searchValues)return"";var d=" ";return angular.forEach(c.searchValues,function(e,f){c.searchValues.hasOwnProperty(f)&&(d+=j(a,b,c,e,f)+" ")}),d},o=function(a,b,c){if(c.sort&&c.sort.attribute&&b){var d=l(a,b,c.sort.attribute);if(d){var e=c.sort.direction;return d.startsWith("text")?" order by `root`.isDirty desc, "+d+" is null "+e+", lower("+d+") "+e+" ":" order by `root`.isDirty desc, "+d+" is null "+e+", "+d+" "+e+" "}}if(b&&b.properties){var f=b.properties["list.defaultorderby"];if(f){var g=m(a,b,f);return" order by `root`.isDirty desc, "+g}}return" order by `root`.isDirty desc, `root`.rowstamp is null desc, `root`.rowstamp desc "},p=function(a,b,c){return angular.forEach(c,function(c){var d=c.substring(1),e=b[d]||"";a=a.replace(new RegExp(c,"g"),"'"+e+"'")}),a},q=function(a,b){for(var c=/@[\w]+/g,d=c.exec(a);d;)a=p(a,b,d),d=c.exec(a);return a},r=function(){e.clear(),c={}},s=function(a){var b=e.get(a);return b?Array.from(b):[]},t={buildIndexes:k,getIndexColumn:l,buildDefaultOrderBy:m,buildSearchQuery:n,buildSortQuery:o,getSearchColumnsByApp:s,parseWhereClause:q,refreshIndexCaches:r};return t}mobileServices.factory("searchIndexService",["dispatcherService","offlineSchemaService",a])}(angular),!function(angular){function a(a,b){var c={SHOW:"show",HIDE:"hide",READ_ONLY:"readonly"},d=[];angular.forEach(c,function(a){d.push(a)});var e={},f=function(a){var b=a.rendererParameters.wizardBehavior;return!b||d.indexOf(b.toLowerCase())<0?c.HIDE:b.toLowerCase()},g=function(a,b){var c={states:[],allWizardFields:{}};if(e[a]=c,!b)return c;angular.forEach(b,function(a){if(a.attribute){var b=a.rendererParameters;if(b){var d=b.wizard;if(!nullOrUndef(d)){var e=Number(d);if(!isNaN(e)){var g=c.states[e];g||(g={fields:{}},c.states[e]=g);var h={attribute:a.attribute,behavior:f(a)};g.fields[a.attribute]=h,c.allWizardFields[a.attribute]=h}}}}});var d=[];return angular.forEach(c.states,function(a,b){c.states[b]&&d.push(a)}),c.states=d,c},h=function(a,b){var c=e[a];return c?c:c=g(a,b)},i=function(c){if(!b.isCreation())return null;var d=a.currentApplicationName();return h(d,c)},j=function(a,b){var d=h(a,b);if(0===d.states.length)return b;var e=d.allWizardFields,f=[];return angular.forEach(b,function(a){if(!a.attribute)return void f.push(a);var b=e[a.attribute];b&&b.behavior===c.HIDE||f.push(a)}),f},k=function(c,d){if(!b.isCreation()||!c)return c;var e=a.currentApplicationName(),f=h(e,c),g=f.states[d];if(!g)return j(e,c);var i=[];return angular.forEach(c,function(a){a&&a.attribute&&g.fields[a.attribute]&&i.push(a)}),i},l=function(a){var c=b.getCrudContext();return k(a,c.wizardStateIndex)},m=function(a){var c=b.getCrudContext();return c.wizardStateIndex++,k(a,c.wizardStateIndex)},n=function(a){var c=b.getCrudContext();return c.wizardStateIndex--,c.wizardStateIndex<0&&(c.wizardStateIndex=0),k(a,c.wizardStateIndex)},o=function(a){var c=i(a);if(!c)return null;var d=b.getCrudContext();return c.states[d.wizardStateIndex]},p=function(a){return!!o(a)},q=function(){if(!b.isCreation())return!1;var a=b.getCrudContext();return a.wizardStateIndex>0},r=function(a,d){if(!a.attribute)return!1;var e=i(d);if(!e)return!1;var f=b.getCrudContext(),g=e.states[f.wizardStateIndex];if(g)return!1;var h=e.allWizardFields[a.attribute];return h&&h.behavior===c.READ_ONLY},s={getWizardFields:l,isInWizardState:p,canReturn:q,next:m,previous:n,isReadOnly:r};return s}mobileServices.factory("wizardService",["crudContextHolderService","crudContextService",a])}(angular),function(a,angular){function b(){function a(a,b){a&&b&&angular.forEach(b,function(b){"numericinput"===b.rendererType&&"double"!==b.rendererParameters.numberType&&"float"!==b.rendererParameters.numberType&&a[b.attribute]&&(a[b.attribute]=parseInt(a[b.attribute]))})}function b(a){if(!a)return a;var b=angular.isString(a)?angular.copy(a):JSON.stringify(a);return c.forEach(function(a){b=a(b)}),b}var c=[function(a){return replaceAll(a,"'","\\'")}],d={sanitize:b,enforceNumericType:a};return d}a.factory("datamapSanitizationService",b)}(mobileServices,angular),function(angular){function a(a,b,c,d,e,f,g){function h(){var a=d.currentDetailItem();return!!a&&a.isDirty&&!d.hasDirtyChanges()}function i(){var a=d.currentDetailItem();if(!a)return!1;var b=a.remoteId&&a.isDirty&&!!a.originaldatamap,c=!a.remoteId;return!a.pending&&(b||c)&&!d.hasDirtyChanges()}function j(){var a=d.currentDetailItem();return c.syncItem(a).then(function(){return d.refreshGrid()}).then(function(){return e.alert({title:"Quick Sync",template:g.buildCenteredTemplate("Sync Successful")})})["catch"](function(a){return e.alert({title:"Quick Sync",template:g.buildCenteredTemplate(a.message||"An error happened during sync")})})}function k(c){var g=c.remoteId&&c.isDirty&&!!c.originaldatamap,h=!c.remoteId;if(c.pending||!g&&!h)return a.when(!1);var i=d.currentTitle(),j=g?{title:"Cancel Changes",template:"Are you sure you want to cancel changes made to this "+i}:{title:"Delete "+i,template:"Are you sure you want to delete this "+i+" created locally"};return e.confirm(j).then(function(a){if(!a)return!1;f.clearLaborCacheIfCurrentParent(c);var h=g?d.restoreItemToOriginalState(c):d.deleteLocalItem(c);return h.then(function(){return e.alert({title:i+" was successfuly "+(g?"restored":"deleted")})}).then(function(){return b.$broadcast("sw_itemrestored",c)}).then(function(){return!0})})}function l(){var a=d.currentDetailItem();return k(a).then(function(a){return a?d.refreshGrid():null})}var m={quickSyncCurrentItem:j,deleteOrRestoreCurrentItem:l,deleteOrRestoreItem:k,shouldAllowQuickSyncForCurrentItem:h,shouldAllowDeleteOrRestoreForCurrentItem:i};return m}angular.module("sw_mobile_services").factory("itemActionService",["$q","$rootScope","synchronizationFacade","crudContextService","$ionicPopup","laborService","alertService",a])}(angular),function(angular){var a=function(){function a(){_classCallCheck(this,a)}return _createClass(a,[{key:"getIconClass",value:function(a){return a.datamap["#runninglabor"]?"hasaction":null!=a.datamap.labtransid?null:"isdirty"}},{key:"getIconIcon",value:function(a){return a.datamap["#runninglabor"]?"clock-o":null!=a.datamap.labtransid?"check":"refresh"}},{key:"getIconColor",value:function(a){return null!=a.datamap.labtransid?"#39b54a":"refresh"}},{key:"getIconText",value:function(a){return""}},{key:"getTextColor",value:function(a){return null!=a.datamap.labtransid?"white":null}}]),a}();a.$inject=[],angular.module("sw_mobile_services").service("laborTimeSheetIconProvider",a)}(angular),function(angular,_){function a(a,b,c,d,e,f,g,h,i,j,k,l){function m(b,c){return M=b,N=c,a.instantiate("ActiveLaborTracker",{parentid:M,laborlocalid:c[constants.localIdKey]}).then(function(b){return a.save(b)})}function n(){return a.executeQuery("delete from ActiveLaborTracker").then(function(){M=null,N=null})}function o(a,b){var c=a?parseFloat(a):0,d=b?parseFloat(b):0,e=c*d;return _.isNaN(e)?0:L(e)}function p(){var a=d.currentDetailItem();return!!(a&&a.id&&Q())&&a.id===P()}function q(c,d){var g=b.currentFullUser();return a.findSingleByQuery("AssociationData","application = 'labor' and datamap like '%\"personid\":\""+g.PersonId+"\"%'").then(function(b){if(!b)return f.reject(new Error("There is no labor registered for the current user with personid '"+g.PersonId+"'"));var d=b.datamap;return c.laborcode=d.laborcode,c["labor_.worksite"]=d.worksite,c["labor_.orgid"]=d.orgid,a.findSingleByQuery("AssociationData","application = 'laborcraftrate' and datamap like '%\"laborcode\":\""+d.laborcode+"\"%'")}).then(function(a){if(!a)return f.reject(new Error("There is no laborcraftrate registered for the labor '"+c.laborcode+"'"));var b=a.datamap;c.craft=b.craft;var e=b.rate;return c.payrate=e,angular.isNumber(d)&&d>=0&&(c.regularhrs=d),c.linecost=o(c.regularhrs,e),c})["catch"](function(a){return e.alert({title:"Labor Reporting Error",template:a.message}).then(function(){return f.reject(a)})})}function r(a,b,c,e,f,g){var h=d.currentApplicationName(),j=S();return i.addAndSaveComposition(h,a,b,j,e,f).then(function(a){var e=d.getCrudContext();if(c);else{var f=e.itemlist.findIndex(function(b){return b.id===a.id});f>=0&&(e.itemlist[f]=a)}return b}).then(T(b,a.datamap,g))}function s(){var a=d.currentDetailItem(),b=R(),c={"_newitem#$":!0};return h.fillDefaultValues(b,c,a.datamap),q(c,0).then(function(b){return r(a,b,!0,"Labor Timer Started",!1,!0)}).then(function(b){return m(a.id,b).then(function(){
return k.updateAppsCount(),j.$broadcast("sw.labor.start"),b})})}function t(a,b){var c=O(),e=new Date(c.startdate),f=((new Date).getTime()-e.getTime())/36e5,g=L(f);c.regularhrs=0===g?.01:g,c.linecost=o(g,c.payrate);var h=!a,i=a||d.currentDetailItem();return r(i,c,h,"Labor Timer Stopped",b,!1).then(function(){return n().then(function(){return j.$broadcast("sw.labor.stop"),c})})}function u(){return!p()}function v(){return p()}function w(){return d.addCompositionAllowed()&&u()}function x(){return d.addCompositionAllowed()&&v()}function y(a){return e.confirm({title:"Labor Reporting",template:"There's a labor timer started. Would you like to stop it in order to start a new one?"}).then(function(b){return b?t(a).then(function(){return s()}):null})}function z(b,c){if(!u())throw new Error("IllegalStateError: there's already an active labor transaction for the current item");if(!Q())return s();var d=P();return a.findById("DataEntry",d).then(function(a){return a?y(a):(g.get("laborService#saveLabor").warn("Parent labor not found! This is the case when a labor timer is started and for some reason the parent of the labor is not on db anymore."),n().then(function(){return s()}))})}function A(a,b){if(!v())throw new Error("IllegalStateError: there's no active labor transaction for the current item");return e.confirm({title:"Active Labor Report",template:"Are you sure you want to stop the labor timer?"}).then(function(a){return a?t():null})}function B(b){if(b&&!v()||!b&&!Q())throw new Error("IllegalStateError: there's no active labor transaction");var c=b?f.when(b):a.findById("DataEntry",P());return c.then(function(a){return e.confirm({title:"Labor Report",template:"You must stop the labor timer before synchronization. Do you want to stop it and proceed with the synchronization?"}).then(function(b){return!!b&&t(a,!1)})})}function C(a,b){A(a,b).then(function(a){a&&j.$broadcast("sw_updatecommandbar","mobile.composition")})}function D(a,b,c){var d=c.regularhrs;angular.isNumber(d)&&!Number.isInteger(d)&&(c.regularhrs=L(d)),c.labtransid||q(c)}function E(a){var b=a.datamap;b.linecost=o(b.regularhrs,b.payrate)}function F(a){var b=a.value;if(!b)return b;var c=Math.trunc(b),d=Math.round(60*b%60);if(0===c&&0===d){var e=Math.round(3600*b%3600);return c+"h "+d+"m "+e+"s"}return c+"h "+d+"m"}function G(a){var b=a.value;if(!b)return b;var c=_.contains([!0,"true","True",1,"1","yes","Yes"],b);return c?"Yes":"No"}function H(a){a.id===P()&&n()}function I(a,b){var c=O();return c&&a["#localswdbid"]===c["#localswdbid"]?e.confirm({title:"Delete Labor",template:"The labor you are trying to delete has a timer. Are you sure you wish to cancel the timer and delete it?"}):b()}function J(a,b,c){var d=O();return d&&a["#localswdbid"]===d["#localswdbid"]?(n(),b):c()}function K(a){if(!a)return!1;var b=O();return!a.application&&b?b["#localswdbid"]===a["#localswdbid"]:P()===a.id}var L=function(a){return parseFloat(a.toFixed(2))},M=null,N=null;a.findUnique("ActiveLaborTracker").then(function(b){b&&(M=b.parentid,a.findById("DataEntry",M).then(function(a){if(a&&a.datamap&&a.datamap.labtrans_){var c=a.datamap.labtrans_;angular.forEach(c,function(a){a[constants.localIdKey]===b.laborlocalid&&(N=a)})}}))});var O=function(){return N},P=function(){return M},Q=function(){return!!O()},R=function(){return d.currentCompositionSchemaById("labtrans","detail")},S=function(){return d.currentCompositionTabByName("labtrans")},T=function(a,b){var c=arguments.length>2&&void 0!==arguments[2]&&arguments[2];a.refwo=b.wonum,a.wodescription=b.description,l.insertTsLaborDataEntry(a,c)},U={onDetailLoad:D,shouldAllowLaborStart:u,shouldAllowLaborFinish:v,showLaborCreationCommand:w,showLaborFinishCommand:x,startLaborTransaction:z,finishLaborTransaction:A,finishLaborBeforeSynch:B,finishLaborTransactionFromComposition:C,updateLineCost:E,formatRegularHours:F,formatApproved:G,getActiveLaborParent:P,getActiveLabor:O,confirmPossibleTimer:I,cancelPossibleTimer:J,hasActiveLabor:Q,hasItemActiveLabor:K,clearLaborCacheIfCurrentParent:H};return U}angular.module("sw_mobile_services").factory("laborService",["swdbDAO","securityService","localStorageService","crudContextService","$ionicPopup","$q","$log","offlineSchemaService","offlineSaveService","$rootScope","menuModelService","fsLaborOfflineService",a])}(angular,_),function(angular){function a(a){function b(b){return a.hasItemActiveLabor(b)?"hasaction":null}function c(b){return a.hasItemActiveLabor(b)?"clock-o":null}var d={getIconClass:b,getIconIcon:c};return d}angular.module("sw_mobile_services").factory("laborTimerIconProvider",["laborService",a])}(angular),function(angular,_){function a(a){function b(a){var b=a.datamap,c=b.linetype;e(b),b.storeloc="null$ignorewatch",b.itemnum="null$ignorewatch",f(b,"MATERIAL"===c),b.qtyrequested=1}function c(a){var b=a.datamap,c=a.newValue;if(!c)return void e(b);var d=b["offlineitem_.description"];b["#description"]=d,b.description=d,b.storeloc=null}function d(a){var b=a.datamap;b.itemnum&&(b.itemnum="null$ignorewatch",e(b),b.storeloc=null)}var e=function(a){a["offlineitem_.description"]=null,a["#description"]=null,a.description=null},f=function(a,b){var c=b?0:null;a.description=null,a.unitcost=c},g=function(){return"textindex02='STOREROOM' and textindex03='OPERATING' and textindex01 in (select textindex02 from AssociationData where application='offlineinventory' and textindex01 = @itemnum and textindex03 = @category)"},h=function(){return"textindex01 in (select textindex01 from AssociationData where application='offlineinventory' and textindex02 in (select textindex01 from AssociationData where application='offlinelocation' and textindex02='STOREROOM' and textindex03='OPERATING') and textindex03 = @category)"},i={lineSelected:b,itemSelected:c,categorySelected:d,getStoreRoomWhereClause:g,getAvailableItemsWhereClause:h};return i}angular.module("sw_mobile_services").factory("materialService",["swdbDAO",a])}(angular,_),function(angular,a){function b(a,b,c,d,e,f,g,h,i,j,k){function l(a,b){return"attachment_"+a+"_"+Date.now()+"_"+(b||A.defaultBaseFileName)}function m(a){return g.instantiate("Attachment",a).then(function(a){return g.save(a)})}function n(a,b,c){b=b||"",c=c||512;for(var d=atob(a),e=[],f=0;f<d.length;f+=c){for(var g=d.slice(f,f+c),h=new Array(g.length),i=0;i<g.length;i++)h[i]=g.charCodeAt(i);var j=new Uint8Array(h);e.push(j)}var k=new Blob(e,{type:b});return k}function o(c,d,e){var f=b.defer(),g=a.get("attachmentService#createFile",["attachment"]);return window.requestFileSystem(window.TEMPORARY,5242880,function(a){g.debug("file system open directory: "+a.name),a.root.getFile(c,{create:!0,exclusive:!1},function(a){a.createWriter(function(b){b.onwriteend=function(){g.info("Successful file read..."),f.resolve(a)},b.onerror=function(a){f.reject()},b.write(n(d,e))})},function(){return f.reject()})}),f.promise}function p(c,d,e){var f=b.defer(),g=d.mimetype,h=d.path,i=h?b.when({toInternalURL:function(){return d.path}}):o(c,d.content,g);a.get("attachmentService#createAndLoadTempFile",["attachment"]);return i.then(function(a){var b=a.toURL(),c=window.open(b,"_blank","location=yes,hidden=no,closebuttoncaption=Close");c.addEventListener("loadstop",function(a){return f.resolve()}),c.addEventListener("loaderror",function(a){return f.reject(a)})})["catch"](function(a){return f.reject(a)}),f.promise}function q(a,b){return Validate.notEmpty(a,"application"),Validate.notEmpty(b,"parentId"),g.findByQuery("Attachment","application='"+a+"' and parentId='"+b+"'")}function r(a,b){return c.captureFile().then(function(a){var b=f.currentApplicationName();return d.copyFile(a.dirPath,a.fileName,cordova.file[e.appDirectory],l(b,a.fileName))}).then(function(a){return b[A.newAttachmentFieldName]=a.nativeURL})}function s(a,b){var c="data:"+b+";base64,",d=a.indexOf(c);return d!==-1?a.substring(c.length):a}function t(a,b){return c.captureData().then(function(c){var d=f.currentApplicationName(),e=h.getFieldByAttribute(a,A.newAttachmentFieldName);e.rendererParameters.showImagePreview=!0,b[A.fileNameFieldName]=b[A.newAttachmentPathFieldName]=l(d),b[A.newAttachmentFieldName]=c.data.value,b["#mimetype"]="image/jpeg"})}function u(a,b){var c={application:f.currentApplicationName(),parentId:f.currentDetailItem().id,content:b[A.newAttachmentFieldName],mimetype:b["#mimetype"],compressed:!1,compositionRemoteId:null};return c.content=s(c.content,c.mimetype),m(c)}function v(a,b){var c={application:f.currentApplicationName(),parentId:f.currentDetailItem().id,path:b[A.newAttachmentFieldName]};return m(c)}function w(b,c){var f=a.get("attachmentService#cancelAttachment",["attachment"]),g=c[A.newAttachmentFieldName];f.debug("deleting "+g);var h=new e.FilePathWrapper(g);return d.removeFile(h.dirPath,h.fileName).then(function(){return f.debug("Successfully deleted "+g)})["catch"](function(a){return f.warn("Could not delete "+g,a)})}function x(c){var d=c.document,e=c.docinfoid,f=c["#offlinehash"],h=a.get("attachmentService#loadRealAttachment",["attachment"]),l={query:e?i.Attachment.ByDocInfoId:i.Attachment.ByHashId,args:e?[String(e)]:[String(f)]},m=b.defer();return j.showDefault(),g.executeQuery(l).then(function(a){if(0===a.length||null==a[0].content){m.reject();var b="Could not open attachment "+e+", not found on database...";return h.warn(b),k.show({title:b}),void j.hide()}var c=a[0],f=c.mimetype,g=f.substring(f.indexOf("/")+1);if(isRippleEmulator())return k.show({title:"File Cannot be openend on Ripple"}),m.resolve(),void j.hide();if(ionic.Platform.isAndroid()){var i=s(c.content,c.mimetype);cordova.plugins.fileOpener2.openBase64(d,g,i,f,{error:function(a){j.hide(),m.reject()},success:function(){j.hide(),m.resolve()}})}else ionic.Platform.isIOS()&&p(d,c,e).then(function(){return m.resolve()})["catch"](function(){return c.path?(h.warn("could not open file at path {0}, creating temporary one... ".format(path)),c.path=null,void p(d,c,e).then(function(){return m.resolve()})["catch"](function(){return m.reject()})["finally"](function(){return j.hide()})):(h.warn("could not open file load file {0}".format(e)),void m.reject())})["finally"](function(){return j.hide()})}),m.promise}function y(a){var b=a["#offlinehash"];return g.executeStatement(i.Attachment.DeleteById,[b])}function z(a){var c=a.map(function(a){return a["#offlinehash"]}).filter(function(a){return!!a}).map(function(a){return"'"+a+"'"});if(c.length<=0)return b.when();var d=i.Attachment.DeleteMultipleByIdsPattern.format(c);return g.executeQuery(d)}var A={newAttachmentFieldName:"newattachment",newAttachmentPathFieldName:"newattachment_path",fileNameFieldName:"document",defaultBaseFileName:"camera.jpg"},B={getAttachment:q,loadRealAttachment:x,deleteRelatedAttachment:y,deleteRelatedAttachments:z,attachCameraPictureAsFile:r,saveAttachmentAsFile:v,deleteAttachmentFile:w,attachCameraPicture:t,saveAttachment:u};return B}a.factory("offlineAttachmentService",["$log","$q","cameraService","$cordovaFile","fileConstants","crudContextHolderService","swdbDAO","offlineSchemaService","offlineEntities","loadingService","swAlertPopup",b])}(angular,mobileServices),function(a){var b=function(){function a(b,c,d,e,f){_classCallCheck(this,a),this.$log=b,this.swdbDAO=c,this.offlineEntities=d,this.attachmentDataSynchronizationService=e,this.searchIndexService=f}return _createClass(a,[{key:"generateSyncQueryArrays",value:function(a){var b=this.$log.get("compositionService#generateSyncQueryArrays",["composition"]),c=[];if(null==a)return b.debug("no compositions returned from the server"),c;for(var d=new Map,e=0;e<a.length;e++){var f=a[e],g=f.newdataMaps;b.debug("inserting {0} new compositions for {1}".format(g.length,f.applicationName));for(var h=[],i=0;i<g.length;i++){var j=g[i],k=persistence.createUUID(),l=j.jsonFields||JSON.stringify(j),m=j.jsonFields?JSON.parse(j.jsonFields):j,n=this.searchIndexService.buildIndexes(f.textIndexes,f.numericIndexes,f.dateIndexes,JSON.parse(j.jsonFields)),o={query:this.offlineEntities.CompositionDataEntry.insertionQueryPattern,args:[j.application,l,j.id,String(j.approwstamp),k,n.t1,n.t2,n.t3,n.t4,n.t5,n.n1,n.n2,n.d1,n.d2,n.d3]};if(h.push("'"+j.id+"'"),c.push(o),"attachment_"===f.applicationName){var p={compositionRemoteId:m.doclinksid,hash:m["docinfo_.urlparam2"],ownerTable:m.ownertable,ownerId:m.ownerid,docinfoid:m.docinfoid};d.set(p.compositionRemoteId,p)}}0!==h.length&&(isRippleEmulator()?c.push(this.offlineEntities.CompositionDataEntry.syncdeletionQuery.format(f.applicationName,h)):c.unshift(this.offlineEntities.CompositionDataEntry.syncdeletionQuery.format(f.applicationName,h)))}return this.attachmentDataSynchronizationService.generateAttachmentsQueryArray(Array.from(d.values())).then(function(a){return c=c.concat(a),b.debug("final composition array count "+c.length),c})}},{key:"allowsUpdate",value:function(a,b){return null==a[b.idFieldName]}},{key:"loadCompositionList",value:function(a,b){var c=a.datamap;if(!b)throw new Error("field displayable is required");for(var d=this.$log.get("offlineCompositionService#loadComposition",["composition"]),e=(a.id,"application = '{0}' and ( (".format(b.associationKey)),f=b.entityAssociation.attributes,g=0;g<f.length;g++){var h=f[g],i=void 0;i=h.literal?h.literal:c[h.from],e+='( datamap like \'%"{0}":"{1}"%\' '.format(h.to,i),e+=" or datamap like '%\"{0}\":{1}%' )".format(h.to,i),g!=f.length-1&&(e+=" and ")}if(e+="))",b.schema&&b.schema.collectionProperties&&b.schema.collectionProperties.orderByField&&b.schema.schemas&&b.schema.schemas.list){var j=b.schema.schemas.list,k=j.applicationName,l=b.schema.collectionProperties.orderByField,m=this.searchIndexService.getIndexColumn(k,j,l);e+=" order by "+m}return d.debug("fetching composition {0} using query {1}".format(b.associationKey,e)),this.swdbDAO.findByQuery("CompositionDataEntry",e,{projectionFields:["remoteId","datamap"]}).then(function(a){for(var d=[],e=0;e<a.length;e++)d.push(a[e].datamap);return c[b.associationKey]&&(d=c[b.associationKey].concat(d)),d})}}]),a}();b.$inject=["$log","swdbDAO","offlineEntities","attachmentDataSynchronizationService","searchIndexService"],a.service("offlineCompositionService",b)}(mobileServices),function(a,_){a.factory("offlineSaveService",["$log","$rootScope","swdbDAO","offlineSchemaService","$ionicPopup","offlineEntities","offlineAttachmentService","crudContextHolderService","searchIndexService","metadataModelService",function(a,b,c,d,e,f,g,h,i,j){var k=f,l=function(d,f,g,j,l){var m=h.getIndexes(),n=i.buildIndexes(m.textIndexes,m.numericIndexes,m.dateIndexes,f.datamap),o=JSON.stringify(f.datamap),p=f.id;null==p&&d.contains("workorder")&&"workorder"!==d&&(d="workorder");var q=p?null:persistence.createUUID(),r=_.contains([!0,1,"true"],f.isDirty),s=!!f.remoteId,t=!r&&s,u=h.getCrudContext().originalDetailItemDatamap;f.isDirty=!0,f.datamap["#offlinesavedate"]=new Date;var v=p?t?{query:k.DataEntry.updateLocalSetOriginalPattern,args:[o,JSON.stringify(f.originaldatamap=u),n.t1,n.t2,n.t3,n.t4,n.t5,n.n1,n.n2,n.d1,n.d2,n.d3,p]}:{query:k.DataEntry.updateLocalPattern,args:[o,n.t1,n.t2,n.t3,n.t4,n.t5,n.n1,n.n2,n.d1,n.d2,n.d3,p]}:{query:k.DataEntry.insertLocalPattern,args:[d,o,q,n.t1,n.t2,n.t3,n.t4,n.t5,n.n1,n.n2,n.d1,n.d2,n.d3]},w=a.get("offlineSaveService#doSave",["crud","detail","save"]);return w.debug("saving item "+p+" for application "+d+", storing original: "+t),c.executeQuery(v).then(function(){return f.application=d,p?h.updateOriginalItemDatamap(f.datamap):f.newId=q,b.$broadcast(JavascriptEventConstants.CrudSaved),void 0===j||null===j||j===!0?e.alert({title:l?l:g+" Saved Successfully"}).then(function(){return f}):f})};return{saveItem:function(a,b,c,d){return l(a,b,c,d)},addAndSaveComposition:function(b,c,e,f,h,i){var k=c.datamap,m=f.associationKey,n=j.getCompositionByName(f.attribute),o=n&&n.data&&n.data.title||f.label;k[m]=k[m]||[];var p=a.get("offlineSaveService#addAndSaveComposition",["crud","detail","save"]);p.debug("adding and saving a new composition "+f.associationKey+" for application "+b);var q=!e[constants.localIdKey];if(q){var r=persistence.createUUID();e[constants.localIdKey]=r;var s=d.locateDisplayableByQualifier(f.schema.schemas.list,"externalid");s&&(e[s.attribute]=r)}if("attachment_"===f.associationKey)return g.saveAttachment(null,e).then(function(a){return e["#offlinehash"]=a.id,delete e.newattachment,k[m].push(e),l(b,c,o,i,h)});if(q)k[m].push(e);else{var t=k[m].findIndex(function(a){return a[constants.localIdKey]===e[constants.localIdKey]});k[m][t]=e}return l(b,c,o,i,h)}}}])}(mobileServices,_),function(a,b){function c(a,c,d){function e(a,c,e){c=c||"get";var f=e||{};return d.getServerUrl().then(function(d){return d+"/api/generic/"+a+"/"+c+"?"+b.param(f)})}function f(b,d,f,g){return e(b,d,f).then(function(b){return a.get("offlineRestService#post").info("invoking post on url",b),c.post(b,g)})}function g(b,d,f){var g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return e(b,d,f).then(function(b){return a.get("offlineRestService#get").info("invoking get on url",b),c.get(b,g)})}var h={get:g,post:f};return h}a.factory("offlineRestService",["$log","$http","settingsService",c])}(mobileServices,jQuery),function(a){function b(a,b){function c(c,d){var e=null==a.getId(c.datamap,d);return e?b.operation.create:b.operation.update}var d={getCrudOperation:c};return d}a.factory("operationService",["schemaService","crudConstants",b])}(mobileServices),function(angular,a){function b(a,b){function c(a){if(!a)return g.options;var b=angular.copy(g.options);return angular.forEach(a,function(a,c){return b[c]=a}),b}function d(b){var d=c(b);return a.getPicture(d)}function e(a){var c=a||{};return c.destinationType=Camera.DestinationType.DATA_URL,d(c).then(function(a){return new b.FileContentWrapper("data:image/jpeg;base64,"+a)})}function f(a){var c=a||{};return c.destinationType=Camera.DestinationType.FILE_URI,d(c).then(function(a){return new b.FilePathWrapper(a)})}var g={options:{quality:50,destinationType:Camera.DestinationType.FILE_URI,sourceType:Camera.PictureSourceType.CAMERA,mediaType:Camera.MediaType.PICTURE,encodingType:Camera.EncodingType.JPEG,cameraDirection:Camera.Direction.BACK,targetWidth:window.innerWidth,targetHeight:window.innerHeight,allowEdit:!1,saveToPhotoAlbum:!1,correctOrientation:!0}},h={capture:d,captureData:e,captureFile:f};return h}a.factory("cameraService",["$cordovaCamera","fileConstants",b])}(angular,mobileServices),function(a){function b(a){function b(){return d?navigator.onLine:a.isOnline()}function c(){return d?"true"===sessionStorage.mockoffline||!navigator.onLine:a.isOffline()}var d=isRippleEmulator(),e={isOnline:b,isOffline:c};return e}a.factory("networkConnectionService",["$cordovaNetwork",b])}(mobileServices),function(angular){function a(a,b,c,d,e){function f(a){return c.findSingleByQuery("Cookie","name='"+a+"'").then(function(a){return a?a.value:null})}function g(a){return d.getServerUrl().then(function(b){return n.getCookieValue(b,a)})}function h(a,b){return d.getServerUrl().then(function(c){return n.setCookieValue(c,a,b)})}function i(a){return function(){return isRippleEmulator()?b.when():a.apply(null,arguments)}}function j(){return n.clearCookies().then(function(){return c.executeStatement(e.Cookie.deleteAllStatement)})}function k(d){return b.all([c.countByQuery("Cookie","name = '"+d+"'"),g(d)]).spread(function(b,f){var g=b<=0?c.executeStatement(e.Cookie.insertStatement,[persistence.createUUID(),d,f]):c.executeStatement(e.Cookie.updateByNameStatement,[f,d]);return g.then(function(){return a.get("cookieService#persistCookie",["cookie"]).debug("persisted cookie {name:"+d+", value: "+f+"}"),f})})}function l(b){var c=a.get("cookieService#restoreCookie",["cookie"]),d=f(b).then(function(a){return a?h(b,a):null});return c.isLevelEnabled("debug")?d.then(function(a){return c.debug("restore cookie {name:"+b+", value: "+a+"}"),a}):d}var m=function(){function a(b,c){_classCallCheck(this,a),this.cookieMaster=b,this.$q=c}return _createClass(a,[{key:"getCookieValue",value:function(a,b){var c=this.$q.defer();return this.cookieMaster.getCookieValue(a,b,function(a){return c.resolve(a.cookieValue)},function(a){return c.reject(a)}),c.promise}},{key:"setCookieValue",value:function(a,b,c){var d=this.$q.defer();return this.cookieMaster.setCookieValue(a,b,c,function(){return d.resolve(c)},function(a){return d.reject(a)}),d.promise}},{key:"clearCookies",value:function(){var a=this.$q.defer();return this.cookieMaster.clear(function(){return a.resolve()},function(b){return a.reject(b)}),a.promise}}]),a}(),n=new m(window.cookieMaster,b),o={clearCookies:i(j),persistCookie:i(k),restoreCookie:i(l)};return o}angular.module("sw_mobile_services").factory("cookieService",["$log","$q","swdbDAO","settingsService","offlineEntities",a])}(angular),function(a,ionic,_){function b(a,b,c,d,e,f,g,h,i,j,k){var l={eventnamespace:"sw4:security:",authkey:"security:auth:user",previouskey:"security:auth:previous",authCookieName:"swcookie",message:{sessionexpired:"Your session has expired. Please log in to resume your activities. ",unauthorizedaccess:"You're not authorized to access this resource. Contact support if you're receiving this message in error."},keyblacklist:["security:","settings:"]},m=function(a){return l.eventnamespace+a},n=function(){return"login"===b.current.name},o=function(a,b){!b||_.isEmpty(b)?delete a.properties:(a.properties=b,b.siteid&&(a.SiteId=b.siteid),b.orgid&&(a.OrgId=b.orgid)),delete a.Properties},p=function(){var a=j.get("trackingService");a.trackStates("securityService#login",["settings","configs","user","device"],"User successfully logged in")},q=function(b){return i.persistCookie(l.authCookieName).then(function(){var d=c.get(l.authkey);return d=d?d:c.get(l.previouskey),o(b,b.Properties),c.put(l.authkey,b),a.$broadcast(m("login"),b,d),p(),b})},r=function(){Object.keys(localStorage).filter(function(a){return!l.keyblacklist.some(function(b){return a.startsWith(b)})}).forEach(function(a){return localStorage.removeItem(a)})},s=function(a,b){a.meta||(a.meta={}),a.meta.changed=b},t=function(a,b,c,g){return d.loginURL().then(function(d){return e({method:"POST",url:d,data:{username:a,password:b,userTimezoneOffset:(new Date).getTimezoneOffset()},headers:{ignorefailure:c},timeout:2e4})}).then(function(a){g||h.clearCache();var b=a.data;return b.Found?q(b):f.reject(new Error("Invalid username or password"))})},u=function(){return c.get(l.authkey)},v=function(){var a=u();return a?a.UserName:null},w=function(){var a=u();return!!a},x=function(){var b=arguments.length>0&&void 0!==arguments[0]&&arguments[0],d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],e=null;e=d?c.remove(l.authkey):c.get(l.authkey),e&&c.put(l.previouskey,e),a.$broadcast(m("logout"),e);var j=b?[]:["Settings"],n=[g.resetDataBase(j)];return d&&n.push(i.clearCookies()),f.all(n).then(function(){return h.clearCache(),r(),k.dropIndexes(),e})},y=function(a){var b=u(),d=b.properties||{};angular.forEach(a||{},function(a,b){return d[b]=a}),o(b,d),s(b,!0),c.put(l.authkey,b)},z=function(a){var b=u();o(b,a),s(b,!1),c.put(l.authkey,b)},A=ionic.debounce(function(a){if(!(a&&a.config&&a.config.headers&&a.config.headers.ignorefailure)){var b=x();n()||b.then(function(){return d.go("login",{message:l.message.unauthorizedaccess})})}},0,!0),B=function(){return i.restoreCookie(l.authCookieName)},C={login:t,loginLocal:q,currentUser:v,currentFullUser:u,hasAuthenticatedUser:w,logout:x,handleUnauthorizedRemoteAccess:A,updateCurrentUserProperties:y,overrideCurrentUserProperties:z,restoreAuthCookie:B};return C}a.factory("securityService",["$rootScope","$state","localStorageService","routeService","$http","$q","swdbDAO","$ionicHistory","cookieService","$injector","indexCreatorService",b])}(mobileServices,ionic,_),function(a,_){function b(a,b,c,d,e,f,g,h){function i(a){return"MenuContainerDefinition"===a.type&&_.contains(Object.values(A),a.id)}function j(a,b){return"MenuContainerDefinition"===a.type&&a.id===b}function k(){return z.listItems}function l(){return k().filter(function(a){return!i(a)})}function m(){return k().filter(i)}function n(a){var b=k().find(function(b){return j(b,a)});return b?b.leafs:[]}function o(){return n(A.admin)}function p(){return n(A.user)}function q(a){return z.appCount[a]||0}function r(a,b,c){var d=b&&z.menuWc[b]?z.menuWc[b]:"1=1";return c=c||"1=1","`root`.application = '{0}' and ({1}) and ({2}) ".format(a,d,c)}function s(a){var b=h.getApplicationByName(a.application);if(!b)return{};var c=e.locateSchema(b,a.schema);return c?f.buildJoinParameters(c):{}}function t(b){var c=s(b);b.parameters&&b.parameters.offlinemenuwc&&(z.menuWc[b.id]=g.invokeServiceByString(b.parameters.offlinemenuwc));var d=r(b.application,b.id);a.countByQuery("DataEntry",d,c).then(function(a){z.appCount[b.id]=a})}function u(){var a=l();angular.forEach(a,function(a){return"ApplicationMenuItemDefinition"===a.type?void t(a):void("MenuContainerDefinition"===a.type&&angular.forEach(a.explodedLeafs,function(a){"ApplicationMenuItemDefinition"===a.type&&t(a)}))})}function v(){var c=b.getInstance("menuModelService#initAndCacheFromDB",["init","metadata","botstrap"]);return a.findSingleByQuery("Menu","data is not null").then(function(b){return b&&(c.info("restoring menu"),z.dbData=b),b?(b.data&&(c.info("restoring menu data"),z.listItems=b.data.leafs),b):(b=new d.Menu,c.info("creating first menu"),a.save(b))})}function w(b){return!b||_.isEmpty(b)?v():a.instantiate("Menu",z.dbData).then(function(c){return c.data=b,a.save(c).then(function(a){return z.dbData.data=b,z.listItems=b.leafs,a})})}function x(){z=angular.copy(y)}var y={dbData:{},listItems:[],menuWc:{},appCount:{}},z=angular.copy(y),A={admin:"admin-section",user:"user-section"},B={getMenuItems:k,getApplicationMenuItems:l,getReservedMenuContainers:m,getMenuContainerItems:n,getAdminMenuItems:o,getUserMenuItems:p,buildListQuery:r,getAppCount:q,updateAppsCount:u,updateMenu:w,initAndCacheFromDB:v,reset:x};return B}a.factory("menuModelService",["swdbDAO","$log","$injector","offlineEntities","offlineSchemaService","queryListBuilderService","dispatcherService","metadataModelService",b])}(mobileServices,_),function(angular){function a(a,b,c){function d(b){var d=b.service,e=b.method;if(!a.has(d))return c.reject(new Error("service '"+d+"' not found"));var f=a.getInstance(d),g=f[e];return angular.isFunction(g)?c.when(g.apply(f,[b])):c.reject(new Error("service '"+d+"' has no method '"+e+"'"))}function e(a){switch(a.type){case"ApplicationMenuItemDefinition":return b.loadApplicationGrid(a.application,a.schema,a.id,a.parameters);case"ServiceMenuItemDefinition":return d(a);default:return c.reject(new Error("Unsupported menu type '"+a.type+"'"))}}var f={routeFromMenuItem:e};return f}angular.module("sw_mobile_services").factory("menuRouterService",["$injector","crudContextService","$q",a])}(angular),function(angular,a,_){function b(a,b,c,d,e){function f(){return a.findAll("CommandBar").then(function(a){var b={};return!a||a.length<=0?b:(c.get("offlineCommandService#initAndCacheFromDataBase").debug("init "),angular.forEach(a,function(a){return b[a.key]=a.data}),k=b)})}function g(d){return c.get("commandService#updateCommandBars",["metadata","commands"]).debug("updating commandbars",d),!d||_.isEmpty(d)?b.when():a.deleteTable("CommandBar").then(function(){return b.all(Object.keys(d).map(function(b){return a.instantiate("CommandBar",{key:b,data:d[b]})}))}).then(function(c){return b.when(persistence.transaction(function(b){return a.bulkSave(c,b)}))}).then(function(a){return k=d})}function h(a,b){return d.getCommands(a,b,k)}function i(a,d,f){var g=c.get("offlineCommandService#executeCommand",["commands"]);g.debug("Executing command "+a.service+"."+a.method);var h=b.defer();try{var i=e.getInstance(a.service);h.resolve(i[a.method](d,f))}catch(j){var k=new Error("Failed to execute command "+a.service+"."+a.method+" due to "+j);g.error(k),h.reject(k)}return h.promise}function j(a,b,c){return d.isCommandHidden(a,b,c)}var k={},l={updateCommandBars:g,getCommands:h,initAndCacheFromDataBase:f,executeCommand:i,isCommandHidden:j};return l}a.factory("offlineCommandService",["swdbDAO","$q","$log","commandCommonsService","$injector",b])}(angular,mobileServices,_),function(angular){function a(a,b,c,d,e,f){function g(){var a=c.current.name;return a.startsWith("main.crudlist")?b.currentListSchema():a.startsWith("main.cruddetail")?b.currentDetailSchema():null}function h(b){var c=b.properties["mobile.icon.provider"];if(!c)return null;var e=a.get("iconProviderService#currentIconProvider",["icon","metadata"]);return d.has(c)?d.get(c):(e.warn("service '"+c+"' not found"),null)}function i(){var a=g();if(!a||!a.properties)return null;var b=r(a);if(q.hasOwnProperty(b))return q[b];var c=h(a);return q[b]=c,c}function j(a,b,c){return function(){if(!c||!c[b]||!angular.isFunction(c[b]))return a.apply(null,arguments);var d=c[b].apply(c,arguments);return null==d?a.apply(null,arguments):d}}function k(a){if(!a)return null;var c=a.datamap,d="#808080";if(!c)return d;var g=e.locateDisplayableByQualifier(b.currentListSchema(),"icon");return g&&g.attribute&&"status"!==g.attribute||!c?g&&g.attribute&&"wopriority"!==g.attribute?d:f.getPriorityColor(c[g.attribute]):f.getColor(c.status,b.currentApplicationName())}function l(a){var b=k(a);return"white"===b||"transparent"===b?"black":"white"}function m(a,c){return a?a.hasProblem?"hasproblem":"true"===c&&!a.id||"true"!==c&&!a.remoteId?"isnew":a.isDirty||a[constants.localIdKey]?"isdirty":a.pending?"ispending":"true"===c?b.tabIcon():null:null}function n(a,c){if(!a)return null;if(a.isDirty||a.pending||a.hasProblem)return"";var d=a.datamap;if(!d)return null;if("true"===c&&!a.id||"true"!==c&&!a.remoteId)return"";var f=e.locateDisplayableByQualifier(b.currentListSchema(),"icon");if(!f||!f.attribute||"status"===f.attribute){var g=null;return d&&(g=d.status),null==g?"N":g.charAt(0)}var h=d[f.attribute];return f&&f.attribute&&"wopriority"!==f.attribute?h?(h+="",h.substring(0,1)):null:(a.icon=h?null:"flag",h?h.substring(0,1):"")}function o(a,c){if(!a)return null;if(a.hasProblem)return"exclamation-triangle";if("true"===c&&!a.id||"true"!==c&&!a.remoteId)return"plus";if(a.isDirty||a[constants.localIdKey])return"refresh";if(a.pending)return"cloud";var d=e.locateDisplayableByQualifier(b.currentListSchema(),"icon");if(!d)return null;if(!a.datamap)return null;var f=a.datamap[d.attribute];return"wopriority"!==d.attribute||f?null:"flag"}function p(a,b){var c=i();return{color:j(k,"getIconColor",c)(a),text:j(n,"getIconText",c)(a,b),icon:j(o,"getIconIcon",c)(a,b),textColor:j(l,"getTextColor",c)(a),clazz:j(m,"getIconClass",c)(a,b)}}var q={},r=function(a){return a.applicationName+"#"+a.schemaId},s={getIcon:p};return s}angular.module("sw_mobile_services").factory("iconProviderService",["$log","crudContextService","$state","$injector","offlineSchemaService","statuscolorService",a])}(angular),function(a){a.factory("metadataModelService",["$q","$log","swdbDAO","dispatcherService",function(a,b,c,d){function e(a,b,d){var e=a.applicationName,f=h[b],g=$.findFirst(f,function(a){return a.application===e}),i=null;return g&&(i=g.id),c.instantiate("Application",{id:i},function(b,c){return c.data=a,c.application=e,d(b,c),c})}function f(b,d,f){var g=a.defer(),i=h[d];if(isArrayNullOrEmpty(b))return g.resolve(),g.promise;for(var j=[],k=[],l=0;l<b.length;l++){var m=b[l];j.push(e(m,d,f))}for(var n=0;n<i.length;n++){var o=i[n],p=$.findFirst(b,function(a){return a.applicationName===o.application});p||k.push(o)}return a.all(j).then(function(b){return a.all([c.bulkSave(b),c.bulkDelete(k)])}).then(function(a){h[d]=a[0],g.resolve()})}var g={topLevelApplications:[],compositionApplications:[],associationApplications:[]},h=angular.copy(g);return{getMetadatas:function(){return h.topLevelApplications},getApplicationByName:function(a,b){for(var c=this.getMetadatas(),d=0;d<c.length;d++){var e=c[d];if(e.application===a)return e}return b?h.associationApplications.find(function(b){return b.application===a}):null},getApplicationNames:function(){var a=[],b=this.getMetadatas();if(!b)return a;for(var c=0;c<b.length;c++)a.push(b[c].application);
return a},updateTopLevelMetadata:function(a){return f(a,"topLevelApplications",function(a,b){return b.association=!1,b.composition=!1,b})},updateCompositionMetadata:function(a){return f(a,"compositionApplications",function(a,b){return b.association=!1,b.composition=!0,b})},updateAssociationMetadata:function(a){return f(a,"associationApplications",function(a,b){return b.association=!0,b.composition=!1,b})},initAndCacheFromDB:function(){var d=b.getInstance("metadataModelService#initAndCacheFromDB",["init","metadata","botstrap"]),e=a.defer();return c.findAll("Application").then(function(a){h.associationApplications=[],h.compositionApplications=[],h.topLevelApplications=[];for(var b=0;b<a.length;b++){var c=a[b];c.association?(d.info("caching association {0}".format(c.application)),h.associationApplications.push(c)):c.composition?(d.info("caching composition {0}".format(c.application)),h.compositionApplications.push(c)):(d.info("caching topLevel App {0}".format(c.application)),h.topLevelApplications.push(c))}e.resolve()}),e.promise},getCompositionByName:function(a){var b=h.compositionApplications;return b?b.find(function(b){return b.application===a}):null},reset:function(){h=angular.copy(g)}}}])}(mobileServices),function(angular,_){mobileServices.factory("offlineAssociationService",["swdbDAO","fieldService","crudContextHolderService","$log","searchIndexService","dispatcherService",function(a,b,c,d,e,f){function g(a){return"(!!"+a+" && "+a+" !== 'null' && "+a+" !== 'undefined')"}function h(a){return"datamap."+a.valueField}function i(a){var b=this.fieldValueExpression(a);if("true"===a.hideDescription)return b;var c="datamap."+a.labelFields[0];return _.contains([!1,"false","False",0,"0"],a.rendererParameters.showCode)?"("+g(c)+" ? "+c+" : '')":"("+g(b)+" ? "+b+" : '' ) + ("+g(c)+" ? (' - '  + "+c+") : '')"}function j(a,b){var c=a.schema.dataProvider.whereClause;return c.startsWith("@")&&(c=f.invokeServiceByString(c.substring(1))),e.parseWhereClause(c,b)}function k(c,e,f,g,h,i,k,l){var m=d.get("offlineAssociationService#filterPromise",["association","query"]),n=h||b.getDisplayablesByAssociationKey(c,f)[0];f.endsWith("_")&&(f=f.substring(0,f.length-1));var o=n.entityAssociation.to,p=" (application = '{0}' or application = '{1}' )".format(f,o);return nullOrEmpty(g)||(p+=" and datamap like '%{0}%' ".format(g)),angular.forEach(n.entityAssociation.attributes,function(a){if(!a.primary){var b,c=!1;a.literal?b=a.literal:(c=a.allowsNull,b=e[a.from]),c?p+=' and ( datamap like \'%"{0}":"{1}"%\' or datamap like \'%"{0}":null%\' )'.format(a.to,b):b?p+=' and datamap like \'%"{0}":"{1}"%\''.format(a.to,b):m.info("field "+a.from+" could not be found on the datamap ignoring it")}}),n.schema&&n.schema.dataProvider&&n.schema.dataProvider.whereClause&&k&&(p+=" and ("+j(n,e)+") "),l&&(p+=' order by (datamap like "%'+l+'%") desc '),i=i||1,a.findByQuery("AssociationData",p,{pagesize:10,pageNumber:i,projectionFields:["datamap"]})}function l(a,e){var f=d.get("offlineAssociationService#updateExtraProjections",["association"]),g=!c.isOnMainTab(),h=g?c.getCompositionDetailSchema():c.currentDetailSchema(),i=b.getDisplayablesByAssociationKey(h,e)[0];if(!i||!i.extraProjectionFields)return void f.trace("no extraprojectionfields to update for "+e);var j=c.currentDetailItemDataMap(),k=a.datamap;f.info("updating extraprojection fields for "+e),i.extraProjectionFields.forEach(function(a){var b=e+"."+a,c=k[a];f.debug("updating "+b+" to "+c),j[b]=c})}function m(a,e){var f=d.get("offlineAssociationService#updateExtraProjections",["association"]),g=!c.isOnMainTab(),h=g?c.getCompositionDetailSchema():c.currentDetailSchema(),i=b.getDisplayablesByAssociationKey(h,e)[0],j=a.extrafields;if(!i||!j)return void f.trace("no extraprojectionfields to update for "+e);var k=c.currentDetailItemDataMap();f.info("updating extraprojection fields for "+e),Object.keys(j).forEach(function(a){var b=e+"_."+a,c=j[a];f.debug("updating "+b+" to "+c),k[b]=c})}var n={filterPromise:k,fieldLabelExpression:i,fieldValueExpression:h,updateExtraProjections:l,updateExtraProjectionsForOptionField:m};return n}])}(angular,_),function(angular,_){function a(a,b,c,d,e,f,g){function h(a,b,c){var e="detail",g=d.getProperty(a,"list.click.service"),h=g&&c?f.invokeServiceByString(g,[b,a,c]):d.getProperty(a,"list.click.schema");return h&&(e=h),this.locateSchema(b,e)}function i(a,b){for(var c=a.data.schemasList,d=0;d<c.length;d++){var e=c[d];if("list".equalsIc(e.stereotype)&&j(e),e.schemaId.equalsIc(b))return e}return null}function j(a){if(a.jscache=a.jscache||{},!a.jscache.griddisplayables){a.jscache.qualifiercache={};for(var b=a.displayables,c=0;c<b.length;c++){var d=b[c];d.qualifier&&(a.jscache.qualifiercache[d.qualifier]=d)}}}function k(a,b){if(isString(a)&&(a=g.getApplicationByName(a,!0)),null==a)return null;for(var c=a.data.schemasList,d=0;d<c.length;d++){var e=c[d];if("list"==e.stereotype&&j(e),b.equalsIc(e.stereotype))return e;if("detail".equalsIc(b)&&e.schemaId.equalsIc("detail"))return e}return null}function l(a,b,c){a[b]||(a[b]=c)}function m(a,b){var c=e.currentFullUser();l(b,"siteid",c.SiteId),l(b,"orgid",c.OrgId)}function n(a,c,d){var e=d?{previousdata:{fields:d},parentdata:{fields:d}}:{};b.fillDefaultValues(a.displayables,c,e),m(a,c)}function o(a,b){if(null==a)return null;if(a.jscache=a.jscache||{},a.jscache.qualifiercache)return a.jscache.qualifiercache[b];j(a);var c=a.jscache.qualifiercache[b];return c?c.attribute:null}function p(a,b,c){if(!a)return null;var d=moment(a);return c?d.format(w):b?d.format(v):d.format(u)}function q(a,b){var c=a.offlineAssociations[b],d=g.getApplicationByName(c.to,!0);return d.data.schemasList.find(function(a){return"list"===a.stereotypeAttr})}function r(a){if(!a.contains("."))return{attribute:a};var b=a.substr(1),c=b.substr(0,b.indexOf(".")),d=b.substr(b.indexOf(".")+1);return{entityName:c,attribute:d}}function s(a,b,d){if(null==a)return null;var e=o(a,b);return e&&e.attribute&&d?"featured"!==b||"datetime"!==e.dataType&&"timestamp"!==e.dataType&&"datetime"!==e.rendererType?"featured"!==b||"date"!==e.dataType&&"date"!==e.rendererType?_.contains([!0,"true"],e.rendererParameters.showLabel)?e.label+": "+d[e.attribute]:e.rendererParameters.formatter?c.format(d[e.attribute],e,d):d[e.attribute]:p(d[e.attribute],!1,!1):p(d[e.attribute],!0,!0):null}function t(a,b){Validate.notEmpty(a);var c=a.displayables;return!c||c.length<=0?null:c.find(function(a){return a.attribute===b})}var u="MMM DD",v="MMM DD hh a",w="MMM DD hh:mm a",x={loadDetailSchema:h,locateSchema:i,locateSchemaByStereotype:k,locateRelatedListSchema:q,fillDefaultValues:n,findRelatedEntityName:r,locateDisplayableByQualifier:o,buildDisplayValue:s,getFieldByAttribute:t};return x}angular.module("sw_mobile_services").factory("offlineSchemaService",["$log","fieldService","formatService","schemaService","securityService","dispatcherService","metadataModelService",a])}(angular,_),function(angular){var a=void 0,b=function(){function b(c,d,e,f,g,h,i,j){_classCallCheck(this,b),this.$log=c,this.$q=d,this.settingsService=e,this.securityService=f,this.loadingService=g,this.swAlertPopup=h,this.routeService=i,this.crudContextService=j,a=function(a){return!!a&&!!a.serverurl&&"http://"!==a.serverurl}}return _createClass(b,[{key:"doInit",value:function(){var b=this,c=this.$log.get("initialRouteService#doInit",["init","bootstrap"]),d=this.securityService.hasAuthenticatedUser();this.crudContextService.restoreState();var e=window.localdevdata;if(e&&e.debuglogs){var f=e.debuglogs;f.forEach(function(a){swlog.debug(a)})}return!e||e.showlogin?(c.debug("redirecting to initial state"),this.routeService.loadInitialState(d)):(c.debug("applying local rules"),this.settingsService.getSettings().then(function(c){if(a(c)&&d)return b.crudContextService.restoreState(),b.routeService.loadInitialState(d);b.loadingService.showDefault();var f=isRippleEmulator()?e.serverurl.ripple:e.serverurl.device,g=b;return b.settingsService.saveSettings({serverurl:f}).then(function(){return g.securityService.login(e.username,e.password)}).then(function(){return isRippleEmulator()?b.$q.when():g.routeService.go("main.home")})["catch"](function(a){return g.securityService.logout(),g.swAlertPopup.show({title:"Login failed",template:a&&a.message?a.message:"Please check your credentials."}),g.routeService.loadInitialState(d)})["finally"](function(){g.loadingService.hide()})}))}}]),b}();b.$inject=["$log","$q","settingsService","securityService","loadingService","swAlertPopup","routeService","crudContextService"],angular.module("sw_mobile_services").service("initialRouterService",b)}(angular),function(angular){angular.module("sw_mobile_services").constant("routeConstants",{events:{sameStateTransition:"sw:$state:transition:same"}})}(angular),function(a){var b=function(){function a(b,c,d,e,f,g,h){var i=this;_classCallCheck(this,a),this.$state=b,this.localStorageService=e,this.contextService=c,this.settingsService=d,this.loadingService=f,this.$rootScope=g,this.routeConstants=h,this.loginURL=function(){return i.settingsService.getServerUrl().then(function(a){return a+"/SignIn/SignInReturningUserData"})}}return _createClass(a,[{key:"go",value:function(a,b){var c=this;return this.contextService.insertIntoContext("currentstate",a),this.loadingService.showDefault()["finally"](function(){var d=c.$state.$current.name===a,e=c.$state.go(a,b);d&&e.then(function(a){return c.$rootScope.$broadcast(c.routeConstants.events.sameStateTransition,a)}),c.loadingService.hide()})}},{key:"loadInitialState",value:function(a){if(!a)return this.localStorageService.get("settings:serverurl")?this.go("login"):this.go("settings");var b=this.contextService.getFromContext("currentstate");return isRippleEmulator()&&b?this.go(b):this.go("main.home")}}]),a}();b.$inject=["$state","contextService","settingsService","localStorageService","loadingService","$rootScope","routeConstants"],a.service("routeService",b)}(mobileServices),function(a){a.factory("associationDataSynchronizationService",["$http","$log","$q","swdbDAO","metadataModelService","offlineRestService","rowstampService","offlineEntities","searchIndexService","securityService","applicationStateService",function(a,b,c,d,e,f,g,h,i,j,k){return{doInsert:function(a,b,c){for(var e=[],f=0;f<c.length;f++)for(var g=c[f],h=b.data.associationData,j=b.data.textIndexes[g],k=b.data.numericIndexes[g],l=b.data.dateIndexes[g],m=h[g],n=m.individualItems,o=m.remoteIdFieldName,p=0;p<n.length;p++){var q=n[p],r=persistence.createUUID(),s=q.jsonFields||JSON.stringify(q),t=q.jsonFields?JSON.parse(q.jsonFields):q,u=t[o],v=i.buildIndexes(j,k,l,t),w={query:a,args:[q.application,s,String(q.approwstamp),r,v.t1,v.t2,v.t3,v.t4,v.t5,v.n1,v.n2,v.d1,v.d2,v.d3,u]};e.push(w)}return d.executeQueries(e).then(function(){return e.length})},doInsertRecursively:function(a,d,e,f,g,h){var i=b.get("associationDataSynchronizationService#doInsertRecursively",["association","sync"]),j=this.doInsertRecursively.bind(this),k=g+f;k>e.length&&(k=e.length);var l=e.slice(g,k);return i.debug("inserting association apps "+l.join(",")),this.doInsert(a,d,l).then(function(b){return h+=b,e.length>k?(g+=f,j(a,d,e,f,g,h)):c.when(h)})},syncData:function(a,d){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,l=this,m=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[];return k.getServerDeviceData().then(function(k){var o=b.get("associationDataSynchronizationService#syncData",["association","sync"]);o.info("bringing server side data to apply based on rowstampmap");var p=l.syncData.bind(l),q=l.doInsertRecursively.bind(l),r={};return g.generateAssociationRowstampMap(e,a).then(function(b){var c={rowstampMap:b,clientOperationId:d,deviceData:k},g=j.currentFullUser();return g&&g.meta&&g.meta.changed&&(c.userData=g),c.applicationsToFetch=e,c.initialLoad=a,c.completeCacheEntries=n,f.post("Mobile","PullAssociationData",r,c)}).then(function(b){var c=b.data.associationData;if(b.data.isEmpty)return m;var e=a?h.AssociationData.InsertionPattern.format(""):h.AssociationData.InsertionPattern.format(" or REPLACE "),f=Object.keys(c);return q(e,b,f,f.length,0,0).then(function(c){if(m+=c,b.data.hasMoreData){var e=b.data.incompleteAssociations.join(",");return o.info("bringing next round of chunked data ("+ ++i+") for applications "+e),p(a,d,b.data.incompleteAssociations,i,m,b.data.completeCacheEntries)}return m})})["catch"](function(a){return a?c.reject(a):c.when(0)})})}}}])}(mobileServices),function(a,angular){var b=function(a,b,c,d,e,f){var g={},h=[],i=6e4,j=this;f.$on("sw4:security:logout",function(){g={}});var k=function(){var a=[];for(var b in g)g.hasOwnProperty(b)&&a.push(b);return a},l=function(){var a=c.get("asyncSynchronizationService#fetchBatchStatus"),d=k();if(!(d.length<=0||h.length<=0)){var e=new Date;a.info("Polling request started at {0}".format(e)),b.get("Mobile","BatchStatus",{ids:d}).then(function(b){return a.info("Polling response received"),b.data}).then(function(a){var b=[];return angular.forEach(a,function(a){if("COMPLETE"===a.status){var c=g[a.remoteId];b.push({remote:a,local:c})}}),b}).then(function(b){return b.length<=0?void a.info("no 'COMPLETE' batches received"):(angular.forEach(h,function(a){a({start:e.getTime(),batchTuples:b})}),void angular.forEach(b,function(a){delete g[a.local.id]}))})["catch"](function(b){a.error(b)})}};this.registerForAsyncProcessing=function(a){g[a.id]||(g[a.id]=a)},this.registerListForAsyncProcessing=function(a){angular.forEach(a,function(a){j.registerForAsyncProcessing(a)})},this.onBatchesCompleted=function(a){h.push(a)};var m=function(){var b=k();b=b.map(function(a){return"'{0}'".format(a)});var c="status!='COMPLETE'";b.length>0&&(c+=" and id not in ({0})".format(b)),d.findByQuery("Batch",c).then(function(b){var c=[];return angular.forEach(b,function(b){var d=a.defer();b.items.prefetch("dataentry").prefetch("problem").list(null,function(a){b.loadeditems=a,d.resolve(b)}),c.push(d.promise)}),a.all(c)}).then(function(a){j.registerListForAsyncProcessing(a)})},n=function(){var a=isRippleEmulator()?1e4:i;e(l,a)};m(),n()};a.service("asyncSynchronizationService",["$q","offlineRestService","$log","swdbDAO","$interval","$rootScope",b])}(mobileServices,angular),function(a,angular){function b(a,b,c,d,e){function f(e){if(0===e.length)return a.when([]);var f=(d.Attachment.NonPendingAttachments,e.filter(function(a){return null!=a.hash}).map(function(a){return a.hash}).join("','")),g="'"+e.map(function(a){return a.docinfoid}).join("','")+"'",h=b.get("attachmentDataSynchronizationService#generateAttachmentsQueryArray",["attachment","sync","download"]);return""!==f&&(f="'"+f+"'"),h.debug("determining which attachments should be downloaded amongst "+f+" and remoteids "+g+" "),c.executeQuery(d.Attachment.NonPendingAttachments.format(f,g)).then(function(a){return k(a,e,h)})}function g(b,e,f){var h=[];if(0===b.length)return f.info("finishing download process for attachments"),void e.resolve();for(var i=0;i<j;i++){var k=b.shift();h.push(k)}var l=h.filter(function(a){return null!=a});return 0===l.length?void e.resolve():void a.all(l.map(function(a){return a.promise})).then(function(a){for(var h=[],i=0;i<l.length;i++){var j=a[i],k=l[i].id;if(j&&j.data){f.info("storing attachment for localid {0} ".format(k));var m=j.data,n={query:d.Attachment.UpdatePendingAttachment,args:[m.content,m.mimeType,k]};h.push(n)}else{f.warn("server returned with a null file result... saving a error file to prevent downloading");var o={query:d.Attachment.UpdatePendingAttachment,args:["error","error",k]};h.push(o)}}c.executeQueries(h).then(g(b,e,f))})}function h(){var f=b.get("attachmentDataSynchronizationService#downloadAttachments",["attachment","sync","download"]);return c.executeQuery(d.Attachment.PendingAttachments).then(function(b){if(0===b.length)return f.debug("no attachments to download, resuming"),null;f.info("starting download process for "+b.length+" attachments");var c=a.defer(),d=[];b.length;return b.forEach(function(a){var b=a,c=e.get("OfflineAttachment","DownloadBase64",{id:b.docinfoRemoteId});d.push({id:b.id,promise:c})}),g(d,c,f),c.promise})}function i(e,f){var g=b.get("attachmentDataSynchronizationService#mergeAttachmentData",["attachment","sync"]);if(!f||f.length<=0)return a.when([]);var h=f.map(function(a){return a.id}).join("','");""!==h&&(h="'"+h+"'");var i={query:d.Attachment.ByApplicationAndIds.format(h),args:[e]};return c.executeQuery(i).then(function(b){return 0===b.length?(g.debug("no attachments to uppload for application {0}".format(e)),a.when(f)):(b.forEach(function(a){var b=f.find(function(b){return b.id===a.parentId}),c=b.datamap.attachment_;if(null==c)return void g.trace("skipping entry {0} since it hold no attachment".format(b.id));var d=c.find(function(b){return b["#offlinehash"]===a.id});return null==d?void g.warn("could not locate attachment "+a.id+" in any of the "+e+" of ids "+h):void(d.newattachment=a.content)}),f)})}var j=2,k=function(b,c,e){var f=function(a){return b.some(function(b){return b.id===a.hash&&(null==b.compositionRemoteId||null==b.docinfoRemoteId)})},g=c.filter(f).map(function(a){return{query:d.Attachment.UpdateRemoteIdOfExistingAttachments,args:[String(a.compositionRemoteId),String(a.docinfoid),a.hash]}}),h=c.filter(function(a){return!b.some(function(b){return b.docinfoRemoteId==a.docinfoid})}).filter(function(a){return!b.some(function(b){return b.id===a.hash&&(null==b.compositionRemoteId||null==b.docinfoRemoteId)})}).map(function(a){return{query:d.Attachment.CreateNewBlankAttachments,args:[a.ownerTable,String(a.ownerId),String(a.compositionRemoteId),String(a.docinfoid),persistence.createUUID()]}}),i=g.concat(h);return 0===i.length&&e.debug("no attachments to be inserted/updated"),0!==g.length&&e.debug(g.length+" locally created attachments will get updated"),0!==h.length&&e.debug(h.length+" attachments will get created locally"),a.when(i)},l={generateAttachmentsQueryArray:f,downloadAttachments:h,mergeAttachmentData:i};return l}a.factory("attachmentDataSynchronizationService",["$q","$log","swdbDAO","offlineEntities","offlineRestService",b])}(mobileServices,angular),function(a,angular,persistence){function b(a,b,c,d,e,f,g,h,i,j,k){function l(a){if(a.operation)return a.operation.datamap;var b=a.dataentry.datamap;return b}function m(a){z.push(a)}function n(b,c,d){if(z.length<=0)return a.when(d);var e=null,f=angular.copy(d);return angular.forEach(z,function(d){e=e?e.then(function(a){return f=a?a:f,d(b,c,f)}):a.when(d(b,c,f))}),e}function o(a){for(var b=a.items,c=[],d=0;d<b.length;d++){var e=b[d];c.push(e.remoteId)}return c}function p(b,e,f){var g=d.getInstance("batchService#saveBatch"),h=a.defer();return persistence.transaction(function(a){g.debug("executing batching db tx"),f&&c.bulkSave(f,a),e&&c.bulkSave(e,a),c.save(b,a),persistence.flush(a,function(){b.items.list(null,function(a){return b.loadeditems=a,h.resolve(b)})})}),h.promise}function q(a,b){var c=d.get("batchService#updateBatch"),e=b.status;a.status=e;var f={};if(a.loadeditems.forEach(function(a){a.status=e,f[a.id]=a}),c.info("Batch response received (id='{0}') with Batch.status = '{1}'".format(b.remoteId,e)),"COMPLETE"!==e)return p(a,a.loadeditems);var g=b.problems,h=[];for(var j in g)if(g.hasOwnProperty(j)){var k=g[j],l=new i.Problem;l.message=k.message;var m=f[j.toUpperCase()];m.problem=l,h.push(l)}var n=b.successItems;angular.forEach(n,function(a){var b=f[a.toUpperCase()];b.problem&&(b.problem=null)}),angular.forEach(a.loadeditems,function(a){a.dataentry.pending=!1,a.dataentry.isDirty=!!a.problem});var o=h.length;return a.hasProblems=o,o>0?p(a,a.loadeditems,h):p(a,a.loadeditems)}function r(a,c,e){var f=d.getInstance("batchService#doSubmitBatch",["batch",["sync"]]);return k.getServerDeviceData().then(function(d){var g={application:a.application,remoteId:a.id,clientOperationId:e,deviceData:d,downloadImmediately:a.forcedownload||!1},h={items:c};return n(a,g,h).then(function(c){var d=c?angular.toJson(c):angular.toJson(h);return f.info("Submitting a Batch (id='{0}') to the server.".format(a.id)),b.post("Mobile","SubmitBatch",g,d)}).then(function(b){var c=b.data;return q(a,c)})})}function s(b,c){var e=d.getInstance("batchService#submitBatches"),f=[];return b.forEach(function(a){if(a&&a.loadeditems){var b=a.loadeditems.map(function(b){return{datamap:l(b),itemId:b.dataentry.remoteId,remoteId:b.id,application:a.application,operation:b.crudoperation,dataentry:b.dataentry.id,additionaldata:{}}});f.push(r(a,b,c))}}),f.length<=0?(e.info("no batches submitted"),a.when()):a.all(f).then(function(a){return y(),a})["catch"](function(b){return x(),a.reject(b)})}function t(b,i){var k=b.application,l=d.getInstance("batchService#createBatch",["sync","batch"]),m=f.locateSchemaByStereotype(b,"detail"),n="isDirty=1 and pending=0 and application='{0}'".format(k),o=null!=i,q=void 0;return q=o?a.when([i]):c.findByQuery("DataEntry",n),q.then(function(a){return j.mergeAttachmentData(k,a)}).then(function(d){if(!d||d.length<=0)return l.debug("no items to submit to the server. returning null batch"),null;var f=[];angular.forEach(d,function(a){var d=b.data.parameters["mobile.presyncservice"];d&&h.invokeServiceByString(d,[a.datamap,a.originaldatamap]),a.pending=!0,w(a),f.push(c.instantiate("BatchItem",a,function(a,b){return b.dataentry=a,b.status="pending",b.label=e.getTitle(m,a.datamap,!0),b.crudoperation=g.getCrudOperation(a,m),b}))});var i=[];l.debug("creating db promises");var j=c.instantiate("Batch");return i.push(j),i.push(a.when(d)),i=i.concat(f),a.all(i)}).then(function(a){if(!a)return a;var b=a[0],c=a[1],d=a.subarray(2,length+1);b.application=k,b.sentDate=new Date;for(var e=0;e<d.length;e++){var f=d[e];b.items.add(f),f.batch=b}return p(b,d,c)})}var u={submittingEntries:[]},v=function(a,b,c,d){if(a.isLevelEnabled(b)){var e=c.map(function(a){return"'{0}'".format(a.id)});a[b](d.format(e))}},w=function(a){var b=d.get("BatchService#rollback");angular.isArray(a)?(v(b,"debug",a,"marking DataEntries {0} to rollback"),angular.forEach(a,function(a){u.submittingEntries.push(a)})):(b.debug("marking DataEntry '{0}' to rollback".format(a.id)),u.submittingEntries.push(a))},x=function(){var a=d.get("BatchService#rollback");a.debug("executing rollback");for(var b=[];u.submittingEntries.length>0;){var e=u.submittingEntries.shift();e&&(e.pending=!1,b.push(e))}c.bulkSave(b).then(function(b){v(a,"debug",b,"DataEntries {0} rolledback successfully")})["catch"](function(c){v(a,"warn",b,"Failed to rollback DataEntries {0} due to "+c)})},y=function(){u.submittingEntries=[]},z=[],A={getIdsFromBatch:o,submitBatches:s,generateDatamapDiff:l,createBatch:t,saveBatch:p,updateBatch:q,onBeforeBatchSubmit:m};return A}a.factory("batchService",["$q","offlineRestService","swdbDAO","$log","schemaService","offlineSchemaService","operationService","dispatcherService","offlineEntities","attachmentDataSynchronizationService","applicationStateService",b])}(mobileServices,angular,persistence),function(a,angular,_){var b=function(a){var b=[];return angular.forEach(a,function(a){b.push("'{0}'".format(a))}),b},c=function(a,c,d,e,f,g,h,i,j,k,l,m,n,o,p){function q(a,b){return c.when(f.invokeService(a.data.clientName+".dataSynchronizationHook","modifyQueries",[a.data,b])).then(function(){return b})}function r(a){var c=d.get("dataSynchronizationService#createAppSyncPromise",["sync"]),f=a.data.topApplicationData,g=a.data.compositionData,h=a.data.userProperties,i=m.currentFullUser()&&m.currentFullUser().properties&&m.currentFullUser().properties["sync.facilities"]||[],n=h&&h["sync.facilities"]||[],p=a.data.facilitiesUpdated||!_.isEqual(i.sort(),n.sort());o.getFullConfig(ConfigurationKeys.FacilitiesChanged).then(function(a){var b=null===a||a&&a.value===!1&&p;b&&o.saveConfig({key:ConfigurationKeys.FacilitiesChanged,value:p})}),m.overrideCurrentUserProperties(h);var r=[];if(a.data.isEmpty)return c.info("no new data returned from the server"),q(a,r).then(function(a){return a?a:0});c.info("receiving new topLevel data from the server"),angular.forEach(f,function(a){var d=a.newdataMaps,e=a.updatedDataMaps,f=a.insertOrUpdateDataMaps,g=a.deletedRecordIds;if(c.debug("{0} topleveldata: inserting:{1} | updating:{2} | deleting: {3}".format(a.applicationName,d.length,e.length,g.length)),angular.forEach(d,function(b){var c=persistence.createUUID(),d=b.jsonFields||JSON.stringify(b),e=b.jsonFields?JSON.parse(b.jsonFields):b,f=l.buildIndexes(a.textIndexes,a.numericIndexes,a.dateIndexes,e),g={query:k.DataEntry.insertOrReplacePattern,args:[b.application,d,b.id,String(b.approwstamp),c,f.t1,f.t2,f.t3,f.t4,f.t5,f.n1,f.n2,f.d1,f.d2,f.d3]};r.push(g)}),angular.forEach(f,function(b){var c=persistence.createUUID(),d=b.jsonFields||JSON.stringify(b),e=b.jsonFields?JSON.parse(b.jsonFields):b,f=l.buildIndexes(a.textIndexes,a.numericIndexes,a.dateIndexes,e),g={query:k.DataEntry.insertOrReplacePattern,args:[b.application,d,b.id,String(b.approwstamp),c,f.t1,f.t2,f.t3,f.t4,f.t5,f.n1,f.n2,f.d1,f.d2,f.d3]};r.push(g)}),angular.forEach(e,function(b){var c=b.jsonFields||JSON.stringify(b),d=b.jsonFields?JSON.parse(b.jsonFields):b,e=l.buildIndexes(a.textIndexes,a.numericIndexes,a.dateIndexes,d),f={query:k.DataEntry.updateQueryPattern,args:[c,String(b.approwstamp),e.t1,e.t2,e.t3,e.t4,e.t5,e.n1,e.n2,e.d1,e.d2,e.d3,b.id,b.application]};r.push(f)}),g.length>0){var h=isRippleEmulator()?"push":"unshift",i={query:k.DataEntry.deleteQueryPattern.format(b(g),a.applicationName)};r[h](i);var j={query:k.AuditEntry.deleteRelatedByRefIdStatement.format(b(g)),args:[a.apllicationName]};r[h](j)}});var s=r.length;return j.generateSyncQueryArrays(g).then(function(a){return r.concat(a)}).then(function(b){return q(a,b)}).then(function(a){return e.executeQueries(a)}).then(function(){return s})}function s(){var a=m.currentFullUser();return a?a.meta&&a.meta.changed?a:null:m.logout()}function t(a,b,c,e,f){var h=d.get("dataSynchronizationService#createAppSyncPromise");return n.getServerDeviceData().then(function(d){return i.generateRowstampMap(b).then(function(i){i.compositionmap=e,h.debug("invoking service to get new data");var j={applicationName:b,clientCurrentTopLevelApps:c,returnNewApps:a,clientOperationId:f,userData:s(),rowstampMap:i,deviceData:d};return g.post("Mobile","PullNewData",null,j)}).then(r)})}function u(a,b){var d=a.application;return n.getServerDeviceData().then(function(e){return i.generateCompositionRowstampMap().then(function(f){var h={compositionmap:f},i={applicationName:d,itemsToDownload:[a.remoteId],userData:s(),rowstampMap:h,deviceData:e,clientOperationId:b},j=g.post("Mobile","PullNewData",null,i).then(r)["catch"](w);return c.all([j])})})}function v(a){return n.getServerDeviceData().then(function(b){var d,e=h.getApplicationNames(),f=0===e.length;return f?(d={clientCurrentTopLevelApps:e,returnNewApps:!0,clientOperationId:a,deviceData:b,userData:s()},g.post("Mobile","PullNewData",null,d).then(r)["catch"](w)):i.generateCompositionRowstampMap().then(function(b){var d=[],f=t(!0,null,e,b,a)["catch"](w);return d.push(f),c.all(d)})})}var w=function(a){return a?c.reject(a):c.when()},x={syncData:v,syncSingleItem:u};return x};c.$inject=["$http","$q","$log","swdbDAO","dispatcherService","offlineRestService","metadataModelService","rowstampService","offlineCompositionService","offlineEntities","searchIndexService","securityService","applicationStateService","configurationService","settingsService"],a.factory("dataSynchronizationService",c)}(mobileServices,angular,_),function(a){a.factory("metadataSynchronizationService",["$q","offlineRestService","menuModelService","metadataModelService","configurationService","offlineCommandService","securityService","searchIndexService","applicationStateService",function(a,b,c,d,e,f,g,h,i){var j=function(a){var b=Object.keys(a).map(function(b){return{key:b,value:a[b]}});return b};return{syncData:function(g,k){return i.getServerDeviceData().then(function(a){return b.post("Mobile","DownloadMetadatas",null,{clientOperationId:k,deviceData:a})}).then(function(b){h.refreshIndexCaches();var g=JSON.parse(b.data.menuJson),i=JSON.parse(b.data.topLevelMetadatasJson),k=JSON.parse(b.data.associationMetadatasJson),l=JSON.parse(b.data.compositionMetadatasJson),m=JSON.parse(b.data.commandBarsJson),n=b.data.appConfiguration,o=c.updateMenu(g),p=d.updateTopLevelMetadata(i),q=d.updateAssociationMetadata(k),r=d.updateCompositionMetadata(l),s=f.updateCommandBars(m),t=j(n),u=e.saveConfigs(t);return a.all([o,p,q,r,s,u])}).then(function(a){return!0})}}}])}(mobileServices),function(a){function b(a,b,c){var d=function(){a.cordova.plugins.notification.local.on("schedule",function(a,d){c(function(){b.$broadcast("$cordovaLocalNotification:schedule",a,d)})}),a.cordova.plugins.notification.local.on("trigger",function(a,d){c(function(){b.$broadcast("$cordovaLocalNotification:trigger",a,d)})}),a.cordova.plugins.notification.local.on("update",function(a,d){c(function(){b.$broadcast("$cordovaLocalNotification:update",a,d)})}),a.cordova.plugins.notification.local.on("clear",function(a,d){c(function(){b.$broadcast("$cordovaLocalNotification:clear",a,d)})}),a.cordova.plugins.notification.local.on("clearall",function(a){c(function(){b.$broadcast("$cordovaLocalNotification:clearall",a)})}),a.cordova.plugins.notification.local.on("cancel",function(a,d){c(function(){b.$broadcast("$cordovaLocalNotification:cancel",a,d)})}),a.cordova.plugins.notification.local.on("cancelall",function(a){c(function(){b.$broadcast("$cordovaLocalNotification:cancelall",a)})}),a.cordova.plugins.notification.local.on("click",function(a,d){c(function(){b.$broadcast("$cordovaLocalNotification:click",a,d)})})},e={init:d};return e}a.factory("notificationPluginWrapper",["$window","$rootScope","$timeout",b])}(mobileServices),function(a){a.constant("rowstampConstants",{maxItemsForFullStrategy:1e3}),a.factory("rowstampService",["$q","$log","swdbDAO","offlineEntities","rowstampConstants",function(a,b,c,d,e){var f=d;return{generateRowstampMap:function(a){var d=b.get("rowstampService#generateRowstampMap"),g=(new Date).getTime(),h=a?"application ='{0}'".format(a):"1=1",i=!0;return c.countByQuery("DataEntry",h).then(function(b){return i=b<e.maxItemsForFullStrategy,i?c.findByQuery("DataEntry",h,{projectionFields:["application","remoteId","rowstamp"]}):a?c.findByQuery("DataEntry",null,{fullquery:f.DataEntry.maxRowstampByAppQuery.format(a)}):c.findByQuery("DataEntry",null,{fullquery:f.DataEntry.maxRowstampGeneralQuery})}).then(function(b){var c={};if(i){if(null!=a){var e=b.map(function(a){return{id:a.remoteId,rowstamp:a.rowstamp}});c.items=e;var f=(new Date).getTime();return d.debug("generated rowstampmap for application {0} with {1} entries. Ellapsed {2} ms".format(a,e.length,f-g)),c}for(var h={},j=0;j<b.length;j++){var k=b[j];h[k.application]||(h[k.application]={}),h[k.application].items||(h[k.application].items=[]),h[k.application].items.push({id:k.remoteId,rowstamp:k.rowstamp})}return c.applications=h,c}if(null!=a)c.maxrowstamp=b[0].rowstamp,c.application=a;else{c.applications={};for(var l=0;l<b.length;l++){var m=b[l];c.applications[[m.application]]=m.rowstamp}}return c})},generateCompositionRowstampMap:function(){var d=b.get("rowstampService#generateCompositionRowstampMap"),e=a.defer(),g=(new Date).getTime();return c.findByQuery("CompositionDataEntry",null,{fullquery:f.CompositionDataEntry.maxRowstampQueries}).then(function(a){for(var b={},c=0;c<a.length;c++){var f=a[c];b[f.application]=f.rowstamp}var h=(new Date).getTime();d.debug("generated rowstampmap for compositions. Ellapsed {0} ms".format(h-g)),e.resolve(b)}),e.promise},generateAssociationRowstampMap:function(d,e){var g=b.get("rowstampService#generateAssociationRowstampMap",["sync","association"]),h=a.defer(),i=(new Date).getTime(),j=null,k=!!d&&d.length>0;k&&(j="'"+d.join("','")+"'");var l=void 0;return l=e?k?f.AssociationData.maxRemoteIdQueryByApps.format(j):f.AssociationData.maxRemoteIdQueries:k?f.AssociationData.maxRowstampQueryByApps.format(j):f.AssociationData.maxRowstampQueries,
c.findByQuery("AssociationData",null,{fullquery:l}).then(function(a){for(var b={},c={},d=0;d<a.length;d++){var f=a[d];e?c[f.application]={maximouid:f.remoteid}:c[f.application]={maximorowstamp:f.rowstamp}}var j=(new Date).getTime();g.debug("generated rowstampmap for associations. Ellapsed {0} ms".format(j-i)),b.associationmap=c,h.resolve(b)}),h.promise}}}])}(mobileServices),function(a){var b=function(){function a(b,c,d,e,f,g){_classCallCheck(this,a),this.restService=b,this.$q=c,this.$log=d,this.localStorageService=e,this.dynamicScriptsCacheService=f,this.$cordovaAppVersion=g}return _createClass(a,[{key:"syncData",value:function(){var a=this,b=this.dynamicScriptsCacheService.getClientState(),c=isRippleEmulator()?this.$q.when("ripple"):this.$cordovaAppVersion.getVersionNumber(),d=ionic.Platform.isAndroid()?"android":"ios";return c.then(function(c){var e={clientState:b,offlineDevice:d,offlineVersion:c};return a.restService.post("Mobile","BuildSyncMap",{},e)}).then(function(b){return a.dynamicScriptsCacheService.syncWithServerSideScripts(b.data)})["catch"](function(b){return a.$log.warn("[dynamic-scripts]incompatible server side version"),a.$q.when()})}}]),a}();b.$inject=["offlineRestService","$q","$log","localStorageService","dynamicScriptsCacheService","$cordovaAppVersion"],a.service("scriptsSynchronizationService",b)}(mobileServices),function(a,angular,_){function b(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A){function B(a){var b=0;return angular.forEach(a,function(a){return angular.isArray(a)?void angular.forEach(a,function(a){return b+=a}):void(b+=a)}),b}function C(a){var c=_.chain(a).pluck("loadeditems").flatten().filter(function(a){return a.crudoperation===s.operation.create&&!a.problem}).pluck("dataentry").groupBy("application").map(function(a,b){var c=_.pluck(a,"id");return{query:t.DataEntry.deleteInIdsStatement,args:[c,b]}}).value();return c.length<=0?b.when(a):p.executeQueries(c).then(function(){return a})}function D(c){var d=a.get("dataSynchronizationService#onBatchesCompleted"),f=c.start,g=c.batchTuples,j=_.map(g,function(a){var b=a.remote,c=a.local;return i.updateBatch(c,b)});b.all(j).then(function(a){return C(a)}).then(function(a){return u.updateHasProblemToDataEntries(a)}).then(function(a){return k.completeFromAsyncBatch(a).then(function(b){return a})}).then(function(a){return b.all([e.syncData(),h.syncData(!1,null)]).then(function(b){var c=B(b[0]);return k.createSynchronousBatchOperation(f,null,c,a)})}).then(function(a){d.info("created SyncOperation for async Batch Processing"),n.notifySynchronizationReceived(a)})["catch"](function(a){return d.error(a)})}function E(a,c,d){var e=d.items.map(function(b){return o.getEntriesForEntity(b.dataentry,a.application).then(function(a){return b.additionaldata.auditentries=a,b})});return b.all(e).then(function(a){return d.items=a,d})}function F(){return p.countByQuery("DataEntry","isDirty=1 and pending=0").then(function(a){return a>0})}function G(){var c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:persistence.createUUID();if(x.isOffline())return b.reject({message:"Cannot synchronize application without internet connection"});var d=a.get("synchronizationFacade#fullDownload");d.info("Executing full download");var i=(new Date).getTime(),l=j.getApplicationNames(),m=0===l.length,n=[f.syncData("1.0",c),g.syncData(),h.syncData(m,c)].concat(e.syncData(c));return b.all(n).then(function(a){var b=(new Date).getTime();d.info("finished full download process. Ellapsed {0}".format(b-i));var e=a[0],f=a[2],g=a.subarray(3),h=B(g);return k.createNonBatchOperation(i,c,b,h,f,e)})}function H(){return y.get("Mobile","PingAuth",{},{headers:{ignorefailure:!0}})["catch"](function(a){return 401!==a.status?b.reject({message:"Cannot synchronize application, failed to reach server."}):(q.hide(),r.prompt({title:"Relogin Required",subTitle:"Please reenter password.",inputType:"password",okText:"Login",inputPlaceholder:"Your password"}).then(function(a){if(void 0===a)throw{data:{errorMessage:"Relogin required.",requestSupportReport:!1}};q.showDefault();var b=z.currentUser();return z.login(b,a,!0,!0)["catch"](function(){throw{data:{errorMessage:"Failed to login.",requestSupportReport:!1}}})}))})}function I(a){var b="",c=!0,d=!0;if(a&&a.data){b=a.data.errorMessage,c=a.data.requestSupportReport,d=a.data.notifyException;var e=new Error(b);throw e.title="Error Synchronizing Data",e.requestSupportReport=c,e.notifyException=d,e}throw a.title="Error Synchronizing Data",a}function J(a){var c=a?F():b.when(!1);return c.then(function(a){return a?b.when(!1):A.getConfig(ConfigurationKeys.FacilitiesChanged).then(function(a){return!!a})})}function K(){var c=a.get("synchronizationFacade#fullSync",["sync"]);if(c.info("init full synchronization process"),v.trackFullState("synchornizationFacace#fullSync pre-sync"),x.isOffline())return b.reject({message:"Cannot synchronize application without internet connection"});var d=void 0;return d=l.hasActiveLabor()?N().then(function(a){return a?b.when(!0):(q.hide(),l.finishLaborBeforeSynch())}):b.when(!0),d.then(function(a){return a?(q.showDefault(),H().then(function(){var a=persistence.createUUID(),d=(new Date).getTime(),f=j.getMetadatas(),g=f.map(function(a){return i.createBatch(a)});return b.all(g).then(function(f){return!f||f.length<=0||!f.some(function(a){return null!=a})?(c.info("No batches created: Executing full download instead of full sync."),G(a)):(c.info("Batches created locally: submitting to server."),i.submitBatches(f,a).then(function(f){var g=f.filter(function(a){return"COMPLETE"!==a.status});return g.length>0?(angular.forEach(g,function(a){return m.registerForAsyncProcessing(a)}),k.createBatchOperation(d,f)):C(f).then(function(){return u.updateHasProblemToDataEntries(f)}).then(function(){var c=[h.syncData(!1,a),e.syncData(a)];return b.all(c)}).then(function(b){c.debug("Batch returned synchronously --> performing download");var e=B(b[1]);return k.createSynchronousBatchOperation(d,a,e,f)})}))})["finally"](function(){v.trackFullState("synchornizationFacace#fullSync post-sync"),w.updateAppsCount()})})):b.reject({})})}function L(d){var f=a.get("synchronizationFacade#syncItem",["sync"]);f.info("init quick sync process"),v.trackFullState("synchornizationFacace#syncItem pre-quicksync");var g=l.hasItemActiveLabor(d)?l.finishLaborBeforeSynch(d):b.when(!0);return g.then(function(a){return a?H().then(function(){var a=persistence.createUUID(),f=j.getMetadatas().find(function(a){return a.application===d.application}),g=(new Date).getTime();return q.showDefault(),i.createBatch(f,d).then(function(b){return i.submitBatches([b],a)}).then(function(f){return C(f).then(function(){return u.updateHasProblemToDataEntries(f,d)}).then(function(){var c=[];return c.push(h.syncData(!1,a)),d.remoteId?c.push(e.syncSingleItem(d,a)):c.push(e.syncData(a)),b.all(c)}).then(function(b){var c=B(b[1]);return k.createSynchronousBatchOperation(g,a,c,f)}).then(function(a){return c.$broadcast("sw.sync.quicksyncfinished"),a})})["finally"](function(){q.hide(),v.trackFullState("synchornizationFacace#syncItem post-quicksync")})}):b.reject({})})}function M(a){return q.showDefault(),K().then(function(){return q.hide(),!0})["catch"](function(){return q.hide(),r.confirm({title:a.title||"Synchronization Failed",template:a.template||"Continue Anyway?"}).then(function(a){return!!a})})}function N(){return w.getMenuItems().length>0?b.when(!1):p.countByQuery("Menu","data is not null").then(function(a){return 0===a})}i.onBeforeBatchSubmit(E),m.onBatchesCompleted(D);var O={hasDataToSync:F,fullDownload:G,fullSync:K,syncItem:L,attempSyncAndContinue:M,handleDeletableDataEntries:C,isFirstSync:N,handleError:I,shouldFullResync:J};return O}a.factory("synchronizationFacade",["$log","$q","$rootScope","$timeout","dataSynchronizationService","metadataSynchronizationService","scriptsSynchronizationService","associationDataSynchronizationService","batchService","metadataModelService","synchronizationOperationService","laborService","asyncSynchronizationService","synchronizationNotificationService","offlineAuditService","swdbDAO","loadingService","$ionicPopup","crudConstants","offlineEntities","problemService","trackingService","menuModelService","networkConnectionService","offlineRestService","securityService","configurationService",b])}(mobileServices,angular,_),function(a,angular){var b=function(a,b,c,d,e,f){var g={title:"Synchronization Result",message:"A synchronization result has been received. Would you like to check it?",idseed:0},h=!!isRippleEmulator(),i=function(a){return{id:g.idseed++,title:g.title,text:g.message,data:{operationId:a.id}}},j=function(a){var b=i(a);return d.schedule(b)},k=function(b){return e.confirm({title:g.title,template:g.message}).then(function(c){if(c){var d=i(b);a.$broadcast("$cordovaLocalNotification:click",d)}})},l=function(a){return h?k(a):j(a)},m=function(){h||d.hasPermission().then(function(a){d.cancelAll(),a||d.promptForPermission()})},n=function(){h||(f.init(),m())};a.$on("$cordovaLocalNotification:click",function(a,d,e){var f=d.data;angular.isString(d.data)&&(f=JSON.parse(f)),c.go("main.syncoperationdetail",{id:f.operationId}),b.updateAppsCount()});var o={notifySynchronizationReceived:l,checkNotificationPermission:m,prepareNotificationFeature:n};return o};a.factory("synchronizationNotificationService",["$rootScope","menuModelService","routeService","$cordovaLocalNotification","$ionicPopup","notificationPluginWrapper",b])}(mobileServices,angular),function(angular,a){var b=function(a,b,c,d){var e=function(a,d){return c.instantiate("SyncOperation",a).then(function(a){var e=d.every(function(a){return"COMPLETE"===a.status});if(d.forEach(function(b){a.batches.add(b),b.loadeditems&&null!==b.loadeditems&&b.loadeditems.length>0&&(a.items+=b.loadeditems.length),b.syncoperation=a}),e){var f=d.some(function(a){return a.hasProblems});a.status="COMPLETE",a.enddate=(new Date).getTime(),a.hasProblems=f}else a.status="PENDING";var g=b.defer();return persistence.transaction(function(b){try{c.bulkSave(d,b),c.save(a,b),persistence.flush(b,function(){g.resolve(a)})}catch(e){g.reject(e)}}),g.promise})};this.createBatchOperation=function(a,b){var c={startdate:a,items:0};return e(c,b)},this.createSynchronousBatchOperation=function(a,b,c,d){var f=d.some(function(a){return a.hasProblems});b||(b=persistence.createUUID());var g={startdate:a,numberofdownloadeditems:c,numberofdownloadedsupportdata:0,hasProblems:f,clientOperationId:b,enddate:new Date};return e(g,d)},this.createNonBatchOperation=function(a,b,d,e,f,g){var h={clientOperationId:b,startdate:a,enddate:d,status:"COMPLETE",numberofdownloadeditems:e,numberofdownloadedsupportdata:f,metadatachange:g};return c.instantiate("SyncOperation",h).then(function(a){return c.save(a)})},this.hasProblems=function(a){return a.hasProblems},this.getSyncList=function(a){var b=this,d=!a||a<=0?1:a;return c.findByQuery("SyncOperation",null,{pagesize:10,pageNumber:d,orderby:"startdate",orderbyascending:!1}).then(function(a){return!a||a.length<=0?a:a.map(function(a){return b.formatOperation(a)})})},this.getOperation=function(a){var b=this;return c.findById("SyncOperation",a).then(function(a){return b.formatOperation(a)})},this.doneNoProblems=function(a){return a.status.equalIc("complete")&&!this.hasProblems(a)},this.doneWithProblems=function(a){return a.status.equalIc("complete")&&this.hasProblems(a)},this.isPending=function(a){return a.status.equalIc("pending")},this.formatOperation=function(a){return a?(a.formatteddate=d.formatDate(a.startdate,"MM/dd/yyyy HH:mm"),a.elapsedtime=(a.enddate-a.startdate)/1e3,this.doneNoProblems(a)?(a.formattedstatus="Completed",a.issuccess=!0):this.isPending(a)?(a.formattedstatus="Pending",a.ispending=!0):this.doneWithProblems(a)&&(a.formattedstatus="Completed with Issues",a.hasproblems=!0),a):a},this.getBatchItems=function(a){return c.findByQuery("Batch","syncoperation = '{0}'".format(a.id)).then(function(a){var b=a.map(function(a){return"'"+a.id+"'"});return c.findByQuery("BatchItem","batch in ({0})".format(b),{prefetch:"problem"})})},this.getMostRecentOperation=function(){var a=this;return c.findSingleByQuery("SyncOperation",null,{orderby:"startdate",orderbyascending:!1}).then(function(b){return a.formatOperation(b)})},this.completeFromAsyncBatch=function(a){var b=new Date,d=a.map(function(a){return a.syncoperation.status="COMPLETE",a.syncoperation.enddate=b,a.syncoperation});return c.bulkSave(d)}};a.webcommons.service("synchronizationOperationService",["$log","$q","swdbDAO","formatService",b])}(angular,modules),function(angular){function a(a){function b(b,c){if(!c){var d=a.$getByHandle("detailHandler").getScrollPosition();c=d?d.top:0}var e=$(".bar-header.bar-positive:visible").outerHeight(!0),f=$(".bar-subheader.bar-dark:visible").outerHeight(!0),g=$(".crud-details .crud-title:visible").outerHeight(!0),h=$(".crud-details .crud-description:visible").outerHeight(!0),i=e+f+g+h,j=angular.isNumber(c)&&c>=0?c:0,k=$(window).height(),l=k-i-70+j;$(b).css("top",l);var m=$("ion-nav-view[name='body']"),n=$(".list.pane[state='main.cruddetail.maininput']");if(i+m.outerHeight(!0)<k){var o=k-i-8;$(m).css("min-height",o),$(n).css("min-height",o)}}var c={positionFabCommandBar:b};return c}angular.module("sw_mobile_services").factory("commandBarDelegate",["$ionicScrollDelegate",a])}(angular),function(a,ionic){function b(a,b,c,d){function e(){return this.show("Loading")}function f(b){var c=this;h.push(d.registerBackButtonAction(function(a){c.hide()},501));var e={template:"<ion-spinner icon='spiral'></ion-spinner><br><span>"+b+"<span>",animation:"fade-in"};return a.show(e)}function g(){h&&h.forEach(function(a){return a()}),ionic.requestAnimationFrame(function(){a.hide()})}var h=[],i={showDefault:e,show:f,hide:g};return i}a.factory("loadingService",["$ionicLoading","$q","$timeout","$ionicPlatform",b])}(mobileServices,ionic),function(a,angular){function b(a,b){function c(d){d&&(g.showing=!1,d.close()),g.queue.length<=0||b(function(){var d=g.queue.shift(),e=a.alert(d);g.showing=!0;var f=null,h=d.timeout;angular.isNumber(h)&&h>0&&(f=b(function(){c(e)},h)),e.then(function(){f&&b.cancel(f),c(e)})},g.showinterval)}function d(a,b){return a.timeout=b,a}function e(a,b){a=d(a,b),g.queue.push(a),g.queue.length<=1&&!g.showing&&c()}function f(b,c,d){var e=b.join("<br>"),f=d?d+"<br>"+e:e;return a.alert({title:c||"There are Validation Errors",subTitle:f,cssClass:"alert"})}var g={queue:[],showing:!1,showinterval:100},h={show:e,alertValidationErrors:f};return h}a.factory("swAlertPopup",["$ionicPopup","$timeout",b])}(mobileServices,angular),function(angular){angular.module("softwrench").directive("associationDescription",["$parse",function(a){var b={restrict:"A",require:"?ngModel",link:function(a,b,c,d){d.$formatters.push(function(b){var c=a.field;return"true"!==c.hideDescription?b+" - "+a.datamap[c.associationKey+"."+c.labelFields[0]]:b})}};return b}])}(angular),function(angular){angular.module("softwrench").directive("autosizeTextarea",["$timeout",function(a){var b={link:function(b,c,d){function e(a){if(!a)return 1;var b=f(a,h+" "+i),c=Math.ceil(b/g);return c}function f(a,b){var c=f.canvas||(f.canvas=document.createElement("canvas")),d=c.getContext("2d");d.font=b;var e=d.measureText(a);return e.width}var g=$(c).width(),h=$(c).css("font-size"),i=$(c).css("font-family");b.$watch(d.ngModel,function(a){c[0].rows=e(a)}),b.$on("sw:ionAutocomplete:viewValue",function(b,d){d.indexOf(c[0].value)>-1&&a(function(){c[0].rows=e(d)})}),b.$on("sw:optionField:viewValue",function(b,d){a(function(){c[0].rows=e(d)})})}};return b}])}(angular),function(angular){angular.module("softwrench").directive("commandBar",["commandBarDelegate",function(a){var b={restrict:"E",templateUrl:getResourcePath("Content/Mobile/templates/directives/commandbar.html"),replace:!1,scope:{position:"@",schema:"=",datamap:"=",label:"@"},controller:["$scope","$rootScope","offlineCommandService",function(b,c,d){function e(c){console.log("keyboard toggle"),b.$digest(),a.positionFabCommandBar(b.element)}var f=function(){function a(){if(_classCallCheck(this,a),this.constructor===a)throw new TypeError("Cannot instantiate abstract class CommandHolder")}return _createClass(a,[{key:"activeCommands",get:function(){throw new TypeError("Abstract getter for activeCommands not implemented")}},{key:"hasActiveCommands",get:function(){return this.activeCommands.length>0}}]),a}(),g=function(a){function b(){_classCallCheck(this,b);var a=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));if(a.constructor===b)throw new TypeError("Cannot instantiate abstract class SingleCommandHolder");return a}return _inherits(b,a),_createClass(b,[{key:"isSingleActiveCommand",get:function(){return 1===this.activeCommands.length}},{key:"singleActiveCommand",get:function(){return this.activeCommands[0]}}]),b}(f),h=function(a){function c(a){_classCallCheck(this,c);var b=_possibleConstructorReturn(this,(c.__proto__||Object.getPrototypeOf(c)).call(this));return b.commands=a,b}return _inherits(c,a),_createClass(c,[{key:"activeCommands",get:function(){return this.hasCommands?this.commands.filter(function(a){return!d.isCommandHidden(b.datamap,b.schema,a)}):[]}},{key:"hasCommands",get:function(){return angular.isArray(this.commands)&&this.commands.length>0}}]),c}(g),i=function(a){function b(a){_classCallCheck(this,b);var c=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this)),d=angular.isArray(a)&&a.length>0;return c.containers=d?a.filter(function(a){return"ContainerCommand"===a.type}).map(function(a){return new h(a.displayables)}):[],c.childCommands=d?new h(a.filter(function(a){return"ContainerCommand"!==a.type})):[],c}return _inherits(b,a),_createClass(b,[{key:"hasActiveCommands",get:function(){return this.childCommands.hasActiveCommands||this.containers.some(function(a){return a.hasActiveCommands})}},{key:"activeCommands",get:function(){return this.childCommands.activeCommands}}]),b}(g);b.commandBar=new i([]),b.getCommandBarStyleClass=function(){return window.replaceAll(b.position,"\\.","-")},b.executeCommand=function(a){return d.executeCommand(a,b.schema,b.datamap).then(function(a){if(window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard)return cordova.plugins.Keyboard.close()})},b.isCommandHidden=function(a){return!a||d.isCommandHidden(b.datamap,b.schema,a)},b.shouldShowFabCommand=function(){return!(window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard)||!cordova.plugins.Keyboard.isVisible},window.addEventListener("native.keyboardshow",e),window.addEventListener("native.keyboardhide",e);var j=function(a,c){var e=d.getCommands(a||b.schema,c||b.position)||[];b.commandBar=new i(e)},k=function(){return j()};k(),b.$watch("schema",function(a,b){a===b||angular.equals(a,b)||j(a)},!0),b.$watch("position",function(a,b){a!==b&&j(null,a)}),b.$on("sw_updatecommandbar",function(a,c){c===b.position&&j()})}],link:function(b,c,d){a.positionFabCommandBar(c),b.element=c}};return b}])}(angular),function(angular){angular.module("softwrench").directive("crudIcon",[function(){var a={restrict:"E",templateUrl:getResourcePath("Content/Mobile/templates/directives/crud/crud_icon.html"),transclude:!1,replace:!1,scope:{item:"=",isdetail:"=",iscomposition:"@",datamap:"="},controller:["$scope","iconProviderService","crudContextService","$rootScope",function(a,b,c,d){var e=function(c){a.icon=b.getIcon(c,a.iscomposition)};e(a.isdetail?c.currentDetailItem():a.item),a.isdetail&&(d.$on(JavascriptEventConstants.CrudSaved,function(){e(c.currentDetailItem())}),d.$on("sw.labor.start",function(){e(c.currentDetailItem())}),d.$on("sw.labor.stop",function(){e(c.currentDetailItem())}),d.$on("sw.sync.quicksyncfinished",function(){e(c.currentDetailItem())}),d.$on("sw.problem.problemupdated",function(){e(c.currentDetailItem())}),a.$watch("datamap.approwstamp",function(a,b){b&&a!==b&&e(c.currentDetailItem())},!0))}]};return a}])}(angular),function(a,angular,_){a.directive("sectionElementInput",["$compile",function(a){return{restrict:"E",replace:!0,scope:{schema:"=",datamap:"=",isDirty:"=",displayables:"=",associationOptions:"=",associationSchemas:"=",blockedassociations:"=",extraparameters:"=",elementid:"@",orientation:"@",islabelless:"@",lookupAssociationsCode:"=",lookupAssociationsDescription:"="},template:"<div></div>",link:function(b,c,d){angular.isArray(b.displayables)&&(c.append("<crud-input-fields displayables='displayables'schema='schema'datamap='datamap'is-dirty='isDirty'displayables='displayables'association-options='associationOptions'association-schemas='associationSchemas'blockedassociations='blockedassociations'elementid='{{elementid}}'orientation='{{orientation}}' insidelabellesssection='{{islabelless}}'outerassociationcode='lookupAssociationsCode' outerassociationdescription='lookupAssociationsDescription' issection='true'></crud-input-fields>"),a(c.contents())(b))}}}]),a.directive("crudInputFields",[function(){return{restrict:"E",replace:!1,templateUrl:getResourcePath("Content/Mobile/templates/directives/crud/crud_input_fields.html"),scope:{schema:"=",datamap:"=",displayables:"=",allDisplayables:"="},link:function(a,b,c){a.name="crud_input_fields"},controller:["$scope","$rootScope","offlineAssociationService","crudContextService","fieldService","expressionService","dispatcherService","$timeout","$log","wizardService","swdbDAO","searchIndexService","offlineSchemaService",function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(){var b=i.get("crud_input_fields#triggerAssociationsInitialLabels",["association","detail"]),c=e.getDisplayablesOfTypes(a.allDisplayables,["ApplicationAssociationDefinition"]).filter(function(b){return a.datamap.hasOwnProperty(b.attribute)&&!!a.datamap[b.attribute]});if(c.length<=0)return void b.debug("no associationfields with value set in the current datamap");b.isLevelEnabled("debug")&&b.debug("fetching values for fields "+c.map(function(a){return a.attribute}));var d=c.map(function(c){var d=c.associationKey,e=d.endsWith("_")?d.substring(0,d.length-1):d,f=c.entityAssociation.to,g=a.datamap[c.attribute];c["#associationLocalCache"]={associationName:e,associationEntityName:f};var h=m.locateSchemaByStereotype(e,"list"),i=e;h||(h=m.locateSchemaByStereotype(f,"list"),i=f);var j=h?l.getIndexColumn(e,h,c.valueField):null;return j?(b.debug("applying index query"),"( application = '"+i+"' and "+j+" = '"+g+"')"):(b.warn("applying non-indexed query consider adjusting your metadata to include the proper index for "+e+": "+c.valueField),"(application in('"+e+"','"+f+"') and datamap like '%\""+c.valueField+'":"'+g+"\"%')")}),f=d.join("or");b.debug("fetching labels with query '"+f+"'"),k.findByQuery("AssociationData",f).then(function(d){var e=d.map(function(b){var d=c.find(function(c){return(b.application===c["#associationLocalCache"].associationName||b.application===c["#associationLocalCache"].associationEntityName)&&b.datamap[c.valueField]===a.datamap[c.attribute]});return{associationKey:d.associationKey,item:b}});c.forEach(function(a){return delete a["#associationLocalCache"]});var f=_.indexBy(e,"associationKey");b.debug("resolved items for labels: "+f),a.$broadcast("sw:association:resolved",f)})}function o(){var c=a.allDisplayables.filter(function(a){return a.events&&a.events.hasOwnProperty("afterchange")&&!!a.events.afterchange});if(c&&!(c.length<=0)){var d=i.get("crud_input_fields",["datamap","event","association"]),e=new q(c,g,h,d);d.debug("watching "+e.expressions),b.areChangeEventsEnabled=!0,e.expressions.forEach(function(c){a.$watch(c,function(d,f){d!==f&&b.areChangeEventsEnabled&&e.dispatchEventFor(c,a.schema,a.datamap,d)})})}}function p(){i.get("crud_input_fieldsl#init").debug("crud_input_fields init"),n(),o()}a.associationSearch=function(b,d,e,f,g){return c.filterPromise(a.schema,a.datamap,d,b,null,e,f,g)},a.itemSelected=function(a){return c.updateExtraProjections(a.item,a.componentId)},a.optionFieldSelected=function(a){return c.updateExtraProjectionsForOptionField(a.item,a.componentId)},a.getAssociationLabelField=function(a){return c.fieldLabelExpression(a)},a.getAssociationValueField=function(a){return c.fieldValueExpression(a)},a.isReadOnly=function(b){return e.isFieldReadOnly(a.datamap,a.schema,b,a)||j.isReadOnly(b,a.allDisplayables)},a.isFieldHidden=function(b){return e.isFieldHidden(a.datamap,a.schema,b)},a.isFieldRequired=function(b){return Boolean(b)?f.evaluate(b,a.datamap):b},a.hasUseWhereClause=function(a){var b=a.rendererParameters;return!!b&&"true"===b.hasUseWhereClause};var q=function(){function b(a,c,d,e){_classCallCheck(this,b),this.fields=a,this.dispatcher=c,this.timeout=d,this.logger=e,this.eventDescriptors=this.fields.map(function(a,b){return{name:a.attribute,shouldWatch:!0,event:a.events.afterchange}}),this.expressions=this.eventDescriptors.map(function(a){return"datamap."+a.name})}return _createClass(b,[{key:"getEvent",value:function(a){return this.eventDescriptors.find(function(b){return"datamap."+b.name===a})}},{key:"handleIgnoreWatchScenario",value:function(b,c,e,f){b.shouldWatch=!1;var g=c.substring(0,f);"null"===g&&(g=null),this.logger.debug("setting real value "+g+" for association "+b.name);var i=d.currentDetailItemDataMap();i[b.name]=g,e[b.name]=g;try{a.$digest(),b.shouldWatch=!0}catch(j){h(function(){return b.shouldWatch=!0},0,!1)}}},{key:"dispatchEventFor",value:function(a,b,c,d){var e=this,f=this.getEvent(a);if(!f.shouldWatch)return void this.logger.trace("ignoring event for "+f.name);var g=null!==d&&void 0!==d&&angular.isFunction(d.indexOf)?d.indexOf("$ignorewatch"):-1;if(g>=0)return this.handleIgnoreWatchScenario(f,d,c,g);var h=f.event.service,i=f.event.method,j=this.dispatcher.loadService(h,i),k={schema:b,datamap:c,newValue:d};this.logger.debug("dispatching 'afterchange' event for field '"+f.name+"'. Value: "+d),this.timeout(function(){return j(k)})["catch"](function(a){return e.logger.error("Failed to execute "+h+"."+i+" on 'afterchange' of field '"+f.name+"'",a)})}}]),b}();a.$on("sw_cruddetailrefreshed",function(){a.datamap=d.currentDetailItemDataMap(),n()}),p()}]}}])}(softwrench,angular,_),function(a){a.directive("crudOutputFields",["$log","fieldService","crudContextService","formatService",function(a,b,c,d){return{restrict:"E",replace:!1,transclude:!0,templateUrl:getResourcePath("Content/Mobile/templates/directives/crud/crud_output_fields.html"),scope:{displayables:"=",datamap:"="},link:function(a,b,c){a.name="crud_output_fields"},controller:["$scope",function(a){a.getFormattedValue=function(a,b,c){return d.format(a,b,c)},a.getDisplayables=function(){return a.displayables},a.isFieldHidden=function(a){return b.isFieldHidden(c.currentDetailItem(),c.currentDetailSchema(),a)}}]}}])}(softwrench),function(angular){angular.module("softwrench").directive("dateconverter",["formatService",function(a){var b={restrict:"A",require:"?ngModel",link:function(b,c,d,e){e.$parsers.push(function(c){return c instanceof Date?a.formatDate(c,b.field.rendererParameters.format):c}),e.$formatters.push(function(a){return new Date(a)}),b.dateHandler=function(){function a(a,b){var c=a.rendererParameters;return!c.hasOwnProperty(b)||"false"!==c[b]&&c[b]!==!1?null:new Date}function b(b){return a(b,"allowfuture")}function c(b){return a(b,"allowpast")}return{getMaxDateValue:b,getMinDateValue:c}}()}};return b}])}(angular),function(angular){angular.module("softwrench").directive("messagesection",["$log","$rootScope",function(a,b){var c={restrict:"E",templateUrl:getResourcePath("Content/Mobile/templates/directives/messagesection.html"),scope:{},controller:["$scope",function(a){a.$on("$stateChangeSuccess",function(b,c,d,e,f){a.hasValidationError=!1,a.validationArray=null})}],link:function(b,c,d){b.$on("sw_validationerrors",function(c,d){a.get("messagesection#sw_validationerrors").debug("sw_validationerrors#enter"),null!=d&&0!=d.length&&(b.hasValidationError=!0,b.validationArray=d)}),b.removeValidationAlert=function(){b.hasValidationError=!1,b.validationArray=null}}};return c}])}(angular),function(a){a.directive("optionField",["$ionicModal","$log",function(a,b){return{restrict:"E",templateUrl:getResourcePath("Content/Mobile/templates/directives/option_field.html"),scope:{items:"=",text:"=",value:"=",componentId:"@",callback:"=",callback2:"&"},link:function(c,d,e){d.find("textArea").on("focus",function(a){a.target.blur()}),c.multiSelect="true"===e.multiSelect,c.allowEmpty="false"!==e.allowEmpty,c.headerText=e.headerText||"",c.defaultText=c.text||"",c.noteText=e.noteText||"",c.noteImg=e.noteImg||"",c.noteImgClass=e.noteImgClass||"";var f=function(a){angular.forEach(c.items,function(b){b.value===a&&(b.checked=!0)})},g=function(a){angular.forEach(a,function(a){a&&f(a)})},h=null,i=function(){return c.$watch("value",function(a,b){a!==h&&c.items&&c.multiSelect&&(h=a,angular.forEach(c.items,function(a){return a.checked=!1}),a&&g(a.split(";")))})};c.deWatchValueChanges=i(),a.fromTemplateUrl(getResourcePath("Content/Mobile/templates/directives/option_field_item.html"),{scope:c}).then(function(a){c.modal=a});var j={moved:!1,startX:0,startY:0};c.onTouchStart=function(a){b.get("optionfield#ontouchstart",["association"]).trace("ontouchstart handler"),j.moved=!1,"undefined"!=typeof a.originalEvent&&(a=a.originalEvent),j.startX=a.touches[0].clientX,j.startY=a.touches[0].clientY},c.onTouchMove=function(a){b.get("optionfield#ontouchmove",["association"]).trace("ontouchmove handler"),"undefined"!=typeof a.originalEvent&&(a=a.originalEvent),(Math.abs(a.touches[0].clientX-j.startX)>10||Math.abs(a.touches[0].clientY-j.startY)>10)&&(j.moved=!0)},c.showItems=function(a){a.preventDefault(),c.modal.show()},c.validate=function(a){1==c.multiSelect&&(c.deWatchValueChanges(),c.value="",c.text="",c.items&&jQuery.each(c.items,function(a,b){b.checked&&(c.value=c.value+b.value+";",c.text=c.text+b.label+", ")}),c.value=c.value.substr(0,c.value.length-1),c.text=c.text.substr(0,c.text.length-2),c.deWatchValueChanges=i()),"undefined"!=typeof c.value&&""!=c.value&&null!=c.value||(0==c.allowEmpty?(c.value=c.items[0].value,c.text=c.items[0].label,c.items[0].checked=!0):c.text=c.defaultText),c.hideItems(),"function"==typeof c.callback&&c.callback(c.value)},c.hideItems=function(){c.modal.hide()},c.$on("$destroy",function(){c.modal.remove()}),c.validateSingle=function(a){c.text=a.label,c.value=a.value,c.hideItems(),"function"==typeof c.callback&&c.callback(c.value),"function"==typeof c.callback2&&c.callback2({callback:{item:a,componentId:c.componentId}})};var k=d[0].querySelector(".js_option_input"),l=angular.element(k).controller("ngModel");l.$formatters.push(function(a){if(!a||!c.items)return a;var b=c.items.find(function(b){return b.value===a}),d=b?b.label:a;return c.$emit("sw:optionField:viewValue",d),d})}}}])}(softwrench),function(angular){angular.module("softwrench").directive("richTextField",[function(){var a={restrict:"E",templateUrl:getResourcePath("Content/Mobile/templates/directives/richtextfield.html"),replace:!1,scope:{value:"=",readOnly:"=",maxLength:"=",isRequired:"="},controller:["$scope",function(a){a.config={options:{toolbar:!1,statusbar:!1,debounce:!0,inline:!1,theme:"modern",skin_url:"Content/Vendor/css/skins/lightgray",content_css:"css/tinymce.css",menubar:!1,readonly:a.readOnly,convert_urls:!1,urlconverter_callback:function(a){return a}}}}]};return a}])}(angular),function(angular){angular.module("softwrench").directive("sideMenu",[function(){var a={restrict:"E",templateUrl:getResourcePath("Content/Mobile/templates/directives/sidemenu.html"),scope:{},controller:["$scope","menuModelService","menuRouterService","routeService","$ionicSideMenuDelegate","swAlertPopup","$ionicPopup","securityService","synchronizationFacade","networkConnectionService",function(a,b,c,d,e,f,g,h,i,j){function k(){return h.logout().then(function(){return!0})["catch"](function(){return f.show({title:"Logout failed",template:"Unexpected logout error.<br>Please contact support."},3e3),!1})}a.vm={activeleaf:null},a.menuleafs=function(){return b.getApplicationMenuItems()},a.isActive=function(b){return"string"==typeof b||b instanceof String?!a.vm.activeleaf&&"main.home"===b||a.vm.activeleaf===b:a.vm.activeleaf===b.id;
},a.loadApplication=function(b,d){c.routeFromMenuItem(d)["catch"](function(a){return f.show({title:"Error",template:a.message},3e3)})["finally"](function(){return e.toggleLeft()}),b.stopImmediatePropagation(),a.vm.activeleaf=d.id},a.loadAction=function(b){d.go(b),e.toggleLeft(),a.vm.activeleaf=b},a.adminMenuItems=function(){return b.getAdminMenuItems()},a.userMenuItems=function(){return b.getUserMenuItems()},a.getAppCount=function(a){return b.getAppCount(a)},a.logout=function(){i.hasDataToSync().then(function(a){return a?j.isOffline()?(f.show({title:"No internet connection detected",template:["You still have data to synchronize","Please connect to the internet to logout."].join("<br>")},3e3),!1):g.confirm({title:"Logout",template:["A synchronization will be performed before the logout, but some data might be lost.","A synchronization will be required after the next login.","Are you sure you want to logout?"].join(" ")}).then(function(a){return a?i.attempSyncAndContinue({template:"Do you wish to logout anyway?"}):a}).then(function(a){return!!a&&k()}):k()}).then(function(a){a&&d.go("login")})["finally"](function(){e.toggleLeft()})}}]};return a}])}(angular),function(angular,a){angular.module("softwrench").directive("singleFileInput",[function(){var a={restrict:"E",templateUrl:getResourcePath("Content/Mobile/templates/directives/singlefileinput.html"),replace:!1,scope:{datamap:"=",schema:"=",fieldName:"@"},controller:["$element","$scope","$timeout","offlineSchemaService","loadingService",function(a,b,c,d,e){b.model={field:d.getFieldByAttribute(b.schema,b.fieldName)};var f=b.model.field.rendererParameters.showImagePreview,g=a[0].querySelector("input[type='file']"),h=function(a){e.showDefault();var d=a.target.files[0],f=d.type,g=d.name,h=new FileReader;h.onloadend=function(a){return c(function(){b.datamap[b.fieldName]=a.target.result,b.model.field.rendererParameters.showImagePreview=!!f&&f.contains("image"),b.datamap.document=g,b.datamap.newattachment_path=g,b.datamap["#mimetype"]=f})["finally"](function(){return e.hide()})},h.readAsDataURL(d)};angular.element(g).on("change",h),b.$on("$destroy",function(){angular.element(g).off("change",h),b.model.field.rendererParameters.showImagePreview=f})}]};return a}])}(angular,jQuery),function(angular){angular.module("softwrench").directive("swOperationIcon",[function(){return{restrict:"E",templateUrl:getResourcePath("Content/Mobile/templates/directives/swoperationicon.html"),scope:{operation:"=syncOperation"}}}])}(angular),function(a){function b(a,b,c){function d(c,d,e,f){var g=f?"findByQuery":"findSingleByQuery";return a[g]("DataEntry","application='"+c+"' and datamap like '%\""+d+'":"'+e+"\"%'").then(function(a){return!a||f&&a.length<=0?b.reject(new Error(h(c)+" with "+d+" = "+e+" not found")):a})}function e(a,b,c){return d(a,b,c,!0)}function f(a,b,c){return d(a,b,c)}function g(a,b,c){return f(a,b.userIdFieldName,c)}var h=c("capitalize"),i={loadItemsByField:e,loadSingleItemByField:f,loadItemByMaximoUid:g};return i}a.factory("maximoDataService",["swdbDAO","$q","$filter",b])}(offlineMaximoApplications),function(a){function b(){function a(a,b){null!=b&&a.status!==b.status&&(a["#hasstatuschange"]=!0,a["#forcestatuschance"]=!0)}var b={preSync:a};return b}a.factory("workorderOfflineService",[b])}(offlineMaximoApplications),function(a){a.filter("capitalize",function(){return function(a){return a?(a=a.toLowerCase(),a.substring(0,1).toUpperCase()+a.substring(1)):a}})}(softwrench),function(a){a.filter("linebreak",function(){return function(a){return null!=a?(a=a.toString(),a.replace(/\n/g,"<br/>")):a}})}(softwrench),function(angular,a,_){angular.module("softwrench").config(["$provide",function(b){b.decorator("$cordovaEmailComposer",["$delegate","$q",function(b,c){function d(a){return function(){var b=_.contains(arguments,!0);b?a.resolve(!0):a.reject(new Error("Email is not available in this device"))}}function e(){var b=c.defer();return a.plugins.email.isAvailable(d(b)),b.promise}return b.isAvailable=e.bind(b),b}])}])}(angular,cordova,_),function(angular){angular.module("softwrench").config(["$provide",function(a){function b(a,b,c,d){function e(a){return a.message=d[a.code]||a.message,a}function f(a,d){var f=c.defer(),g=a+(d?d:"");try{b.resolveLocalFileSystemURL(g,function(a){var b=a.createReader();b.readEntries(function(a){return f.resolve(a)},function(a){return f.reject(e(a))})},function(a){return f.reject(e(a))})}catch(h){f.reject(e(h))}return f.promise}return angular.isFunction(a.listDir)||(a.listDir=f.bind(a)),a}a.decorator("$cordovaFile",["$delegate","$window","$q","$cordovaFileError",b])}])}(angular),function(angular,a,b){a.config(["$provide",function(a){a.decorator("$exceptionHandler",["$delegate","$injector","fileConstants","rollingLogFileConstants",function(a,b,c,d){function e(a,c){var d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:b,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"get";return a||(a=d[e](c)),a}var f,g,h,i,j;return function(a,b){if(!(a&&isString(a)&&a.startsWith("Possibly unhandled rejection:")||a.notifyException===!1)){g=e(g,"$log"),f=e(f,"swAlertPopup"),h=e(h,"$exceptionHandler",g),h.error.apply(h,arguments),i=e(i,"supportService");var c={subject:"Unexpected Error"};return a&&a.title&&(c.title=a.title),c.notifyException=a.notifyException,c.requestSupportReport=a.requestSupportReport,"unreacheable"===a.type?(j=e(j,"offlineRestService",j),j.get("SignIn","Ping",{},{timeout:3e3}).then(function(){i.requestLogReporting(c)})["catch"](function(){f.show({title:a.title,template:"Server unreachable.<br> Please make sure the url in settings is correct and check your internet / vpn connection."})})):void(a.requestSupportReport!==!1?i.requestLogReporting(c):f.show({title:a.title,template:a.message}))}}}])}])}(angular,mobileServices,cordova),function(angular,a,_){a.config(["$provide",function(a){a.decorator("$log",["$delegate","$injector","rollingLogFileConstants","fileConstants",function(a,b,c,d){function e(){k.enabled&&(j||(j=b.get("$roll")),k.configured||j.setConfig(k.config),m())}function f(a,b){k.enabled&&k.started&&j[a].apply(j,b)}function g(a,b,c){return function(){var d=[].slice.call(arguments),e=a.apply(c,d);return c.isLevelEnabled(b)&&e&&e.length>0&&f(b,e),e}}function h(a){for(var b in a)a.hasOwnProperty(b)&&angular.isFunction(a[b])&&n(b)&&(a[b]=g(a[b],b,a))}function i(){return window.loglevel||(p||(p=b.get("contextService")),window.loglevel=p.retrieveFromContext("defaultlevel")||"warn"),window.loglevel}var j,k={enabled:d.fileEnabled,configured:!1,started:!1,config:{logSize:c.logFileSize,eventBuffer:c.eventBuffer,writeOnPause:c.writeOnPause,console:c.logToConsole,debug:c.debug,prefix:c.logFileName,directory:d.appDirectory}},l=["log","info","warn","debug","trace","error"],m=ionic.debounce(function(){k.started||j.start().then(function(){return k.started=!0})["catch"](function(a){return console.error("Couldn't start file logger",a)})},100),n=function(a){return _.contains(l,a)},o=a.getInstance,p=null;sessionStorage.loglevel&&(window.loglevel=sessionStorage.loglevel);var q=Object.getOwnPropertyDescriptor(sessionStorage,"loglevel");q&&q.configurable!==!0||Object.defineProperty(sessionStorage,"loglevel",{set:function(a){return window.loglevel=a},get:function(){return window.loglevel}},{enumerable:!0,writable:!0,configurable:!0});var r={};return a.getInstance=function(){arguments[1]&&arguments[1].indexOf("angular")!==-1||e();var b=i();r[b]||(r[b]={});var c=arguments[0]+"#"+arguments[1];if(r[b][c])return r[b][c];var d=[].slice.call(arguments),f=o.apply(a,d);return h(f),r[b][c]=f,f},a}])}])}(angular,mobileServices,_),function(angular){angular.module("sw_mobile_services").config(["$provide",function(a){a.decorator("$q",["$delegate",function(a){var b=a.defer;return a.defer=function(){var a=b().promise.constructor.prototype;return Object.defineProperty(a,"spread",{value:function(a,b){function c(b){return a.apply(void 0,b)}return this.then(c,b)},writable:!0,enumerable:!1}),b()},a}])}])}(angular),function(angular){var a=function(){function a(b,c,d){_classCallCheck(this,a),this.swdbDAO=b,this.$log=c,this.loadingService=d}return _createClass(a,[{key:"createIndexAfterFirstSync",value:function(){var a=this,b=[],c=this.$log.get("indexCreatorService#createIndexAfterFirstSync",["persistence"]);isRippleEmulator()||(c.info("creating sql indexes"),this.loadingService.show("Applying Indexes"),b.push(this.swdbDAO.addIndexQuery("DataEntry","textindex01",!1)),b.push(this.swdbDAO.addIndexQuery("DataEntry","textindex02",!1)),b.push(this.swdbDAO.addIndexQuery("DataEntry","dateindex01",!1)),b.push(this.swdbDAO.addIndexQuery("DataEntry",["application","remoteid"],!0)),b.push(this.swdbDAO.addIndexQuery("AssociationData","textindex01",!1)),b.push(this.swdbDAO.addIndexQuery("AssociationData","textindex02",!1)),b.push(this.swdbDAO.addIndexQuery("AssociationData",["application","textindex01"],!1)),this.swdbDAO.executeQueries(b).then(function(b){c.info("sql indexes created successfully"),a.loadingService.hide()}))}},{key:"dropIndexes",value:function(){var a=this.$log.get("indexCreatorService#dropIndexes",["persistence"]);isRippleEmulator()||(a.info("dropping sql indexes"),this.swdbDAO.dropIndex("DataEntry","textindex01"),this.swdbDAO.dropIndex("DataEntry","textindex02"),this.swdbDAO.dropIndex("DataEntry","dateindex01"),this.swdbDAO.dropIndex("AssociationData","textindex01"),this.swdbDAO.dropIndex("AssociationData","textindex02"),this.swdbDAO.dropIndex("AssociationData",["application","textindex01"]),this.swdbDAO.dropIndex("DataEntry",["application","remoteid"]),a.info("sql indexes dropped successfully"))}}]),a}();a.$inject=["swdbDAO","$log","loadingService"],angular.module("persistence.offline").service("indexCreatorService",a)}(angular),function(angular){try{angular.module("persistence.offline")}catch(a){return}angular.module("persistence.offline").config(["offlineMigrationsProvider",function(a){a.createMigrationGroup(15,"index migrations")}])}(angular),function(angular,_){function a(a,b,c,d,e,f,g,h,i,j){function k(a){return a=a.slice(-12),f.loadSingleItemByField("transportation","serialnum",a)["catch"](function(b){var c=e.confirm({title:"Transportation Asset Scan",template:"VIN/SN "+a+" not found.<br>Would you like to scan using the asset?"});return c.then(function(b){return b?(w.vin=a,w.vinMode=!1,j.reject({code:w.codes.ignore})):j.reject({code:w.codes.ignore})})})}function l(a,b){return f.loadItemByMaximoUid("transportation",b,a).then(function(a){return a.datamap.serialnum=w.vin,a})["finally"](function(){w.vin=null,w.vinMode=!0})}function m(a,f,g){return a.then(function(a){return d.registerEvent("scan",f,a.id,a.remoteId,g).then(function(b){return a})}).then(function(a){return c.refreshGrid().then(function(){return a})}).then(function(a){return c.loadDetail(a)})["catch"](function(a){a&&a.code===w.codes.ignore||(b.get("paeAssetService#initScanEventListener",["scan"]).error(a),e.alert({title:a.message}))})}function n(b,c){a.registerScanCallBackOnSchema(c,function(a){var c=f.loadItemByMaximoUid("asset",b,a).then(function(a){return a.isDirty=!0,h.saveItem("asset",a,"Asset",!1)});m(c,"asset",a)})}function o(a){var b=c.currentDetailItem(),d=i.currentFullUser().PersonId,e=new Date;return b.isDirty=!0,b.datamap.invposttype="AUTOMATIC",b.datamap.invpostdateby=d,b.datamap.changeby=d,b.datamap.invpostdate=e,b.datamap.changedate=e,b.datamap.scanremarks="No Scan Remarks Entered",h.saveItem("transportation",b,"Transportation",!1)}function p(b,c){a.registerScanCallBackOnSchema(c,function(a){var c=w.vinMode?k(a):l(a,b),d=c.then(function(a){var b=i.currentFullUser().PersonId,c=new Date;return a.isDirty=!0,a.datamap.invposttype="AUTOMATIC",a.datamap.invpostdateby=b,a.datamap.changeby=b,a.datamap.invpostdate=c,a.datamap.changedate=c,a.datamap.scanremarks="No Scan Remarks Entered",h.saveItem("transportation",a,"Transportation",!1)});m(d,"transportation",a)})}function q(a,b){a["#originallocation"]=a.location}function r(a,b,c,d){n(b,d)}function s(a,b,c,d){n(b,d)}function t(a,b,c,d){p(b,d)}function u(a,b,c,d){p(b,d)}function v(a,b){var c=i.currentFullUser();b.changeby=c.PersonId,b.changedate=new Date}var w={vin:null,vinMode:!0,codes:{ignore:"CODE_IGNORE_ERROR"}},x={initAssetDetailListener:r,initAssetGridListener:s,initTransportationDetailListener:t,initTransportationGridListener:u,markAsScanned:o,preSync:q,transportationAssetChanged:v};return x}angular.module("maximo_offlineapplications").service("paeAssetService",["scanningCommonsService","$log","crudContextService","offlineAuditService","$ionicPopup","maximoDataService","swdbDAO","offlineSaveService","securityService","$q",a])}(angular,_),function(angular){var a=function(a){var b=[];return angular.forEach(a,function(a){b.push("'{0}'".format(a))}),b},b=function(){function b(a,c,d){_classCallCheck(this,b),this.searchIndexService=a,this.entities=c,this.fsLaborOfflineService=d}return _createClass(b,[{key:"modifyQueries",value:function(b,c){var d=this,e=_.chain(b.compositionData).filter(function(a){return"labtrans_"===a.applicationName}).pluck("newdataMaps").flatten().value();if(e.length>0){var f=(b.compositionData.find(function(a){return"labtrans_"===a.applicationName}),new Set);e.forEach(function(a){var b=d.fsLaborOfflineService.generateTsLaborDataEntryQuery(a);c.push(b.query),f.add(b.wonum)});var g=a(Array.from(f));c.push({query:"delete from DataEntry where application = 'tslabor' and rowstamp is null and textindex02 in ({0})".format(g)})}return null}}]),b}();b.$inject=["searchIndexService","offlineEntities","fsLaborOfflineService"],angular.module("sw_mobile_services").service("firstsolar.dataSynchronizationHook",b)}(angular),function(angular){var a=function(){function a(b,c,d,e,f){_classCallCheck(this,a),this.$rootScope=b,this.securityService=c,this.searchIndexService=d,this.entities=e,this.dao=f,this.$rootScope.$on("sw_itemrestored",function(a,b){f.executeQuery({query:"delete from DataEntry where application = 'tslabor' and textindex02 = ? and rowstamp is null",args:[b.datamap.wonum]})})}return _createClass(a,[{key:"laborCode",value:function(){var a=this.securityService.currentFullUser();return null==a?this.securityService.logout():a.properties.laborcode}},{key:"getCurrentWeekLaborsWhereClause",value:function(){var a=new Date,b=a.getDate()-a.getDay(),c=b+6,d=new Date(a.setDate(b)).getTime(),e=new Date(a.setDate(c)).getTime(),f=this.laborCode();return"`root`.dateindex01 >= {0} and `root`.dateindex01 < {1} and `root`.textindex01 = '{2}'".format(d,e,f)}},{key:"getCurrentMonthLaborsWhereClause",value:function(){var a=new Date,b=new Date(a.getFullYear(),a.getMonth(),1,0,0,0).getTime(),c=new Date(a.getFullYear(),a.getMonth()+1,1,0,0,0).getTime(),d=this.laborCode();return"`root`.dateindex01 >= {0} and `root`.dateindex01 < {1} and `root`.textindex01 = '{2}'".format(b,c,d)}},{key:"generateTsLaborDataEntryQuery",value:function(a){var b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],c=!a.id,d=persistence.createUUID(),e=a.id,f=a.approwstamp;c&&(a["#runninglabor"]=b,e=a["#localswdbid"]?a["#localswdbid"]:d,f=null);var g=a.jsonFields||JSON.stringify(a),h=a.jsonFields?JSON.parse(a.jsonFields):a,i=this.searchIndexService.buildIndexes(["laborcode","refwo"],[],["enterdate"],h),j=this.entities.DataEntry.insertOrReplacePattern,k={query:j,args:["tslabor",g,e,f,d,i.t1,i.t2,i.t3,i.t4,i.t5,i.n1,i.n2,i.d1,i.d2,i.d3]};return{query:k,wonum:h.refwo}}},{key:"insertTsLaborDataEntry",value:function(a,b){var c=this.generateTsLaborDataEntryQuery(a,b).query;return this.dao.executeQuery(c)}}]),a}();a.$inject=["$rootScope","securityService","searchIndexService","offlineEntities","swdbDAO"],angular.module("sw_mobile_services").service("fsLaborOfflineService",a)}(angular),function(angular,_){var a=864e5,b="select textindex04 from DataEntry where application like '%workorder' and textindex04 is not null",c="select textindex01 from associationdata where application = 'locancestor' and textindex02 in ("+b+")",d="textindex01 in ("+b+") or textindex01 in ("+c+")",e="select textindex01 from associationdata where application = 'locancestor' and textindex02 = @location",f="textindex01 = @location or textindex01 in ("+e+")",g=function(){function b(a,c,d,e,f,g,h){_classCallCheck(this,b),this.$q=a,this.crudContextService=c,this.dao=d,this.$timeout=e,this.securityService=f,this.offlineSchemaService=g,this.$log=h}return _createClass(b,[{key:"afterFailureChanged",value:function(){var a=this.crudContextService.currentDetailItemDataMap();null!=a.problemcode&&(a.problemcode="null$ignorewatch"),null!=a.fr1code&&(a.fr1code="null$ignorewatch"),null!=a.fr2code&&(a.fr2code="null$ignorewatch")}},{key:"afterProblemChanged",value:function(){var a=this.crudContextService.currentDetailItemDataMap();null!=a.fr1code&&(a.fr1code="null$ignorewatch"),null!=a.fr2code&&(a.fr2code="null$ignorewatch")}},{key:"afterCauseChanged",value:function(){var a=this.crudContextService.currentDetailItemDataMap();null!=a.fr2code&&(a.fr2code="null$ignorewatch")}},{key:"afterRemedyChanged",value:function(){}},{key:"updateLocation",value:function(a){var b=a.datamap,c=b.assetnum;if(!c||angular.isArray(c)&&0===c.length)return this.$q.when();var d=b["offlineasset_.location"],e=b["offlineasset_.failurecode"];return b.location=d+"$ignorewatch",b.failurecode=e,e?this.dao.findSingleByQuery("AssociationData","textindex01='"+e+"' and application = 'failurelistonly'").then(function(a){b["failurelistonly_.failurelist"]=a.datamap.failurelist}):void 0}},{key:"clearAsset",value:function(a){var b=a.datamap;b.assetnum="null$ignorewatch"}},{key:"onDetailLoad",value:function(){var a=this.$log.get("fsWorkorderOfflineService#onDetailLoad",["crud","detail"]),b=this.crudContextService.currentDetailItem(),c=b.datamap,d=c.problemlist,e=c.fr1list,f=c.failurelist;d&&(c["offlineproblemlist_.failurelist"]=d),f&&(c["failurelistonly_.failurelist"]=f),e&&(c["offlinecauselist_.failurelist"]=e),a.debug("setting failurelist ids")}},{key:"onNewDetailLoad",value:function(a,b,c){var d=this.offlineSchemaService,e=this.$timeout;this.dao.findSingleByQuery("AssociationData","application='classstructure' and datamap like '%\"description\":\"Field Analysis\"%'").then(function(a){if(a&&a.datamap&&a.datamap.classstructureid){var f=a.datamap.classstructureid,g=a.datamap.description;c.classstructureid=f;var h=document.querySelector("textarea[ion-autocomplete][item-value-key='datamap.classstructureid']"),i=d.getFieldByAttribute(b,"classstructureid"),j=!_.contains([!1,"false","False",0,"0"],i.rendererParameters.showCode);h&&e(function(){var a=angular.element(h).controller("ngModel");a.$viewValue=j?f+" - "+g:g,a.$render()})}})}},{key:"assignWorkOrder",value:function(a,b){var c=this.crudContextService,d=this.$timeout,e=c.currentDetailItem();return e.application="workorder",this.crudContextService.saveChanges().then(function(a){return c.loadApplicationGrid("workorder","list").then(function(){return d(function(){return c.loadDetail(a)},0,!1)})})}},{key:"getLocationsWhereClause",value:function(){return d}},{key:"getAssetWhereClause",value:function(){return f}},{key:"getFacilityFilterWhereClause",value:function(a){var b=a.split(","),c=[];return angular.forEach(b,function(a){var b=a.trim();b&&c.push("root.textindex04 like '"+b+"%'")}),"("+c.join(" or ")+")"}},{key:"getFacilityFilterOptions",value:function(){var a=[],b=this.securityService.currentFullUser();if(!b)return a;var c=b.properties;if(!c)return a;var d=c["sync.facilities"];return d?(angular.forEach(d.sort(),function(b){var c={value:b};c.label=c.value,c.text=c.value,a.push(c)}),a):a}},{key:"laborCode",value:function(){var a=this.securityService.currentFullUser();return null==a?this.securityService.logout():a.properties.laborcode}},{key:"getTodayWosWhereClause",value:function(){var b=new Date,c=new Date(b.getFullYear(),b.getMonth(),b.getDate(),0,0,0).getTime(),d=c+a,e=this.laborCode();return"assignment_.dateindex01 >= "+c+" and assignment_.dateindex01 < "+d+" and assignment_.textindex02 = '"+e+"'"}},{key:"getBaseWhereClause",value:function(){var a=this.laborCode();return"assignment_.textindex02 = '"+a+"'"}},{key:"getPastWosWhereClause",value:function(){var a=new Date,b=new Date(a.getFullYear(),a.getMonth(),a.getDate(),0,0,0).getTime(),c=this.laborCode();return"assignment_.dateindex01 < "+b+" and assignment_.textindex02 = '"+c+"'"}},{key:"getFutureWosWhereClause",value:function(){var b=new Date,c=new Date(b.getFullYear(),b.getMonth(),b.getDate(),0,0,0).getTime()+a,d=this.laborCode();return"assignment_.dateindex01 >= "+c+" and assignment_.textindex02 = '"+d+"'"}},{key:"getCreatedWosWhereClause",value:function(){return"`root`.remoteId is null"}}]),b}();g.$inject=["$q","crudContextService","swdbDAO","$timeout","securityService","offlineSchemaService","$log"],angular.module("maximo_offlineapplications").service("fsWorkorderOfflineService",g)}(angular,_),function(angular){angular.module("softwrench").controller("FsLocationDrillDownController",["$rootScope","$scope","$timeout","$ionicHistory","drillDownService","crudContextService","swdbDAO",function(a,b,c,d,e,f,g){b.buildLocationTitle=function(a){if(!a)return"";var b=a.datamap;return b.description?b.location+" - "+b.description:b.location},b.buildAssetTitle=function(a){if(!a)return"";var b=a.datamap;return b.description?b.assetnum+" - "+b.description:b.assetnum},b.locationClick=function(a){e.locationDrillDownClick(a)},b.locationTitle=function(){return b.buildLocationTitle(b.drillDown.selectedLocation)},b.locationSubTitle=function(){var a=b.drillDown,c=a.locationsCount+" "+(1===a.locationsCount?"sublocation":"sublocations"),d=a.assetsCount+" "+(1===a.assetsCount?"asset":"assets");return c+" - "+d},b.noChildLocations=function(){return 0===(b.drillDown.locations?b.drillDown.locations.length:0)},b.assetsSubTitle=function(){var a=b.drillDown;return a.assetsCount+" "+(1===a.assetsCount?"asset":"assets")},b.noAssetsTitle=function(){var a=b.drillDown,c=a.selectedLocation,d=c?" on location "+b.buildLocationTitle(c):"",e=a.childAssetsView?" children's":"";return"No"+e+" assets were found"+d+"."},b.noAssets=function(){return 0===(b.drillDown.assets?b.drillDown.assets.length:0)},b.assetClick=function(b){var e=f.currentDetailItemDataMap();e.assetnum=b.datamap.assetnum,e.location=b.datamap.location;var h=b.datamap.failurecode;return e.failurecode=h,h?g.findSingleByQuery("AssociationData","textindex01='"+h+"' and application = 'failurelistonly'").then(function(b){e["failurelistonly_.failurelist"]=b.datamap.failurelist,c(function(){d.goBack(),c(function(){a.$broadcast("sw:association:resolved",{failurelistonly_:{associationKey:"failurelistonly_",item:b}})},200,!1)},0,!1)}):void c(function(){return d.goBack()},0,!1)},b.loadMore=function(){e.loadMore()},e.drillDownClear(),b.drillDown=e.getDrillDown(),b.$watch("drillDown.locationQuery",function(){b.drillDown.assetView||c(function(){return e.updateDrillDownLocations()},0,!1)}),b.$watch("drillDown.assetQuery",function(){b.drillDown.assetView&&c(function(){return e.updateDrillDownAssets()},0,!1)})}]),angular.module("softwrench").directive("locationDrillDown",[function(){var a={restrict:"E",template:"<div ng-if='!context.currentDetailItem.datamap.assetnum'><button class='button button-calm button-block search-clear-button' ng-click='openDrillDown()' style='margin-bottom: 0px;'>Drill Down</button></div><textarea autosize-textarea wrap='hard' ng-model='description' ng-if='context.currentDetailItem.datamap.assetnum' ng-click='openDrillDown()' ng-readonly='true' style='cursor: pointer; color: black;'/>",transclude:!1,replace:!1,scope:{},controller:["$rootScope","$scope","routeService","drillDownService","crudContextService",function(a,b,c,d,e){b.openDrillDown=function(){c.go("main.cruddetail.locationdrilldown")},b.context=e.getCrudContext(),b.$watch("context.currentDetailItem.datamap.assetnum",function(a){b.description="",a&&d.findAsset(a).then(function(a){if(a){var c=a.datamap;b.description=c.description?c.assetnum+" - "+c.description:c.assetnum}})})}]};return a}])}(angular),function(angular){angular.module("softwrench").config(["$stateProvider",function(a){a.state("main.firstsolar",{"abstract":!0,url:"/firstsolar"}).state("main.firstsolar.userprofile",{url:"/myprofile",cache:!1,views:{"main@main":{templateUrl:"Content/Customers/templates/firstsolar_offline/templates/userprofile.html",controller:"fsUserProfile"}}})}])}(angular),function(angular){angular.module("softwrench").controller("fsUserProfile",["$scope","fsUserProfileService","routeService","$ionicPopup",function(a,b,c,d){function e(){var c=b.getUserProfileViewModel();a.profile={original:angular.copy(c),current:c}}a.hasChanges=function(){return!angular.equals(a.profile.original,a.profile.current)},a.navigateBack=function(){c.go("main.home")},a.cancel=function(){d.confirm({title:"Cancel",template:"Are you sure you want to cancel unsaved changes?"}).then(function(a){return a?e():null})},a.saveProfile=function(){b.saveUserProfile(a.profile.current).then(function(){return d.alert({title:"Success",template:"Profile Saved Successfully"})}).then(e)},e()}])}(angular),function(angular,_){function a(a,b,c,d){function e(b){return a.go("main.firstsolar.userprofile")}function f(){var a=b.currentFullUser(),d={personid:a.PersonId,username:a.UserName,siteid:a.SiteId,orgid:a.OrgId};if(!a.properties||!a.properties[h.facilities.available]||!a.properties[h.facilities.selected])return d;var e=a.properties[h.facilities.available].map(function(a){return a.toUpperCase()}),f=a.properties[h.facilities.selected].map(function(a){return a.toUpperCase()}),g=_.chain(e).map(function(a){return new c.Option(a).setChecked(_.contains(f,a))}).sortBy("value").value();return d.facilities={options:g,selected:f.join(";")},d}function g(a){var c=a.facilities.options.filter(function(a){return a.checked}).map(function(a){return a.value}),e=_defineProperty({},h.facilities.selected,c);return d.when(b.updateCurrentUserProperties(e))}var h={facilities:{available:"sync.availablefacilities",selected:"sync.facilities"}},i={goToMyProfile:e,getUserProfileViewModel:f,saveUserProfile:g};return i}angular.module("sw_mobile_services").service("fsUserProfileService",["routeService","securityService","associationConstants","$q",a])}(angular,_),function(angular){var a=864e5,b=function(){function b(){_classCallCheck(this,b)}return _createClass(b,[{key:"getTodayWosWhereClause",value:function(){var b=new Date,c=new Date(b.getFullYear(),b.getMonth(),b.getDate(),0,0,0).getTime(),d=c+a;return"`root`.dateindex01 >= "+c+" and 'root'.dateindex01 < "+d}},{key:"getPastWosWhereClause",value:function(){var a=new Date,b=new Date(a.getFullYear(),a.getMonth(),a.getDate(),0,0,0).getTime();return"`root`.dateindex01 < "+b}},{key:"getFutureWosWhereClause",value:function(){var b=new Date,c=new Date(b.getFullYear(),b.getMonth(),b.getDate(),0,0,0).getTime()+a;return"`root`.dateindex01 >= "+c}}]),b}();b.$inject=[],angular.module("maximo_offlineapplications").service("gricWorkorderOfflineService",b)}(angular);
//# sourceMappingURL=app.min.js.map